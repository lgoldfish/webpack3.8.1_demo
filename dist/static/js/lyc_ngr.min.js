/*! Copyright (c) Palmap Inc. All rights reserved. */
!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="./",e(0)}(function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(typeof t[e]){case"function":break;case"object":t[e]=function(e){var n=e.slice(1),i=t[e[0]];return function(t,e,r){i.apply(this,[t,e,r].concat(n))}}(t[e]);break;default:t[e]=t[t[e]]}return t}([function(t,e,n){t.exports=n(128)},function(t,e){/*
	object-assign
	(c) Sindre Sorhus
	@license MIT
	*/
"use strict";function n(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function i(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var i=Object.getOwnPropertyNames(e).map(function(t){return e[t]});if("0123456789"!==i.join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=i()?Object.assign:function(t,e){for(var i,s,u=n(t),l=1;l<arguments.length;l++){i=Object(arguments[l]);for(var c in i)o.call(i,c)&&(u[c]=i[c]);if(r){s=r(i);for(var h=0;h<s.length;h++)a.call(i,s[h])&&(u[s[h]]=i[s[h]])}}return u}},function(t,e,n){var i,r,o,a=n(1),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(n,a){"object"===s(e)&&"undefined"!=typeof t?a(e):(r=[e],i=a,o="function"==typeof i?i.apply(e,r):i,!(void 0!==o&&(t.exports=o)))}(void 0,function(t){"use strict";function e(t,e,n,i){this._x=t||0,this._y=e||0,this._z=n||0,this._w=void 0!==i?i:1}function n(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function i(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function r(){}function o(t,e){this.x=t||0,this.y=e||0}function u(t,e,n,i,r,a,s,l,c,h){Object.defineProperty(this,"id",{value:Zr++}),this.uuid=Wr.generateUUID(),this.name="",this.image=void 0!==t?t:u.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:u.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:Vi,this.wrapT=void 0!==i?i:Vi,this.magFilter=void 0!==r?r:Wi,this.minFilter=void 0!==a?a:Ji,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:hr,this.type=void 0!==l?l:Ki,this.offset=new o(0,0),this.repeat=new o(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:Br,this.version=0,this.onUpdate=null}function l(t,e,n,i,r,o,a,s,l,c,h,f){u.call(this,null,o,a,s,l,c,i,r,h,f),this.image={data:t,width:e,height:n},this.magFilter=void 0!==l?l:Hi,this.minFilter=void 0!==c?c:Hi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function c(t,e,n,i,r,o,a,s,l,c){t=void 0!==t?t:[],e=void 0!==e?e:Ri,u.call(this,t,e,n,i,r,o,a,s,l,c),this.flipY=!1}function h(){this.seq=[],this.map={}}function f(t,e,n){var i=t[0];if(i<=0||i>0)return t;var r=e*n,o=Qr[r];if(void 0===o&&(o=new Float32Array(r),Qr[r]=o),0!==e){i.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=n,t[a].toArray(o,s)}return o}function d(t,e){var n=$r[e];void 0===n&&(n=new Int32Array(e),$r[e]=n);for(var i=0;i!==e;++i)n[i]=t.allocTextureUnit();return n}function p(t,e){t.uniform1f(this.addr,e)}function g(t,e){t.uniform1i(this.addr,e)}function v(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function m(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function y(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function _(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function b(t,e){void 0===e.elements?t.uniformMatrix3fv(this.addr,!1,e):(eo.set(e.elements),t.uniformMatrix3fv(this.addr,!1,eo))}function x(t,e){void 0===e.elements?t.uniformMatrix4fv(this.addr,!1,e):(to.set(e.elements),t.uniformMatrix4fv(this.addr,!1,to))}function w(t,e,n){var i=n.allocTextureUnit();t.uniform1i(this.addr,i),n.setTexture2D(e||Jr,i)}function E(t,e,n){var i=n.allocTextureUnit();t.uniform1i(this.addr,i),n.setTextureCube(e||Kr,i)}function S(t,e){t.uniform2iv(this.addr,e)}function M(t,e){t.uniform3iv(this.addr,e)}function C(t,e){t.uniform4iv(this.addr,e)}function I(t){switch(t){case 5126:return p;case 35664:return v;case 35665:return m;case 35666:return y;case 35674:return _;case 35675:return b;case 35676:return x;case 35678:return w;case 35680:return E;case 5124:case 35670:return g;case 35667:case 35671:return S;case 35668:case 35672:return M;case 35669:case 35673:return C}}function O(t,e){t.uniform1fv(this.addr,e)}function T(t,e){t.uniform1iv(this.addr,e)}function P(t,e){t.uniform2fv(this.addr,f(e,this.size,2))}function A(t,e){t.uniform3fv(this.addr,f(e,this.size,3))}function L(t,e){t.uniform4fv(this.addr,f(e,this.size,4))}function N(t,e){t.uniformMatrix2fv(this.addr,!1,f(e,this.size,4))}function k(t,e){t.uniformMatrix3fv(this.addr,!1,f(e,this.size,9))}function R(t,e){t.uniformMatrix4fv(this.addr,!1,f(e,this.size,16))}function D(t,e,n){var i=e.length,r=d(n,i);t.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.setTexture2D(e[o]||Jr,r[o])}function F(t,e,n){var i=e.length,r=d(n,i);t.uniform1iv(this.addr,r);for(var o=0;o!==i;++o)n.setTextureCube(e[o]||Kr,r[o])}function B(t){switch(t){case 5126:return O;case 35664:return P;case 35665:return A;case 35666:return L;case 35674:return N;case 35675:return k;case 35676:return R;case 35678:return D;case 35680:return F;case 5124:case 35670:return T;case 35667:case 35671:return S;case 35668:case 35672:return M;case 35669:case 35673:return C}}function j(t,e,n){this.id=t,this.addr=n,this.setValue=I(e.type)}function U(t,e,n){this.id=t,this.addr=n,this.size=e.size,this.setValue=B(e.type)}function z(t){this.id=t,h.call(this)}function G(t,e){t.seq.push(e),t.map[e.id]=e}function V(t,e,n){var i=t.name,r=i.length;for(no.lastIndex=0;;){var o=no.exec(i),a=no.lastIndex,s=o[1],u="]"===o[2],l=o[3];if(u&&(s|=0),void 0===l||"["===l&&a+2===r){G(n,void 0===l?new j(s,t,e):new U(s,t,e));break}var c=n.map,h=c[s];void 0===h&&(h=new z(s),G(n,h)),n=h}}function X(t,e,n){h.call(this),this.renderer=n;for(var i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;r<i;++r){var o=t.getActiveUniform(e,r),a=o.name,s=t.getUniformLocation(e,a);V(o,s,this)}}function H(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1}function q(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}function Y(t,e,n){this.uuid=Wr.generateUUID(),this.width=t,this.height=e,this.scissor=new H(0,0,t,e),this.scissorTest=!1,this.viewport=new H(0,0,t,e),n=n||{},void 0===n.minFilter&&(n.minFilter=Wi),this.texture=new u(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function W(){Object.defineProperty(this,"id",{value:hs++}),this.uuid=Wr.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Kn,this.side=Gn,this.shading=qn,this.vertexColors=Yn,this.opacity=1,this.transparent=!1,this.blendSrc=hi,this.blendDst=fi,this.blendEquation=ni,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=xi,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.needsUpdate=!0}function Z(t){W.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function J(t){W.call(this),this.type="MeshDepthMaterial",this.depthPacking=qr,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(t)}function K(t,e){this.min=void 0!==t?t:new n(+(1/0),+(1/0),+(1/0)),this.max=void 0!==e?e:new n(-(1/0),-(1/0),-(1/0))}function Q(t,e){this.center=void 0!==t?t:new n,this.radius=void 0!==e?e:0}function $(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function tt(t,e){this.normal=void 0!==t?t:new n(1,0,0),this.constant=void 0!==e?e:0}function et(t,e,n,i,r,o){this.planes=[void 0!==t?t:new tt,void 0!==e?e:new tt,void 0!==n?n:new tt,void 0!==i?i:new tt,void 0!==r?r:new tt,void 0!==o?o:new tt]}function nt(t,e,r,a){function s(e,n,i,r){var o=e.geometry,a=null,s=x,u=e.customDepthMaterial;if(i&&(s=w,u=e.customDistanceMaterial),u)a=u;else{var l=!1;n.morphTargets&&(o&&o.isBufferGeometry?l=o.morphAttributes&&o.morphAttributes.position&&o.morphAttributes.position.length>0:o&&o.isGeometry&&(l=o.morphTargets&&o.morphTargets.length>0)),e.isSkinnedMesh&&n.skinning===!1&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e);var c=e.isSkinnedMesh&&n.skinning,h=0;l&&(h|=y),c&&(h|=_),a=s[h]}if(t.localClippingEnabled&&n.clipShadows===!0&&0!==n.clippingPlanes.length){var f=a.uuid,d=n.uuid,p=E[f];void 0===p&&(p={},E[f]=p);var g=p[d];void 0===g&&(g=a.clone(),p[d]=g),a=g}a.visible=n.visible,a.wireframe=n.wireframe;var v=n.side;return R.renderSingleSided&&v==Xn&&(v=Gn),R.renderReverseSided&&(v===Gn?v=Vn:v===Vn&&(v=Gn)),a.side=v,a.clipShadows=n.clipShadows,a.clippingPlanes=n.clippingPlanes,a.wireframeLinewidth=n.wireframeLinewidth,a.linewidth=n.linewidth,i&&void 0!==a.uniforms.lightPos&&a.uniforms.lightPos.value.copy(r),a}function u(e,n,i,o){if(e.visible!==!1){var a=e.layers.test(n.layers);if(a&&(e.isMesh||e.isLine||e.isPoints)&&e.castShadow&&(!e.frustumCulled||h.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld);var l=r.update(e),c=e.material;if(Array.isArray(c))for(var f=l.groups,d=0,p=f.length;d<p;d++){var g=f[d],v=c[g.materialIndex];if(v&&v.visible){var y=s(e,v,o,m);t.renderBufferDirect(i,null,l,y,e,g)}}else if(c.visible){var y=s(e,c,o,m);t.renderBufferDirect(i,null,l,y,e,null)}}for(var _=e.children,b=0,x=_.length;b<x;b++)u(_[b],n,i,o)}}var l=t.context,c=t.state,h=new et,f=new i,d=e.shadows,p=new o,g=new o(a.maxTextureSize,a.maxTextureSize),v=new n,m=new n,y=1,_=2,b=(y|_)+1,x=new Array(b),w=new Array(b),E={},S=[new n(1,0,0),new n(-1,0,0),new n(0,0,1),new n(0,0,-1),new n(0,1,0),new n(0,-1,0)],M=[new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,1,0),new n(0,0,1),new n(0,0,-1)],C=[new H,new H,new H,new H,new H,new H],I=new J;I.depthPacking=Yr,I.clipping=!0;for(var O=cs.distanceRGBA,T=oo.clone(O.uniforms),P=0;P!==b;++P){var A=0!==(P&y),L=0!==(P&_),N=I.clone();N.morphTargets=A,N.skinning=L,x[P]=N;var k=new Z({defines:{USE_SHADOWMAP:""},uniforms:T,vertexShader:O.vertexShader,fragmentShader:O.fragmentShader,morphTargets:A,skinning:L,clipping:!0});w[P]=k}var R=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Un,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(e,n){if(R.enabled!==!1&&(R.autoUpdate!==!1||R.needsUpdate!==!1)&&0!==d.length){c.disable(l.BLEND),c.buffers.color.setClear(1,1,1,1),c.buffers.depth.setTest(!0),c.setScissorTest(!1);for(var i,r,o=0,a=d.length;o<a;o++){var s=d[o],y=s.shadow;if(void 0!==y){var _=y.camera;if(p.copy(y.mapSize),p.min(g),s&&s.isPointLight){i=6,r=!0;var b=p.x,x=p.y;C[0].set(2*b,x,b,x),C[1].set(0,x,b,x),C[2].set(3*b,x,b,x),C[3].set(b,x,b,x),C[4].set(3*b,0,b,x),C[5].set(b,0,b,x),p.x*=4,p.y*=2}else i=1,r=!1;if(null===y.map){var w={minFilter:Hi,magFilter:Hi,format:hr};y.map=new Y(p.x,p.y,w),y.map.texture.name=s.name+".shadowMap",_.updateProjectionMatrix()}y.isSpotLightShadow&&y.update(s);var E=y.map,I=y.matrix;m.setFromMatrixPosition(s.matrixWorld),_.position.copy(m),t.setRenderTarget(E),t.clear();for(var O=0;O<i;O++){if(r){v.copy(_.position),v.add(S[O]),_.up.copy(M[O]),_.lookAt(v);var T=C[O];c.viewport(T)}else v.setFromMatrixPosition(s.target.matrixWorld),_.lookAt(v);_.updateMatrixWorld(),_.matrixWorldInverse.getInverse(_.matrixWorld),I.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),I.multiply(_.projectionMatrix),I.multiply(_.matrixWorldInverse),f.multiplyMatrices(_.projectionMatrix,_.matrixWorldInverse),h.setFromMatrix(f),u(e,n,_,r)}}else console.warn("THREE.WebGLShadowMap:",s,"has no shadow.")}var P=t.getClearColor(),A=t.getClearAlpha();t.setClearColor(P,A),R.needsUpdate=!1}}}function it(t,e){this.origin=void 0!==t?t:new n,this.direction=void 0!==e?e:new n}function rt(t,e,n,i){this._x=t||0,this._y=e||0,this._z=n||0,this._order=i||rt.DefaultOrder}function ot(){this.mask=1}function at(){function t(){s.setFromEuler(a,!1)}function r(){a.setFromQuaternion(s,void 0,!1)}Object.defineProperty(this,"id",{value:fs++}),this.uuid=Wr.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=at.DefaultUp.clone();var o=new n,a=new rt,s=new e,u=new n(1,1,1);a.onChange(t),s.onChange(r),Object.defineProperties(this,{position:{enumerable:!0,value:o},rotation:{enumerable:!0,value:a},quaternion:{enumerable:!0,value:s},scale:{enumerable:!0,value:u},modelViewMatrix:{value:new i},normalMatrix:{value:new $}}),this.matrix=new i,this.matrixWorld=new i,this.matrixAutoUpdate=at.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ot,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={},this.onBeforeRender=function(){},this.onAfterRender=function(){}}function st(t,e){this.start=void 0!==t?t:new n,this.end=void 0!==e?e:new n}function ut(t,e,i){this.a=void 0!==t?t:new n,this.b=void 0!==e?e:new n,this.c=void 0!==i?i:new n}function lt(t,e,i,r,o,a){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new n,this.vertexNormals=Array.isArray(r)?r:[],this.color=o&&o.isColor?o:new q,this.vertexColors=Array.isArray(o)?o:[],this.materialIndex=void 0!==a?a:0}function ct(t){W.call(this),this.type="MeshBasicMaterial",this.color=new q(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ci,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(t)}function ht(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Wr.generateUUID(),this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=n===!0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function ft(t,e){ht.call(this,new Int8Array(t),e)}function dt(t,e){ht.call(this,new Uint8Array(t),e)}function pt(t,e){ht.call(this,new Uint8ClampedArray(t),e)}function gt(t,e){ht.call(this,new Int16Array(t),e)}function vt(t,e){ht.call(this,new Uint16Array(t),e)}function mt(t,e){ht.call(this,new Int32Array(t),e)}function yt(t,e){ht.call(this,new Uint32Array(t),e)}function _t(t,e){ht.call(this,new Float32Array(t),e)}function bt(t,e){ht.call(this,new Float64Array(t),e)}function xt(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function wt(t){if(0===t.length)return-(1/0);for(var e=t[0],n=1,i=t.length;n<i;++n)t[n]>e&&(e=t[n]);return e}function Et(){return ds++}function St(){Object.defineProperty(this,"id",{value:Et()}),this.uuid=Wr.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Mt(){Object.defineProperty(this,"id",{value:Et()}),this.uuid=Wr.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Ct(t,e){at.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Mt,this.material=void 0!==e?e:new ct({color:16777215*Math.random()}),this.drawMode=Rr,this.updateMorphTargets()}function It(t,e,i,r,o,a){function s(t,e,i,r,o,a,s,g,v,m,y){var _,b,x=a/v,w=s/m,E=a/2,S=s/2,M=g/2,C=v+1,I=m+1,O=0,T=0,P=new n;for(b=0;b<I;b++){var A=b*w-S;for(_=0;_<C;_++){var L=_*x-E;P[t]=L*r,P[e]=A*o,P[i]=M,c.push(P.x,P.y,P.z),P[t]=0,P[e]=0,P[i]=g>0?1:-1,h.push(P.x,P.y,P.z),f.push(_/v),f.push(1-b/m),O+=1}}for(b=0;b<m;b++)for(_=0;_<v;_++){var N=d+_+C*b,k=d+_+C*(b+1),R=d+(_+1)+C*(b+1),D=d+(_+1)+C*b;l.push(N,k,D),l.push(k,R,D),T+=6}u.addGroup(p,T,y),p+=T,d+=O}Mt.call(this),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:o,depthSegments:a};var u=this;r=Math.floor(r)||1,o=Math.floor(o)||1,a=Math.floor(a)||1;var l=[],c=[],h=[],f=[],d=0,p=0;s("z","y","x",-1,-1,i,e,t,a,o,0),s("z","y","x",1,-1,i,e,-t,a,o,1),s("x","z","y",1,1,t,i,e,r,a,2),s("x","z","y",1,-1,t,i,-e,r,a,3),s("x","y","z",1,-1,t,e,i,r,o,4),s("x","y","z",-1,-1,t,e,-i,r,o,5),this.setIndex(l),this.addAttribute("position",new _t(c,3)),this.addAttribute("normal",new _t(h,3)),this.addAttribute("uv",new _t(f,2))}function Ot(t,e,n,i){Mt.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};var r,o,a=t/2,s=e/2,u=Math.floor(n)||1,l=Math.floor(i)||1,c=u+1,h=l+1,f=t/u,d=e/l,p=[],g=[],v=[],m=[];for(o=0;o<h;o++){var y=o*d-s;for(r=0;r<c;r++){var _=r*f-a;g.push(_,-y,0),v.push(0,0,1),m.push(r/u),m.push(1-o/l)}}for(o=0;o<l;o++)for(r=0;r<u;r++){var b=r+c*o,x=r+c*(o+1),w=r+1+c*(o+1),E=r+1+c*o;p.push(b,x,E),p.push(x,w,E)}this.setIndex(p),this.addAttribute("position",new _t(g,3)),this.addAttribute("normal",new _t(v,3)),this.addAttribute("uv",new _t(m,2))}function Tt(){at.call(this),this.type="Camera",this.matrixWorldInverse=new i,this.projectionMatrix=new i}function Pt(t,e,n,i){Tt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function At(t,e,n,i,r,o){Tt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Lt(t){function e(e,n){var i=e.array,r=e.dynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW,o=t.createBuffer();t.bindBuffer(n,o),t.bufferData(n,i,r),e.onUploadCallback();var a=t.FLOAT;return i instanceof Float32Array?a=t.FLOAT:i instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):i instanceof Uint16Array?a=t.UNSIGNED_SHORT:i instanceof Int16Array?a=t.SHORT:i instanceof Uint32Array?a=t.UNSIGNED_INT:i instanceof Int32Array?a=t.INT:i instanceof Int8Array?a=t.BYTE:i instanceof Uint8Array&&(a=t.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version}}function n(e,n,i){var r=n.array,o=n.updateRange;t.bindBuffer(i,e),n.dynamic===!1?t.bufferData(i,r,t.STATIC_DRAW):o.count===-1?t.bufferSubData(i,0,r):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(t.bufferSubData(i,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=0)}function i(t){return t.isInterleavedBufferAttribute&&(t=t.data),a[t.uuid]}function r(e){var n=a[e.uuid];n&&(t.deleteBuffer(n.buffer),delete a[e.uuid])}function o(t,i){t.isInterleavedBufferAttribute&&(t=t.data);var r=a[t.uuid];void 0===r?a[t.uuid]=e(t,i):r.version<t.version&&(n(r.buffer,t,i),r.version=t.version)}var a={};return{get:i,remove:r,update:o}}function Nt(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program&&e.program&&t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function kt(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Rt(){function t(){o=-1,s=-1}function e(t,e,n,i,u){var l,c;n.transparent?(l=a,c=++s):(l=r,c=++o);var h=l[c];h?(h.id=t.id,h.object=t,h.geometry=e,h.material=n,h.program=n.program,h.renderOrder=t.renderOrder,h.z=i,h.group=u):(h={id:t.id,object:t,geometry:e,material:n,program:n.program,renderOrder:t.renderOrder,z:i,group:u},l.push(h))}function n(){r.length=o+1,a.length=s+1}function i(){r.sort(Nt),a.sort(kt)}var r=[],o=-1,a=[],s=-1;return{opaque:r,transparent:a,init:t,push:e,finish:n,sort:i}}function Dt(){function t(t,e){var i=t.id+","+e.id,r=n[i];return void 0===r&&(console.log("THREE.WebGLRenderLists:",i),r=new Rt,n[i]=r),r}function e(){n={}}var n={};return{get:t,dispose:e}}function Ft(t,e,n){function i(t){s=t}function r(n){n.array instanceof Uint32Array&&e.get("OES_element_index_uint")?(u=t.UNSIGNED_INT,l=4):n.array instanceof Uint16Array?(u=t.UNSIGNED_SHORT,l=2):(u=t.UNSIGNED_BYTE,l=1)}function o(e,i){t.drawElements(s,i,u,e*l),n.calls++,n.vertices+=i,s===t.TRIANGLES&&(n.faces+=i/3)}function a(i,r,o){var a=e.get("ANGLE_instanced_arrays");return null===a?void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(a.drawElementsInstancedANGLE(s,o,u,r*l,i.maxInstancedCount),n.calls++,n.vertices+=o*i.maxInstancedCount,void(s===t.TRIANGLES&&(n.faces+=i.maxInstancedCount*o/3)))}var s,u,l;this.setMode=i,this.setIndex=r,this.render=o,this.renderInstances=a}function Bt(t,e,n){function i(t){a=t}function r(e,i){t.drawArrays(a,e,i),n.calls++,n.vertices+=i,a===t.TRIANGLES&&(n.faces+=i/3)}function o(i,r,o){var s=e.get("ANGLE_instanced_arrays");if(null===s)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var u=i.attributes.position;u.isInterleavedBufferAttribute?(o=u.data.count,s.drawArraysInstancedANGLE(a,0,o,i.maxInstancedCount)):s.drawArraysInstancedANGLE(a,r,o,i.maxInstancedCount),n.calls++,n.vertices+=o*i.maxInstancedCount,a===t.TRIANGLES&&(n.faces+=i.maxInstancedCount*o/3)}var a;this.setMode=i,this.render=r,this.renderInstances=o}function jt(t,e,n){function i(t){var r=t.target,o=s[r.id];null!==o.index&&e.remove(o.index);for(var a in o.attributes)e.remove(o.attributes[a]);r.removeEventListener("dispose",i),delete s[r.id];var l=u[r.id];l&&(e.remove(l),delete u[r.id]),l=u[o.id],l&&(e.remove(l),delete u[o.id]),n.geometries--}function r(t,e){var r=s[e.id];return r?r:(e.addEventListener("dispose",i),e.isBufferGeometry?r=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Mt).setFromObject(t)),r=e._bufferGeometry),s[e.id]=r,n.geometries++,r)}function o(n){var i=n.index,r=n.attributes;null!==i&&e.update(i,t.ELEMENT_ARRAY_BUFFER);for(var o in r)e.update(r[o],t.ARRAY_BUFFER);var a=n.morphAttributes;for(var o in a)for(var s=a[o],u=0,l=s.length;u<l;u++)e.update(s[u],t.ARRAY_BUFFER)}function a(n){var i=u[n.id];if(i)return i;var r=[],o=n.index,a=n.attributes;if(null!==o)for(var s=o.array,l=0,c=s.length;l<c;l+=3){var h=s[l+0],f=s[l+1],d=s[l+2];r.push(h,f,f,d,d,h)}else for(var s=a.position.array,l=0,c=s.length/3-1;l<c;l+=3){var h=l+0,f=l+1,d=l+2;r.push(h,f,f,d,d,h)}return i=new(wt(r)>65535?yt:vt)(r,1),e.update(i,t.ELEMENT_ARRAY_BUFFER),u[n.id]=i,i}var s={},u={};return{get:r,update:o,getWireframeAttribute:a}}function Ut(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var i;switch(e.type){case"DirectionalLight":i={direction:new n,color:new q,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"SpotLight":i={position:new n,direction:new n,color:new q,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"PointLight":i={position:new n,color:new q,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new o};break;case"HemisphereLight":i={direction:new n,skyColor:new q,groundColor:new q};break;case"RectAreaLight":i={color:new q,position:new n,halfWidth:new n,halfHeight:new n}}return t[e.id]=i,i}}}function zt(t,e,n){function i(t){var i=n.frame,r=t.geometry,a=e.get(t,r);return o[a.id]!==i&&(r.isGeometry&&a.updateFromObject(t),e.update(a),o[a.id]=i),a}function r(){o={}}var o={};return{update:i,clear:r}}function Gt(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}function Vt(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(i),Gt(n)),i}function Xt(t){switch(t){case Br:return["Linear","( value )"];case jr:return["sRGB","( value )"];case zr:return["RGBE","( value )"];case Vr:return["RGBM","( value, 7.0 )"];case Xr:return["RGBM","( value, 16.0 )"];case Hr:return["RGBD","( value, 256.0 )"];case Ur:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+t)}}function Ht(t,e){var n=Xt(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function qt(t,e){var n=Xt(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Yt(t,e){var n;switch(e){case Pi:n="Linear";break;case Ai:n="Reinhard";break;case Li:n="Uncharted2";break;case Ni:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Wt(t,e,n){t=t||{};var i=[t.derivatives||e.envMapCubeUV||e.bumpMap||e.normalMap||e.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(t.fragDepth||e.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",t.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(t.shaderTextureLOD||e.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return i.filter(Kt).join("\n")}function Zt(t){var e=[];for(var n in t){var i=t[n];i!==!1&&e.push("#define "+n+" "+i)}return e.join("\n")}function Jt(t,e,n){for(var i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<r;o++){var a=t.getActiveAttrib(e,o),s=a.name;i[s]=t.getAttribLocation(e,s)}return i}function Kt(t){return""!==t}function Qt(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights)}function $t(t){function e(t,e){var n=ls[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return $t(n)}var n=/^\s*#include +<([\w\d.]+)>/gm;return t.replace(n,e)}function te(t){function e(t,e,n,i){for(var r="",o=parseInt(e);o<parseInt(n);o++)r+=i.replace(/\[ i \]/g,"[ "+o+" ]");return r}var n=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return t.replace(n,e)}function ee(t,e,n,i){var r=t.context,o=n.extensions,a=n.defines,s=n.__webglShader.vertexShader,u=n.__webglShader.fragmentShader,l="SHADOWMAP_TYPE_BASIC";i.shadowMapType===Un?l="SHADOWMAP_TYPE_PCF":i.shadowMapType===zn&&(l="SHADOWMAP_TYPE_PCF_SOFT");var c="ENVMAP_TYPE_CUBE",h="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(i.envMap){switch(n.envMap.mapping){case Ri:case Di:c="ENVMAP_TYPE_CUBE";break;case Ui:case zi:c="ENVMAP_TYPE_CUBE_UV";break;case Fi:case Bi:c="ENVMAP_TYPE_EQUIREC";break;case ji:c="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case Di:case Bi:h="ENVMAP_MODE_REFRACTION"}switch(n.combine){case Ci:f="ENVMAP_BLENDING_MULTIPLY";break;case Ii:f="ENVMAP_BLENDING_MIX";break;case Oi:f="ENVMAP_BLENDING_ADD"}}var d,p,g=t.gammaFactor>0?t.gammaFactor:1,v=Wt(o,i,t.extensions),m=Zt(a),y=r.createProgram();n.isRawShaderMaterial?(d=[m,"\n"].filter(Kt).join("\n"),p=[v,m,"\n"].filter(Kt).join("\n")):(d=["precision "+i.precision+" float;","precision "+i.precision+" int;","#define SHADER_NAME "+n.__webglShader.name,m,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+h:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+i.numClippingPlanes,i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Kt).join("\n"),p=[v,"precision "+i.precision+" float;","precision "+i.precision+" int;","#define SHADER_NAME "+n.__webglShader.name,m,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"","#define GAMMA_FACTOR "+g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+h:"",i.envMap?"#define "+f:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+i.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(i.numClippingPlanes-i.numClipIntersection),i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&t.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",i.envMap&&t.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",i.toneMapping!==Ti?"#define TONE_MAPPING":"",i.toneMapping!==Ti?ls.tonemapping_pars_fragment:"",i.toneMapping!==Ti?Yt("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.dithering?ls.dithering_pars_fragment:"",i.outputEncoding||i.mapEncoding||i.envMapEncoding||i.emissiveMapEncoding?ls.encodings_pars_fragment:"",i.mapEncoding?Ht("mapTexelToLinear",i.mapEncoding):"",i.envMapEncoding?Ht("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMapEncoding?Ht("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.outputEncoding?qt("linearToOutputTexel",i.outputEncoding):"",i.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Kt).join("\n")),
s=$t(s,i),s=Qt(s,i),u=$t(u,i),u=Qt(u,i),n.isShaderMaterial||(s=te(s),u=te(u));var _=d+s,b=p+u,x=Vt(r,r.VERTEX_SHADER,_),w=Vt(r,r.FRAGMENT_SHADER,b);r.attachShader(y,x),r.attachShader(y,w),void 0!==n.index0AttributeName?r.bindAttribLocation(y,0,n.index0AttributeName):i.morphTargets===!0&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y);var E=r.getProgramInfoLog(y),S=r.getShaderInfoLog(x),M=r.getShaderInfoLog(w),C=!0,I=!0;r.getProgramParameter(y,r.LINK_STATUS)===!1?(C=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(y,r.VALIDATE_STATUS),"gl.getProgramInfoLog",E,S,M)):""!==E?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",E):""!==S&&""!==M||(I=!1),I&&(this.diagnostics={runnable:C,material:n,programLog:E,vertexShader:{log:S,prefix:d},fragmentShader:{log:M,prefix:p}}),r.deleteShader(x),r.deleteShader(w);var O;this.getUniforms=function(){return void 0===O&&(O=new X(r,y,t)),O};var T;return this.getAttributes=function(){return void 0===T&&(T=Jt(r,y)),T},this.destroy=function(){r.deleteProgram(y),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=ps++,this.code=e,this.usedTimes=1,this.program=y,this.vertexShader=x,this.fragmentShader=w,this}function ne(t,e){function n(t){var n=t.skeleton,i=n.bones;if(e.floatVertexTextures)return 1024;var r=e.maxVertexUniforms,o=Math.floor((r-20)/4),a=Math.min(o,i.length);return a<i.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+i.length+" bones. This GPU supports "+a+"."),0):a}function i(t,e){var n;return t?t.isTexture?n=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=t.texture.encoding):n=Br,n===Br&&e&&(n=Ur),n}var r=[],o={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},a=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(r,a,s,u,l,c){var h=o[r.type],f=c.isSkinnedMesh?n(c):0,d=t.getPrecision();null!==r.precision&&(d=e.getMaxPrecision(r.precision),d!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",d,"instead."));var p=t.getRenderTarget(),g={shaderID:h,precision:d,supportsVertexTextures:e.vertexTextures,outputEncoding:i(p?p.texture:null,t.gammaOutput),map:!!r.map,mapEncoding:i(r.map,t.gammaInput),envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,envMapEncoding:i(r.envMap,t.gammaInput),envMapCubeUV:!!r.envMap&&(r.envMap.mapping===Ui||r.envMap.mapping===zi),lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:i(r.emissiveMap,t.gammaInput),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,combine:r.combine,vertexColors:r.vertexColors,fog:!!s,useFog:r.fog,fogExp:s&&s.isFogExp2,flatShading:r.shading===Hn,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:e.logarithmicDepthBuffer,skinning:r.skinning&&f>0,maxBones:f,useVertexTexture:e.floatVertexTextures,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numClippingPlanes:u,numClipIntersection:l,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&c.receiveShadow&&a.shadows.length>0,shadowMapType:t.shadowMap.type,toneMapping:t.toneMapping,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===Xn,flipSided:r.side===Vn,depthPacking:void 0!==r.depthPacking&&r.depthPacking};return g},this.getProgramCode=function(t,e){var n=[];if(e.shaderID?n.push(e.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)n.push(i),n.push(t.defines[i]);for(var r=0;r<a.length;r++)n.push(e[a[r]]);return n.join()},this.acquireProgram=function(e,n,i){for(var o,a=0,s=r.length;a<s;a++){var u=r[a];if(u.code===i){o=u,++o.usedTimes;break}}return void 0===o&&(o=new ee(t,i,e,n),r.push(o)),o},this.releaseProgram=function(t){if(0===--t.usedTimes){var e=r.indexOf(t);r[e]=r[r.length-1],r.pop(),t.destroy()}},this.programs=r}function ie(t,e,n,i,r,o,a){function s(t,e){if(t.width>e||t.height>e){var n=e/Math.max(t.width,t.height),i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=Math.floor(t.width*n),i.height=Math.floor(t.height*n);var r=i.getContext("2d");return r.drawImage(t,0,0,t.width,t.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+t.width+"x"+t.height+"). Resized to "+i.width+"x"+i.height,t),i}return t}function u(t){return Wr.isPowerOfTwo(t.width)&&Wr.isPowerOfTwo(t.height)}function l(t){if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");e.width=Wr.nearestPowerOfTwo(t.width),e.height=Wr.nearestPowerOfTwo(t.height);var n=e.getContext("2d");return n.drawImage(t,0,0,e.width,e.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+t.width+"x"+t.height+"). Resized to "+e.width+"x"+e.height,t),e}return t}function c(t){return t.wrapS!==Vi||t.wrapT!==Vi||t.minFilter!==Hi&&t.minFilter!==Wi}function h(e){return e===Hi||e===qi||e===Yi?t.NEAREST:t.LINEAR}function f(t){var e=t.target;e.removeEventListener("dispose",f),p(e),a.textures--}function d(t){var e=t.target;e.removeEventListener("dispose",d),g(e),a.textures--}function p(e){var n=i.get(e);if(e.image&&n.__image__webglTextureCube)t.deleteTexture(n.__image__webglTextureCube);else{if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture)}i.remove(e)}function g(e){var n=i.get(e),r=i.get(e.texture);if(e){if(void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture),e.depthTexture&&e.depthTexture.dispose(),e.isWebGLRenderTargetCube)for(var o=0;o<6;o++)t.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[o]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer);i.remove(e.texture),i.remove(e)}}function v(e,r){var o=i.get(e);if(e.version>0&&o.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",e);else{if(a.complete!==!1)return void b(o,e,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",e)}}n.activeTexture(t.TEXTURE0+r),n.bindTexture(t.TEXTURE_2D,o.__webglTexture)}function m(e,l){var c=i.get(e);if(6===e.image.length)if(e.version>0&&c.__version!==e.version){c.__image__webglTextureCube||(e.addEventListener("dispose",f),c.__image__webglTextureCube=t.createTexture(),a.textures++),n.activeTexture(t.TEXTURE0+l),n.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var h=e&&e.isCompressedTexture,d=e.image[0]&&e.image[0].isDataTexture,p=[],g=0;g<6;g++)h||d?p[g]=d?e.image[g].image:e.image[g]:p[g]=s(e.image[g],r.maxCubemapSize);var v=p[0],m=u(v),y=o(e.format),b=o(e.type);_(t.TEXTURE_CUBE_MAP,e,m);for(var g=0;g<6;g++)if(h)for(var x,w=p[g].mipmaps,E=0,S=w.length;E<S;E++)x=w[E],e.format!==hr&&e.format!==cr?n.getCompressedTextureFormats().indexOf(y)>-1?n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,E,y,x.width,x.height,0,x.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,E,y,x.width,x.height,0,y,b,x.data);else d?n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,y,p[g].width,p[g].height,0,y,b,p[g].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,y,y,b,p[g]);e.generateMipmaps&&m&&t.generateMipmap(t.TEXTURE_CUBE_MAP),c.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(t.TEXTURE0+l),n.bindTexture(t.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)}function y(e,r){n.activeTexture(t.TEXTURE0+r),n.bindTexture(t.TEXTURE_CUBE_MAP,i.get(e).__webglTexture)}function _(n,a,s){var u;if(s?(t.texParameteri(n,t.TEXTURE_WRAP_S,o(a.wrapS)),t.texParameteri(n,t.TEXTURE_WRAP_T,o(a.wrapT)),t.texParameteri(n,t.TEXTURE_MAG_FILTER,o(a.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,o(a.minFilter))):(t.texParameteri(n,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(n,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),a.wrapS===Vi&&a.wrapT===Vi||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",a),t.texParameteri(n,t.TEXTURE_MAG_FILTER,h(a.magFilter)),t.texParameteri(n,t.TEXTURE_MIN_FILTER,h(a.minFilter)),a.minFilter!==Hi&&a.minFilter!==Wi&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",a)),u=e.get("EXT_texture_filter_anisotropic")){if(a.type===ir&&null===e.get("OES_texture_float_linear"))return;if(a.type===rr&&null===e.get("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(t.texParameterf(n,u.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function b(e,i,h){void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",f),e.__webglTexture=t.createTexture(),a.textures++),n.activeTexture(t.TEXTURE0+h),n.bindTexture(t.TEXTURE_2D,e.__webglTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,i.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,i.unpackAlignment);var d=s(i.image,r.maxTextureSize);c(i)&&u(d)===!1&&(d=l(d));var p=u(d),g=o(i.format),v=o(i.type);_(t.TEXTURE_2D,i,p);var m,y=i.mipmaps;if(i.isDepthTexture){var b=t.DEPTH_COMPONENT;if(i.type===ir){if(!I)throw new Error("Float Depth Texture only supported in WebGL2.0");b=t.DEPTH_COMPONENT32F}else I&&(b=t.DEPTH_COMPONENT16);i.format===gr&&b===t.DEPTH_COMPONENT&&i.type!==tr&&i.type!==nr&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=tr,v=o(i.type)),i.format===vr&&(b=t.DEPTH_STENCIL,i.type!==ur&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ur,v=o(i.type))),n.texImage2D(t.TEXTURE_2D,0,b,d.width,d.height,0,g,v,null)}else if(i.isDataTexture)if(y.length>0&&p){for(var x=0,w=y.length;x<w;x++)m=y[x],n.texImage2D(t.TEXTURE_2D,x,g,m.width,m.height,0,g,v,m.data);i.generateMipmaps=!1}else n.texImage2D(t.TEXTURE_2D,0,g,d.width,d.height,0,g,v,d.data);else if(i.isCompressedTexture)for(var x=0,w=y.length;x<w;x++)m=y[x],i.format!==hr&&i.format!==cr?n.getCompressedTextureFormats().indexOf(g)>-1?n.compressedTexImage2D(t.TEXTURE_2D,x,g,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(t.TEXTURE_2D,x,g,m.width,m.height,0,g,v,m.data);else if(y.length>0&&p){for(var x=0,w=y.length;x<w;x++)m=y[x],n.texImage2D(t.TEXTURE_2D,x,g,g,v,m);i.generateMipmaps=!1}else n.texImage2D(t.TEXTURE_2D,0,g,g,v,d);i.generateMipmaps&&p&&t.generateMipmap(t.TEXTURE_2D),e.__version=i.version,i.onUpdate&&i.onUpdate(i)}function x(e,r,a,s){var u=o(r.texture.format),l=o(r.texture.type);n.texImage2D(s,0,u,r.width,r.height,0,u,l,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,a,s,i.get(r.texture).__webglTexture,0),t.bindFramebuffer(t.FRAMEBUFFER,null)}function w(e,n){t.bindRenderbuffer(t.RENDERBUFFER,e),n.depthBuffer&&!n.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)):n.depthBuffer&&n.stencilBuffer?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,n.width,n.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)):t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,n.width,n.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}function E(e,n){var r=n&&n.isWebGLRenderTargetCube;if(r)throw new Error("Depth Texture with cube render targets is not supported!");if(t.bindFramebuffer(t.FRAMEBUFFER,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),v(n.depthTexture,0);var o=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===gr)t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,o,0);else{if(n.depthTexture.format!==vr)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,o,0)}}function S(e){var n=i.get(e),r=e.isWebGLRenderTargetCube===!0;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");E(n.__webglFramebuffer,e)}else if(r){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=t.createRenderbuffer(),w(n.__webglDepthbuffer[o],e)}else t.bindFramebuffer(t.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),w(n.__webglDepthbuffer,e);t.bindFramebuffer(t.FRAMEBUFFER,null)}function M(e){var r=i.get(e),o=i.get(e.texture);e.addEventListener("dispose",d),o.__webglTexture=t.createTexture(),a.textures++;var s=e.isWebGLRenderTargetCube===!0,l=u(e);if(s){r.__webglFramebuffer=[];for(var c=0;c<6;c++)r.__webglFramebuffer[c]=t.createFramebuffer()}else r.__webglFramebuffer=t.createFramebuffer();if(s){n.bindTexture(t.TEXTURE_CUBE_MAP,o.__webglTexture),_(t.TEXTURE_CUBE_MAP,e.texture,l);for(var c=0;c<6;c++)x(r.__webglFramebuffer[c],e,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+c);e.texture.generateMipmaps&&l&&t.generateMipmap(t.TEXTURE_CUBE_MAP),n.bindTexture(t.TEXTURE_CUBE_MAP,null)}else n.bindTexture(t.TEXTURE_2D,o.__webglTexture),_(t.TEXTURE_2D,e.texture,l),x(r.__webglFramebuffer,e,t.COLOR_ATTACHMENT0,t.TEXTURE_2D),e.texture.generateMipmaps&&l&&t.generateMipmap(t.TEXTURE_2D),n.bindTexture(t.TEXTURE_2D,null);e.depthBuffer&&S(e)}function C(e){var r=e.texture;if(r.generateMipmaps&&u(e)&&r.minFilter!==Hi&&r.minFilter!==Wi){var o=e&&e.isWebGLRenderTargetCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,a=i.get(r).__webglTexture;n.bindTexture(o,a),t.generateMipmap(o),n.bindTexture(o,null)}}var I="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext;this.setTexture2D=v,this.setTextureCube=m,this.setTextureCubeDynamic=y,this.setupRenderTarget=M,this.updateRenderTargetMipmap=C}function re(){function t(t){var e=t.uuid,n=i[e];return void 0===n&&(n={},i[e]=n),n}function e(t){delete i[t.uuid]}function n(){i={}}var i={};return{get:t,remove:e,clear:n}}function oe(t,e,n){function i(){var e=!1,n=new H,i=null,r=new H;return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,o,a,s){s===!0&&(e*=a,i*=a,o*=a),n.set(e,i,o,a),r.equals(n)===!1&&(t.clearColor(e,i,o,a),r.copy(n))},reset:function(){e=!1,i=null,r.set(0,0,0,1)}}}function r(){var e=!1,n=null,i=null,r=null;return{setTest:function(e){e?f(t.DEPTH_TEST):d(t.DEPTH_TEST)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case yi:t.depthFunc(t.NEVER);break;case _i:t.depthFunc(t.ALWAYS);break;case bi:t.depthFunc(t.LESS);break;case xi:t.depthFunc(t.LEQUAL);break;case wi:t.depthFunc(t.EQUAL);break;case Ei:t.depthFunc(t.GEQUAL);break;case Si:t.depthFunc(t.GREATER);break;case Mi:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}else t.depthFunc(t.LEQUAL);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}}function o(){var e=!1,n=null,i=null,r=null,o=null,a=null,s=null,u=null,l=null;return{setTest:function(e){e?f(t.STENCIL_TEST):d(t.STENCIL_TEST)},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,a){i===e&&r===n&&o===a||(t.stencilFunc(e,n,a),i=e,r=n,o=a)},setOp:function(e,n,i){a===e&&s===n&&u===i||(t.stencilOp(e,n,i),a=e,s=n,u=i)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,i=null,r=null,o=null,a=null,s=null,u=null,l=null}}}function a(e,n,i){var r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(var a=0;a<i;a++)t.texImage2D(n+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return o}function s(){P.setClear(0,0,0,1),A.setClear(1),L.setClear(0),f(t.DEPTH_TEST),A.setFunc(xi),m(!1),y(kn),f(t.CULL_FACE),f(t.BLEND),g(Kn)}function u(){for(var t=0,e=k.length;t<e;t++)k[t]=0}function l(n){if(k[n]=1,0===R[n]&&(t.enableVertexAttribArray(n),R[n]=1),0!==D[n]){var i=e.get("ANGLE_instanced_arrays");i.vertexAttribDivisorANGLE(n,0),D[n]=0}}function c(n,i){if(k[n]=1,0===R[n]&&(t.enableVertexAttribArray(n),R[n]=1),D[n]!==i){var r=e.get("ANGLE_instanced_arrays");r.vertexAttribDivisorANGLE(n,i),D[n]=i}}function h(){for(var e=0,n=R.length;e!==n;++e)R[e]!==k[e]&&(t.disableVertexAttribArray(e),R[e]=0)}function f(e){F[e]!==!0&&(t.enable(e),F[e]=!0)}function d(e){F[e]!==!1&&(t.disable(e),F[e]=!1)}function p(){if(null===B&&(B=[],e.get("WEBGL_compressed_texture_pvrtc")||e.get("WEBGL_compressed_texture_s3tc")||e.get("WEBGL_compressed_texture_etc1")))for(var n=t.getParameter(t.COMPRESSED_TEXTURE_FORMATS),i=0;i<n.length;i++)B.push(n[i]);return B}function g(e,i,r,o,a,s,u,l){e!==Jn?f(t.BLEND):d(t.BLEND),e===j&&l===Y||(e===Qn?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)):e===$n?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR)):e===ti?l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)):(t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR)):l?(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)):(t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)),j=e,Y=l),e===ei?(a=a||i,s=s||r,u=u||o,i===U&&a===V||(t.blendEquationSeparate(n(i),n(a)),U=i,V=a),r===z&&o===G&&s===X&&u===q||(t.blendFuncSeparate(n(r),n(o),n(s),n(u)),z=r,G=o,X=s,q=u)):(U=null,z=null,G=null,V=null,X=null,q=null)}function v(e){e.side===Xn?d(t.CULL_FACE):f(t.CULL_FACE),m(e.side===Vn),e.transparent===!0?g(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha):g(Jn),A.setFunc(e.depthFunc),A.setTest(e.depthTest),A.setMask(e.depthWrite),P.setMask(e.colorWrite),b(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)}function m(e){W!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),W=e)}function y(e){e!==Nn?(f(t.CULL_FACE),e!==Z&&(e===kn?t.cullFace(t.BACK):e===Rn?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):d(t.CULL_FACE),Z=e}function _(e){e!==J&&(nt&&t.lineWidth(e),J=e)}function b(e,n,i){e?(f(t.POLYGON_OFFSET_FILL),K===n&&Q===i||(t.polygonOffset(n,i),K=n,Q=i)):d(t.POLYGON_OFFSET_FILL)}function x(){return $}function w(e){$=e,e?f(t.SCISSOR_TEST):d(t.SCISSOR_TEST)}function E(e){void 0===e&&(e=t.TEXTURE0+tt-1),it!==e&&(t.activeTexture(e),it=e)}function S(e,n){null===it&&E();var i=rt[it];void 0===i&&(i={type:void 0,texture:void 0},rt[it]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||st[e]),i.type=e,i.texture=n)}function M(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error(t)}}function C(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error(t)}}function I(e){ot.equals(e)===!1&&(t.scissor(e.x,e.y,e.z,e.w),ot.copy(e))}function O(e){at.equals(e)===!1&&(t.viewport(e.x,e.y,e.z,e.w),at.copy(e))}function T(){for(var e=0;e<R.length;e++)1===R[e]&&(t.disableVertexAttribArray(e),R[e]=0);F={},B=null,it=null,rt={},j=null,W=null,Z=null,P.reset(),A.reset(),L.reset()}var P=new i,A=new r,L=new o,N=t.getParameter(t.MAX_VERTEX_ATTRIBS),k=new Uint8Array(N),R=new Uint8Array(N),D=new Uint8Array(N),F={},B=null,j=null,U=null,z=null,G=null,V=null,X=null,q=null,Y=!1,W=null,Z=null,J=null,K=null,Q=null,$=null,tt=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),et=parseFloat(/^WebGL\ ([0-9])/.exec(t.getParameter(t.VERSION))[1]),nt=parseFloat(et)>=1,it=null,rt={},ot=new H,at=new H,st={};return st[t.TEXTURE_2D]=a(t.TEXTURE_2D,t.TEXTURE_2D,1),st[t.TEXTURE_CUBE_MAP]=a(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:P,depth:A,stencil:L},init:s,initAttributes:u,enableAttribute:l,enableAttributeAndDivisor:c,disableUnusedAttributes:h,enable:f,disable:d,getCompressedTextureFormats:p,setBlending:g,setMaterial:v,setFlipSided:m,setCullFace:y,setLineWidth:_,setPolygonOffset:b,getScissorTest:x,setScissorTest:w,activeTexture:E,bindTexture:S,compressedTexImage2D:M,texImage2D:C,scissor:I,viewport:O,reset:T}}function ae(t,e,n){function i(){if(void 0!==o)return o;var n=e.get("EXT_texture_filter_anisotropic");return o=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o,a=void 0!==n.precision?n.precision:"highp",s=r(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var u=n.logarithmicDepthBuffer===!0&&!!e.get("EXT_frag_depth"),l=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),c=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=t.getParameter(t.MAX_TEXTURE_SIZE),f=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),d=t.getParameter(t.MAX_VERTEX_ATTRIBS),p=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),v=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),m=c>0,y=!!e.get("OES_texture_float"),_=m&&y;return{getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:p,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:m,floatFragmentTextures:y,floatVertexTextures:_}}function se(t){var e={};return{get:function(n){if(void 0!==e[n])return e[n];var i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":i=t.getExtension("WEBGL_compressed_texture_etc1");break;default:i=t.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=i,i}}}function ue(){function t(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),n.numPlanes=r,n.numIntersection=0}function e(t,e,i,r){var o=null!==t?t.length:0,a=null;if(0!==o){if(a=l.value,r!==!0||null===a){var c=i+4*o,h=e.matrixWorldInverse;u.getNormalMatrix(h),(null===a||a.length<c)&&(a=new Float32Array(c));for(var f=0,d=i;f!==o;++f,d+=4)s.copy(t[f]).applyMatrix4(h,u),s.normal.toArray(a,d),a[d+3]=s.constant}l.value=a,l.needsUpdate=!0}return n.numPlanes=o,a}var n=this,i=null,r=0,o=!1,a=!1,s=new tt,u=new $,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,n,a){var s=0!==t.length||n||0!==r||o;return o=n,i=e(t,a,0),r=t.length,s},this.beginShadows=function(){a=!0,e(null)},this.endShadows=function(){a=!1,t()},this.setState=function(n,s,u,c,h,f){if(!o||null===n||0===n.length||a&&!u)a?e(null):t();else{var d=a?0:r,p=4*d,g=h.clippingState||null;l.value=g,g=e(n,c,p,f);for(var v=0;v!==p;++v)g[v]=i[v];h.clippingState=g,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=d}}}function le(t){function e(){return null===tt?vt:1}function r(){Wt.init(),Wt.scissor(st.copy(mt).multiplyScalar(vt)),Wt.viewport(lt.copy(_t).multiplyScalar(vt)),Wt.buffers.color.setClear(ft.r,ft.g,ft.b,dt,z)}function o(){$=null,at=null,ot="",rt=-1,Wt.reset()}function a(t){t.preventDefault(),o(),r(),Zt.clear(),$t.clear()}function s(t){var e=t.target;e.removeEventListener("dispose",s),u(e)}function u(t){c(t),Zt.remove(t)}function c(t){var e=Zt.get(t).program;t.program=void 0,void 0!==e&&te.releaseProgram(e)}function h(t,e,n){t.render(function(t){Q.renderBufferImmediate(t,e,n)})}function f(t,e,n,i){if(n&&n.isInstancedBufferGeometry&&null===qt.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0),Wt.initAttributes();var r=n.attributes,o=e.getAttributes(),a=t.defaultAttributeValues;for(var s in o){var u=o[s];if(u>=0){var l=r[s];if(void 0!==l){var c=l.normalized,h=l.itemSize,f=Kt.get(l),d=f.buffer,p=f.type,g=f.bytesPerElement;if(l.isInterleavedBufferAttribute){var v=l.data,m=v.stride,y=l.offset;v&&v.isInstancedInterleavedBuffer?(Wt.enableAttributeAndDivisor(u,v.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=v.meshPerAttribute*v.count)):Wt.enableAttribute(u),Xt.bindBuffer(Xt.ARRAY_BUFFER,d),Xt.vertexAttribPointer(u,h,p,c,m*g,(i*m+y)*g)}else l.isInstancedBufferAttribute?(Wt.enableAttributeAndDivisor(u,l.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):Wt.enableAttribute(u),Xt.bindBuffer(Xt.ARRAY_BUFFER,d),Xt.vertexAttribPointer(u,h,p,c,0,i*h*g)}else if(void 0!==a){var _=a[s];if(void 0!==_)switch(_.length){case 2:Xt.vertexAttrib2fv(u,_);break;case 3:Xt.vertexAttrib3fv(u,_);break;case 4:Xt.vertexAttrib4fv(u,_);break;default:Xt.vertexAttrib1fv(u,_)}}}}Wt.disableUnusedAttributes()}function d(t,e){return Math.abs(e[0])-Math.abs(t[0])}function p(t,e,n){if(t.visible){if(t.isLight)V.push(t);else if(t.isSprite)t.frustumCulled&&!bt.intersectsSprite(t)||J.push(t);else if(t.isLensFlare)K.push(t);else if(t.isImmediateRenderObject)n&&Tt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(St),Y.push(t,null,t.material,Tt.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||bt.intersectsObject(t))){n&&Tt.setFromMatrixPosition(t.matrixWorld).applyMatrix4(St);var i=$t.update(t),r=t.material;if(Array.isArray(r))for(var o=i.groups,a=0,s=o.length;a<s;a++){var u=o[a],l=r[u.materialIndex];l&&l.visible&&Y.push(t,i,l,Tt.z,u)}else r.visible&&Y.push(t,i,r,Tt.z,null)}for(var c=t.children,a=0,s=c.length;a<s;a++)p(c[a],e,n)}}function g(t,e,n,i){for(var r=0,o=t.length;r<o;r++){var a=t[r],s=a.object,u=a.geometry,l=void 0===i?a.material:i,c=a.group;if(s.onBeforeRender(Q,e,n,u,l,c),n.isArrayCamera&&n.enabled)for(var h=n.cameras,f=0,d=h.length;f<d;f++){var p=h[f],g=p.bounds;Q.setViewport(g.x*pt*vt,g.y*gt*vt,g.z*pt*vt,g.w*gt*vt),Q.setScissor(g.x*pt*vt,g.y*gt*vt,g.z*pt*vt,g.w*gt*vt),Q.setScissorTest(!0),v(s,e,p,u,l,c)}else v(s,e,n,u,l,c);s.onAfterRender(Q,e,n,u,l,c)}}function v(t,e,n,i,r,o){if(t.layers.test(n.layers)!==!1)if(t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){Wt.setMaterial(r);var a=y(n,e.fog,r,t);ot="",h(t,a,r)}else Q.renderBufferDirect(n,e.fog,i,r,t,o)}function m(t,e,n){var i=Zt.get(t),r=te.getParameters(t,Rt,e,xt.numPlanes,xt.numIntersection,n),o=te.getProgramCode(t,r),a=i.program,u=!0;if(void 0===a)t.addEventListener("dispose",s);else if(a.code!==o)c(t);else{if(void 0!==r.shaderID)return;u=!1}if(u){if(r.shaderID){var l=cs[r.shaderID];i.__webglShader={name:t.type,uniforms:oo.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else i.__webglShader={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};t.__webglShader=i.__webglShader,a=te.acquireProgram(t,r,o),i.program=a,t.program=a}var h=a.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var f=0;f<Q.maxMorphTargets;f++)h["morphTarget"+f]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(var f=0;f<Q.maxMorphNormals;f++)h["morphNormal"+f]>=0&&t.numSupportedMorphNormals++}var d=i.__webglShader.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&t.clipping!==!0||(i.numClippingPlanes=xt.numPlanes,i.numIntersection=xt.numIntersection,d.clippingPlanes=xt.uniform),i.fog=e,i.lightsHash=Rt.hash,t.lights&&(d.ambientLightColor.value=Rt.ambient,d.directionalLights.value=Rt.directional,d.spotLights.value=Rt.spot,d.rectAreaLights.value=Rt.rectArea,d.pointLights.value=Rt.point,d.hemisphereLights.value=Rt.hemi,d.directionalShadowMap.value=Rt.directionalShadowMap,d.directionalShadowMatrix.value=Rt.directionalShadowMatrix,d.spotShadowMap.value=Rt.spotShadowMap,d.spotShadowMatrix.value=Rt.spotShadowMatrix,d.pointShadowMap.value=Rt.pointShadowMap,d.pointShadowMatrix.value=Rt.pointShadowMatrix);var p=i.program.getUniforms(),g=X.seqWithValue(p.seq,d);i.uniformsList=g}function y(t,e,n,i){ht=0;var r=Zt.get(n);if(wt&&(Et||t!==at)){var o=t===at&&n.id===rt;xt.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,r,o)}n.needsUpdate===!1&&(void 0===r.program?n.needsUpdate=!0:n.fog&&r.fog!==e?n.needsUpdate=!0:n.lights&&r.lightsHash!==Rt.hash?n.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===xt.numPlanes&&r.numIntersection===xt.numIntersection||(n.needsUpdate=!0)),n.needsUpdate&&(m(n,e,i),n.needsUpdate=!1);var a=!1,s=!1,u=!1,c=r.program,h=c.getUniforms(),f=r.__webglShader.uniforms;if(c.id!==$&&(Xt.useProgram(c.program),$=c.id,a=!0,s=!0,u=!0),n.id!==rt&&(rt=n.id,s=!0),a||t!==at){if(h.setValue(Xt,"projectionMatrix",t.projectionMatrix),Yt.logarithmicDepthBuffer&&h.setValue(Xt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),
t!==at&&(at=t,s=!0,u=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var d=h.map.cameraPosition;void 0!==d&&d.setValue(Xt,Tt.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&h.setValue(Xt,"viewMatrix",t.matrixWorldInverse),h.setValue(Xt,"toneMappingExposure",Q.toneMappingExposure),h.setValue(Xt,"toneMappingWhitePoint",Q.toneMappingWhitePoint)}if(n.skinning){h.setOptional(Xt,i,"bindMatrix"),h.setOptional(Xt,i,"bindMatrixInverse");var p=i.skeleton;if(p){var g=p.bones;if(Yt.floatVertexTextures){if(void 0===p.boneTexture){var v=Math.sqrt(4*g.length);v=Wr.nextPowerOfTwo(Math.ceil(v)),v=Math.max(v,4);var y=new Float32Array(v*v*4);y.set(p.boneMatrices);var A=new l(y,v,v,hr,ir);p.boneMatrices=y,p.boneTexture=A,p.boneTextureSize=v}h.setValue(Xt,"boneTexture",p.boneTexture),h.setValue(Xt,"boneTextureSize",p.boneTextureSize)}else h.setOptional(Xt,p,"boneMatrices")}}return s&&(n.lights&&P(f,u),e&&n.fog&&E(f,e),(n.isMeshBasicMaterial||n.isMeshLambertMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.isMeshNormalMaterial||n.isMeshDepthMaterial)&&_(f,n),n.isLineBasicMaterial?b(f,n):n.isLineDashedMaterial?(b(f,n),x(f,n)):n.isPointsMaterial?w(f,n):n.isMeshLambertMaterial?S(f,n):n.isMeshToonMaterial?C(f,n):n.isMeshPhongMaterial?M(f,n):n.isMeshPhysicalMaterial?O(f,n):n.isMeshStandardMaterial?I(f,n):n.isMeshDepthMaterial?n.displacementMap&&(f.displacementMap.value=n.displacementMap,f.displacementScale.value=n.displacementScale,f.displacementBias.value=n.displacementBias):n.isMeshNormalMaterial&&T(f,n),void 0!==f.ltcMat&&(f.ltcMat.value=ro.LTC_MAT_TEXTURE),void 0!==f.ltcMag&&(f.ltcMag.value=ro.LTC_MAG_TEXTURE),X.upload(Xt,r.uniformsList,f,Q)),h.setValue(Xt,"modelViewMatrix",i.modelViewMatrix),h.setValue(Xt,"normalMatrix",i.normalMatrix),h.setValue(Xt,"modelMatrix",i.matrixWorld),c}function _(t,e){t.opacity.value=e.opacity,t.diffuse.value=e.color,e.emissive&&t.emissive.value.copy(e.emissive).multiplyScalar(e.emissiveIntensity),t.map.value=e.map,t.specularMap.value=e.specularMap,t.alphaMap.value=e.alphaMap,e.lightMap&&(t.lightMap.value=e.lightMap,t.lightMapIntensity.value=e.lightMapIntensity),e.aoMap&&(t.aoMap.value=e.aoMap,t.aoMapIntensity.value=e.aoMapIntensity);var n;if(e.map?n=e.map:e.specularMap?n=e.specularMap:e.displacementMap?n=e.displacementMap:e.normalMap?n=e.normalMap:e.bumpMap?n=e.bumpMap:e.roughnessMap?n=e.roughnessMap:e.metalnessMap?n=e.metalnessMap:e.alphaMap?n=e.alphaMap:e.emissiveMap&&(n=e.emissiveMap),void 0!==n){n.isWebGLRenderTarget&&(n=n.texture);var i=n.offset,r=n.repeat;t.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}t.envMap.value=e.envMap,t.flipEnvMap.value=e.envMap&&e.envMap.isCubeTexture?-1:1,t.reflectivity.value=e.reflectivity,t.refractionRatio.value=e.refractionRatio}function b(t,e){t.diffuse.value=e.color,t.opacity.value=e.opacity}function x(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}function w(t,e){if(t.diffuse.value=e.color,t.opacity.value=e.opacity,t.size.value=e.size*vt,t.scale.value=.5*gt,t.map.value=e.map,null!==e.map){var n=e.map.offset,i=e.map.repeat;t.offsetRepeat.value.set(n.x,n.y,i.x,i.y)}}function E(t,e){t.fogColor.value=e.color,e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)}function S(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}function M(t,e){t.specular.value=e.specular,t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function C(t,e){M(t,e),e.gradientMap&&(t.gradientMap.value=e.gradientMap)}function I(t,e){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}function O(t,e){t.clearCoat.value=e.clearCoat,t.clearCoatRoughness.value=e.clearCoatRoughness,I(t,e)}function T(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale)),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}function P(t,e){t.ambientLightColor.needsUpdate=e,t.directionalLights.needsUpdate=e,t.pointLights.needsUpdate=e,t.spotLights.needsUpdate=e,t.rectAreaLights.needsUpdate=e,t.hemisphereLights.needsUpdate=e}function A(t){for(var e=0,n=0,i=t.length;n<i;n++){var r=t[n];r.castShadow&&(Rt.shadows[e]=r,e++)}Rt.shadows.length=e}function L(t,e){var n,r,o,a,s,u,l,c,h=0,f=0,d=0,p=e.matrixWorldInverse,g=0,v=0,m=0,y=0,_=0;for(n=0,r=t.length;n<r;n++)if(o=t[n],s=o.color,u=o.intensity,l=o.distance,c=o.shadow&&o.shadow.map?o.shadow.map.texture:null,o.isAmbientLight)h+=s.r*u,f+=s.g*u,d+=s.b*u;else if(o.isDirectionalLight){var b=ee.get(o);b.color.copy(o.color).multiplyScalar(o.intensity),b.direction.setFromMatrixPosition(o.matrixWorld),Tt.setFromMatrixPosition(o.target.matrixWorld),b.direction.sub(Tt),b.direction.transformDirection(p),b.shadow=o.castShadow,o.castShadow&&(a=o.shadow,b.shadowBias=a.bias,b.shadowRadius=a.radius,b.shadowMapSize=a.mapSize),Rt.directionalShadowMap[g]=c,Rt.directionalShadowMatrix[g]=o.shadow.matrix,Rt.directional[g]=b,g++}else if(o.isSpotLight){var b=ee.get(o);b.position.setFromMatrixPosition(o.matrixWorld),b.position.applyMatrix4(p),b.color.copy(s).multiplyScalar(u),b.distance=l,b.direction.setFromMatrixPosition(o.matrixWorld),Tt.setFromMatrixPosition(o.target.matrixWorld),b.direction.sub(Tt),b.direction.transformDirection(p),b.coneCos=Math.cos(o.angle),b.penumbraCos=Math.cos(o.angle*(1-o.penumbra)),b.decay=0===o.distance?0:o.decay,b.shadow=o.castShadow,o.castShadow&&(a=o.shadow,b.shadowBias=a.bias,b.shadowRadius=a.radius,b.shadowMapSize=a.mapSize),Rt.spotShadowMap[m]=c,Rt.spotShadowMatrix[m]=o.shadow.matrix,Rt.spot[m]=b,m++}else if(o.isRectAreaLight){var b=ee.get(o);b.color.copy(s).multiplyScalar(u/(o.width*o.height)),b.position.setFromMatrixPosition(o.matrixWorld),b.position.applyMatrix4(p),kt.identity(),Nt.copy(o.matrixWorld),Nt.premultiply(p),kt.extractRotation(Nt),b.halfWidth.set(.5*o.width,0,0),b.halfHeight.set(0,.5*o.height,0),b.halfWidth.applyMatrix4(kt),b.halfHeight.applyMatrix4(kt),Rt.rectArea[y]=b,y++}else if(o.isPointLight){var b=ee.get(o);b.position.setFromMatrixPosition(o.matrixWorld),b.position.applyMatrix4(p),b.color.copy(o.color).multiplyScalar(o.intensity),b.distance=o.distance,b.decay=0===o.distance?0:o.decay,b.shadow=o.castShadow,o.castShadow&&(a=o.shadow,b.shadowBias=a.bias,b.shadowRadius=a.radius,b.shadowMapSize=a.mapSize),Rt.pointShadowMap[v]=c,void 0===Rt.pointShadowMatrix[v]&&(Rt.pointShadowMatrix[v]=new i),Tt.setFromMatrixPosition(o.matrixWorld).negate(),Rt.pointShadowMatrix[v].identity().setPosition(Tt),Rt.point[v]=b,v++}else if(o.isHemisphereLight){var b=ee.get(o);b.direction.setFromMatrixPosition(o.matrixWorld),b.direction.transformDirection(p),b.direction.normalize(),b.skyColor.copy(o.color).multiplyScalar(u),b.groundColor.copy(o.groundColor).multiplyScalar(u),Rt.hemi[_]=b,_++}Rt.ambient[0]=h,Rt.ambient[1]=f,Rt.ambient[2]=d,Rt.directional.length=g,Rt.spot.length=m,Rt.rectArea.length=y,Rt.point.length=v,Rt.hemi.length=_,Rt.hash=g+","+v+","+m+","+y+","+_+","+Rt.shadows.length}function N(){var t=ht;return t>=Yt.maxTextures&&console.warn("WebGLRenderer: trying to use "+t+" texture units while this GPU supports only "+Yt.maxTextures),ht+=1,t}function k(t){var e;if(t===Gi)return Xt.REPEAT;if(t===Vi)return Xt.CLAMP_TO_EDGE;if(t===Xi)return Xt.MIRRORED_REPEAT;if(t===Hi)return Xt.NEAREST;if(t===qi)return Xt.NEAREST_MIPMAP_NEAREST;if(t===Yi)return Xt.NEAREST_MIPMAP_LINEAR;if(t===Wi)return Xt.LINEAR;if(t===Zi)return Xt.LINEAR_MIPMAP_NEAREST;if(t===Ji)return Xt.LINEAR_MIPMAP_LINEAR;if(t===Ki)return Xt.UNSIGNED_BYTE;if(t===or)return Xt.UNSIGNED_SHORT_4_4_4_4;if(t===ar)return Xt.UNSIGNED_SHORT_5_5_5_1;if(t===sr)return Xt.UNSIGNED_SHORT_5_6_5;if(t===Qi)return Xt.BYTE;if(t===$i)return Xt.SHORT;if(t===tr)return Xt.UNSIGNED_SHORT;if(t===er)return Xt.INT;if(t===nr)return Xt.UNSIGNED_INT;if(t===ir)return Xt.FLOAT;if(t===rr&&(e=qt.get("OES_texture_half_float"),null!==e))return e.HALF_FLOAT_OES;if(t===lr)return Xt.ALPHA;if(t===cr)return Xt.RGB;if(t===hr)return Xt.RGBA;if(t===fr)return Xt.LUMINANCE;if(t===dr)return Xt.LUMINANCE_ALPHA;if(t===gr)return Xt.DEPTH_COMPONENT;if(t===vr)return Xt.DEPTH_STENCIL;if(t===ni)return Xt.FUNC_ADD;if(t===ii)return Xt.FUNC_SUBTRACT;if(t===ri)return Xt.FUNC_REVERSE_SUBTRACT;if(t===si)return Xt.ZERO;if(t===ui)return Xt.ONE;if(t===li)return Xt.SRC_COLOR;if(t===ci)return Xt.ONE_MINUS_SRC_COLOR;if(t===hi)return Xt.SRC_ALPHA;if(t===fi)return Xt.ONE_MINUS_SRC_ALPHA;if(t===di)return Xt.DST_ALPHA;if(t===pi)return Xt.ONE_MINUS_DST_ALPHA;if(t===gi)return Xt.DST_COLOR;if(t===vi)return Xt.ONE_MINUS_DST_COLOR;if(t===mi)return Xt.SRC_ALPHA_SATURATE;if((t===mr||t===yr||t===_r||t===br)&&(e=qt.get("WEBGL_compressed_texture_s3tc"),null!==e)){if(t===mr)return e.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===yr)return e.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===_r)return e.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===br)return e.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((t===xr||t===wr||t===Er||t===Sr)&&(e=qt.get("WEBGL_compressed_texture_pvrtc"),null!==e)){if(t===xr)return e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===wr)return e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Er)return e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Sr)return e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Mr&&(e=qt.get("WEBGL_compressed_texture_etc1"),null!==e))return e.COMPRESSED_RGB_ETC1_WEBGL;if((t===oi||t===ai)&&(e=qt.get("EXT_blend_minmax"),null!==e)){if(t===oi)return e.MIN_EXT;if(t===ai)return e.MAX_EXT}return t===ur&&(e=qt.get("WEBGL_depth_texture"),null!==e)?e.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer",An),t=t||{};var R=void 0!==t.canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),D=void 0!==t.context?t.context:null,F=void 0!==t.alpha&&t.alpha,B=void 0===t.depth||t.depth,j=void 0===t.stencil||t.stencil,U=void 0!==t.antialias&&t.antialias,z=void 0===t.premultipliedAlpha||t.premultipliedAlpha,G=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,V=[],Y=null,W=new Float32Array(8),J=[],K=[];this.domElement=R,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=Pi,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var Q=this,$=null,tt=null,it=null,rt=-1,ot="",at=null,st=new H,ut=null,lt=new H,ht=0,ft=new q(0),dt=0,pt=R.width,gt=R.height,vt=1,mt=new H(0,0,pt,gt),yt=!1,_t=new H(0,0,pt,gt),bt=new et,xt=new ue,wt=!1,Et=!1,St=new i,Tt=new n,Nt=new i,kt=new i,Rt={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Gt={geometries:0,textures:0},Vt={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:Vt,memory:Gt,programs:null};var Xt;try{var Ht={alpha:F,depth:B,stencil:j,antialias:U,premultipliedAlpha:z,preserveDrawingBuffer:G};if(Xt=D||R.getContext("webgl",Ht)||R.getContext("experimental-webgl",Ht),null===Xt)throw null!==R.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Xt.getShaderPrecisionFormat&&(Xt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),R.addEventListener("webglcontextlost",a,!1)}catch(t){console.error("THREE.WebGLRenderer: "+t)}var qt=new se(Xt);qt.get("WEBGL_depth_texture"),qt.get("OES_texture_float"),qt.get("OES_texture_float_linear"),qt.get("OES_texture_half_float"),qt.get("OES_texture_half_float_linear"),qt.get("OES_standard_derivatives"),qt.get("ANGLE_instanced_arrays"),qt.get("OES_element_index_uint")&&(Mt.MaxIndex=4294967296);var Yt=new ae(Xt,qt,t),Wt=new oe(Xt,qt,k),Zt=new re,Jt=new ie(Xt,qt,Wt,Zt,Yt,k,Gt),Kt=new Lt(Xt),Qt=new jt(Xt,Kt,Gt),$t=new zt(Xt,Qt,Vt),te=new ne(this,Yt),ee=new Ut,le=new Dt;this.info.programs=te.programs;var ce,he,fe,de,pe=new Bt(Xt,qt,Vt),ge=new Ft(Xt,qt,Vt);r(),this.context=Xt,this.capabilities=Yt,this.extensions=qt,this.properties=Zt,this.state=Wt;var ve=new nt(this,Rt,$t,Yt);this.shadowMap=ve;var me=new t.SpritePlugin(this,J);this.getContext=function(){return Xt},this.getContextAttributes=function(){return Xt.getContextAttributes()},this.forceContextLoss=function(){var t=qt.get("WEBGL_lose_context");t&&t.loseContext()},this.getMaxAnisotropy=function(){return Yt.getMaxAnisotropy()},this.getPrecision=function(){return Yt.precision},this.getPixelRatio=function(){return vt},this.setPixelRatio=function(t){void 0!==t&&(vt=t,this.setSize(_t.z,_t.w,!1))},this.getSize=function(){return{width:pt,height:gt}},this.setSize=function(t,e,n){pt=t,gt=e,R.width=t*vt,R.height=e*vt,n!==!1&&(R.style.width=t+"px",R.style.height=e+"px"),this.setViewport(0,0,t,e)},this.setViewport=function(t,e,n,i){Wt.viewport(_t.set(t,e,n,i))},this.setScissor=function(t,e,n,i){Wt.scissor(mt.set(t,e,n,i))},this.setScissorTest=function(t){Wt.setScissorTest(yt=t)},this.getClearColor=function(){return ft},this.setClearColor=function(t,e){ft.set(t),dt=void 0!==e?e:1,Wt.buffers.color.setClear(ft.r,ft.g,ft.b,dt,z)},this.getClearAlpha=function(){return dt},this.setClearAlpha=function(t){dt=t,Wt.buffers.color.setClear(ft.r,ft.g,ft.b,dt,z)},this.clear=function(t,e,n){var i=0;(void 0===t||t)&&(i|=Xt.COLOR_BUFFER_BIT),(void 0===e||e)&&(i|=Xt.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=Xt.STENCIL_BUFFER_BIT),Xt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(t,e,n,i){this.setRenderTarget(t),this.clear(e,n,i)},this.resetGLState=o,this.dispose=function(){R.removeEventListener("webglcontextlost",a,!1),le.dispose()},this.renderBufferImmediate=function(t,e,n){Wt.initAttributes();var i=Zt.get(t);t.hasPositions&&!i.position&&(i.position=Xt.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=Xt.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=Xt.createBuffer()),t.hasColors&&!i.color&&(i.color=Xt.createBuffer());var r=e.getAttributes();if(t.hasPositions&&(Xt.bindBuffer(Xt.ARRAY_BUFFER,i.position),Xt.bufferData(Xt.ARRAY_BUFFER,t.positionArray,Xt.DYNAMIC_DRAW),Wt.enableAttribute(r.position),Xt.vertexAttribPointer(r.position,3,Xt.FLOAT,!1,0,0)),t.hasNormals){if(Xt.bindBuffer(Xt.ARRAY_BUFFER,i.normal),!n.isMeshPhongMaterial&&!n.isMeshStandardMaterial&&!n.isMeshNormalMaterial&&n.shading===Hn)for(var o=0,a=3*t.count;o<a;o+=9){var s=t.normalArray,u=(s[o+0]+s[o+3]+s[o+6])/3,l=(s[o+1]+s[o+4]+s[o+7])/3,c=(s[o+2]+s[o+5]+s[o+8])/3;s[o+0]=u,s[o+1]=l,s[o+2]=c,s[o+3]=u,s[o+4]=l,s[o+5]=c,s[o+6]=u,s[o+7]=l,s[o+8]=c}Xt.bufferData(Xt.ARRAY_BUFFER,t.normalArray,Xt.DYNAMIC_DRAW),Wt.enableAttribute(r.normal),Xt.vertexAttribPointer(r.normal,3,Xt.FLOAT,!1,0,0)}t.hasUvs&&n.map&&(Xt.bindBuffer(Xt.ARRAY_BUFFER,i.uv),Xt.bufferData(Xt.ARRAY_BUFFER,t.uvArray,Xt.DYNAMIC_DRAW),Wt.enableAttribute(r.uv),Xt.vertexAttribPointer(Kt.uv,2,Xt.FLOAT,!1,0,0)),t.hasColors&&n.vertexColors!==Yn&&(Xt.bindBuffer(Xt.ARRAY_BUFFER,i.color),Xt.bufferData(Xt.ARRAY_BUFFER,t.colorArray,Xt.DYNAMIC_DRAW),Wt.enableAttribute(r.color),Xt.vertexAttribPointer(r.color,3,Xt.FLOAT,!1,0,0)),Wt.disableUnusedAttributes(),Xt.drawArrays(Xt.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,n,i,r,o,a){Wt.setMaterial(r);var s=y(t,n,r,o),u=i.id+"_"+s.id+"_"+(r.wireframe===!0),l=!1;u!==ot&&(ot=u,l=!0);var c=o.morphTargetInfluences;if(void 0!==c){for(var h=[],p=0,g=c.length;p<g;p++){var v=c[p];h.push([v,p])}h.sort(d),h.length>8&&(h.length=8);for(var m=i.morphAttributes,p=0,g=h.length;p<g;p++){var v=h[p];if(W[p]=v[0],0!==v[0]){var _=v[1];r.morphTargets===!0&&m.position&&i.addAttribute("morphTarget"+p,m.position[_]),r.morphNormals===!0&&m.normal&&i.addAttribute("morphNormal"+p,m.normal[_])}else r.morphTargets===!0&&i.removeAttribute("morphTarget"+p),r.morphNormals===!0&&i.removeAttribute("morphNormal"+p)}for(var p=h.length,b=W.length;p<b;p++)W[p]=0;s.getUniforms().setValue(Xt,"morphTargetInfluences",W),l=!0}var _=i.index,x=i.attributes.position,w=1;r.wireframe===!0&&(_=Qt.getWireframeAttribute(i),w=2);var E=pe;null!==_&&(E=ge,E.setIndex(_)),l&&(f(r,s,i),null!==_&&Xt.bindBuffer(Xt.ELEMENT_ARRAY_BUFFER,Kt.get(_).buffer));var S=0;null!==_?S=_.count:void 0!==x&&(S=x.count);var M=i.drawRange.start*w,C=i.drawRange.count*w,I=null!==a?a.start*w:0,O=null!==a?a.count*w:1/0,T=Math.max(M,I),P=Math.min(S,M+C,I+O)-1,A=Math.max(0,P-T+1);if(0!==A){if(o.isMesh)if(r.wireframe===!0)Wt.setLineWidth(r.wireframeLinewidth*e()),E.setMode(Xt.LINES);else switch(o.drawMode){case Rr:E.setMode(Xt.TRIANGLES);break;case Dr:E.setMode(Xt.TRIANGLE_STRIP);break;case Fr:E.setMode(Xt.TRIANGLE_FAN)}else if(o.isLine){var L=r.linewidth;void 0===L&&(L=1),Wt.setLineWidth(L*e()),o.isLineSegments?E.setMode(Xt.LINES):o.isLineLoop?E.setMode(Xt.LINE_LOOP):E.setMode(Xt.LINE_STRIP)}else o.isPoints&&E.setMode(Xt.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&E.renderInstances(i,T,A):E.render(T,A)}},this.render=function(t,e,n,i){if(void 0!==e&&e.isCamera!==!0)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");ot="",rt=-1,at=null,t.autoUpdate===!0&&t.updateMatrixWorld(),e.onBeforeRender(Q),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),St.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),bt.setFromMatrix(St),V.length=0,J.length=0,K.length=0,Et=this.localClippingEnabled,wt=xt.init(this.clippingPlanes,Et,e),Y=le.get(t,e),Y.init(),p(t,e,Q.sortObjects),Y.finish(),Q.sortObjects===!0&&Y.sort(),wt&&xt.beginShadows(),A(V),ve.render(t,e),L(V,e),wt&&xt.endShadows(),Vt.frame++,Vt.calls=0,Vt.vertices=0,Vt.faces=0,Vt.points=0,void 0===n&&(n=null),this.setRenderTarget(n);var r=t.background;null===r?Wt.buffers.color.setClear(ft.r,ft.g,ft.b,dt,z):r&&r.isColor&&(Wt.buffers.color.setClear(r.r,r.g,r.b,1,z),i=!0),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),r&&r.isCubeTexture?(void 0===fe&&(fe=new Pt,de=new Ct(new It(5,5,5),new Z({uniforms:cs.cube.uniforms,vertexShader:cs.cube.vertexShader,fragmentShader:cs.cube.fragmentShader,side:Vn,depthTest:!1,depthWrite:!1,fog:!1}))),fe.projectionMatrix.copy(e.projectionMatrix),fe.matrixWorld.extractRotation(e.matrixWorld),fe.matrixWorldInverse.getInverse(fe.matrixWorld),de.material.uniforms.tCube.value=r,de.modelViewMatrix.multiplyMatrices(fe.matrixWorldInverse,de.matrixWorld),$t.update(de),Q.renderBufferDirect(fe,null,de.geometry,de.material,de,null)):r&&r.isTexture&&(void 0===ce&&(ce=new At(-1,1,1,-1,0,1),he=new Ct(new Ot(2,2),new ct({depthTest:!1,depthWrite:!1,fog:!1}))),he.material.map=r,$t.update(he),Q.renderBufferDirect(ce,null,he.geometry,he.material,he,null));var o=Y.opaque,a=Y.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;o.length&&g(o,t,e,s),a.length&&g(a,t,e,s)}else o.length&&g(o,t,e),a.length&&g(a,t,e);me.render(t,e),n&&Jt.updateRenderTargetMipmap(n),Wt.buffers.depth.setTest(!0),Wt.buffers.depth.setMask(!0),Wt.buffers.color.setMask(!0),e.isArrayCamera&&e.enabled&&Q.setScissorTest(!1),e.onAfterRender(Q)},this.setFaceCulling=function(t,e){Wt.setCullFace(t),Wt.setFlipSided(e===Fn)},this.allocTextureUnit=N,this.setTexture2D=function(){var t=!1;return function(e,n){e&&e.isWebGLRenderTarget&&(t||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),Jt.setTexture2D(e,n)}}(),this.setTexture=function(){var t=!1;return function(e,n){t||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),t=!0),Jt.setTexture2D(e,n)}}(),this.setTextureCube=function(){var t=!1;return function(e,n){e&&e.isWebGLRenderTargetCube&&(t||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),t=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?Jt.setTextureCube(e,n):Jt.setTextureCubeDynamic(e,n)}}(),this.getRenderTarget=function(){return tt},this.setRenderTarget=function(t){tt=t,t&&void 0===Zt.get(t).__webglFramebuffer&&Jt.setupRenderTarget(t);var e,n=t&&t.isWebGLRenderTargetCube;if(t){var i=Zt.get(t);e=n?i.__webglFramebuffer[t.activeCubeFace]:i.__webglFramebuffer,st.copy(t.scissor),ut=t.scissorTest,lt.copy(t.viewport)}else e=null,st.copy(mt).multiplyScalar(vt),ut=yt,lt.copy(_t).multiplyScalar(vt);if(it!==e&&(Xt.bindFramebuffer(Xt.FRAMEBUFFER,e),it=e),Wt.scissor(st),Wt.setScissorTest(ut),Wt.viewport(lt),n){var r=Zt.get(t.texture);Xt.framebufferTexture2D(Xt.FRAMEBUFFER,Xt.COLOR_ATTACHMENT0,Xt.TEXTURE_CUBE_MAP_POSITIVE_X+t.activeCubeFace,r.__webglTexture,t.activeMipMapLevel)}},this.readRenderTargetPixels=function(t,e,n,i,r,o){if((t&&t.isWebGLRenderTarget)===!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var a=Zt.get(t).__webglFramebuffer;if(a){var s=!1;a!==it&&(Xt.bindFramebuffer(Xt.FRAMEBUFFER,a),s=!0);try{var u=t.texture,l=u.format,c=u.type;if(l!==hr&&k(l)!==Xt.getParameter(Xt.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===Ki||k(c)===Xt.getParameter(Xt.IMPLEMENTATION_COLOR_READ_TYPE)||c===ir&&(qt.get("OES_texture_float")||qt.get("WEBGL_color_buffer_float"))||c===rr&&qt.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Xt.checkFramebufferStatus(Xt.FRAMEBUFFER)===Xt.FRAMEBUFFER_COMPLETE?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&Xt.readPixels(e,n,i,r,k(l),k(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&Xt.bindFramebuffer(Xt.FRAMEBUFFER,it)}}}}function ce(){at.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function he(t){W.call(this),this.type="SpriteMaterial",this.color=new q(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(t)}function fe(t){at.call(this),this.type="Sprite",this.material=void 0!==t?t:new he}function de(t){W.call(this),this.type="LineBasicMaterial",this.color=new q(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(t)}function pe(t,e,n){return 1===n?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new ge(t,e)):(at.call(this),this.type="Line",this.geometry=void 0!==t?t:new Mt,void(this.material=void 0!==e?e:new de({color:16777215*Math.random()})))}function ge(t,e){pe.call(this,t,e),this.type="LineSegments"}function ve(t){W.call(this),this.type="PointsMaterial",this.color=new q(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(t)}function me(t,e){at.call(this),this.type="Points",this.geometry=void 0!==t?t:new Mt,this.material=void 0!==e?e:new ve({color:16777215*Math.random()})}function ye(){at.call(this),this.type="Group"}function _e(t,e,n,i,r,o){St.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new be(t,e,n,i,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function be(t,e,i,r,a){function s(){for(f=0;f<e;f++)u(f);u(a===!1?e:0),c(),l()}function u(n){var o=t.getPointAt(n/e),a=h.normals[n],s=h.binormals[n];for(d=0;d<=r;d++){var u=d/r*Math.PI*2,l=Math.sin(u),c=-Math.cos(u);g.x=c*a.x+l*s.x,g.y=c*a.y+l*s.y,g.z=c*a.z+l*s.z,g.normalize(),y.push(g.x,g.y,g.z),p.x=o.x+i*g.x,p.y=o.y+i*g.y,p.z=o.z+i*g.z,m.push(p.x,p.y,p.z)}}function l(){for(d=1;d<=e;d++)for(f=1;f<=r;f++){var t=(r+1)*(d-1)+(f-1),n=(r+1)*d+(f-1),i=(r+1)*d+f,o=(r+1)*(d-1)+f;b.push(t,n,o),b.push(n,i,o)}}function c(){for(f=0;f<=e;f++)for(d=0;d<=r;d++)v.x=f/e,v.y=d/r,_.push(v.x,v.y)}Mt.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:r,closed:a},e=e||64,i=i||1,r=r||8,a=a||!1;var h=t.computeFrenetFrames(e,a);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals;var f,d,p=new n,g=new n,v=new o,m=[],y=[],_=[],b=[];s(),this.setIndex(b),this.addAttribute("position",new _t(m,3)),this.addAttribute("normal",new _t(y,3)),this.addAttribute("uv",new _t(_,2))}function xe(t,e,n,i,r,o,a){St.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new we(t,e,n,i,r,o,a)),this.mergeVertices()}function we(t,e,i,r,o,a,s){Mt.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:o,thetaStart:a,thetaLength:s},t=t||50,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;var u,l,c=a+s,h=0,f=[],d=new n,p=new n,g=[],v=[],m=[],y=[];for(l=0;l<=i;l++){var _=[],b=l/i;for(u=0;u<=e;u++){var x=u/e;d.x=-t*Math.cos(r+x*o)*Math.sin(a+b*s),d.y=t*Math.cos(a+b*s),d.z=t*Math.sin(r+x*o)*Math.sin(a+b*s),v.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),m.push(p.x,p.y,p.z),y.push(x,1-b),_.push(h++)}f.push(_)}for(l=0;l<i;l++)for(u=0;u<e;u++){var w=f[l][u+1],E=f[l][u],S=f[l+1][u],M=f[l+1][u+1];(0!==l||a>0)&&g.push(w,E,M),(l!==i-1||c<Math.PI)&&g.push(E,S,M)}this.setIndex(g),this.addAttribute("position",new _t(v,3)),this.addAttribute("normal",new _t(m,3)),this.addAttribute("uv",new _t(y,2))}function Ee(t,e){St.call(this),this.type="ShapeGeometry","object"===("undefined"==typeof e?"undefined":s(e))&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Se(t,e)),this.mergeVertices()}function Se(t,e){function n(t){var n,s,l,c=r.length/3,h=t.extractPoints(e),f=h.shape,d=h.holes;if(gs.isClockWise(f)===!1)for(f=f.reverse(),n=0,s=d.length;n<s;n++)l=d[n],gs.isClockWise(l)===!0&&(d[n]=l.reverse());var p=gs.triangulateShape(f,d);for(n=0,s=d.length;n<s;n++)l=d[n],f=f.concat(l);for(n=0,s=f.length;n<s;n++){var g=f[n];r.push(g.x,g.y,0),o.push(0,0,1),a.push(g.x,g.y)}for(n=0,s=p.length;n<s;n++){var v=p[n],m=v[0]+c,y=v[1]+c,_=v[2]+c;i.push(m,y,_),u+=3}}Mt.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var i=[],r=[],o=[],a=[],s=0,u=0;if(Array.isArray(t)===!1)n(t);else for(var l=0;l<t.length;l++)n(t[l]),this.addGroup(s,u,l),s+=u,u=0;this.setIndex(i),this.addAttribute("position",new _t(r,3)),this.addAttribute("normal",new _t(o,3)),this.addAttribute("uv",new _t(a,2))}function Me(t,e){St.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Ce(t,e)),this.mergeVertices()}function Ce(t,e){return"undefined"==typeof t?void(t=[]):(Mt.call(this),this.type="ExtrudeBufferGeometry",t=Array.isArray(t)?t:[t],this.addShapeList(t,e),void this.computeVertexNormals())}function Ie(t){W.call(this),this.type="MeshPhongMaterial",this.color=new q(16777215),this.specular=new q(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new q(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ci,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Oe(t,e,n){var i=this,r=!1,o=0,a=0;this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,r===!1&&void 0!==i.onStart&&i.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)}}function Te(t){this.manager=void 0!==t?t:ys}function Pe(t){this.manager=void 0!==t?t:ys}function Ae(t){this.manager=void 0!==t?t:ys}function Le(t){this.manager=void 0!==t?t:ys,this.textures={}}function Ne(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function ke(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function Re(t,e,n,i){ke.call(this,t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function De(t,e,n,i){ke.call(this,t,e,n,i)}function Fe(t,e,n,i){ke.call(this,t,e,n,i)}function Be(t,e,n,i){if(void 0===t)throw new Error("track name is undefined");if(void 0===e||0===e.length)throw new Error("no keyframes in track named "+t);this.name=t,this.times=_s.convertArray(e,this.TimeBufferType),this.values=_s.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation),this.validate(),this.optimize()}function je(t,e,n,i){Be.call(this,t,e,n,i)}function Ue(t,e,n,i){ke.call(this,t,e,n,i)}function ze(t,e,n,i){Be.call(this,t,e,n,i)}function Ge(t,e,n,i){Be.call(this,t,e,n,i)}function Ve(t,e,n,i){Be.call(this,t,e,n,i)}function Xe(t,e,n){Be.call(this,t,e,n)}function He(t,e,n,i){Be.call(this,t,e,n,i)}function qe(t,e,n,i){Be.apply(this,arguments)}function Ye(t,e,n){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.uuid=Wr.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function We(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:ys,this.withCredentials=!1}function Ze(t,e){at.call(this),this.type="Light",this.color=new q(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function Je(t,e,n){Ze.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(at.DefaultUp),this.updateMatrix(),this.groundColor=new q(e)}function Ke(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new o(512,512),this.map=null,this.matrix=new i}function Qe(){Ke.call(this,new At(-5,5,5,-5,.5,500))}function $e(t,e){Ze.call(this,t,e),this.type="DirectionalLight",this.position.copy(at.DefaultUp),this.updateMatrix(),this.target=new at,this.shadow=new Qe}function tn(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function en(t,e,n,i){
this.ray=new it(t,e),this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function nn(t,e){return t.distance-e.distance}function rn(t,e,n,i){if(t.visible!==!1&&(t.raycast(e,n),i===!0))for(var r=t.children,o=0,a=r.length;o<a;o++)rn(r[o],e,n,!0)}function on(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function an(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}function sn(t,e){this.min=void 0!==t?t:new o(+(1/0),+(1/0)),this.max=void 0!==e?e:new o(-(1/0),-(1/0))}function un(){this.arcLengthDivisions=200}function ln(){function t(t,o,a,s){e=t,n=a,i=-3*t+3*o-2*a-s,r=2*t-2*o+a+s}var e=0,n=0,i=0,r=0;return{initCatmullRom:function(e,n,i,r,o){t(n,i,o*(i-e),o*(r-n))},initNonuniformCatmullRom:function(e,n,i,r,o,a,s){var u=(n-e)/o-(i-e)/(o+a)+(i-n)/a,l=(i-n)/a-(r-n)/(a+s)+(r-i)/s;u*=a,l*=a,t(n,i,u,l)},calc:function(t){var o=t*t,a=o*t;return e+n*t+i*o+r*a}}}function cn(t){un.call(this),this.points=t||[],this.closed=!1}function hn(t,e){un.call(this),this.v1=t,this.v2=e}function fn(t,e){un.call(this),this.v1=t,this.v2=e}function dn(){un.call(this),this.curves=[],this.autoClose=!1}function pn(t,e,n,i,r,o,a,s){un.call(this),this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=s||0}function gn(t,e,n,i,r){var o=.5*(i-e),a=.5*(r-n),s=t*t,u=t*s;return(2*n-2*i+o+a)*u+(-3*n+3*i-2*o-a)*s+o*t+n}function vn(t,e){var n=1-t;return n*n*e}function mn(t,e){return 2*(1-t)*t*e}function yn(t,e){return t*t*e}function _n(t,e,n,i){return vn(t,e)+mn(t,n)+yn(t,i)}function bn(t,e){var n=1-t;return n*n*n*e}function xn(t,e){var n=1-t;return 3*n*n*t*e}function wn(t,e){return 3*(1-t)*t*t*e}function En(t,e){return t*t*t*e}function Sn(t,e,n,i,r){return bn(t,e)+xn(t,n)+wn(t,i)+En(t,r)}function Mn(t){un.call(this),this.points=void 0===t?[]:t}function Cn(t,e,n,i){un.call(this),this.v0=t,this.v1=e,this.v2=n,this.v3=i}function In(t,e,n){un.call(this),this.v0=t,this.v1=e,this.v2=n}function On(t){dn.call(this),this.currentPoint=new o,t&&this.fromPoints(t)}function Tn(){On.apply(this,arguments),this.holes=[]}function Pn(){this.subPaths=[],this.currentPath=null}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===a&&!function(){a=function(t){if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}}();var An="85dev",Ln={LEFT:0,MIDDLE:1,RIGHT:2},Nn=0,kn=1,Rn=2,Dn=3,Fn=0,Bn=1,jn=0,Un=1,zn=2,Gn=0,Vn=1,Xn=2,Hn=1,qn=2,Yn=0,Wn=1,Zn=2,Jn=0,Kn=1,Qn=2,$n=3,ti=4,ei=5,ni=100,ii=101,ri=102,oi=103,ai=104,si=200,ui=201,li=202,ci=203,hi=204,fi=205,di=206,pi=207,gi=208,vi=209,mi=210,yi=0,_i=1,bi=2,xi=3,wi=4,Ei=5,Si=6,Mi=7,Ci=0,Ii=1,Oi=2,Ti=0,Pi=1,Ai=2,Li=3,Ni=4,ki=300,Ri=301,Di=302,Fi=303,Bi=304,ji=305,Ui=306,zi=307,Gi=1e3,Vi=1001,Xi=1002,Hi=1003,qi=1004,Yi=1005,Wi=1006,Zi=1007,Ji=1008,Ki=1009,Qi=1010,$i=1011,tr=1012,er=1013,nr=1014,ir=1015,rr=1016,or=1017,ar=1018,sr=1019,ur=1020,lr=1021,cr=1022,hr=1023,fr=1024,dr=1025,pr=hr,gr=1026,vr=1027,mr=2001,yr=2002,_r=2003,br=2004,xr=2100,wr=2101,Er=2102,Sr=2103,Mr=2151,Cr=2200,Ir=2201,Or=2202,Tr=2300,Pr=2301,Ar=2302,Lr=2400,Nr=2401,kr=2402,Rr=0,Dr=1,Fr=2,Br=3e3,jr=3001,Ur=3007,zr=3002,Gr=3003,Vr=3004,Xr=3005,Hr=3006,qr=3200,Yr=3201,Wr={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?n[r]="-":14===r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),t=15&i,i>>=4,n[r]=e[19===r?3&t|8:t]);return n.join("")}}(),clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(6*t-15)+10))},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*Wr.DEG2RAD},radToDeg:function(t){return t*Wr.RAD2DEG},isPowerOfTwo:function(t){return 0===(t&t-1)&&0!==t},nearestPowerOfTwo:function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},nextPowerOfTwo:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t}};a(e,{slerp:function(t,e,n,i){return n.copy(t).slerp(e,i)},slerpFlat:function(t,e,n,i,r,o,a){var s=n[i+0],u=n[i+1],l=n[i+2],c=n[i+3],h=r[o+0],f=r[o+1],d=r[o+2],p=r[o+3];if(c!==p||s!==h||u!==f||l!==d){var g=1-a,v=s*h+u*f+l*d+c*p,m=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,v*m);g=Math.sin(g*b)/_,a=Math.sin(a*b)/_}var x=a*m;if(s=s*g+h*x,u=u*g+f*x,l=l*g+d*x,c=c*g+p*x,g===1-a){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}t[e]=s,t[e+1]=u,t[e+2]=l,t[e+3]=c}}),Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),a(e.prototype,{set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if((t&&t.isEuler)===!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=t._x,i=t._y,r=t._z,o=t.order,a=Math.cos,s=Math.sin,u=a(n/2),l=a(i/2),c=a(r/2),h=s(n/2),f=s(i/2),d=s(r/2);return"XYZ"===o?(this._x=h*l*c+u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c-h*f*d):"YXZ"===o?(this._x=h*l*c+u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c+h*f*d):"ZXY"===o?(this._x=h*l*c-u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c-h*f*d):"ZYX"===o?(this._x=h*l*c-u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c+h*f*d):"YZX"===o?(this._x=h*l*c+u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c-h*f*d):"XZY"===o&&(this._x=h*l*c-u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c+h*f*d),e!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,n=t.elements,i=n[0],r=n[4],o=n[8],a=n[1],s=n[5],u=n[9],l=n[2],c=n[6],h=n[10],f=i+s+h;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(c-u)*e,this._y=(o-l)*e,this._z=(a-r)*e):i>s&&i>h?(e=2*Math.sqrt(1+i-s-h),this._w=(c-u)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(o+l)/e):s>h?(e=2*Math.sqrt(1+s-i-h),this._w=(o-l)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(u+c)/e):(e=2*Math.sqrt(1+h-i-s),this._w=(a-r)/e,this._x=(o+l)/e,this._y=(u+c)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,e=new n,i=1e-6;return function(r,o){return void 0===e&&(e=new n),t=r.dot(o)+1,t<i?(t=0,Math.abs(r.x)>Math.abs(r.z)?e.set(-r.y,r.x,0):e.set(0,-r.z,r.y)):e.crossVectors(r,o),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var n=t._x,i=t._y,r=t._z,o=t._w,a=e._x,s=e._y,u=e._z,l=e._w;return this._x=n*l+o*a+i*u-r*s,this._y=i*l+o*s+r*a-n*u,this._z=r*l+o*u+n*s-i*a,this._w=o*l-n*a-i*s-r*u,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,i=this._y,r=this._z,o=this._w,a=o*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var u=Math.atan2(s,a),l=Math.sin((1-e)*u)/s,c=Math.sin(e*u)/s;return this._w=o*l+this._w*c,this._x=n*l+this._x*c,this._y=i*l+this._y*c,this._z=r*l+this._z*c,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),a(n.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(){var t=new e;return function(e){return(e&&e.isEuler)===!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(t.setFromEuler(e))}}(),applyAxisAngle:function(){var t=new e;return function(e,n){return this.applyQuaternion(t.setFromAxisAngle(e,n))}}(),applyMatrix3:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;this.x=r[0]*e+r[4]*n+r[8]*i+r[12],this.y=r[1]*e+r[5]*n+r[9]*i+r[13],this.z=r[2]*e+r[6]*n+r[10]*i+r[14];var o=r[3]*e+r[7]*n+r[11]*i+r[15];return this.divideScalar(o)},applyQuaternion:function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,s=t.w,u=s*e+o*i-a*n,l=s*n+a*e-r*i,c=s*i+r*n-o*e,h=-r*e-o*n-a*i;return this.x=u*s+h*-r+l*-a-c*-o,this.y=l*s+h*-o+c*-r-u*-a,this.z=c*s+h*-a+u*-o-l*-r,this},project:function(){var t=new i;return function(e){return t.multiplyMatrices(e.projectionMatrix,t.getInverse(e.matrixWorld)),this.applyMatrix4(t)}}(),unproject:function(){var t=new i;return function(e){return t.multiplyMatrices(e.matrixWorld,t.getInverse(e.projectionMatrix)),this.applyMatrix4(t)}}(),transformDirection:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(){var t=new n,e=new n;return function(n,i){return t.set(n,n,n),e.set(i,i,i),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,n))/n)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},cross:function(t,e){if(void 0!==e)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e);var n=this.x,i=this.y,r=this.z;return this.x=i*t.z-r*t.y,this.y=r*t.x-n*t.z,this.z=n*t.y-i*t.x,this},crossVectors:function(t,e){var n=t.x,i=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=i*s-r*a,this.y=r*o-n*s,this.z=n*a-i*o,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:function(){var t=new n;return function(e){return t.copy(this).projectOnVector(e),this.sub(t)}}(),reflect:function(){var t=new n;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return Math.acos(Wr.clamp(e,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){var e=Math.sin(t.phi)*t.radius;return this.x=e*Math.sin(t.theta),this.y=Math.cos(t.phi)*t.radius,this.z=e*Math.cos(t.theta),this},setFromCylindrical:function(t){return this.x=t.radius*Math.sin(t.theta),this.y=t.y,this.z=t.radius*Math.cos(t.theta),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}}),a(i.prototype,{isMatrix4:!0,set:function(t,e,n,i,r,o,a,s,u,l,c,h,f,d,p,g){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=i,v[1]=r,v[5]=o,v[9]=a,v[13]=s,v[2]=u,v[6]=l,v[10]=c,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=g,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new i).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(){var t=new n;return function(e){var n=this.elements,i=e.elements,r=1/t.setFromMatrixColumn(e,0).length(),o=1/t.setFromMatrixColumn(e,1).length(),a=1/t.setFromMatrixColumn(e,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*o,n[5]=i[5]*o,n[6]=i[6]*o,n[8]=i[8]*a,n[9]=i[9]*a,n[10]=i[10]*a,this}}(),makeRotationFromEuler:function(t){(t&&t.isEuler)===!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),a=Math.sin(n),s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){var h=o*l,f=o*c,d=a*l,p=a*c;e[0]=s*l,e[4]=-s*c,e[8]=u,e[1]=f+d*u,e[5]=h-p*u,e[9]=-a*s,e[2]=p-h*u,e[6]=d+f*u,e[10]=o*s}else if("YXZ"===t.order){var g=s*l,v=s*c,m=u*l,y=u*c;e[0]=g+y*a,e[4]=m*a-v,e[8]=o*u,e[1]=o*c,e[5]=o*l,e[9]=-a,e[2]=v*a-m,e[6]=y+g*a,e[10]=o*s}else if("ZXY"===t.order){var g=s*l,v=s*c,m=u*l,y=u*c;e[0]=g-y*a,e[4]=-o*c,e[8]=m+v*a,e[1]=v+m*a,e[5]=o*l,e[9]=y-g*a,e[2]=-o*u,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){var h=o*l,f=o*c,d=a*l,p=a*c;e[0]=s*l,e[4]=d*u-f,e[8]=h*u+p,e[1]=s*c,e[5]=p*u+h,e[9]=f*u-d,e[2]=-u,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var _=o*s,b=o*u,x=a*s,w=a*u;e[0]=s*l,e[4]=w-_*c,e[8]=x*c+b,e[1]=c,e[5]=o*l,e[9]=-a*l,e[2]=-u*l,e[6]=b*c+x,e[10]=_-w*c}else if("XZY"===t.order){var _=o*s,b=o*u,x=a*s,w=a*u;e[0]=s*l,e[4]=-c,e[8]=u*l,e[1]=_*c+w,e[5]=o*l,e[9]=b*c-x,e[2]=x*c-b,e[6]=a*l,e[10]=w*c+_}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.elements,n=t._x,i=t._y,r=t._z,o=t._w,a=n+n,s=i+i,u=r+r,l=n*a,c=n*s,h=n*u,f=i*s,d=i*u,p=r*u,g=o*a,v=o*s,m=o*u;return e[0]=1-(f+p),e[4]=c-m,e[8]=h+v,e[1]=c+m,e[5]=1-(l+p),e[9]=d-g,e[2]=h-v,e[6]=d+g,e[10]=1-(l+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:function(){var t=new n,e=new n,i=new n;return function(n,r,o){var a=this.elements;return i.subVectors(n,r),0===i.lengthSq()&&(i.z=1),i.normalize(),t.crossVectors(o,i),0===t.lengthSq()&&(i.z+=1e-4,t.crossVectors(o,i)),t.normalize(),e.crossVectors(i,t),a[0]=t.x,a[4]=e.x,a[8]=i.x,a[1]=t.y,a[5]=e.y,a[9]=i.y,a[2]=t.z,a[6]=e.z,a[10]=i.z,this}}(),multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],f=n[13],d=n[2],p=n[6],g=n[10],v=n[14],m=n[3],y=n[7],_=n[11],b=n[15],x=i[0],w=i[4],E=i[8],S=i[12],M=i[1],C=i[5],I=i[9],O=i[13],T=i[2],P=i[6],A=i[10],L=i[14],N=i[3],k=i[7],R=i[11],D=i[15];return r[0]=o*x+a*M+s*T+u*N,r[4]=o*w+a*C+s*P+u*k,r[8]=o*E+a*I+s*A+u*R,r[12]=o*S+a*O+s*L+u*D,r[1]=l*x+c*M+h*T+f*N,r[5]=l*w+c*C+h*P+f*k,r[9]=l*E+c*I+h*A+f*R,r[13]=l*S+c*O+h*L+f*D,r[2]=d*x+p*M+g*T+v*N,r[6]=d*w+p*C+g*P+v*k,r[10]=d*E+p*I+g*A+v*R,r[14]=d*S+p*O+g*L+v*D,r[3]=m*x+y*M+_*T+b*N,r[7]=m*w+y*C+_*P+b*k,r[11]=m*E+y*I+_*A+b*R,r[15]=m*S+y*O+_*L+b*D,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},applyToBufferAttribute:function(){var t=new n;return function(e){for(var n=0,i=e.count;n<i;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix4(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),determinant:function(){var t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],a=t[5],s=t[9],u=t[13],l=t[2],c=t[6],h=t[10],f=t[14],d=t[3],p=t[7],g=t[11],v=t[15];return d*(+r*s*c-i*u*c-r*a*h+n*u*h+i*a*f-n*s*f)+p*(+e*s*f-e*u*h+r*o*h-i*o*f+i*u*l-r*s*l)+g*(+e*u*c-e*a*f-r*o*c+n*o*f+r*a*l-n*u*l)+v*(-i*a*l-e*s*c+e*a*h+i*o*c-n*o*h+n*s*l)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,i=t.elements,r=i[0],o=i[1],a=i[2],s=i[3],u=i[4],l=i[5],c=i[6],h=i[7],f=i[8],d=i[9],p=i[10],g=i[11],v=i[12],m=i[13],y=i[14],_=i[15],b=d*y*h-m*p*h+m*c*g-l*y*g-d*c*_+l*p*_,x=v*p*h-f*y*h-v*c*g+u*y*g+f*c*_-u*p*_,w=f*m*h-v*d*h+v*l*g-u*m*g-f*l*_+u*d*_,E=v*d*c-f*m*c-v*l*p+u*m*p+f*l*y-u*d*y,S=r*b+o*x+a*w+s*E;if(0===S){var M="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e===!0)throw new Error(M);return console.warn(M),this.identity()}var C=1/S;return n[0]=b*C,n[1]=(m*p*s-d*y*s-m*a*g+o*y*g+d*a*_-o*p*_)*C,n[2]=(l*y*s-m*c*s+m*a*h-o*y*h-l*a*_+o*c*_)*C,n[3]=(d*c*s-l*p*s-d*a*h+o*p*h+l*a*g-o*c*g)*C,n[4]=x*C,n[5]=(f*y*s-v*p*s+v*a*g-r*y*g-f*a*_+r*p*_)*C,n[6]=(v*c*s-u*y*s-v*a*h+r*y*h+u*a*_-r*c*_)*C,n[7]=(u*p*s-f*c*s+f*a*h-r*p*h-u*a*g+r*c*g)*C,n[8]=w*C,n[9]=(v*d*s-f*m*s-v*o*g+r*m*g+f*o*_-r*d*_)*C,n[10]=(u*m*s-v*l*s+v*o*h-r*m*h-u*o*_+r*l*_)*C,n[11]=(f*l*s-u*d*s-f*o*h+r*d*h+u*o*g-r*l*g)*C,n[12]=E*C,n[13]=(f*m*a-v*d*a+v*o*p-r*m*p-f*o*y+r*d*y)*C,n[14]=(v*l*a-u*m*a-v*o*c+r*m*c+u*o*y-r*l*y)*C,n[15]=(u*d*a-f*l*a+f*o*c-r*d*c-u*o*p+r*l*p)*C,this},scale:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,a=t.y,s=t.z,u=r*o,l=r*a;return this.set(u*o+n,u*a-i*s,u*s+i*a,0,u*a+i*s,l*a+n,l*s-i*o,0,u*s-i*a,l*s+i*o,r*s*s+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){return this.makeRotationFromQuaternion(e),this.scale(n),this.setPosition(t),this},decompose:function(){var t=new n,e=new i;return function(n,i,r){var o=this.elements,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),u=t.set(o[8],o[9],o[10]).length(),l=this.determinant();l<0&&(a=-a),n.x=o[12],n.y=o[13],n.z=o[14],e.copy(this);var c=1/a,h=1/s,f=1/u;return e.elements[0]*=c,e.elements[1]*=c,e.elements[2]*=c,e.elements[4]*=h,e.elements[5]*=h,e.elements[6]*=h,e.elements[8]*=f,e.elements[9]*=f,e.elements[10]*=f,i.setFromRotationMatrix(e),r.x=a,r.y=s,r.z=u,this}}(),makePerspective:function(t,e,n,i,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*r/(e-t),u=2*r/(n-i),l=(e+t)/(e-t),c=(n+i)/(n-i),h=-(o+r)/(o-r),f=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=u,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,n,i,r,o){var a=this.elements,s=1/(e-t),u=1/(n-i),l=1/(o-r),c=(e+t)*s,h=(n+i)*u,f=(o+r)*l;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*u,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*l,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,n=t.elements,i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}),a(r.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&n[t].indexOf(e)!==-1},removeEventListener:function(t,e){if(void 0!==this._listeners){var n=this._listeners,i=n[t];if(void 0!==i){var r=i.indexOf(e);r!==-1&&i.splice(r,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;var i=[],r=0,o=n.length;for(r=0;r<o;r++)i[r]=n[r];for(r=0;r<o;r++)i[r].call(this,t)}}}}),Object.defineProperties(o.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),a(o.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(){var t=new o,e=new o;return function(n,i){return t.set(n,n),e.set(i,i),this.clamp(t,e)}}(),clampLength:function(t,e){var n=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,n))/n)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function t(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},distanceToManhattan:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this}});var Zr=0;u.DEFAULT_IMAGE=void 0,u.DEFAULT_MAPPING=ki,Object.defineProperty(u.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),a(u.prototype,r.prototype,{constructor:u,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,
this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){function e(t){var e;return void 0!==t.toDataURL?e=t:(e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0,t.width,t.height)),e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}if(void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=Wr.generateUUID()),void 0===t.images[i.uuid]&&(t.images[i.uuid]={uuid:i.uuid,url:e(i)}),n.image=i.uuid}return t.textures[this.uuid]=n,n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping===ki){if(t.multiply(this.repeat),t.add(this.offset),t.x<0||t.x>1)switch(this.wrapS){case Gi:t.x=t.x-Math.floor(t.x);break;case Vi:t.x=t.x<0?0:1;break;case Xi:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case Gi:t.y=t.y-Math.floor(t.y);break;case Vi:t.y=t.y<0?0:1;break;case Xi:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}this.flipY&&(t.y=1-t.y)}}}),l.prototype=Object.create(u.prototype),l.prototype.constructor=l,l.prototype.isDataTexture=!0,c.prototype=Object.create(u.prototype),c.prototype.constructor=c,c.prototype.isCubeTexture=!0,Object.defineProperty(c.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}});var Jr=new u,Kr=new c,Qr=[],$r=[],to=new Float32Array(16),eo=new Float32Array(9);z.prototype.setValue=function(t,e){for(var n=this.seq,i=0,r=n.length;i!==r;++i){var o=n[i];o.setValue(t,e[o.id])}};var no=/([\w\d_]+)(\])?(\[|\.)?/g;X.prototype.setValue=function(t,e,n){var i=this.map[e];void 0!==i&&i.setValue(t,n,this.renderer)},X.prototype.setOptional=function(t,e,n){var i=e[n];void 0!==i&&this.setValue(t,n,i)},X.upload=function(t,e,n,i){for(var r=0,o=e.length;r!==o;++r){var a=e[r],s=n[a.id];s.needsUpdate!==!1&&a.setValue(t,s.value,i)}},X.seqWithValue=function(t,e){for(var n=[],i=0,r=t.length;i!==r;++i){var o=t[i];o.id in e&&n.push(o)}return n},a(H.prototype,{isVector4:!0,set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,n,i,r,o=.01,a=.1,s=t.elements,u=s[0],l=s[4],c=s[8],h=s[1],f=s[5],d=s[9],p=s[2],g=s[6],v=s[10];if(Math.abs(l-h)<o&&Math.abs(c-p)<o&&Math.abs(d-g)<o){if(Math.abs(l+h)<a&&Math.abs(c+p)<a&&Math.abs(d+g)<a&&Math.abs(u+f+v-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var m=(u+1)/2,y=(f+1)/2,_=(v+1)/2,b=(l+h)/4,x=(c+p)/4,w=(d+g)/4;return m>y&&m>_?m<o?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(m),i=b/n,r=x/n):y>_?y<o?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(y),n=b/i,r=w/i):_<o?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=x/r,i=w/r),this.set(n,i,r,e),this}var E=Math.sqrt((g-d)*(g-d)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(E)<.001&&(E=1),this.x=(g-d)/E,this.y=(c-p)/E,this.z=(h-l)/E,this.w=Math.acos((u+f+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t=new H,e=new H;return function(n,i){return t.set(n,n,n,n),e.set(i,i,i,i),this.clamp(t,e)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(t){return this.multiplyScalar(t/this.length())},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.subVectors(e,t).multiplyScalar(n).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}});var io={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};a(q.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,n){return this.r=t,this.g=e,this.b=n,this},setHSL:function(){function t(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}return function(e,n,i){if(e=Wr.euclideanModulo(e,1),n=Wr.clamp(n,0,1),i=Wr.clamp(i,0,1),0===n)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+n):i+n-i*n,o=2*i-r;this.r=t(o,r,e+1/3),this.g=t(o,r,e),this.b=t(o,r,e-1/3)}return this}}(),setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var i,r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,e(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,e(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return e(i[5]),this.setHSL(a,s,u)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(t)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}if(t&&t.length>0){var l=io[t];void 0!==l?this.setHex(l):console.warn("THREE.Color: Unknown color "+t)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(){var t=this.r,e=this.g,n=this.b;return this.r=t*t,this.g=e*e,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){var e,n,i=t||{h:0,s:0,l:0},r=this.r,o=this.g,a=this.b,s=Math.max(r,o,a),u=Math.min(r,o,a),l=(u+s)/2;if(u===s)e=0,n=0;else{var c=s-u;switch(n=l<=.5?c/(s+u):c/(2-s-u),s){case r:e=(o-a)/c+(o<a?6:0);break;case o:e=(a-r)/c+2;break;case a:e=(r-o)/c+4}e/=6}return i.h=e,i.s=n,i.l=l,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,n){var i=this.getHSL();return i.h+=t,i.s+=e,i.l+=n,this.setHSL(i.h,i.s,i.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}});var ro={common:{diffuse:{value:new q(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new H(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new o(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new q(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new q(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new H(0,0,1,1)}}},oo={merge:function(t){for(var e={},n=0;n<t.length;n++){var i=this.clone(t[n]);for(var r in i)e[r]=i[r]}return e},clone:function(t){var e={};for(var n in t){e[n]={};for(var i in t[n]){var r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}},ao="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",so="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",uo="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",lo="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",co="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",ho="\nvec3 transformed = vec3( position );\n",fo="\nvec3 objectNormal = vec3( normal );\n",po="float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",go="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",vo="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",mo="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",yo="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",_o="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",bo="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",xo="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",wo="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Eo="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",So="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",Mo="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",Co="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",Io="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",Oo="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",To="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",Po="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",Ao="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",Lo="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",No="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",ko="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",Ro="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",Do="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",Fo="\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",Bo="#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",jo="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",Uo="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",zo="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",Go="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",Vo="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",Xo="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",Ho="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",qo="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",Yo="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",Wo="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",Zo="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",Jo="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",Ko="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",Qo="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",$o="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",ta="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",ea="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",na="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",ia="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",ra="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",oa="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",aa="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",sa="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",ua="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",la="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",ca="#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",ha="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",fa="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",da="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",pa="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",ga="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",va="#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",ma="vec3 dithering( vec3 color ) {\n\tfloat grid_position = fract( dot( gl_FragCoord.xy - vec2( 0.5, 0.5 ) , vec2( 1.0 / 16.0, 10.0 / 36.0 ) + 0.25 ) );\n\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\treturn color + 0.5 / 255.0 + dither_shift_RGB;\n}",ya="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",_a="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",ba="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",xa="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",wa="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",Ea="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",Sa="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",Ma="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",Ca="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",Ia="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",Oa="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",Ta="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",Pa="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",Aa="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",La="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",Na="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",ka="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",Ra="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",Da="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",Fa="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",Ba="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",ja="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",Ua="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",za="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",Ga="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",Va="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",Xa="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",Ha="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",qa="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",Ya="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Wa="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",Za="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Ja="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",Ka="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <dithering_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Qa="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",$a="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <dithering_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",ts="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",es="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <dithering_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",ns="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",is="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",rs="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",os="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",as="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",ss="uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",us="#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",ls={
alphamap_fragment:ao,alphamap_pars_fragment:so,alphatest_fragment:uo,aomap_fragment:lo,aomap_pars_fragment:co,begin_vertex:ho,beginnormal_vertex:fo,bsdfs:po,bumpmap_pars_fragment:go,clipping_planes_fragment:vo,clipping_planes_pars_fragment:mo,clipping_planes_pars_vertex:yo,clipping_planes_vertex:_o,color_fragment:bo,color_pars_fragment:xo,color_pars_vertex:wo,color_vertex:Eo,common:So,cube_uv_reflection_fragment:Mo,defaultnormal_vertex:Co,displacementmap_pars_vertex:Io,displacementmap_vertex:Oo,emissivemap_fragment:To,emissivemap_pars_fragment:Po,encodings_fragment:Ao,encodings_pars_fragment:Lo,envmap_fragment:No,envmap_pars_fragment:ko,envmap_pars_vertex:Ro,envmap_vertex:Do,fog_vertex:Fo,fog_pars_vertex:Bo,fog_fragment:jo,fog_pars_fragment:Uo,gradientmap_pars_fragment:zo,lightmap_fragment:Go,lightmap_pars_fragment:Vo,lights_lambert_vertex:Xo,lights_pars:Ho,lights_phong_fragment:qo,lights_phong_pars_fragment:Yo,lights_physical_fragment:Wo,lights_physical_pars_fragment:Zo,lights_template:Jo,logdepthbuf_fragment:Ko,logdepthbuf_pars_fragment:Qo,logdepthbuf_pars_vertex:$o,logdepthbuf_vertex:ta,map_fragment:ea,map_pars_fragment:na,map_particle_fragment:ia,map_particle_pars_fragment:ra,metalnessmap_fragment:oa,metalnessmap_pars_fragment:aa,morphnormal_vertex:sa,morphtarget_pars_vertex:ua,morphtarget_vertex:la,normal_flip:ca,normal_fragment:ha,normalmap_pars_fragment:fa,packing:da,premultiplied_alpha_fragment:pa,project_vertex:ga,dithering_fragment:va,dithering_pars_fragment:ma,roughnessmap_fragment:ya,roughnessmap_pars_fragment:_a,shadowmap_pars_fragment:ba,shadowmap_pars_vertex:xa,shadowmap_vertex:wa,shadowmask_pars_fragment:Ea,skinbase_vertex:Sa,skinning_pars_vertex:Ma,skinning_vertex:Ca,skinnormal_vertex:Ia,specularmap_fragment:Oa,specularmap_pars_fragment:Ta,tonemapping_fragment:Pa,tonemapping_pars_fragment:Aa,uv_pars_fragment:La,uv_pars_vertex:Na,uv_vertex:ka,uv2_pars_fragment:Ra,uv2_pars_vertex:Da,uv2_vertex:Fa,worldpos_vertex:Ba,cube_frag:ja,cube_vert:Ua,depth_frag:za,depth_vert:Ga,distanceRGBA_frag:Va,distanceRGBA_vert:Xa,equirect_frag:Ha,equirect_vert:qa,linedashed_frag:Ya,linedashed_vert:Wa,meshbasic_frag:Za,meshbasic_vert:Ja,meshlambert_frag:Ka,meshlambert_vert:Qa,meshphong_frag:$a,meshphong_vert:ts,meshphysical_frag:es,meshphysical_vert:ns,normal_frag:is,normal_vert:rs,points_frag:os,points_vert:as,shadow_frag:ss,shadow_vert:us},cs={basic:{uniforms:oo.merge([ro.common,ro.aomap,ro.lightmap,ro.fog]),vertexShader:ls.meshbasic_vert,fragmentShader:ls.meshbasic_frag},lambert:{uniforms:oo.merge([ro.common,ro.aomap,ro.lightmap,ro.emissivemap,ro.fog,ro.lights,{emissive:{value:new q(0)}}]),vertexShader:ls.meshlambert_vert,fragmentShader:ls.meshlambert_frag},phong:{uniforms:oo.merge([ro.common,ro.aomap,ro.lightmap,ro.emissivemap,ro.bumpmap,ro.normalmap,ro.displacementmap,ro.gradientmap,ro.fog,ro.lights,{emissive:{value:new q(0)},specular:{value:new q(1118481)},shininess:{value:30}}]),vertexShader:ls.meshphong_vert,fragmentShader:ls.meshphong_frag},standard:{uniforms:oo.merge([ro.common,ro.aomap,ro.lightmap,ro.emissivemap,ro.bumpmap,ro.normalmap,ro.displacementmap,ro.roughnessmap,ro.metalnessmap,ro.fog,ro.lights,{emissive:{value:new q(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ls.meshphysical_vert,fragmentShader:ls.meshphysical_frag},points:{uniforms:oo.merge([ro.points,ro.fog]),vertexShader:ls.points_vert,fragmentShader:ls.points_frag},dashed:{uniforms:oo.merge([ro.common,ro.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ls.linedashed_vert,fragmentShader:ls.linedashed_frag},depth:{uniforms:oo.merge([ro.common,ro.displacementmap]),vertexShader:ls.depth_vert,fragmentShader:ls.depth_frag},normal:{uniforms:oo.merge([ro.common,ro.bumpmap,ro.normalmap,ro.displacementmap,{opacity:{value:1}}]),vertexShader:ls.normal_vert,fragmentShader:ls.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ls.cube_vert,fragmentShader:ls.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:ls.equirect_vert,fragmentShader:ls.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new n}},vertexShader:ls.distanceRGBA_vert,fragmentShader:ls.distanceRGBA_frag}};cs.physical={uniforms:oo.merge([cs.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ls.meshphysical_vert,fragmentShader:ls.meshphysical_frag},a(Y.prototype,r.prototype,{isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var hs=0;a(W.prototype,r.prototype,{isMaterial:!0,setValues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n){var i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):"overdraw"===e?this[e]=Number(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){function e(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}var n=void 0===t;n&&(t={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Kn&&(i.blending=this.blending),this.shading!==qn&&(i.shading=this.shading),this.side!==Gn&&(i.side=this.side),this.vertexColors!==Yn&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),i.skinning=this.skinning,i.morphTargets=this.morphTargets,i.dithering=this.dithering,n){var r=e(t.textures),o=e(t.images);r.length>0&&(i.textures=r),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.lights=t.lights,this.blending=t.blending,this.side=t.side,this.shading=t.shading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.overdraw=t.overdraw,this.visible=t.visible,this.clipShadows=t.clipShadows,this.clipIntersection=t.clipIntersection;var e=t.clippingPlanes,n=null;if(null!==e){var i=e.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Z.prototype=Object.create(W.prototype),Z.prototype.constructor=Z,Z.prototype.isShaderMaterial=!0,Z.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=oo.clone(t.uniforms),this.defines=t.defines,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=t.extensions,this},Z.prototype.toJSON=function(t){var e=W.prototype.toJSON.call(this,t);return e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e},J.prototype=Object.create(W.prototype),J.prototype.constructor=J,J.prototype.isMeshDepthMaterial=!0,J.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},a(K.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=+(1/0),n=+(1/0),i=+(1/0),r=-(1/0),o=-(1/0),a=-(1/0),s=0,u=t.length;s<u;s+=3){var l=t[s],c=t[s+1],h=t[s+2];l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>o&&(o=c),h>a&&(a=h)}return this.min.set(e,n,i),this.max.set(r,o,a),this},setFromBufferAttribute:function(t){for(var e=+(1/0),n=+(1/0),i=+(1/0),r=-(1/0),o=-(1/0),a=-(1/0),s=0,u=t.count;s<u;s++){var l=t.getX(s),c=t.getY(s),h=t.getZ(s);l<e&&(e=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>o&&(o=c),h>a&&(a=h)}return this.min.set(e,n,i),this.max.set(r,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new n;return function(e,n){var i=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){var e=t||new n;return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new n;return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(){var t=new n;return function(e){var n=this;return e.updateMatrixWorld(!0),e.traverse(function(e){var i,r,o=e.geometry;if(void 0!==o)if(o.isGeometry){var a=o.vertices;for(i=0,r=a.length;i<r;i++)t.copy(a[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}else if(o.isBufferGeometry){var s=o.attributes.position;if(void 0!==s)for(i=0,r=s.count;i<r;i++)t.fromBufferAttribute(s,i).applyMatrix4(e.matrixWorld),n.expandByPoint(t)}}),this}}(),containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){var i=e||new n;return i.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(){var t=new n;return function(e){return this.clampPoint(e.center,t),t.distanceToSquared(e.center)<=e.radius*e.radius}}(),intersectsPlane:function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=t.constant&&n>=t.constant},clampPoint:function(t,e){var i=e||new n;return i.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new n;return function(e){var n=t.copy(e).clamp(this.min,this.max);return n.sub(e).length()}}(),getBoundingSphere:function(){var t=new n;return function(e){var n=e||new Q;return this.getCenter(n.center),n.radius=.5*this.getSize(t).length(),n}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new n,new n,new n,new n,new n,new n,new n,new n];return function(e){return this.isEmpty()?this:(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t),this)}}(),translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),a(Q.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new K;return function(e,n){var i=this.center;void 0!==n?i.copy(n):t.setFromPoints(e).getCenter(i);for(var r=0,o=0,a=e.length;o<a;o++)r=Math.max(r,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(this.center.dot(t.normal)-t.constant)<=this.radius},clampPoint:function(t,e){var i=this.center.distanceToSquared(t),r=e||new n;return r.copy(t),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(t){var e=t||new K;return e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}}),a($.prototype,{isMatrix3:!0,set:function(t,e,n,i,r,o,a,s,u){var l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=e,l[4]=r,l[5]=s,l[6]=n,l[7]=o,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new n;return function(e){for(var n=0,i=e.count;n<i;n++)t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.applyMatrix3(this),e.setXYZ(n,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],f=n[5],d=n[8],p=i[0],g=i[3],v=i[6],m=i[1],y=i[4],_=i[7],b=i[2],x=i[5],w=i[8];return r[0]=o*p+a*m+s*b,r[3]=o*g+a*y+s*x,r[6]=o*v+a*_+s*w,r[1]=u*p+l*m+c*b,r[4]=u*g+l*y+c*x,r[7]=u*v+l*_+c*w,r[2]=h*p+f*m+d*b,r[5]=h*g+f*y+d*x,r[8]=h*v+f*_+d*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*o*l-e*a*u-n*r*l+n*a*s+i*r*u-i*o*s},getInverse:function(t,e){t&&t.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var n=t.elements,i=this.elements,r=n[0],o=n[1],a=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],f=n[8],d=f*u-l*h,p=l*c-f*s,g=h*s-u*c,v=r*d+o*p+a*g;if(0===v){var m="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e===!0)throw new Error(m);return console.warn(m),this.identity()}var y=1/v;return i[0]=d*y,i[1]=(a*h-f*o)*y,i[2]=(l*o-a*u)*y,i[3]=p*y,i[4]=(f*r-a*c)*y,i[5]=(a*s-l*r)*y,i[6]=g*y,i[7]=(o*c-h*r)*y,i[8]=(u*r-o*s)*y,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},equals:function(t){for(var e=this.elements,n=t.elements,i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}}),a(tt.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new n,e=new n;return function(n,i,r){var o=t.subVectors(r,i).cross(e.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return this.orthoPoint(t,e).sub(t).negate()},orthoPoint:function(t,e){var i=this.distanceToPoint(t),r=e||new n;return r.copy(this.normal).multiplyScalar(i)},intersectLine:function(){var t=new n;return function(e,i){var r=i||new n,o=e.delta(t),a=this.normal.dot(o);if(0!==a){var s=-(e.start.dot(this.normal)+this.constant)/a;if(!(s<0||s>1))return r.copy(o).multiplyScalar(s).add(e.start)}else if(0===this.distanceToPoint(e.start))return r.copy(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){var e=t||new n;return e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new n,e=new $;return function(n,i){var r=this.coplanarPoint(t).applyMatrix4(n),o=i||e.getNormalMatrix(n),a=this.normal.applyMatrix3(o).normalize();return this.constant=-r.dot(a),this}}(),translate:function(t){return this.constant=this.constant-t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}),a(et.prototype,{set:function(t,e,n,i,r,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},setFromMatrix:function(t){var e=this.planes,n=t.elements,i=n[0],r=n[1],o=n[2],a=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=n[9],d=n[10],p=n[11],g=n[12],v=n[13],m=n[14],y=n[15];return e[0].setComponents(a-i,c-s,p-h,y-g).normalize(),e[1].setComponents(a+i,c+s,p+h,y+g).normalize(),e[2].setComponents(a+r,c+u,p+f,y+v).normalize(),e[3].setComponents(a-r,c-u,p-f,y-v).normalize(),e[4].setComponents(a-o,c-l,p-d,y-m).normalize(),e[5].setComponents(a+o,c+l,p+d,y+m).normalize(),this},intersectsObject:function(){var t=new Q;return function(e){var n=e.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),t.copy(n.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Q;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,n=t.center,i=-t.radius,r=0;r<6;r++){var o=e[r].distanceToPoint(n);if(o<i)return!1}return!0},intersectsBox:function(){var t=new n,e=new n;return function(n){for(var i=this.planes,r=0;r<6;r++){var o=i[r];t.x=o.normal.x>0?n.min.x:n.max.x,e.x=o.normal.x>0?n.max.x:n.min.x,t.y=o.normal.y>0?n.min.y:n.max.y,e.y=o.normal.y>0?n.max.y:n.min.y,t.z=o.normal.z>0?n.min.z:n.max.z,e.z=o.normal.z>0?n.max.z:n.min.z;var a=o.distanceToPoint(t),s=o.distanceToPoint(e);if(a<0&&s<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}}),a(it.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){var i=e||new n;return i.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(){var t=new n;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var i=e||new n;i.subVectors(t,this.origin);var r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(){var t=new n;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceToSquared(e))}}(),distanceSqToSegment:function(){var t=new n,e=new n,i=new n;return function(n,r,o,a){t.copy(n).add(r).multiplyScalar(.5),e.copy(r).sub(n).normalize(),i.copy(this.origin).sub(t);var s,u,l,c,h=.5*n.distanceTo(r),f=-this.direction.dot(e),d=i.dot(this.direction),p=-i.dot(e),g=i.lengthSq(),v=Math.abs(1-f*f);if(v>0)if(s=f*p-d,u=f*d-p,c=h*v,s>=0)if(u>=-c)if(u<=c){var m=1/v;s*=m,u*=m,l=s*(s+f*u+2*d)+u*(f*s+u+2*p)+g}else u=h,s=Math.max(0,-(f*u+d)),l=-s*s+u*(u+2*p)+g;else u=-h,s=Math.max(0,-(f*u+d)),l=-s*s+u*(u+2*p)+g;else u<=-c?(s=Math.max(0,-(-f*h+d)),u=s>0?-h:Math.min(Math.max(-h,-p),h),l=-s*s+u*(u+2*p)+g):u<=c?(s=0,u=Math.min(Math.max(-h,-p),h),l=u*(u+2*p)+g):(s=Math.max(0,-(f*h+d)),u=s>0?h:Math.min(Math.max(-h,-p),h),l=-s*s+u*(u+2*p)+g);else u=f>0?-h:h,s=Math.max(0,-(f*u+d)),l=-s*s+u*(u+2*p)+g;return o&&o.copy(this.direction).multiplyScalar(s).add(this.origin),a&&a.copy(e).multiplyScalar(u).add(t),l}}(),intersectSphere:function(){var t=new n;return function(e,n){t.subVectors(e.center,this.origin);var i=t.dot(this.direction),r=t.dot(t)-i*i,o=e.radius*e.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=i-a,u=i+a;return s<0&&u<0?null:s<0?this.at(u,n):this.at(s,n)}}(),intersectsSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);if(0===e)return!0;var n=t.normal.dot(this.direction);return n*e<0},intersectBox:function(t,e){var n,i,r,o,a,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(t.min.x-h.x)*u,i=(t.max.x-h.x)*u):(n=(t.max.x-h.x)*u,i=(t.min.x-h.x)*u),l>=0?(r=(t.min.y-h.y)*l,o=(t.max.y-h.y)*l):(r=(t.max.y-h.y)*l,o=(t.min.y-h.y)*l),n>o||r>i?null:((r>n||n!==n)&&(n=r),(o<i||i!==i)&&(i=o),c>=0?(a=(t.min.z-h.z)*c,s=(t.max.z-h.z)*c):(a=(t.max.z-h.z)*c,s=(t.min.z-h.z)*c),n>s||a>i?null:((a>n||n!==n)&&(n=a),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,e)))},intersectsBox:function(){var t=new n;return function(e){return null!==this.intersectBox(e,t)}}(),intersectTriangle:function(){var t=new n,e=new n,i=new n,r=new n;return function(n,o,a,s,u){e.subVectors(o,n),i.subVectors(a,n),r.crossVectors(e,i);var l,c=this.direction.dot(r);if(c>0){if(s)return null;l=1}else{if(!(c<0))return null;l=-1,c=-c}t.subVectors(this.origin,n);var h=l*this.direction.dot(i.crossVectors(t,i));if(h<0)return null;var f=l*this.direction.dot(e.cross(t));if(f<0)return null;if(h+f>c)return null;var d=-l*t.dot(r);return d<0?null:this.at(d/c,u)}}(),applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}),rt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],rt.DefaultOrder="XYZ",Object.defineProperties(rt.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),a(rt.prototype,{isEuler:!0,set:function(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){var i=Wr.clamp,r=t.elements,o=r[0],a=r[4],s=r[8],u=r[1],l=r[5],c=r[9],h=r[2],f=r[6],d=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,l),this._z=0)):"YXZ"===e?(this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(i(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(u,o))):"ZYX"===e?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(f,d),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,l))):"YZX"===e?(this._z=Math.asin(i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===e?(this._z=Math.asin(-i(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(f,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+e),this._order=e,n!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new i;return function(e,n,i){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,n,i)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new e;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new n(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}}),a(ot.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},test:function(t){return 0!==(this.mask&t.mask)}});var fs=0;at.DefaultUp=new n(0,1,0),at.DefaultMatrixAutoUpdate=!0,a(at.prototype,r.prototype,{isObject3D:!0,applyMatrix:function(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(){var t=new e;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new n(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new n(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new n(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new n;return function(e,n){
return t.copy(e).applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translateX:function(){var t=new n(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new n(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new n(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new i;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new i;return function(e){this.isCamera?t.lookAt(this.position,e,this.up):t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1)for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);var n=this.children.indexOf(t);n!==-1&&(t.parent=null,t.dispatchEvent({type:"removed"}),this.children.splice(n,1))},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n],o=r.getObjectByProperty(t,e);if(void 0!==o)return o}},getWorldPosition:function(t){var e=t||new n;return this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var t=new n,i=new n;return function(n){var r=n||new e;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,r,i),r}}(),getWorldRotation:function(){var t=new e;return function(e){var n=e||new rt;return this.getWorldQuaternion(t),n.setFromQuaternion(t,this.rotation.order,!1)}}(),getWorldScale:function(){var t=new n,i=new e;return function(e){var r=e||new n;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(t,i,r),r}}(),getWorldDirection:function(){var t=new e;return function(e){var i=e||new n;return this.getWorldQuaternion(t),i.set(0,0,1).applyQuaternion(t)}}(),raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverse(t)},traverseVisible:function(t){if(this.visible!==!1){t(this);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)},toJSON:function(t){function e(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}function n(t){var e=[];for(var n in t){var i=t[n];delete i.metadata,e.push(i)}return e}var i=void 0===t||""===t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),o.matrix=this.matrix.toArray(),void 0!==this.geometry&&(o.geometry=e(t.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var a=[],s=0,u=this.material.length;s<u;s++)a.push(e(t.materials,this.material[s]));o.material=a}else o.material=e(t.materials,this.material);if(this.children.length>0){o.children=[];for(var s=0;s<this.children.length;s++)o.children.push(this.children[s].toJSON(t).object)}if(i){var l=n(t.geometries),c=n(t.materials),h=n(t.textures),f=n(t.images);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),h.length>0&&(r.textures=h),f.length>0&&(r.images=f)}return r.object=o,r},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(var n=0;n<t.children.length;n++){var i=t.children[n];this.add(i.clone())}return this}}),a(st.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){var e=t||new n;return e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){var e=t||new n;return e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){var i=e||new n;return this.delta(i).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new n,e=new n;return function(n,i){t.subVectors(n,this.start),e.subVectors(this.end,this.start);var r=e.dot(e),o=e.dot(t),a=o/r;return i&&(a=Wr.clamp(a,0,1)),a}}(),closestPointToPoint:function(t,e,i){var r=this.closestPointToPointParameter(t,e),o=i||new n;return this.delta(o).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),a(ut,{normal:function(){var t=new n;return function(e,i,r,o){var a=o||new n;a.subVectors(r,i),t.subVectors(e,i),a.cross(t);var s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),barycoordFromPoint:function(){var t=new n,e=new n,i=new n;return function(r,o,a,s,u){t.subVectors(s,o),e.subVectors(a,o),i.subVectors(r,o);var l=t.dot(t),c=t.dot(e),h=t.dot(i),f=e.dot(e),d=e.dot(i),p=l*f-c*c,g=u||new n;if(0===p)return g.set(-2,-1,-1);var v=1/p,m=(f*h-c*d)*v,y=(l*d-c*h)*v;return g.set(1-m-y,y,m)}}(),containsPoint:function(){var t=new n;return function(e,n,i,r){var o=ut.barycoordFromPoint(e,n,i,r,t);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}()}),a(ut.prototype,{set:function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},setFromPointsAndIndices:function(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},area:function(){var t=new n,e=new n;return function(){return t.subVectors(this.c,this.b),e.subVectors(this.a,this.b),.5*t.cross(e).length()}}(),midpoint:function(t){var e=t||new n;return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return ut.normal(this.a,this.b,this.c,t)},plane:function(t){var e=t||new tt;return e.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,e){return ut.barycoordFromPoint(t,this.a,this.b,this.c,e)},containsPoint:function(t){return ut.containsPoint(t,this.a,this.b,this.c)},closestPointToPoint:function(){var t=new tt,e=[new st,new st,new st],i=new n,r=new n;return function(o,a){var s=a||new n,u=1/0;if(t.setFromCoplanarPoints(this.a,this.b,this.c),t.projectPoint(o,i),this.containsPoint(i)===!0)s.copy(i);else{e[0].set(this.a,this.b),e[1].set(this.b,this.c),e[2].set(this.c,this.a);for(var l=0;l<e.length;l++){e[l].closestPointToPoint(i,!0,r);var c=i.distanceToSquared(r);c<u&&(u=c,s.copy(r))}}return s}}(),equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}),a(lt.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,n=t.vertexNormals.length;e<n;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(var e=0,n=t.vertexColors.length;e<n;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}),ct.prototype=Object.create(W.prototype),ct.prototype.constructor=ct,ct.prototype.isMeshBasicMaterial=!0,ct.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this},Object.defineProperty(ht.prototype,"needsUpdate",{set:function(t){t===!0&&this.version++}}),a(ht.prototype,{isBufferAttribute:!0,setArray:function(t){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==t?t.length/this.itemSize:0,this.array=t},setDynamic:function(t){return this.dynamic=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.dynamic=t.dynamic,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new q),e[n++]=o.r,e[n++]=o.g,e[n++]=o.b}return this},copyIndicesArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];e[n++]=o.a,e[n++]=o.b,e[n++]=o.c}return this},copyVector2sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var a=t[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),a=new o),e[n++]=a.x,e[n++]=a.y}return this},copyVector3sArray:function(t){for(var e=this.array,i=0,r=0,o=t.length;r<o;r++){var a=t[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new n),e[i++]=a.x,e[i++]=a.y,e[i++]=a.z}return this},copyVector4sArray:function(t){for(var e=this.array,n=0,i=0,r=t.length;i<r;i++){var o=t[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new H),e[n++]=o.x,e[n++]=o.y,e[n++]=o.z,e[n++]=o.w}return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this},setXYZW:function(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),ft.prototype=Object.create(ht.prototype),ft.prototype.constructor=ft,dt.prototype=Object.create(ht.prototype),dt.prototype.constructor=dt,pt.prototype=Object.create(ht.prototype),pt.prototype.constructor=pt,gt.prototype=Object.create(ht.prototype),gt.prototype.constructor=gt,vt.prototype=Object.create(ht.prototype),vt.prototype.constructor=vt,mt.prototype=Object.create(ht.prototype),mt.prototype.constructor=mt,yt.prototype=Object.create(ht.prototype),yt.prototype.constructor=yt,_t.prototype=Object.create(ht.prototype),_t.prototype.constructor=_t,bt.prototype=Object.create(ht.prototype),bt.prototype.constructor=bt,a(xt.prototype,{computeGroups:function(t){for(var e,n=[],i=void 0,r=t.faces,o=0;o<r.length;o++){var a=r[o];a.materialIndex!==i&&(i=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,n.push(e)),e={start:3*o,materialIndex:i})}void 0!==e&&(e.count=3*o-e.start,n.push(e)),this.groups=n},fromGeometry:function(t){var e,n=t.faces,i=t.vertices,r=t.faceVertexUvs,a=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,u=t.morphTargets,l=u.length;if(l>0){e=[];for(var c=0;c<l;c++)e[c]=[];this.morphTargets.position=e}var h,f=t.morphNormals,d=f.length;if(d>0){h=[];for(var c=0;c<d;c++)h[c]=[];this.morphTargets.normal=h}for(var p=t.skinIndices,g=t.skinWeights,v=p.length===i.length,m=g.length===i.length,c=0;c<n.length;c++){var y=n[c];this.vertices.push(i[y.a],i[y.b],i[y.c]);var _=y.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var b=y.normal;this.normals.push(b,b,b)}var x=y.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=y.color;this.colors.push(w,w,w)}if(a===!0){var E=r[0][c];void 0!==E?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new o,new o,new o))}if(s===!0){var E=r[1][c];void 0!==E?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new o,new o,new o))}for(var S=0;S<l;S++){var M=u[S].vertices;e[S].push(M[y.a],M[y.b],M[y.c])}for(var S=0;S<d;S++){var C=f[S].vertexNormals[c];h[S].push(C.a,C.b,C.c)}v&&this.skinIndices.push(p[y.a],p[y.b],p[y.c]),m&&this.skinWeights.push(g[y.a],g[y.b],g[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}});var ds=0;a(St.prototype,r.prototype,{isGeometry:!0,applyMatrix:function(t){for(var e=(new $).getNormalMatrix(t),n=0,i=this.vertices.length;n<i;n++){var r=this.vertices[n];r.applyMatrix4(t)}for(var n=0,i=this.faces.length;n<i;n++){var o=this.faces[n];o.normal.applyMatrix3(e).normalize();for(var a=0,s=o.vertexNormals.length;a<s;a++)o.vertexNormals[a].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var t=new i;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new i;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new i;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new i;return function(e,n,i){return t.makeTranslation(e,n,i),this.applyMatrix(t),this}}(),scale:function(){var t=new i;return function(e,n,i){return t.makeScale(e,n,i),this.applyMatrix(t),this}}(),lookAt:function(){var t=new at;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),fromBufferGeometry:function(t){function e(t,e,n,r){var o=void 0!==u?[f[t].clone(),f[e].clone(),f[n].clone()]:[],a=void 0!==l?[i.colors[t].clone(),i.colors[e].clone(),i.colors[n].clone()]:[],s=new lt(t,e,n,o,a,r);i.faces.push(s),void 0!==c&&i.faceVertexUvs[0].push([d[t].clone(),d[e].clone(),d[n].clone()]),void 0!==h&&i.faceVertexUvs[1].push([p[t].clone(),p[e].clone(),p[n].clone()])}var i=this,r=null!==t.index?t.index.array:void 0,a=t.attributes,s=a.position.array,u=void 0!==a.normal?a.normal.array:void 0,l=void 0!==a.color?a.color.array:void 0,c=void 0!==a.uv?a.uv.array:void 0,h=void 0!==a.uv2?a.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var f=[],d=[],p=[],g=0,v=0;g<s.length;g+=3,v+=2)i.vertices.push(new n(s[g],s[g+1],s[g+2])),void 0!==u&&f.push(new n(u[g],u[g+1],u[g+2])),void 0!==l&&i.colors.push(new q(l[g],l[g+1],l[g+2])),void 0!==c&&d.push(new o(c[v],c[v+1])),void 0!==h&&p.push(new o(h[v],h[v+1]));var m=t.groups;if(m.length>0)for(var g=0;g<m.length;g++)for(var y=m[g],_=y.start,b=y.count,v=_,x=_+b;v<x;v+=3)void 0!==r?e(r[v],r[v+1],r[v+2],y.materialIndex):e(v,v+1,v+2,y.materialIndex);else if(void 0!==r)for(var g=0;g<r.length;g+=3)e(r[g],r[g+1],r[g+2]);else for(var g=0;g<s.length/3;g+=3)e(g,g+1,g+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,n=0===e?1:1/e,r=new i;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var t=new n,e=new n,i=0,r=this.faces.length;i<r;i++){var o=this.faces[i],a=this.vertices[o.a],s=this.vertices[o.b],u=this.vertices[o.c];t.subVectors(u,s),e.subVectors(a,s),t.cross(e),t.normalize(),o.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);var e,i,r,o,a,s;for(s=new Array(this.vertices.length),e=0,i=this.vertices.length;e<i;e++)s[e]=new n;if(t){var u,l,c,h=new n,f=new n;for(r=0,o=this.faces.length;r<o;r++)a=this.faces[r],u=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],h.subVectors(c,l),f.subVectors(u,l),h.cross(f),s[a.a].add(h),s[a.b].add(h),s[a.c].add(h)}else for(this.computeFaceNormals(),r=0,o=this.faces.length;r<o;r++)a=this.faces[r],s[a.a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal);for(e=0,i=this.vertices.length;e<i;e++)s[e].normalize();for(r=0,o=this.faces.length;r<o;r++){a=this.faces[r];var d=a.vertexNormals;3===d.length?(d[0].copy(s[a.a]),d[1].copy(s[a.b]),d[2].copy(s[a.c])):(d[0]=s[a.a].clone(),d[1]=s[a.b].clone(),d[2]=s[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,n;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){n=this.faces[t];var i=n.vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,i,r,o;for(i=0,r=this.faces.length;i<r;i++)for(o=this.faces[i],o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),t=0,e=o.vertexNormals.length;t<e;t++)o.__originalVertexNormals[t]?o.__originalVertexNormals[t].copy(o.vertexNormals[t]):o.__originalVertexNormals[t]=o.vertexNormals[t].clone();var a=new St;for(a.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var s,u,l=this.morphNormals[t].faceNormals,c=this.morphNormals[t].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)s=new n,u={a:new n,b:new n,c:new n},l.push(s),c.push(u)}var h=this.morphNormals[t];a.vertices=this.morphTargets[t].vertices,a.computeFaceNormals(),a.computeVertexNormals();var s,u;for(i=0,r=this.faces.length;i<r;i++)o=this.faces[i],s=h.faceNormals[i],u=h.vertexNormals[i],s.copy(o.normal),u.a.copy(o.vertexNormals[0]),u.b.copy(o.vertexNormals[1]),u.c.copy(o.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)o=this.faces[i],o.normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeLineDistances:function(){for(var t=0,e=this.vertices,n=0,i=e.length;n<i;n++)n>0&&(t+=e[n].distanceTo(e[n-1])),this.lineDistances[n]=t},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new K),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Q),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if((t&&t.isGeometry)===!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);var i,r=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,u=t.faces,l=this.faceVertexUvs[0],c=t.faceVertexUvs[0],h=this.colors,f=t.colors;void 0===n&&(n=0),void 0!==e&&(i=(new $).getNormalMatrix(e));for(var d=0,p=a.length;d<p;d++){var g=a[d],v=g.clone();void 0!==e&&v.applyMatrix4(e),o.push(v)}for(var d=0,p=f.length;d<p;d++)h.push(f[d].clone());for(d=0,p=u.length;d<p;d++){var m,y,_,b=u[d],x=b.vertexNormals,w=b.vertexColors;m=new lt(b.a+r,b.b+r,b.c+r),m.normal.copy(b.normal),void 0!==i&&m.normal.applyMatrix3(i).normalize();for(var E=0,S=x.length;E<S;E++)y=x[E].clone(),void 0!==i&&y.applyMatrix3(i).normalize(),m.vertexNormals.push(y);m.color.copy(b.color);for(var E=0,S=w.length;E<S;E++)_=w[E],m.vertexColors.push(_.clone());m.materialIndex=b.materialIndex+n,s.push(m)}for(d=0,p=c.length;d<p;d++){var M=c[d],C=[];if(void 0!==M){for(var E=0,S=M.length;E<S;E++)C.push(M[E].clone());l.push(C)}}},mergeMesh:function(t){return(t&&t.isMesh)===!1?void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t):(t.matrixAutoUpdate&&t.updateMatrix(),void this.merge(t.geometry,t.matrix))},mergeVertices:function(){var t,e,n,i,r,o,a,s,u={},l=[],c=[],h=4,f=Math.pow(10,h);for(n=0,i=this.vertices.length;n<i;n++)t=this.vertices[n],e=Math.round(t.x*f)+"_"+Math.round(t.y*f)+"_"+Math.round(t.z*f),void 0===u[e]?(u[e]=n,l.push(this.vertices[n]),c[n]=l.length-1):c[n]=c[u[e]];var d=[];for(n=0,i=this.faces.length;n<i;n++){r=this.faces[n],r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(o[p]===o[(p+1)%3]){d.push(n);break}}for(n=d.length-1;n>=0;n--){var g=d[n];for(this.faces.splice(g,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(g,1)}var v=this.vertices.length-l.length;return this.vertices=l,v},sortFacesByMaterialIndex:function(){function t(t,e){return t.materialIndex-e.materialIndex}for(var e=this.faces,n=e.length,i=0;i<n;i++)e[i]._id=i;e.sort(t);var r,o,a=this.faceVertexUvs[0],s=this.faceVertexUvs[1];a&&a.length===n&&(r=[]),s&&s.length===n&&(o=[]);for(var i=0;i<n;i++){var u=e[i]._id;r&&r.push(a[u]),o&&o.push(s[u])}r&&(this.faceVertexUvs[0]=r),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){function t(t,e,n){return n?t|1<<e:t&~(1<<e)}function e(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==f[e]?f[e]:(f[e]=h.length/3,h.push(t.x,t.y,t.z),f[e])}function n(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==p[e]?p[e]:(p[e]=d.length,d.push(t.getHex()),p[e])}function i(t){var e=t.x.toString()+t.y.toString();return void 0!==v[e]?v[e]:(v[e]=g.length/2,g.push(t.x,t.y),v[e])}var r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o=this.parameters;for(var a in o)void 0!==o[a]&&(r[a]=o[a]);return r}for(var s=[],u=0;u<this.vertices.length;u++){var l=this.vertices[u];s.push(l.x,l.y,l.z)}for(var c=[],h=[],f={},d=[],p={},g=[],v={},u=0;u<this.faces.length;u++){var m=this.faces[u],y=!0,_=!1,b=void 0!==this.faceVertexUvs[0][u],x=m.normal.length()>0,w=m.vertexNormals.length>0,E=1!==m.color.r||1!==m.color.g||1!==m.color.b,S=m.vertexColors.length>0,M=0;if(M=t(M,0,0),M=t(M,1,y),M=t(M,2,_),M=t(M,3,b),M=t(M,4,x),M=t(M,5,w),M=t(M,6,E),M=t(M,7,S),c.push(M),c.push(m.a,m.b,m.c),c.push(m.materialIndex),b){var C=this.faceVertexUvs[0][u];c.push(i(C[0]),i(C[1]),i(C[2]))}if(x&&c.push(e(m.normal)),w){var I=m.vertexNormals;c.push(e(I[0]),e(I[1]),e(I[2]))}if(E&&c.push(n(m.color)),S){var O=m.vertexColors;c.push(n(O[0]),n(O[1]),n(O[2]))}}return r.data={},r.data.vertices=s,r.data.normals=h,d.length>0&&(r.data.colors=d),g.length>0&&(r.data.uvs=[g]),r.data.faces=c,r},clone:function(){return(new St).copy(this)},copy:function(t){var e,n,i,r,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,n=s.length;e<n;e++)this.vertices.push(s[e].clone());var u=t.colors;for(e=0,n=u.length;e<n;e++)this.colors.push(u[e].clone());var l=t.faces;for(e=0,n=l.length;e<n;e++)this.faces.push(l[e].clone());for(e=0,n=t.faceVertexUvs.length;e<n;e++){var c=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),i=0,r=c.length;i<r;i++){var h=c[i],f=[];for(o=0,a=h.length;o<a;o++){var d=h[o];f.push(d.clone())}this.faceVertexUvs[e].push(f)}}var p=t.morphTargets;for(e=0,n=p.length;e<n;e++){var g={};if(g.name=p[e].name,void 0!==p[e].vertices)for(g.vertices=[],i=0,r=p[e].vertices.length;i<r;i++)g.vertices.push(p[e].vertices[i].clone());if(void 0!==p[e].normals)for(g.normals=[],i=0,r=p[e].normals.length;i<r;i++)g.normals.push(p[e].normals[i].clone());this.morphTargets.push(g)}var v=t.morphNormals;for(e=0,n=v.length;e<n;e++){var m={};if(void 0!==v[e].vertexNormals)for(m.vertexNormals=[],i=0,r=v[e].vertexNormals.length;i<r;i++){var y=v[e].vertexNormals[i],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),m.vertexNormals.push(_)}if(void 0!==v[e].faceNormals)for(m.faceNormals=[],i=0,r=v[e].faceNormals.length;i<r;i++)m.faceNormals.push(v[e].faceNormals[i].clone());this.morphNormals.push(m)}var b=t.skinWeights;for(e=0,n=b.length;e<n;e++)this.skinWeights.push(b[e].clone());var x=t.skinIndices;for(e=0,n=x.length;e<n;e++)this.skinIndices.push(x[e].clone());var w=t.lineDistances;for(e=0,n=w.length;e<n;e++)this.lineDistances.push(w[e]);var E=t.boundingBox;null!==E&&(this.boundingBox=E.clone());var S=t.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Mt.MaxIndex=65535,a(Mt.prototype,r.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(wt(t)>65535?yt:vt)(t,1):this.index=t},addAttribute:function(t,e){return(e&&e.isBufferAttribute)===!1&&(e&&e.isInterleavedBufferAttribute)===!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(t,new ht(arguments[1],arguments[2]))):"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(e)):(this.attributes[t]=e,this)},getAttribute:function(t){return this.attributes[t]},removeAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix:function(t){var e=this.attributes.position;void 0!==e&&(t.applyToBufferAttribute(e),e.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new $).getNormalMatrix(t);i.applyToBufferAttribute(n),n.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var t=new i;return function(e){return t.makeRotationX(e),this.applyMatrix(t),this}}(),rotateY:function(){var t=new i;return function(e){return t.makeRotationY(e),this.applyMatrix(t),this}}(),rotateZ:function(){var t=new i;return function(e){return t.makeRotationZ(e),this.applyMatrix(t),this}}(),translate:function(){var t=new i;return function(e,n,i){return t.makeTranslation(e,n,i),this.applyMatrix(t),this}}(),scale:function(){var t=new i;return function(e,n,i){return t.makeScale(e,n,i),this.applyMatrix(t),this}}(),lookAt:function(){var t=new at;return function(e){t.lookAt(e),t.updateMatrix(),this.applyMatrix(t.matrix)}}(),center:function(){this.computeBoundingBox();var t=this.boundingBox.getCenter().negate();return this.translate(t.x,t.y,t.z),t},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var n=new _t(3*e.vertices.length,3),i=new _t(3*e.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(e.vertices)),this.addAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var r=new _t(e.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},updateFromObject:function(t){var e=t.geometry;if(t.isMesh){var n=e.__directGeometry;if(e.elementsNeedUpdate===!0&&(n=void 0,e.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(e);n.verticesNeedUpdate=e.verticesNeedUpdate,n.normalsNeedUpdate=e.normalsNeedUpdate,n.colorsNeedUpdate=e.colorsNeedUpdate,n.uvsNeedUpdate=e.uvsNeedUpdate,n.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=n}var i;return e.verticesNeedUpdate===!0&&(i=this.attributes.position,void 0!==i&&(i.copyVector3sArray(e.vertices),i.needsUpdate=!0),e.verticesNeedUpdate=!1),e.normalsNeedUpdate===!0&&(i=this.attributes.normal,void 0!==i&&(i.copyVector3sArray(e.normals),i.needsUpdate=!0),e.normalsNeedUpdate=!1),e.colorsNeedUpdate===!0&&(i=this.attributes.color,void 0!==i&&(i.copyColorsArray(e.colors),i.needsUpdate=!0),e.colorsNeedUpdate=!1),e.uvsNeedUpdate&&(i=this.attributes.uv,void 0!==i&&(i.copyVector2sArray(e.uvs),i.needsUpdate=!0),e.uvsNeedUpdate=!1),e.lineDistancesNeedUpdate&&(i=this.attributes.lineDistance,void 0!==i&&(i.copyArray(e.lineDistances),i.needsUpdate=!0),e.lineDistancesNeedUpdate=!1),e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new xt).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.addAttribute("position",new ht(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var n=new Float32Array(3*t.normals.length);this.addAttribute("normal",new ht(n,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var i=new Float32Array(3*t.colors.length);this.addAttribute("color",new ht(i,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var r=new Float32Array(2*t.uvs.length);this.addAttribute("uv",new ht(r,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.addAttribute("uv2",new ht(o,2).copyVector2sArray(t.uvs2))}if(t.indices.length>0){var a=wt(t.indices)>65535?Uint32Array:Uint16Array,s=new a(3*t.indices.length);this.setIndex(new ht(s,1).copyIndicesArray(t.indices))}this.groups=t.groups;for(var u in t.morphTargets){for(var l=[],c=t.morphTargets[u],h=0,f=c.length;h<f;h++){
var d=c[h],p=new _t(3*d.length,3);l.push(p.copyVector3sArray(d))}this.morphAttributes[u]=l}if(t.skinIndices.length>0){var g=new _t(4*t.skinIndices.length,4);this.addAttribute("skinIndex",g.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var v=new _t(4*t.skinWeights.length,4);this.addAttribute("skinWeight",v.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new K);var t=this.attributes.position;void 0!==t?this.boundingBox.setFromBufferAttribute(t):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var t=new K,e=new n;return function(){null===this.boundingSphere&&(this.boundingSphere=new Q);var n=this.attributes.position;if(n){var i=this.boundingSphere.center;t.setFromBufferAttribute(n),t.getCenter(i);for(var r=0,o=0,a=n.count;o<a;o++)e.x=n.getX(o),e.y=n.getY(o),e.z=n.getZ(o),r=Math.max(r,i.distanceToSquared(e));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes,i=this.groups;if(e.position){var r=e.position.array;if(void 0===e.normal)this.addAttribute("normal",new ht(new Float32Array(r.length),3));else for(var o=e.normal.array,a=0,s=o.length;a<s;a++)o[a]=0;var u,l,c,h=e.normal.array,f=new n,d=new n,p=new n,g=new n,v=new n;if(t){var m=t.array;0===i.length&&this.addGroup(0,m.length);for(var y=0,_=i.length;y<_;++y)for(var b=i[y],x=b.start,w=b.count,a=x,s=x+w;a<s;a+=3)u=3*m[a+0],l=3*m[a+1],c=3*m[a+2],f.fromArray(r,u),d.fromArray(r,l),p.fromArray(r,c),g.subVectors(p,d),v.subVectors(f,d),g.cross(v),h[u]+=g.x,h[u+1]+=g.y,h[u+2]+=g.z,h[l]+=g.x,h[l+1]+=g.y,h[l+2]+=g.z,h[c]+=g.x,h[c+1]+=g.y,h[c+2]+=g.z}else for(var a=0,s=r.length;a<s;a+=9)f.fromArray(r,a),d.fromArray(r,a+3),p.fromArray(r,a+6),g.subVectors(p,d),v.subVectors(f,d),g.cross(v),h[a]=g.x,h[a+1]=g.y,h[a+2]=g.z,h[a+3]=g.x,h[a+4]=g.y,h[a+5]=g.z,h[a+6]=g.x,h[a+7]=g.y,h[a+8]=g.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if((t&&t.isBufferGeometry)===!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0);var n=this.attributes;for(var i in n)if(void 0!==t.attributes[i])for(var r=n[i],o=r.array,a=t.attributes[i],s=a.array,u=a.itemSize,l=0,c=u*e;l<s.length;l++,c++)o[c]=s[l];return this},normalizeNormals:function(){for(var t,e,n,i,r=this.attributes.normal,o=0,a=r.count;o<a;o++)t=r.getX(o),e=r.getY(o),n=r.getZ(o),i=1/Math.sqrt(t*t+e*e+n*n),r.setXYZ(o,t*i,e*i,n*i)},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Mt,e=this.index.array,n=this.attributes;for(var i in n){for(var r=n[i],o=r.array,a=r.itemSize,s=new o.constructor(e.length*a),u=0,l=0,c=0,h=e.length;c<h;c++){u=e[c]*a;for(var f=0;f<a;f++)s[l++]=o[u++]}t.addAttribute(i,new ht(s,a))}return t},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var i=this.index;if(null!==i){var r=Array.prototype.slice.call(i.array);t.data.index={type:i.array.constructor.name,array:r}}var o=this.attributes;for(var n in o){var a=o[n],r=Array.prototype.slice.call(a.array);t.data.attributes[n]={itemSize:a.itemSize,type:a.array.constructor.name,array:r,normalized:a.normalized}}var s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));var u=this.boundingSphere;return null!==u&&(t.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),t},clone:function(){return(new Mt).copy(this)},copy:function(t){var e,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var r=t.index;null!==r&&this.setIndex(r.clone());var o=t.attributes;for(e in o){var a=o[e];this.addAttribute(e,a.clone())}var s=t.morphAttributes;for(e in s){var u=[],l=s[e];for(n=0,i=l.length;n<i;n++)u.push(l[n].clone());this.morphAttributes[e]=u}var c=t.groups;for(n=0,i=c.length;n<i;n++){var h=c[n];this.addGroup(h.start,h.count,h.materialIndex)}var f=t.boundingBox;null!==f&&(this.boundingBox=f.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Ct.prototype=a(Object.create(at.prototype),{constructor:Ct,isMesh:!0,setDrawMode:function(t){this.drawMode=t},copy:function(t){return at.prototype.copy.call(this,t),this.drawMode=t.drawMode,this},updateMorphTargets:function(){var t=this.geometry.morphTargets;if(void 0!==t&&t.length>0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,n=t.length;e<n;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[t[e].name]=e}},raycast:function(){function t(t,e,n,i,r,o,a){return ut.barycoordFromPoint(t,e,n,i,y),r.multiplyScalar(y.x),o.multiplyScalar(y.y),a.multiplyScalar(y.z),r.add(o).add(a),r.clone()}function e(t,e,n,i,r,o,a){var s,u=t.material;if(s=u.side===Vn?n.intersectTriangle(o,r,i,!0,a):n.intersectTriangle(i,r,o,u.side!==Xn,a),null===s)return null;b.copy(a),b.applyMatrix4(t.matrixWorld);var l=e.ray.origin.distanceTo(b);return l<e.near||l>e.far?null:{distance:l,point:b.clone(),object:t}}function r(n,i,r,o,a,s,u,f){l.fromBufferAttribute(o,s),c.fromBufferAttribute(o,u),h.fromBufferAttribute(o,f);var d=e(n,i,r,l,c,h,_);return d&&(a&&(g.fromBufferAttribute(a,s),v.fromBufferAttribute(a,u),m.fromBufferAttribute(a,f),d.uv=t(_,l,c,h,g,v,m)),d.face=new lt(s,u,f,ut.normal(l,c,h)),d.faceIndex=s),d}var a=new i,s=new it,u=new Q,l=new n,c=new n,h=new n,f=new n,d=new n,p=new n,g=new o,v=new o,m=new o,y=new n,_=new n,b=new n;return function(n,i){var o=this.geometry,y=this.material,b=this.matrixWorld;if(void 0!==y&&(null===o.boundingSphere&&o.computeBoundingSphere(),u.copy(o.boundingSphere),u.applyMatrix4(b),n.ray.intersectsSphere(u)!==!1&&(a.getInverse(b),s.copy(n.ray).applyMatrix4(a),null===o.boundingBox||s.intersectsBox(o.boundingBox)!==!1))){var x;if(o.isBufferGeometry){var w,E,S,M,C,I=o.index,O=o.attributes.position,T=o.attributes.uv;if(null!==I)for(M=0,C=I.count;M<C;M+=3)w=I.getX(M),E=I.getX(M+1),S=I.getX(M+2),x=r(this,n,s,O,T,w,E,S),x&&(x.faceIndex=Math.floor(M/3),i.push(x));else for(M=0,C=O.count;M<C;M+=3)w=M,E=M+1,S=M+2,x=r(this,n,s,O,T,w,E,S),x&&(x.index=w,i.push(x))}else if(o.isGeometry){var P,A,L,N,k=Array.isArray(y),R=o.vertices,D=o.faces,F=o.faceVertexUvs[0];F.length>0&&(N=F);for(var B=0,j=D.length;B<j;B++){var U=D[B],z=k?y[U.materialIndex]:y;if(void 0!==z){if(P=R[U.a],A=R[U.b],L=R[U.c],z.morphTargets===!0){var G=o.morphTargets,V=this.morphTargetInfluences;l.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(var X=0,H=G.length;X<H;X++){var q=V[X];if(0!==q){var Y=G[X].vertices;l.addScaledVector(f.subVectors(Y[U.a],P),q),c.addScaledVector(d.subVectors(Y[U.b],A),q),h.addScaledVector(p.subVectors(Y[U.c],L),q)}}l.add(P),c.add(A),h.add(L),P=l,A=c,L=h}if(x=e(this,n,s,P,A,L,_)){if(N&&N[B]){var W=N[B];g.copy(W[0]),v.copy(W[1]),m.copy(W[2]),x.uv=t(_,P,A,L,g,v,m)}x.face=U,x.faceIndex=B,i.push(x)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),It.prototype=Object.create(Mt.prototype),It.prototype.constructor=It,Ot.prototype=Object.create(Mt.prototype),Ot.prototype.constructor=Ot,Tt.prototype=a(Object.create(at.prototype),{constructor:Tt,isCamera:!0,copy:function(t){return at.prototype.copy.call(this,t),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this},getWorldDirection:function(){var t=new e;return function(e){var i=e||new n;return this.getWorldQuaternion(t),i.set(0,0,-1).applyQuaternion(t)}}(),clone:function(){return(new this.constructor).copy(this)}}),Pt.prototype=a(Object.create(Tt.prototype),{constructor:Pt,isPerspectiveCamera:!0,copy:function(t){return Tt.prototype.copy.call(this,t),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:a({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*Wr.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*Wr.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Wr.RAD2DEG*Math.atan(Math.tan(.5*Wr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,i,r,o){this.aspect=t/e,this.view={fullWidth:t,fullHeight:e,offsetX:n,offsetY:i,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*Wr.DEG2RAD*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i,o=this.view;if(null!==o){var a=o.fullWidth,s=o.fullHeight;r+=o.offsetX*i/a,e-=o.offsetY*n/s,i*=o.width/a,n*=o.height/s}var u=this.filmOffset;0!==u&&(r+=t*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far)},toJSON:function(t){var e=at.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=a({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),At.prototype=a(Object.create(Tt.prototype),{constructor:At,isOrthographicCamera:!0,copy:function(t){return Tt.prototype.copy.call(this,t),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:a({},t.view),this},setViewOffset:function(t,e,n,i,r,o){this.view={fullWidth:t,fullHeight:e,offsetX:n,offsetY:i,width:r,height:o},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-t,o=n+t,a=i+e,s=i-e;if(null!==this.view){var u=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;r+=c*(this.view.offsetX/u),o=r+c*(this.view.width/u),a-=h*(this.view.offsetY/l),s=a-h*(this.view.height/l)}this.projectionMatrix.makeOrthographic(r,o,a,s,this.near,this.far)},toJSON:function(t){var e=at.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=a({},this.view)),e}});var ps=0;ce.prototype=a(Object.create(at.prototype),{constructor:ce,copy:function(t,e){return at.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=at.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}),he.prototype=Object.create(W.prototype),he.prototype.constructor=he,he.prototype.isSpriteMaterial=!0,he.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.rotation=t.rotation,this},fe.prototype=a(Object.create(at.prototype),{constructor:fe,isSprite:!0,raycast:function(){var t=new n,e=new n,i=new n;return function(n,r){e.setFromMatrixPosition(this.matrixWorld),n.ray.closestPointToPoint(e,t),i.setFromMatrixScale(this.matrixWorld);var o=i.x*i.y/4;if(!(e.distanceToSquared(t)>o)){var a=n.ray.origin.distanceTo(t);a<n.near||a>n.far||r.push({distance:a,point:t.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),de.prototype=Object.create(W.prototype),de.prototype.constructor=de,de.prototype.isLineBasicMaterial=!0,de.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this},pe.prototype=a(Object.create(at.prototype),{constructor:pe,isLine:!0,raycast:function(){var t=new i,e=new it,r=new Q;return function(i,o){var a=i.linePrecision,s=a*a,u=this.geometry,l=this.matrixWorld;if(null===u.boundingSphere&&u.computeBoundingSphere(),r.copy(u.boundingSphere),r.applyMatrix4(l),i.ray.intersectsSphere(r)!==!1){t.getInverse(l),e.copy(i.ray).applyMatrix4(t);var c=new n,h=new n,f=new n,d=new n,p=this&&this.isLineSegments?2:1;if(u.isBufferGeometry){var g=u.index,v=u.attributes,m=v.position.array;if(null!==g)for(var y=g.array,_=0,b=y.length-1;_<b;_+=p){var x=y[_],w=y[_+1];c.fromArray(m,3*x),h.fromArray(m,3*w);var E=e.distanceSqToSegment(c,h,d,f);if(!(E>s)){d.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(d);S<i.near||S>i.far||o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else for(var _=0,b=m.length/3-1;_<b;_+=p){c.fromArray(m,3*_),h.fromArray(m,3*_+3);var E=e.distanceSqToSegment(c,h,d,f);if(!(E>s)){d.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(d);S<i.near||S>i.far||o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(u.isGeometry)for(var M=u.vertices,C=M.length,_=0;_<C-1;_+=p){var E=e.distanceSqToSegment(M[_],M[_+1],d,f);if(!(E>s)){d.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(d);S<i.near||S>i.far||o.push({distance:S,point:f.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ge.prototype=a(Object.create(pe.prototype),{constructor:ge,isLineSegments:!0}),ve.prototype=Object.create(W.prototype),ve.prototype.constructor=ve,ve.prototype.isPointsMaterial=!0,ve.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this},me.prototype=a(Object.create(at.prototype),{constructor:me,isPoints:!0,raycast:function(){var t=new i,e=new it,r=new Q;return function(i,o){function a(t,n){var r=e.distanceSqToPoint(t);if(r<f){var a=e.closestPointToPoint(t);a.applyMatrix4(l);var u=i.ray.origin.distanceTo(a);if(u<i.near||u>i.far)return;o.push({distance:u,distanceToRay:Math.sqrt(r),point:a.clone(),index:n,face:null,object:s})}}var s=this,u=this.geometry,l=this.matrixWorld,c=i.params.Points.threshold;if(null===u.boundingSphere&&u.computeBoundingSphere(),r.copy(u.boundingSphere),r.applyMatrix4(l),r.radius+=c,i.ray.intersectsSphere(r)!==!1){t.getInverse(l),e.copy(i.ray).applyMatrix4(t);var h=c/((this.scale.x+this.scale.y+this.scale.z)/3),f=h*h,d=new n;if(u.isBufferGeometry){var p=u.index,g=u.attributes,v=g.position.array;if(null!==p)for(var m=p.array,y=0,_=m.length;y<_;y++){var b=m[y];d.fromArray(v,3*b),a(d,b)}else for(var y=0,x=v.length/3;y<x;y++)d.fromArray(v,3*y),a(d,y)}else for(var w=u.vertices,y=0,x=w.length;y<x;y++)a(w[y],y)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ye.prototype=a(Object.create(at.prototype),{constructor:ye}),_e.prototype=Object.create(St.prototype),_e.prototype.constructor=_e,be.prototype=Object.create(Mt.prototype),be.prototype.constructor=be,xe.prototype=Object.create(St.prototype),xe.prototype.constructor=xe,we.prototype=Object.create(Mt.prototype),we.prototype.constructor=we;var gs={area:function(t){for(var e=t.length,n=0,i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n},triangulate:function(){function t(t,e,n,i,r,o){var a,s,u,l,c,h,f,d,p;if(s=t[o[e]].x,u=t[o[e]].y,l=t[o[n]].x,c=t[o[n]].y,h=t[o[i]].x,f=t[o[i]].y,(l-s)*(f-u)-(c-u)*(h-s)<=0)return!1;var g,v,m,y,_,b,x,w,E,S,M,C,I,O,T;for(g=h-l,v=f-c,m=s-h,y=u-f,_=l-s,b=c-u,a=0;a<r;a++)if(d=t[o[a]].x,p=t[o[a]].y,!(d===s&&p===u||d===l&&p===c||d===h&&p===f)&&(x=d-s,w=p-u,E=d-l,S=p-c,M=d-h,C=p-f,T=g*S-v*E,I=_*w-b*x,O=m*C-y*M,T>=-Number.EPSILON&&O>=-Number.EPSILON&&I>=-Number.EPSILON))return!1;return!0}return function(e,n){var i=e.length;if(i<3)return null;var r,o,a,s=[],u=[],l=[];if(gs.area(e)>0)for(o=0;o<i;o++)u[o]=o;else for(o=0;o<i;o++)u[o]=i-1-o;var c=i,h=2*c;for(o=c-1;c>2;){if(h--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),n?l:s;if(r=o,c<=r&&(r=0),o=r+1,c<=o&&(o=0),a=o+1,c<=a&&(a=0),t(e,r,o,a,c,u)){var f,d,p,g,v;for(f=u[r],d=u[o],p=u[a],s.push([e[f],e[d],e[p]]),l.push([u[r],u[o],u[a]]),g=o,v=o+1;v<c;g++,v++)u[g]=u[v];c--,h=2*c}}return n?l:s}}(),triangulateShape:function(t,e){function n(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function i(t,e,n){return t.x!==e.x?t.x<e.x?t.x<=n.x&&n.x<=e.x:e.x<=n.x&&n.x<=t.x:t.y<e.y?t.y<=n.y&&n.y<=e.y:e.y<=n.y&&n.y<=t.y}function r(t,e,n,r,o){var a=e.x-t.x,s=e.y-t.y,u=r.x-n.x,l=r.y-n.y,c=t.x-n.x,h=t.y-n.y,f=s*u-a*l,d=s*c-a*h;if(Math.abs(f)>Number.EPSILON){var p;if(f>0){if(d<0||d>f)return[];if(p=l*c-u*h,p<0||p>f)return[]}else{if(d>0||d<f)return[];if(p=l*c-u*h,p>0||p<f)return[]}if(0===p)return!o||0!==d&&d!==f?[t]:[];if(p===f)return!o||0!==d&&d!==f?[e]:[];if(0===d)return[n];if(d===f)return[r];var g=p/f;return[{x:t.x+g*a,y:t.y+g*s}]}if(0!==d||l*c!==u*h)return[];var v=0===a&&0===s,m=0===u&&0===l;if(v&&m)return t.x!==n.x||t.y!==n.y?[]:[t];if(v)return i(n,r,t)?[t]:[];if(m)return i(t,e,n)?[n]:[];var y,_,b,x,w,E,S,M;return 0!==a?(t.x<e.x?(y=t,b=t.x,_=e,x=e.x):(y=e,b=e.x,_=t,x=t.x),n.x<r.x?(w=n,S=n.x,E=r,M=r.x):(w=r,S=r.x,E=n,M=n.x)):(t.y<e.y?(y=t,b=t.y,_=e,x=e.y):(y=e,b=e.y,_=t,x=t.y),n.y<r.y?(w=n,S=n.y,E=r,M=r.y):(w=r,S=r.y,E=n,M=n.y)),b<=S?x<S?[]:x===S?o?[]:[w]:x<=M?[w,_]:[w,E]:b>M?[]:b===M?o?[]:[y]:x<=M?[y,_]:[y,E]}function o(t,e,n,i){var r=e.x-t.x,o=e.y-t.y,a=n.x-t.x,s=n.y-t.y,u=i.x-t.x,l=i.y-t.y,c=r*s-o*a,h=r*l-o*u;if(Math.abs(c)>Number.EPSILON){var f=u*s-l*a;return c>0?h>=0&&f>=0:h>=0||f>=0}return h>0}function a(t,e){function n(t,e){var n=y.length-1,i=t-1;i<0&&(i=n);var r=t+1;r>n&&(r=0);var a=o(y[t],y[i],y[r],s[e]);if(!a)return!1;var u=s.length-1,l=e-1;l<0&&(l=u);var c=e+1;return c>u&&(c=0),a=o(s[e],s[l],s[c],y[t]),!!a}function i(t,e){var n,i,o;for(n=0;n<y.length;n++)if(i=n+1,i%=y.length,o=r(t,e,y[n],y[i],!0),o.length>0)return!0;return!1}function a(t,n){var i,o,a,s,u;for(i=0;i<_.length;i++)for(o=e[_[i]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,u=r(t,n,o[a],o[s],!0),u.length>0)return!0;return!1}for(var s,u,l,c,h,f,d,p,g,v,m,y=t.concat(),_=[],b=[],x=0,w=e.length;x<w;x++)_.push(x);for(var E=0,S=2*_.length;_.length>0;){if(S--,S<0){console.log("Infinite Loop! Holes left:"+_.length+", Probably Hole outside Shape!");break}for(l=E;l<y.length;l++){c=y[l],u=-1;for(var x=0;x<_.length;x++)if(f=_[x],d=c.x+":"+c.y+":"+f,void 0===b[d]){s=e[f];for(var M=0;M<s.length;M++)if(h=s[M],n(l,M)&&!i(c,h)&&!a(c,h)){u=M,_.splice(x,1),p=y.slice(0,l+1),g=y.slice(l),v=s.slice(u),m=s.slice(0,u+1),y=p.concat(v).concat(m).concat(g),E=l;break}if(u>=0)break;b[d]=!0}if(u>=0)break}}return y}n(t),e.forEach(n);for(var s,u,l,c,h,f,d={},p=t.concat(),g=0,v=e.length;g<v;g++)Array.prototype.push.apply(p,e[g]);for(s=0,u=p.length;s<u;s++)h=p[s].x+":"+p[s].y,void 0!==d[h]&&console.warn("THREE.ShapeUtils: Duplicate point",h,s),d[h]=s;var m=a(t,e),y=gs.triangulate(m,!1);for(s=0,u=y.length;s<u;s++)for(c=y[s],l=0;l<3;l++)h=c[l].x+":"+c[l].y,f=d[h],void 0!==f&&(c[l]=f);return y.concat()},isClockWise:function(t){return gs.area(t)<0}};Ee.prototype=Object.create(St.prototype),Ee.prototype.constructor=Ee,Se.prototype=Object.create(Mt.prototype),Se.prototype.constructor=Se,Me.prototype=Object.create(St.prototype),Me.prototype.constructor=Me,Ce.prototype=Object.create(Mt.prototype),Ce.prototype.constructor=Ce,Ce.prototype.getArrays=function(){var t=this.getAttribute("position"),e=t?Array.prototype.slice.call(t.array):[],n=this.getAttribute("uv"),i=n?Array.prototype.slice.call(n.array):[],r=this.index,o=r?Array.prototype.slice.call(r.array):[];return{position:e,uv:i,index:o}},Ce.prototype.addShapeList=function(t,e){var n=t.length;e.arrays=this.getArrays();for(var i=0;i<n;i++){var r=t[i];this.addShape(r,e)}this.setIndex(e.arrays.index),this.addAttribute("position",new _t(e.arrays.position,3)),this.addAttribute("uv",new _t(e.arrays.uv,2))},Ce.prototype.addShape=function(t,e){function i(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}function r(t,e,n){var i,r,a=1,s=t.x-e.x,u=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=s*s+u*u,f=s*c-u*l;if(Math.abs(f)>Number.EPSILON){var d=Math.sqrt(h),p=Math.sqrt(l*l+c*c),g=e.x-u/d,v=e.y+s/d,m=n.x-c/p,y=n.y+l/p,_=((m-g)*c-(y-v)*l)/(s*c-u*l);i=g+s*_-t.x,r=v+u*_-t.y;var b=i*i+r*r;if(b<=2)return new o(i,r);a=Math.sqrt(b/2)}else{var x=!1;s>Number.EPSILON?l>Number.EPSILON&&(x=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(x=!0):Math.sign(u)===Math.sign(c)&&(x=!0),x?(i=-u,r=s,a=Math.sqrt(h)):(i=s,r=u,a=Math.sqrt(h/2))}return new o(i/a,r/a)}function a(){var t=b.length/3;if(O){var n=0,i=J*n;for($=0;$<K;$++)Z=G[$],c(Z[2]+i,Z[1]+i,Z[0]+i);for(n=P+2*I,i=J*n,$=0;$<K;$++)Z=G[$],c(Z[0]+i,Z[1]+i,Z[2]+i)}else{for($=0;$<K;$++)Z=G[$],c(Z[2],Z[1],Z[0]);for($=0;$<K;$++)Z=G[$],c(Z[0]+J*P,Z[1]+J*P,Z[2]+J*P)}F.addGroup(t,b.length/3-t,void 0!==e.material?e.material:0)}function s(){var t=b.length/3,n=0;for(u(V,n),n+=V.length,R=0,D=U.length;R<D;R++)k=U[R],u(k,n),n+=k.length;F.addGroup(t,b.length/3-t,void 0!==e.extrudeMaterial?e.extrudeMaterial:1)}function u(t,e){var n,i;for($=t.length;--$>=0;){n=$,i=$-1,i<0&&(i=t.length-1);var r=0,o=P+2*I;for(r=0;r<o;r++){var a=J*r,s=J*(r+1),u=e+n+a,l=e+i+a,c=e+i+s,f=e+n+s;h(u,l,c,f,t,r,o,n,i)}}}function l(t,e,n){E.push(t),E.push(e),E.push(n)}function c(t,e,n){f(t),f(e),f(n);var i=b.length/3,r=N.generateTopUV(F,b,i-3,i-2,i-1);d(r[0]),d(r[1]),d(r[2])}function h(t,e,n,i,r,o,a,s,u){f(t),f(e),f(i),f(e),f(n),f(i);var l=b.length/3,c=N.generateSideWallUV(F,b,l-6,l-3,l-2,l-1);d(c[0]),d(c[1]),d(c[3]),d(c[1]),d(c[2]),d(c[3])}function f(t){x.push(b.length/3),b.push(E[3*t+0]),b.push(E[3*t+1]),b.push(E[3*t+2])}function d(t){w.push(t.x),w.push(t.y)}var p,g,v,m,y,_=e.arrays?e.arrays:this.getArrays(),b=_.position,x=_.index,w=_.uv,E=[],S=void 0!==e.amount?e.amount:100,M=void 0!==e.bevelThickness?e.bevelThickness:6,C=void 0!==e.bevelSize?e.bevelSize:M-2,I=void 0!==e.bevelSegments?e.bevelSegments:3,O=void 0===e.bevelEnabled||e.bevelEnabled,T=void 0!==e.curveSegments?e.curveSegments:12,P=void 0!==e.steps?e.steps:1,A=e.extrudePath,L=!1,N=void 0!==e.UVGenerator?e.UVGenerator:Me.WorldUVGenerator;A&&(p=A.getSpacedPoints(P),L=!0,O=!1,g=void 0!==e.frames?e.frames:A.computeFrenetFrames(P,!1),v=new n,m=new n,y=new n),O||(I=0,M=0,C=0);var k,R,D,F=this,B=t.extractPoints(T),j=B.shape,U=B.holes,z=!gs.isClockWise(j);if(z){for(j=j.reverse(),R=0,D=U.length;R<D;R++)k=U[R],gs.isClockWise(k)&&(U[R]=k.reverse());z=!1}var G=gs.triangulateShape(j,U),V=j;for(R=0,D=U.length;R<D;R++)k=U[R],j=j.concat(k);for(var X,H,q,Y,W,Z,J=j.length,K=G.length,Q=[],$=0,tt=V.length,et=tt-1,nt=$+1;$<tt;$++,et++,nt++)et===tt&&(et=0),nt===tt&&(nt=0),Q[$]=r(V[$],V[et],V[nt]);var it,rt=[],ot=Q.concat();for(R=0,D=U.length;R<D;R++){for(k=U[R],it=[],$=0,tt=k.length,et=tt-1,nt=$+1;$<tt;$++,et++,nt++)et===tt&&(et=0),nt===tt&&(nt=0),it[$]=r(k[$],k[et],k[nt]);rt.push(it),ot=ot.concat(it)}for(X=0;X<I;X++){for(q=X/I,Y=M*Math.cos(q*Math.PI/2),H=C*Math.sin(q*Math.PI/2),$=0,tt=V.length;$<tt;$++)W=i(V[$],Q[$],H),l(W.x,W.y,-Y);for(R=0,D=U.length;R<D;R++)for(k=U[R],it=rt[R],$=0,tt=k.length;$<tt;$++)W=i(k[$],it[$],H),l(W.x,W.y,-Y)}for(H=C,$=0;$<J;$++)W=O?i(j[$],ot[$],H):j[$],L?(m.copy(g.normals[0]).multiplyScalar(W.x),v.copy(g.binormals[0]).multiplyScalar(W.y),y.copy(p[0]).add(m).add(v),l(y.x,y.y,y.z)):l(W.x,W.y,0);var at;for(at=1;at<=P;at++)for($=0;$<J;$++)W=O?i(j[$],ot[$],H):j[$],L?(m.copy(g.normals[at]).multiplyScalar(W.x),v.copy(g.binormals[at]).multiplyScalar(W.y),y.copy(p[at]).add(m).add(v),l(y.x,y.y,y.z)):l(W.x,W.y,S/P*at);for(X=I-1;X>=0;X--){for(q=X/I,Y=M*Math.cos(q*Math.PI/2),H=C*Math.sin(q*Math.PI/2),$=0,tt=V.length;$<tt;$++)W=i(V[$],Q[$],H),l(W.x,W.y,S+Y);for(R=0,D=U.length;R<D;R++)for(k=U[R],it=rt[R],$=0,tt=k.length;$<tt;$++)W=i(k[$],it[$],H),L?l(W.x,W.y+p[P-1].y,p[P-1].x+Y):l(W.x,W.y,S+Y)}a(),s(),e.arrays||(this.setIndex(x),this.addAttribute("position",new _t(b,3)),this.addAttribute("uv",new _t(e.arrays.uv,2)))},Me.WorldUVGenerator={generateTopUV:function(t,e,n,i,r){var a=e[3*n],s=e[3*n+1],u=e[3*i],l=e[3*i+1],c=e[3*r],h=e[3*r+1];return[new o(a,s),new o(u,l),new o(c,h)]},generateSideWallUV:function(t,e,n,i,r,a){var s=e[3*n],u=e[3*n+1],l=e[3*n+2],c=e[3*i],h=e[3*i+1],f=e[3*i+2],d=e[3*r],p=e[3*r+1],g=e[3*r+2],v=e[3*a],m=e[3*a+1],y=e[3*a+2];return Math.abs(u-h)<.01?[new o(s,1-l),new o(c,1-f),new o(d,1-g),new o(v,1-y)]:[new o(u,1-l),new o(h,1-f),new o(p,1-g),new o(m,1-y)]}},Ie.prototype=Object.create(W.prototype),Ie.prototype.constructor=Ie,Ie.prototype.isMeshPhongMaterial=!0,Ie.prototype.copy=function(t){return W.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this};var vs=Object.freeze({SpriteMaterial:he,ShaderMaterial:Z,MeshPhongMaterial:Ie,MeshBasicMaterial:ct,LineBasicMaterial:de,Material:W}),ms={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},ys=new Oe;a(Te.prototype,{load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,o=ms.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");return a.addEventListener("load",function(){ms.add(t,this),e&&e(this),r.manager.itemEnd(t)},!1),a.addEventListener("error",function(e){i&&i(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),a(Pe.prototype,{load:function(t,e,n,i){var r=new Te(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);var o=new u;return o.image=r.load(t,function(){var n=t.search(/\.(jpg|jpeg)$/)>0||0===t.search(/^data\:image\/jpeg/);o.format=n?cr:hr,o.needsUpdate=!0,void 0!==e&&e(o)},n,i),o},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this}}),a(Ae.prototype,{load:function(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t);var r=this,o=ms.get(t);if(void 0!==o)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;var a=/^data:(.*?)(;base64)?,(.*)$/,s=t.match(a);if(s){var u=s[1],l=!!s[2],c=s[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var h,f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":h=new ArrayBuffer(c.length);for(var d=new Uint8Array(h),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);"blob"===f&&(h=new Blob([h],{type:u}));break;case"document":var g=new DOMParser;h=g.parseFromString(c,u);break;case"json":h=JSON.parse(c);break;default:h=c}window.setTimeout(function(){e&&e(h),r.manager.itemEnd(t)},0)}catch(e){window.setTimeout(function(){i&&i(e),r.manager.itemEnd(t),r.manager.itemError(t)},0)}}else{var v=new XMLHttpRequest;v.open("GET",t,!0),v.addEventListener("load",function(n){var o=n.target.response;ms.add(t,o),200===this.status?(e&&e(o),r.manager.itemEnd(t)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),e&&e(o),r.manager.itemEnd(t)):(i&&i(n),r.manager.itemEnd(t),r.manager.itemError(t))},!1),void 0!==n&&v.addEventListener("progress",function(t){n(t)},!1),v.addEventListener("error",function(e){i&&i(e),r.manager.itemEnd(t),r.manager.itemError(t)},!1),void 0!==this.responseType&&(v.responseType=this.responseType),void 0!==this.withCredentials&&(v.withCredentials=this.withCredentials),v.overrideMimeType&&v.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var m in this.requestHeader)v.setRequestHeader(m,this.requestHeader[m]);v.send(null)}return r.manager.itemStart(t),v},setPath:function(t){return this.path=t,this},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}}),a(Le.prototype,{load:function(t,e,n,i){var r=this,o=new Ae(r.manager);o.setResponseType("json"),o.load(t,function(t){e(r.parse(t))},n,i)},setTextures:function(t){this.textures=t},parse:function(t){function e(t){return void 0===n[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),n[t]}var n=this.textures,i=new vs[t.type];if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&i.specular.setHex(t.specular),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearCoat&&(i.clearCoat=t.clearCoat),void 0!==t.clearCoatRoughness&&(i.clearCoatRoughness=t.clearCoatRoughness),void 0!==t.uniforms&&(i.uniforms=t.uniforms),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.vertexColors&&(i.vertexColors=t.vertexColors),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.shading&&(i.shading=t.shading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.side&&(i.side=t.side),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),
void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.skinning&&(i.skinning=t.skinning),void 0!==t.morphTargets&&(i.morphTargets=t.morphTargets),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=e(t.map)),void 0!==t.alphaMap&&(i.alphaMap=e(t.alphaMap),i.transparent=!0),void 0!==t.bumpMap&&(i.bumpMap=e(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=e(t.normalMap)),void 0!==t.normalScale){var r=t.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=(new o).fromArray(r)}if(void 0!==t.displacementMap&&(i.displacementMap=e(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=e(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=e(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=e(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=e(t.specularMap)),void 0!==t.envMap&&(i.envMap=e(t.envMap)),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.lightMap&&(i.lightMap=e(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=e(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=e(t.gradientMap)),void 0!==t.materials)for(var a=0,s=t.materials.length;a<s;a++)i.materials.push(this.parse(t.materials[a]));return i}}),Ne.Handlers={handlers:[],add:function(t,e){this.handlers.push(t,e)},get:function(t){for(var e=this.handlers,n=0,i=e.length;n<i;n+=2){var r=e[n],o=e[n+1];if(r.test(t))return o}return null}},a(Ne.prototype,{crossOrigin:void 0,extractUrlBase:function(t){var e=t.split("/");return 1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(t,e,n){for(var i=[],r=0;r<t.length;++r)i[r]=this.createMaterial(t[r],e,n);return i},createMaterial:function(){var t={NoBlending:Jn,NormalBlending:Kn,AdditiveBlending:Qn,SubtractiveBlending:$n,MultiplyBlending:ti,CustomBlending:ei},e=new q,n=new Pe,i=new Le;return function(r,o,a){function s(t,e,i,r,s){var l,c=o+t,h=Ne.Handlers.get(c);null!==h?l=h.load(c):(n.setCrossOrigin(a),l=n.load(c)),void 0!==e&&(l.repeat.fromArray(e),1!==e[0]&&(l.wrapS=Gi),1!==e[1]&&(l.wrapT=Gi)),void 0!==i&&l.offset.fromArray(i),void 0!==r&&("repeat"===r[0]&&(l.wrapS=Gi),"mirror"===r[0]&&(l.wrapS=Xi),"repeat"===r[1]&&(l.wrapT=Gi),"mirror"===r[1]&&(l.wrapT=Xi)),void 0!==s&&(l.anisotropy=s);var f=Wr.generateUUID();return u[f]=l,f}var u={},l={uuid:Wr.generateUUID(),type:"MeshLambertMaterial"};for(var c in r){var h=r[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":l.name=h;break;case"blending":l.blending=t[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":l.color=e.fromArray(h).getHex();break;case"colorSpecular":l.specular=e.fromArray(h).getHex();break;case"colorEmissive":l.emissive=e.fromArray(h).getHex();break;case"specularCoef":l.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(l.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(l.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(l.type="MeshStandardMaterial");break;case"mapDiffuse":l.map=s(h,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":l.emissiveMap=s(h,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":l.lightMap=s(h,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":l.aoMap=s(h,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":l.bumpMap=s(h,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":l.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":l.normalMap=s(h,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":l.normalScale=[h,h];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":l.specularMap=s(h,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":l.metalnessMap=s(h,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":l.roughnessMap=s(h,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":l.alphaMap=s(h,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":l.side=Vn;break;case"doubleSided":l.side=Xn;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),l.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":l[c]=h;break;case"vertexColors":h===!0&&(l.vertexColors=Zn),"face"===h&&(l.vertexColors=Wn);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,h)}}return"MeshBasicMaterial"===l.type&&delete l.emissive,"MeshPhongMaterial"!==l.type&&delete l.specular,l.opacity<1&&(l.transparent=!0),i.setTextures(u),i.parse(l)}}()});var _s={arraySlice:function(t,e,n){return _s.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){function e(e,n){return t[e]-t[n]}for(var n=t.length,i=new Array(n),r=0;r!==n;++r)i[r]=r;return i.sort(e),i},sortedArray:function(t,e,n){for(var i=t.length,r=new t.constructor(i),o=0,a=0;a!==i;++o)for(var s=n[o]*e,u=0;u!==e;++u)r[a++]=t[s+u];return r},flattenJSON:function(t,e,n,i){for(var r=1,o=t[0];void 0!==o&&void 0===o[i];)o=t[r++];if(void 0!==o){var a=o[i];if(void 0!==a)if(Array.isArray(a)){do a=o[i],void 0!==a&&(e.push(o.time),n.push.apply(n,a)),o=t[r++];while(void 0!==o)}else if(void 0!==a.toArray){do a=o[i],void 0!==a&&(e.push(o.time),a.toArray(n,n.length)),o=t[r++];while(void 0!==o)}else do a=o[i],void 0!==a&&(e.push(o.time),n.push(a)),o=t[r++];while(void 0!==o)}}};a(ke.prototype,{evaluate:function(t){var e=this.parameterPositions,n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{var o;n:{i:if(!(t<i)){for(var a=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===a)break;if(r=i,i=e[++n],t<i)break e}o=e.length;break n}{if(t>=r)break t;var s=e[1];t<s&&(n=2,r=s);for(var a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===a)break;if(i=r,r=e[--n-1],t>=r)break e}o=n,n=0}}for(;n<o;){var u=n+o>>>1;t<e[u]?o=u:n=u+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i,o=0;o!==i;++o)e[o]=n[r+o];return e},interpolate_:function(t,e,n,i){throw new Error("call to abstract method")},intervalChanged_:function(t,e,n){}}),//!\ DECLARE ALIAS AFTER assign prototype !
a(ke.prototype,{beforeStart_:ke.prototype.copySampleValue_,afterEnd_:ke.prototype.copySampleValue_}),Re.prototype=a(Object.create(ke.prototype),{constructor:Re,DefaultSettings_:{endingStart:Lr,endingEnd:Lr},intervalChanged_:function(t,e,n){var i=this.parameterPositions,r=t-2,o=t+1,a=i[r],s=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case Nr:r=t,a=2*e-n;break;case kr:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Nr:o=t,s=2*n-e;break;case kr:o=1,s=n+i[1]-i[0];break;default:o=t-1,s=e}var u=.5*(n-e),l=this.valueSize;this._weightPrev=u/(e-a),this._weightNext=u/(s-n),this._offsetPrev=r*l,this._offsetNext=o*l},interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-e)/(i-e),p=d*d,g=p*d,v=-h*g+2*h*p-h*d,m=(1+h)*g+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*g+(1.5+f)*p+.5*d,_=f*g-f*p,b=0;b!==a;++b)r[b]=v*o[l+b]+m*o[u+b]+y*o[s+b]+_*o[c+b];return r}}),De.prototype=a(Object.create(ke.prototype),{constructor:De,interpolate_:function(t,e,n,i){for(var r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,u=s-a,l=(n-e)/(i-e),c=1-l,h=0;h!==a;++h)r[h]=o[u+h]*c+o[s+h]*l;return r}}),Fe.prototype=a(Object.create(ke.prototype),{constructor:Fe,interpolate_:function(t,e,n,i){return this.copySampleValue_(t-1)}});var bs;bs={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Pr,InterpolantFactoryMethodDiscrete:function(t){return new Fe(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new De(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Re(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case Tr:e=this.InterpolantFactoryMethodDiscrete;break;case Pr:e=this.InterpolantFactoryMethodLinear;break;case Ar:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return void console.warn(n)}this.createInterpolant=e},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Tr;case this.InterpolantFactoryMethodLinear:return Pr;case this.InterpolantFactoryMethodSmooth:return Ar}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,i=e.length;n!==i;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,i=e.length;n!==i;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,i=n.length,r=0,o=i-1;r!==i&&n[r]<t;)++r;for(;o!==-1&&n[o]>e;)--o;if(++o,0!==r||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);var a=this.getValueSize();this.times=_s.arraySlice(n,r,o),this.values=_s.arraySlice(this.values,r*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("invalid value size in track",this),t=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("track is empty",this),t=!1);for(var o=null,a=0;a!==r;a++){var s=n[a];if("number"==typeof s&&isNaN(s)){console.error("time is not a valid number",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("out of order keys",this,a,s,o),t=!1;break}o=s}if(void 0!==i&&_s.isTypedArray(i))for(var a=0,u=i.length;a!==u;++a){var l=i[a];if(isNaN(l)){console.error("value is not a valid number",this,a,l),t=!1;break}}return t},optimize:function(){for(var t=this.times,e=this.values,n=this.getValueSize(),i=this.getInterpolation()===Ar,r=1,o=t.length-1,a=1;a<o;++a){var s=!1,u=t[a],l=t[a+1];if(u!==l&&(1!==a||u!==u[0]))if(i)s=!0;else for(var c=a*n,h=c-n,f=c+n,d=0;d!==n;++d){var p=e[c+d];if(p!==e[h+d]||p!==e[f+d]){s=!0;break}}if(s){if(a!==r){t[r]=t[a];for(var g=a*n,v=r*n,d=0;d!==n;++d)e[v+d]=e[g+d]}++r}}if(o>0){t[r]=t[o];for(var g=o*n,v=r*n,d=0;d!==n;++d)e[v+d]=e[g+d];++r}return r!==t.length&&(this.times=_s.arraySlice(t,0,r),this.values=_s.arraySlice(e,0,r*n)),this}},je.prototype=a(Object.create(bs),{constructor:je,ValueTypeName:"vector"}),Ue.prototype=a(Object.create(ke.prototype),{constructor:Ue,interpolate_:function(t,n,i,r){for(var o=this.resultBuffer,a=this.sampleValues,s=this.valueSize,u=t*s,l=(i-n)/(r-n),c=u+s;u!==c;u+=4)e.slerpFlat(o,0,a,u-s,a,u,l);return o}}),ze.prototype=a(Object.create(bs),{constructor:ze,ValueTypeName:"quaternion",DefaultInterpolation:Pr,InterpolantFactoryMethodLinear:function(t){return new Ue(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Ge.prototype=a(Object.create(bs),{constructor:Ge,ValueTypeName:"number"}),Ve.prototype=a(Object.create(bs),{constructor:Ve,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Tr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Xe.prototype=a(Object.create(bs),{constructor:Xe,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Tr,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),He.prototype=a(Object.create(bs),{constructor:He,ValueTypeName:"color"}),qe.prototype=bs,bs.constructor=qe,a(qe,{parse:function(t){if(void 0===t.type)throw new Error("track type undefined, can not parse");var e=qe._getTrackTypeForValueTypeName(t.type);if(void 0===t.times){var n=[],i=[];_s.flattenJSON(t.keys,n,i,"value"),t.times=n,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)},toJSON:function(t){var e,n=t.constructor;if(void 0!==n.toJSON)e=n.toJSON(t);else{e={name:t.name,times:_s.convertArray(t.times,Array),values:_s.convertArray(t.values,Array)};var i=t.getInterpolation();i!==t.DefaultInterpolation&&(e.interpolation=i)}return e.type=t.ValueTypeName,e},_getTrackTypeForValueTypeName:function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ge;case"vector":case"vector2":case"vector3":case"vector4":return je;case"color":return He;case"quaternion":return ze;case"bool":case"boolean":return Xe;case"string":return Ve}throw new Error("Unsupported typeName: "+t)}}),a(Ye,{parse:function(t){for(var e=[],n=t.tracks,i=1/(t.fps||1),r=0,o=n.length;r!==o;++r)e.push(qe.parse(n[r]).scale(i));return new Ye(t.name,t.duration,e)},toJSON:function(t){for(var e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e},r=0,o=n.length;r!==o;++r)e.push(qe.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(t,e,n,i){for(var r=e.length,o=[],a=0;a<r;a++){var s=[],u=[];s.push((a+r-1)%r,a,(a+1)%r),u.push(0,1,0);var l=_s.getKeyframeOrder(s);s=_s.sortedArray(s,1,l),u=_s.sortedArray(u,1,l),i||0!==s[0]||(s.push(r),u.push(u[0])),o.push(new Ge(".morphTargetInfluences["+e[a].name+"]",s,u).scale(1/n))}return new Ye(t,-1,o)},findByName:function(t,e){var n=t;if(!Array.isArray(t)){var i=t;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===e)return n[r];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],u=s.name.match(r);if(u&&u.length>1){var l=u[1],c=i[l];c||(i[l]=c=[]),c.push(s)}}var h=[];for(var l in i)h.push(Ye.CreateFromMorphTargetSequence(l,i[l],e,n));return h},parseAnimation:function(t,e){if(!t)return console.error("  no animation in JSONLoader data"),null;for(var n=function(t,e,n,i,r){if(0!==n.length){var o=[],a=[];_s.flattenJSON(n,o,a,i),0!==o.length&&r.push(new t(e,o,a))}},i=[],r=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.hierarchy||[],u=0;u<s.length;u++){var l=s[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},h=0;h<l.length;h++)if(l[h].morphTargets)for(var f=0;f<l[h].morphTargets.length;f++)c[l[h].morphTargets[f]]=-1;for(var d in c){for(var p=[],g=[],f=0;f!==l[h].morphTargets.length;++f){var v=l[h];p.push(v.time),g.push(v.morphTarget===d?1:0)}i.push(new Ge(".morphTargetInfluence["+d+"]",p,g))}o=c.length*(a||1)}else{var m=".bones["+e[u].name+"]";n(je,m+".position",l,"pos",i),n(ze,m+".quaternion",l,"rot",i),n(je,m+".scale",l,"scl",i)}}if(0===i.length)return null;var y=new Ye(r,o,i);return y}}),a(Ye.prototype,{resetDuration:function(){for(var t=this.tracks,e=0,n=0,i=t.length;n!==i;++n){var r=this.tracks[n];e=Math.max(e,r.times[r.times.length-1])}this.duration=e},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}}),a(We.prototype,{load:function(t,e,n,i){var r=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:Ne.prototype.extractUrlBase(t),a=new Ae(this.manager);a.setResponseType("json"),a.setWithCredentials(this.withCredentials),a.load(t,function(n){var i=n.metadata;if(void 0!==i){var a=i.type;if(void 0!==a){if("object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.");if("scene"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.SceneLoader instead.")}}var s=r.parse(n,o);e(s.geometry,s.materials)},n,i)},setTexturePath:function(t){this.texturePath=t},parse:function(){function t(t,e){function i(t,e){return t&1<<e}var r,a,s,u,l,c,h,f,d,p,g,v,m,y,_,b,x,w,E,S,M,C,I,O,T,P,A,L=t.faces,N=t.vertices,k=t.normals,R=t.colors,D=t.scale,F=0;if(void 0!==t.uvs){for(r=0;r<t.uvs.length;r++)t.uvs[r].length&&F++;for(r=0;r<F;r++)e.faceVertexUvs[r]=[]}for(u=0,l=N.length;u<l;)w=new n,w.x=N[u++]*D,w.y=N[u++]*D,w.z=N[u++]*D,e.vertices.push(w);for(u=0,l=L.length;u<l;)if(p=L[u++],g=i(p,0),v=i(p,1),m=i(p,3),y=i(p,4),_=i(p,5),b=i(p,6),x=i(p,7),g){if(S=new lt,S.a=L[u],S.b=L[u+1],S.c=L[u+3],M=new lt,M.a=L[u+1],M.b=L[u+2],M.c=L[u+3],u+=4,v&&(d=L[u++],S.materialIndex=d,M.materialIndex=d),s=e.faces.length,m)for(r=0;r<F;r++)for(O=t.uvs[r],e.faceVertexUvs[r][s]=[],e.faceVertexUvs[r][s+1]=[],a=0;a<4;a++)f=L[u++],P=O[2*f],A=O[2*f+1],T=new o(P,A),2!==a&&e.faceVertexUvs[r][s].push(T),0!==a&&e.faceVertexUvs[r][s+1].push(T);if(y&&(h=3*L[u++],S.normal.set(k[h++],k[h++],k[h]),M.normal.copy(S.normal)),_)for(r=0;r<4;r++)h=3*L[u++],I=new n(k[h++],k[h++],k[h]),2!==r&&S.vertexNormals.push(I),0!==r&&M.vertexNormals.push(I);if(b&&(c=L[u++],C=R[c],S.color.setHex(C),M.color.setHex(C)),x)for(r=0;r<4;r++)c=L[u++],C=R[c],2!==r&&S.vertexColors.push(new q(C)),0!==r&&M.vertexColors.push(new q(C));e.faces.push(S),e.faces.push(M)}else{if(E=new lt,E.a=L[u++],E.b=L[u++],E.c=L[u++],v&&(d=L[u++],E.materialIndex=d),s=e.faces.length,m)for(r=0;r<F;r++)for(O=t.uvs[r],e.faceVertexUvs[r][s]=[],a=0;a<3;a++)f=L[u++],P=O[2*f],A=O[2*f+1],T=new o(P,A),e.faceVertexUvs[r][s].push(T);if(y&&(h=3*L[u++],E.normal.set(k[h++],k[h++],k[h])),_)for(r=0;r<3;r++)h=3*L[u++],I=new n(k[h++],k[h++],k[h]),E.vertexNormals.push(I);if(b&&(c=L[u++],E.color.setHex(R[c])),x)for(r=0;r<3;r++)c=L[u++],E.vertexColors.push(new q(R[c]));e.faces.push(E)}}function e(t,e){var n=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var i=0,r=t.skinWeights.length;i<r;i+=n){var o=t.skinWeights[i],a=n>1?t.skinWeights[i+1]:0,s=n>2?t.skinWeights[i+2]:0,u=n>3?t.skinWeights[i+3]:0;e.skinWeights.push(new H(o,a,s,u))}if(t.skinIndices)for(var i=0,r=t.skinIndices.length;i<r;i+=n){var l=t.skinIndices[i],c=n>1?t.skinIndices[i+1]:0,h=n>2?t.skinIndices[i+2]:0,f=n>3?t.skinIndices[i+3]:0;e.skinIndices.push(new H(l,c,h,f))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}function i(t,e){var i=t.scale;if(void 0!==t.morphTargets)for(var r=0,o=t.morphTargets.length;r<o;r++){e.morphTargets[r]={},e.morphTargets[r].name=t.morphTargets[r].name,e.morphTargets[r].vertices=[];for(var a=e.morphTargets[r].vertices,s=t.morphTargets[r].vertices,u=0,l=s.length;u<l;u+=3){var c=new n;c.x=s[u]*i,c.y=s[u+1]*i,c.z=s[u+2]*i,a.push(c)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var h=e.faces,f=t.morphColors[0].colors,r=0,o=h.length;r<o;r++)h[r].color.fromArray(f,3*r)}}function r(t,e){var n=[],i=[];void 0!==t.animation&&i.push(t.animation),void 0!==t.animations&&(t.animations.length?i=i.concat(t.animations):i.push(t.animations));for(var r=0;r<i.length;r++){var o=Ye.parseAnimation(i[r],e.bones);o&&n.push(o)}if(e.morphTargets){var a=Ye.CreateClipsFromMorphTargetSequences(e.morphTargets,10);n=n.concat(a)}n.length>0&&(e.animations=n)}return function(n,o){void 0!==n.data&&(n=n.data),void 0!==n.scale?n.scale=1/n.scale:n.scale=1;var a=new St;if(t(n,a),e(n,a),i(n,a),r(n,a),a.computeFaceNormals(),a.computeBoundingSphere(),void 0===n.materials||0===n.materials.length)return{geometry:a};var s=Ne.prototype.initMaterials(n.materials,o,this.crossOrigin);return{geometry:a,materials:s}}}()}),Ze.prototype=a(Object.create(at.prototype),{constructor:Ze,isLight:!0,copy:function(t){return at.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=at.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Je.prototype=a(Object.create(Ze.prototype),{constructor:Je,isHemisphereLight:!0,copy:function(t){return Ze.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),a(Ke.prototype,{copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Qe.prototype=a(Object.create(Ke.prototype),{constructor:Qe}),$e.prototype=a(Object.create(Ze.prototype),{constructor:$e,isDirectionalLight:!0,copy:function(t){return Ze.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),tn.prototype.clone=function(){return new tn(void 0===this.value.clone?this.value:this.value.clone())},a(en.prototype,{linePrecision:1,set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize()):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e){var n=[];return rn(t,this,n,e),n.sort(nn),n},intersectObjects:function(t,e){var n=[];if(Array.isArray(t)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,r=t.length;i<r;i++)rn(t[i],this,n,e);return n.sort(nn),n}}),a(on.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}),a(an.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.radius=t.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(Wr.clamp(t.y/this.radius,-1,1))),this}}),a(sn.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(){var t=new o;return function(e,n){var i=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=+(1/0),this.max.x=this.max.y=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){var e=t||new o;return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){var e=t||new o;return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){var n=e||new o;return n.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){var n=e||new o;return n.copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new o;return function(e){var n=t.copy(e).clamp(this.min,this.max);return n.sub(e).length()}}(),intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}),a(un.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,n,i=[],r=this.getPoint(0),o=0;for(i.push(0),n=1;n<=t;n++)e=this.getPoint(n/t),o+=e.distanceTo(r),i.push(o),r=e;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var n,i=this.getLengths(),r=0,o=i.length;n=e?e:t*i[o-1];for(var a,s=0,u=o-1;s<=u;)if(r=Math.floor(s+(u-s)/2),a=i[r]-n,a<0)s=r+1;else{if(!(a>0)){u=r;break}u=r-1}if(r=u,i[r]===n)return r/(o-1);var l=i[r],c=i[r+1],h=c-l,f=(n-l)/h,d=(r+f)/(o-1);return d},getTangent:function(t){var e=1e-4,n=t-e,i=t+e;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n),o=this.getPoint(i),a=o.clone().sub(r);return a.normalize()},getTangentAt:function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},computeFrenetFrames:function(t,e){var r,o,a,s=new n,u=[],l=[],c=[],h=new n,f=new i;for(r=0;r<=t;r++)o=r/t,u[r]=this.getTangentAt(o),u[r].normalize();l[0]=new n,c[0]=new n;var d=Number.MAX_VALUE,p=Math.abs(u[0].x),g=Math.abs(u[0].y),v=Math.abs(u[0].z);for(p<=d&&(d=p,s.set(1,0,0)),g<=d&&(d=g,s.set(0,1,0)),v<=d&&s.set(0,0,1),h.crossVectors(u[0],s).normalize(),l[0].crossVectors(u[0],h),c[0].crossVectors(u[0],l[0]),r=1;r<=t;r++)l[r]=l[r-1].clone(),c[r]=c[r-1].clone(),h.crossVectors(u[r-1],u[r]),h.length()>Number.EPSILON&&(h.normalize(),a=Math.acos(Wr.clamp(u[r-1].dot(u[r]),-1,1)),l[r].applyMatrix4(f.makeRotationAxis(h,a))),c[r].crossVectors(u[r],l[r]);if(e===!0)for(a=Math.acos(Wr.clamp(l[0].dot(l[t]),-1,1)),a/=t,u[0].dot(h.crossVectors(l[0],l[t]))>0&&(a=-a),r=1;r<=t;r++)l[r].applyMatrix4(f.makeRotationAxis(u[r],a*r)),c[r].crossVectors(u[r],l[r]);return{tangents:u,normals:l,binormals:c}}});var xs=new n,ws=new ln,Es=new ln,Ss=new ln;cn.prototype=Object.create(un.prototype),cn.prototype.constructor=cn,cn.prototype.getPoint=function(t){var e=this.points,i=e.length;i<2&&console.log("duh, you need at least 2 points");var r=(i-(this.closed?0:1))*t,o=Math.floor(r),a=r-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/e.length)+1)*e.length:0===a&&o===i-1&&(o=i-2,a=1);var s,u,l,c;if(this.closed||o>0?s=e[(o-1)%i]:(xs.subVectors(e[0],e[1]).add(e[0]),s=xs),u=e[o%i],l=e[(o+1)%i],this.closed||o+2<i?c=e[(o+2)%i]:(xs.subVectors(e[i-1],e[i-2]).add(e[i-1]),c=xs),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var h="chordal"===this.type?.5:.25,f=Math.pow(s.distanceToSquared(u),h),d=Math.pow(u.distanceToSquared(l),h),p=Math.pow(l.distanceToSquared(c),h);d<1e-4&&(d=1),f<1e-4&&(f=d),p<1e-4&&(p=d),ws.initNonuniformCatmullRom(s.x,u.x,l.x,c.x,f,d,p),Es.initNonuniformCatmullRom(s.y,u.y,l.y,c.y,f,d,p),Ss.initNonuniformCatmullRom(s.z,u.z,l.z,c.z,f,d,p)}else if("catmullrom"===this.type){var g=void 0!==this.tension?this.tension:.5;ws.initCatmullRom(s.x,u.x,l.x,c.x,g),Es.initCatmullRom(s.y,u.y,l.y,c.y,g),Ss.initCatmullRom(s.z,u.z,l.z,c.z,g)}return new n(ws.calc(a),Es.calc(a),Ss.calc(a))},hn.prototype=Object.create(un.prototype),hn.prototype.constructor=hn,hn.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=new n;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e},fn.prototype=Object.create(un.prototype),fn.prototype.constructor=fn,fn.prototype.isLineCurve=!0,fn.prototype.getPoint=function(t){if(1===t)return this.v2.clone();var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},fn.prototype.getPointAt=function(t){return this.getPoint(t)},fn.prototype.getTangent=function(t){var e=this.v2.clone().sub(this.v1);return e.normalize()},dn.prototype=a(Object.create(un.prototype),{constructor:dn,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new fn(e,t))},getPoint:function(t){for(var e=t*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=e){var r=n[i]-e,o=this.curves[i],a=o.getLength(),s=0===a?0:1-r/a;return o.getPointAt(s)}i++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,n=[],i=0,r=this.curves;i<r.length;i++)for(var o=r[i],a=o&&o.isEllipseCurve?2*t:o&&o.isLineCurve?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),u=0;u<s.length;u++){var l=s[u];e&&e.equals(l)||(n.push(l),e=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},createPointsGeometry:function(t){var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){for(var e=new St,i=0,r=t.length;i<r;i++){var o=t[i];e.vertices.push(new n(o.x,o.y,o.z||0))}return e}}),pn.prototype=Object.create(un.prototype),pn.prototype.constructor=pn,pn.prototype.isEllipseCurve=!0,pn.prototype.getPoint=function(t){for(var e=2*Math.PI,n=this.aEndAngle-this.aStartAngle,i=Math.abs(n)<Number.EPSILON;n<0;)n+=e;for(;n>e;)n-=e;n<Number.EPSILON&&(n=i?0:e),this.aClockwise!==!0||i||(n===e?n=-e:n-=e);var r=this.aStartAngle+t*n,a=this.aX+this.xRadius*Math.cos(r),s=this.aY+this.yRadius*Math.sin(r);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),c=a-this.aX,h=s-this.aY;a=c*u-h*l+this.aX,s=c*l+h*u+this.aY}return new o(a,s)},Mn.prototype=Object.create(un.prototype),Mn.prototype.constructor=Mn,Mn.prototype.isSplineCurve=!0,Mn.prototype.getPoint=function(t){var e=this.points,n=(e.length-1)*t,i=Math.floor(n),r=n-i,a=e[0===i?i:i-1],s=e[i],u=e[i>e.length-2?e.length-1:i+1],l=e[i>e.length-3?e.length-1:i+2];return new o(gn(r,a.x,s.x,u.x,l.x),gn(r,a.y,s.y,u.y,l.y))},Cn.prototype=Object.create(un.prototype),Cn.prototype.constructor=Cn,Cn.prototype.getPoint=function(t){var e=this.v0,n=this.v1,i=this.v2,r=this.v3;return new o(Sn(t,e.x,n.x,i.x,r.x),Sn(t,e.y,n.y,i.y,r.y))},In.prototype=Object.create(un.prototype),In.prototype.constructor=In,In.prototype.getPoint=function(t){var e=this.v0,n=this.v1,i=this.v2;return new o(_n(t,e.x,n.x,i.x),_n(t,e.y,n.y,i.y))};var Ms=a(Object.create(dn.prototype),{fromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y)},moveTo:function(t,e){this.currentPoint.set(t,e)},lineTo:function(t,e){var n=new fn(this.currentPoint.clone(),new o(t,e));this.curves.push(n),this.currentPoint.set(t,e)},quadraticCurveTo:function(t,e,n,i){var r=new In(this.currentPoint.clone(),new o(t,e),new o(n,i));this.curves.push(r),this.currentPoint.set(n,i)},bezierCurveTo:function(t,e,n,i,r,a){var s=new Cn(this.currentPoint.clone(),new o(t,e),new o(n,i),new o(r,a));this.curves.push(s),this.currentPoint.set(r,a)},splineThru:function(t){var e=[this.currentPoint.clone()].concat(t),n=new Mn(e);this.curves.push(n),this.currentPoint.copy(t[t.length-1])},arc:function(t,e,n,i,r,o){var a=this.currentPoint.x,s=this.currentPoint.y;this.absarc(t+a,e+s,n,i,r,o)},absarc:function(t,e,n,i,r,o){this.absellipse(t,e,n,n,i,r,o)},ellipse:function(t,e,n,i,r,o,a,s){var u=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(t+u,e+l,n,i,r,o,a,s)},absellipse:function(t,e,n,i,r,o,a,s){var u=new pn(t,e,n,i,r,o,a,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);this.currentPoint.copy(c)}});On.prototype=Ms,Ms.constructor=On,Tn.prototype=a(Object.create(Ms),{constructor:Tn,getPointsHoles:function(t){for(var e=[],n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e},extractAllPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},extractPoints:function(t){return this.extractAllPoints(t)}}),a(Pn.prototype,{moveTo:function(t,e){this.currentPath=new On,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e)},lineTo:function(t,e){this.currentPath.lineTo(t,e)},quadraticCurveTo:function(t,e,n,i){this.currentPath.quadraticCurveTo(t,e,n,i)},bezierCurveTo:function(t,e,n,i,r,o){this.currentPath.bezierCurveTo(t,e,n,i,r,o)},splineThru:function(t){this.currentPath.splineThru(t)},toShapes:function(t,e){function n(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n],o=new Tn;o.curves=r.curves,e.push(o)}return e}function i(t,e){for(var n=e.length,i=!1,r=n-1,o=0;o<n;r=o++){var a=e[r],s=e[o],u=s.x-a.x,l=s.y-a.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(a=e[o],u=-u,s=e[r],l=-l),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var c=l*(t.x-a.x)-u*(t.y-a.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return i}var r=gs.isClockWise,o=this.subPaths;if(0===o.length)return[];if(e===!0)return n(o);var a,s,u,l=[];if(1===o.length)return s=o[0],u=new Tn,u.curves=s.curves,l.push(u),l;var c=!r(o[0].getPoints());c=t?!c:c;var h,f=[],d=[],p=[],g=0;d[g]=void 0,p[g]=[];for(var v=0,m=o.length;v<m;v++)s=o[v],h=s.getPoints(),a=r(h),a=t?!a:a,a?(!c&&d[g]&&g++,d[g]={s:new Tn,p:h},d[g].s.curves=s.curves,c&&g++,p[g]=[]):p[g].push({h:s,p:h[0]});if(!d[0])return n(o);if(d.length>1){for(var y=!1,_=[],b=0,x=d.length;b<x;b++)f[b]=[];for(var b=0,x=d.length;b<x;b++)for(var w=p[b],E=0;E<w.length;E++){for(var S=w[E],M=!0,C=0;C<d.length;C++)i(S.p,d[C].p)&&(b!==C&&_.push({froms:b,tos:C,hole:E}),M?(M=!1,f[C].push(S)):y=!0);M&&f[b].push(S)}_.length>0&&(y||(p=f))}for(var I,v=0,O=d.length;v<O;v++){u=d[v].s,l.push(u),I=p[v];for(var T=0,P=I.length;T<P;T++)u.holes.push(I[T].h)}return l}});var Cs={createMultiMaterialObject:function(t,e){for(var n=new ye,i=0,r=e.length;i<r;i++)n.add(new Ct(t,e[i]));return n},detach:function(t,e,n){t.applyMatrix(e.matrixWorld),e.remove(t),n.add(t)},attach:function(t,e,n){var r=new i;r.getInverse(n.matrixWorld),t.applyMatrix(r),e.remove(t),n.add(t)}};t.WebGLRenderer=le,t.ShaderChunk=ls,t.Scene=ce,t.Sprite=fe,t.Mesh=Ct,t.LineSegments=ge,t.Line=pe,t.Points=me,t.Group=ye,t.Texture=u,t.TextureLoader=Pe,t.JSONLoader=We,t.ImageLoader=Te,t.FileLoader=Ae,t.Loader=Ne,t.Cache=ms,t.HemisphereLight=Je,t.DirectionalLightShadow=Qe,t.DirectionalLight=$e,t.Light=Ze,t.PerspectiveCamera=Pt,t.Camera=Tt,t.Uniform=tn,t.BufferGeometry=Mt,t.GeometryIdCount=Et,t.Geometry=St,t.Face3=lt,t.Object3D=at,t.Raycaster=en,t.EventDispatcher=r,t.Clock=on,t.Interpolant=ke,t.Triangle=ut,t.Math=Wr,t.Spherical=an,t.Plane=tt,t.Ray=it,t.Matrix4=i,t.Matrix3=$,t.Box3=K,t.Box2=sn,t.Line3=st,t.Euler=rt,t.Vector4=H,t.Vector3=n,t.Vector2=o,t.Quaternion=e,t.Color=q,t.CatmullRomCurve3=cn,t.LineCurve3=hn,t.LineCurve=fn,t.Shape=Tn,t.Path=On,t.ShapePath=Pn,t.CurvePath=dn,t.Curve=un,t.ShapeUtils=gs,t.SceneUtils=Cs,t.TubeGeometry=_e,t.TubeBufferGeometry=be,t.SphereGeometry=xe,t.SphereBufferGeometry=we,t.ShapeGeometry=Ee,t.ShapeBufferGeometry=Se,t.ExtrudeGeometry=Me,t.ExtrudeBufferGeometry=Ce,t.SpriteMaterial=he,t.ShaderMaterial=Z,t.MeshPhongMaterial=Ie,t.MeshBasicMaterial=ct,t.LineBasicMaterial=de,t.Material=W,t.Float64BufferAttribute=bt,t.Float32BufferAttribute=_t,t.Uint32BufferAttribute=yt,t.Int32BufferAttribute=mt,t.Uint16BufferAttribute=vt,t.Int16BufferAttribute=gt,t.Uint8ClampedBufferAttribute=pt,t.Uint8BufferAttribute=dt,t.Int8BufferAttribute=ft,t.BufferAttribute=ht,t.REVISION=An,t.MOUSE=Ln,t.CullFaceNone=Nn,t.CullFaceBack=kn,t.CullFaceFront=Rn,t.CullFaceFrontBack=Dn,t.FrontFaceDirectionCW=Fn,t.FrontFaceDirectionCCW=Bn,t.BasicShadowMap=jn,t.PCFShadowMap=Un,t.PCFSoftShadowMap=zn,t.FrontSide=Gn,t.BackSide=Vn,t.DoubleSide=Xn,t.FlatShading=Hn,t.SmoothShading=qn,t.NoColors=Yn,t.FaceColors=Wn,t.VertexColors=Zn,t.NoBlending=Jn,t.NormalBlending=Kn,t.AdditiveBlending=Qn,t.SubtractiveBlending=$n,t.MultiplyBlending=ti,t.CustomBlending=ei,t.AddEquation=ni,t.SubtractEquation=ii,t.ReverseSubtractEquation=ri,t.MinEquation=oi,t.MaxEquation=ai,t.ZeroFactor=si,t.OneFactor=ui,t.SrcColorFactor=li,t.OneMinusSrcColorFactor=ci,t.SrcAlphaFactor=hi,t.OneMinusSrcAlphaFactor=fi,t.DstAlphaFactor=di,t.OneMinusDstAlphaFactor=pi,t.DstColorFactor=gi,t.OneMinusDstColorFactor=vi,t.SrcAlphaSaturateFactor=mi,t.NeverDepth=yi,t.AlwaysDepth=_i,t.LessDepth=bi,t.LessEqualDepth=xi,t.EqualDepth=wi,t.GreaterEqualDepth=Ei,t.GreaterDepth=Si,t.NotEqualDepth=Mi,t.MultiplyOperation=Ci,t.MixOperation=Ii,t.AddOperation=Oi,t.NoToneMapping=Ti,t.LinearToneMapping=Pi,t.ReinhardToneMapping=Ai,t.Uncharted2ToneMapping=Li,
t.CineonToneMapping=Ni,t.UVMapping=ki,t.CubeReflectionMapping=Ri,t.CubeRefractionMapping=Di,t.EquirectangularReflectionMapping=Fi,t.EquirectangularRefractionMapping=Bi,t.SphericalReflectionMapping=ji,t.CubeUVReflectionMapping=Ui,t.CubeUVRefractionMapping=zi,t.RepeatWrapping=Gi,t.ClampToEdgeWrapping=Vi,t.MirroredRepeatWrapping=Xi,t.NearestFilter=Hi,t.NearestMipMapNearestFilter=qi,t.NearestMipMapLinearFilter=Yi,t.LinearFilter=Wi,t.LinearMipMapNearestFilter=Zi,t.LinearMipMapLinearFilter=Ji,t.UnsignedByteType=Ki,t.ByteType=Qi,t.ShortType=$i,t.UnsignedShortType=tr,t.IntType=er,t.UnsignedIntType=nr,t.FloatType=ir,t.HalfFloatType=rr,t.UnsignedShort4444Type=or,t.UnsignedShort5551Type=ar,t.UnsignedShort565Type=sr,t.UnsignedInt248Type=ur,t.AlphaFormat=lr,t.RGBFormat=cr,t.RGBAFormat=hr,t.LuminanceFormat=fr,t.LuminanceAlphaFormat=dr,t.RGBEFormat=pr,t.DepthFormat=gr,t.DepthStencilFormat=vr,t.RGB_S3TC_DXT1_Format=mr,t.RGBA_S3TC_DXT1_Format=yr,t.RGBA_S3TC_DXT3_Format=_r,t.RGBA_S3TC_DXT5_Format=br,t.RGB_PVRTC_4BPPV1_Format=xr,t.RGB_PVRTC_2BPPV1_Format=wr,t.RGBA_PVRTC_4BPPV1_Format=Er,t.RGBA_PVRTC_2BPPV1_Format=Sr,t.RGB_ETC1_Format=Mr,t.LoopOnce=Cr,t.LoopRepeat=Ir,t.LoopPingPong=Or,t.InterpolateDiscrete=Tr,t.InterpolateLinear=Pr,t.InterpolateSmooth=Ar,t.ZeroCurvatureEnding=Lr,t.ZeroSlopeEnding=Nr,t.WrapAroundEnding=kr,t.TrianglesDrawMode=Rr,t.TriangleStripDrawMode=Dr,t.TriangleFanDrawMode=Fr,t.LinearEncoding=Br,t.sRGBEncoding=jr,t.GammaEncoding=Ur;t.RGBEEncoding=zr;t.LogLuvEncoding=Gr,t.RGBM7Encoding=Vr,t.RGBM16Encoding=Xr,t.RGBDEncoding=Hr,t.BasicDepthPacking=qr,t.RGBADepthPacking=Yr,Object.defineProperty(t,"__esModule",{value:!0})})},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=e.isPresent=function(t){return"undefined"!=typeof t&&null!==t},r=e.isBlank=function(t){return"undefined"==typeof t||null===t},o=(e.isBoolean=function(t){return"boolean"==typeof t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isArray=function(t){try{return Array.isArray(t)}catch(e){return"[object Array]"===Object.prototype.toString.call(t)}},e.isDate=function(t){return t instanceof Date&&!isNaN(t.valueOf())},e.isFunction=function(t){return"function"==typeof t});e.isJsObject=function(t){return null!==t&&(o(t)||"object"===("undefined"==typeof t?"undefined":n(t)))},e.isPromise=function(t){return i(t)&&o(t.then)},e.isEmpty=function(t){if(r(t))return!0;if(0===t.length)return!0;for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}},function(t,e,n){var i,r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};/**
	 * JSTS. See https://github.com/bjornharrtell/jsts
	 * https://github.com/bjornharrtell/jsts/blob/master/LICENSE_EDLv1.txt
	 * https://github.com/bjornharrtell/jsts/blob/master/LICENSE_EPLv1.txt
	 * https://github.com/bjornharrtell/jsts/blob/master/LICENSE_LICENSE_ES6_COLLECTIONS.txt
	 * @license
	 */
!function(n,s){"object"==a(e)&&"undefined"!=typeof t?s(e):(r=[e],i=s,o="function"==typeof i?i.apply(e,r):i,!(void 0!==o&&(t.exports=o)))}(void 0,function(t){"use strict";function e(){}function n(){}function i(){}function r(){}function o(){}function a(){}function s(){}function u(t){this.name="RuntimeException",this.message=t,this.stack=(new Error).stack,Error.call(this,t)}function l(){if(0===arguments.length)u.call(this);else if(1===arguments.length){var t=arguments[0];u.call(this,t)}}function c(){}function h(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)h.call(this,0,0);else if(1===arguments.length){var t=arguments[0];h.call(this,t.x,t.y,t.z)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];h.call(this,e,n,h.NULL_ORDINATE)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];this.x=i,this.y=r,this.z=o}}function f(){if(this.dimensionsToTest=2,0===arguments.length)f.call(this,2);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new n("only 2 or 3 dimensions may be specified");this.dimensionsToTest=t}}function d(){}function p(){}function g(t){this.message=t||""}function v(){}function m(t){this.message=t||""}function y(t){this.message=t||""}function _(){this.array_=[],arguments[0]instanceof p&&this.addAll(arguments[0])}function b(){if(_.apply(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.ensureCapacity(e.length),this.add(e,n)}}function x(){if(this.minx=null,this.maxx=null,this.miny=null,this.maxy=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof h){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof x){var e=arguments[0];this.init(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];this.init(r,o,a,s)}}function w(){}function E(){w.call(this,"Projective point not representable on the Cartesian plane.")}function S(){}function M(){}function C(t){this.str=t}function I(t){this.value=t}function O(){}function T(){if(this.hi=0,this.lo=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof T){var e=arguments[0];this.init(e)}else if("string"==typeof arguments[0]){var n=arguments[0];T.call(this,T.parse(n))}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i,r)}}function P(){}function A(){}function L(){}function N(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var e=arguments[0],n=arguments[1];this.x=e,this.y=n,this.w=1}else if(arguments[0]instanceof N&&arguments[1]instanceof N){var i=arguments[0],r=arguments[1];this.x=i.y*r.w-r.y*i.w,this.y=r.x*i.w-i.x*r.w,this.w=i.x*r.y-r.x*i.y}else if(arguments[0]instanceof h&&arguments[1]instanceof h){var o=arguments[0],a=arguments[1];this.x=o.y-a.y,this.y=a.x-o.x,this.w=o.x*a.y-a.x*o.y}}else if(3===arguments.length){var s=arguments[0],u=arguments[1],l=arguments[2];this.x=s,this.y=u,this.w=l}else if(4===arguments.length){var c=arguments[0],f=arguments[1],d=arguments[2],p=arguments[3],g=c.y-f.y,v=f.x-c.x,m=c.x*f.y-f.x*c.y,y=d.y-p.y,_=p.x-d.x,b=d.x*p.y-p.x*d.y;this.x=v*b-_*m,this.y=y*m-g*b,this.w=g*_-y*v}}function k(){}function R(){}function D(){this.envelope=null,this.factory=null,this.SRID=null,this.userData=null;var t=arguments[0];this.factory=t,this.SRID=t.getSRID()}function F(){}function B(){}function j(){}function U(){}function z(){}function G(){}function V(){}function X(){}function H(){}function q(){}function Y(){}function W(){}function Z(){this.array_=[],arguments[0]instanceof p&&this.addAll(arguments[0])}function J(t){return null==t?kr:t.color}function K(t){return null==t?null:t.parent}function Q(t,e){null!==t&&(t.color=e)}function $(t){return null==t?null:t.left}function tt(t){return null==t?null:t.right}function et(){this.root_=null,this.size_=0}function nt(){}function it(){}function rt(){this.array_=[],arguments[0]instanceof p&&this.addAll(arguments[0])}function ot(){}function at(){}function st(){}function ut(){}function lt(){this.geometries=null;var t=arguments[0],e=arguments[1];if(D.call(this,e),null===t&&(t=[]),D.hasNullElements(t))throw new n("geometries must not contain null elements");this.geometries=t}function ct(){var t=arguments[0],e=arguments[1];lt.call(this,t,e)}function ht(){if(this.geom=null,this.geomFact=null,this.bnRule=null,this.endpointMap=null,1===arguments.length){var t=arguments[0];ht.call(this,t,B.MOD2_BOUNDARY_RULE)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.geom=e,this.geomFact=e.getFactory(),this.bnRule=n}}function ft(){this.count=null}function dt(){}function pt(){}function gt(){}function vt(){}function mt(){}function yt(){}function _t(){}function bt(){}function xt(){this.points=null;var t=arguments[0],e=arguments[1];D.call(this,e),this.init(t)}function wt(){}function Et(){this.coordinates=null;var t=arguments[0],e=arguments[1];D.call(this,e),this.init(t)}function St(){}function Mt(){this.shell=null,this.holes=null;var t=arguments[0],e=arguments[1],i=arguments[2];if(D.call(this,i),null===t&&(t=this.getFactory().createLinearRing()),null===e&&(e=[]),D.hasNullElements(e))throw new n("holes must not contain null elements");if(t.isEmpty()&&D.hasNonEmptyElements(e))throw new n("shell is empty but holes are not");this.shell=t,this.holes=e}function Ct(){var t=arguments[0],e=arguments[1];lt.call(this,t,e)}function It(){if(arguments[0]instanceof h&&arguments[1]instanceof $t){var t=arguments[0],e=arguments[1];It.call(this,e.getCoordinateSequenceFactory().create(t),e)}else if(Lr(arguments[0],A)&&arguments[1]instanceof $t){var n=arguments[0],i=arguments[1];xt.call(this,n,i),this.validateConstruction()}}function Ot(){var t=arguments[0],e=arguments[1];lt.call(this,t,e)}function Tt(){if(this.factory=null,this.isUserDataCopied=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.factory=t}}function Pt(){}function At(){}function Lt(){}function Nt(){}function kt(){if(this.dimension=3,this.coordinates=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];kt.call(this,t,3)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this.coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)this.coordinates[n]=new h}else if(Lr(arguments[0],A)){var i=arguments[0];if(null===i)return this.coordinates=new Array(0).fill(null),null;this.dimension=i.getDimension(),this.coordinates=new Array(i.size()).fill(null);for(var n=0;n<this.coordinates.length;n++)this.coordinates[n]=i.getCoordinateCopy(n)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var r=arguments[0],o=arguments[1];this.coordinates=r,this.dimension=o,null===r&&(this.coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],s=arguments[1];this.coordinates=new Array(a).fill(null),this.dimension=s;for(var n=0;n<a;n++)this.coordinates[n]=new h}}function Rt(){}function Dt(t,e){return t===e||t!==t&&e!==e}function Ft(t){this.add?t.forEach(this.add,this):t.forEach(function(t){this.set(t[0],t[1])},this)}function Bt(t){return this.has(t)&&(this._keys.splice(Dr,1),this._values.splice(Dr,1),this._itp.forEach(function(t){Dr<t[0]&&t[0]--})),Dr>-1}function jt(t){return this.has(t)?this._values[Dr]:void 0}function Ut(t,e){if(this.objectOnly&&e!==Object(e))throw new TypeError("Invalid value used as weak collection key");if(e!==e||0===e)for(Dr=t.length;Dr--&&!Dt(t[Dr],e););else Dr=t.indexOf(e);return Dr>-1}function zt(t){return Ut.call(this,this._keys,t)}function Gt(t,e){return this.has(t)?this._values[Dr]=e:this._values[this._keys.push(t)-1]=e,this}function Vt(){(this._keys||0).length=this._values.length=0}function Xt(){return Yt(this._itp,this._keys)}function Ht(){return Yt(this._itp,this._values)}function qt(){return Yt(this._itp,this._keys,this._values)}function Yt(t,e,n){var i=[0],r=!1;return t.push(i),{next:function(){var o,a=i[0];return!r&&a<e.length?(o=n?[e[a],n[a]]:e[a],i[0]++):(r=!0,t.splice(t.indexOf(i),1)),{done:r,value:o}}}}function Wt(){return this._values.length}function Zt(t,e){for(var n=this.entries();;){var i=n.next();if(i.done)break;t.call(e,i.value[1],i.value[0],this)}}function Jt(){this.map_=new jr}function Kt(){if(this.modelType=null,this.scale=null,0===arguments.length)this.modelType=Kt.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Qt){var t=arguments[0];this.modelType=t,t===Kt.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var e=arguments[0];this.modelType=Kt.FIXED,this.setScale(e)}else if(arguments[0]instanceof Kt){var n=arguments[0];this.modelType=n.modelType,this.scale=n.scale}}function Qt(){this.name=null;var t=arguments[0];this.name=t,Qt.nameToTypeMap.put(t,this)}function $t(){if(this.precisionModel=null,this.coordinateSequenceFactory=null,this.SRID=null,0===arguments.length)$t.call(this,new Kt,0);else if(1===arguments.length){if(Lr(arguments[0],k)){var t=arguments[0];$t.call(this,new Kt,0,t)}else if(arguments[0]instanceof Kt){var e=arguments[0];$t.call(this,e,0,$t.getDefaultCoordinateSequenceFactory())}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];$t.call(this,n,i,$t.getDefaultCoordinateSequenceFactory())}else if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];this.precisionModel=r,this.coordinateSequenceFactory=a,this.SRID=o}}function te(t){this.geometryFactory=t||new $t}function ee(t){this.parser=new te(t)}function ne(){this.result=null,this.inputLines=Array(2).fill().map(function(){return Array(2)}),this.intPt=new Array(2).fill(null),this.intLineIndex=null,this._isProper=null,this.pa=null,this.pb=null,this.precisionModel=null,this.intPt[0]=new h,this.intPt[1]=new h,this.pa=this.intPt[0],this.pb=this.intPt[1],this.result=0}function ie(){ne.apply(this)}function re(){}function oe(){this.p=null,this.crossingCount=0,this.isPointOnSegment=!1;var t=arguments[0];this.p=t}function ae(){}function se(){if(this.p0=null,this.p1=null,0===arguments.length)se.call(this,new h,new h);else if(1===arguments.length){var t=arguments[0];se.call(this,t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0=e,this.p1=n}else if(4===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],a=arguments[3];se.call(this,new h(i,r),new h(o,a))}}function ue(){this.items=new _,this.subnode=new Array(4).fill(null)}function le(){}function ce(t,e){var n,i,r,o,a={32:{d:127,c:128,b:0,a:0},64:{d:32752,c:0,b:0,a:0}},s={32:8,64:11}[t];if(o||(n=e<0||1/e<0,isFinite(e)||(o=a[t],n&&(o.d+=1<<t/4-1),i=Math.pow(2,s)-1,r=0)),!o){for(i={32:127,64:1023}[t],r=Math.abs(e);r>=2;)i++,r/=2;for(;r<1&&i>0;)i--,r*=2;i<=0&&(r/=2),32===t&&i>254&&(o={d:n?255:127,c:128,b:0,a:0},i=Math.pow(2,s)-1,r=0)}return i}function he(){this.pt=new h,this.level=0,this.env=null;var t=arguments[0];this.computeKey(t)}function fe(){ue.apply(this),this.env=null,this.centrex=null,this.centrey=null,this.level=null;var t=arguments[0],e=arguments[1];this.env=t,this.level=e,this.centrex=(t.getMinX()+t.getMaxX())/2,this.centrey=(t.getMinY()+t.getMaxY())/2}function de(){}function pe(){ue.apply(this)}function ge(){}function ve(){}function me(){this.items=new _}function ye(){this.root=null,this.minExtent=1,this.root=new pe}function _e(t){this.geometryFactory=t||new $t}function be(t){this.geometryFactory=t||new $t,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new _e(this.geometryFactory)}function xe(){this.parser=new _e(this.geometryFactory)}function we(){this.parent=null,this.atStart=null,this.max=null,this.index=null,this.subcollectionIterator=null;var t=arguments[0];this.parent=t,this.atStart=!0,this.index=0,this.max=t.getNumGeometries()}function Ee(){if(this.boundaryRule=B.OGC_SFS_BOUNDARY_RULE,this.isIn=null,this.numBoundaries=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new n("Rule must be non-null");this.boundaryRule=t}}function Se(){this.comps=null;var t=arguments[0];this.comps=t}function Me(){if(this.component=null,this.segIndex=null,this.pt=null,2===arguments.length){var t=arguments[0],e=arguments[1];Me.call(this,t,Me.INSIDE_AREA,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.component=n,this.segIndex=i,this.pt=r}}function Ce(){this.pts=null;var t=arguments[0];this.pts=t}function Ie(){this.locations=null;var t=arguments[0];this.locations=t}function Oe(){if(this.lines=null,this.isForcedToLineString=!1,1===arguments.length){var t=arguments[0];this.lines=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.lines=e,this.isForcedToLineString=n}}function Te(){if(this.geom=null,this.terminateDistance=0,this.ptLocator=new Ee,this.minDistanceLocation=null,this.minDistance=i.MAX_VALUE,2===arguments.length){var t=arguments[0],e=arguments[1];Te.call(this,t,e,0)}else if(3===arguments.length){var n=arguments[0],r=arguments[1],o=arguments[2];this.geom=new Array(2).fill(null),this.geom[0]=n,this.geom[1]=r,this.terminateDistance=o}}function Pe(){this.mapOp=null;var t=arguments[0];this.mapOp=t}function Ae(){}function Le(){if(this.pt=null,1===arguments.length){var t=arguments[0];u.call(this,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];u.call(this,Le.msgWithCoord(e,n)),this.name="TopologyException",this.pt=new h(n)}}function Ne(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];this.init(t.length)}else if(Number.isInteger(arguments[0])){var e=arguments[0];this.init(1),this.location[Ae.ON]=e}else if(arguments[0]instanceof Ne){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var i=0;i<this.location.length;i++)this.location[i]=n.location[i]}}else if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];this.init(3),this.location[Ae.ON]=r,this.location[Ae.LEFT]=o,this.location[Ae.RIGHT]=a}}function ke(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Ne(t),this.elt[1]=new Ne(t)}else if(arguments[0]instanceof ke){var e=arguments[0];this.elt[0]=new Ne(e.elt[0]),this.elt[1]=new Ne(e.elt[1])}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.elt[0]=new Ne(S.NONE),this.elt[1]=new Ne(S.NONE),this.elt[n].setLocation(i)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];this.elt[0]=new Ne(r,o,a),this.elt[1]=new Ne(r,o,a)}else if(4===arguments.length){var s=arguments[0],u=arguments[1],l=arguments[2],c=arguments[3];this.elt[0]=new Ne(S.NONE,S.NONE,S.NONE),this.elt[1]=new Ne(S.NONE,S.NONE,S.NONE),this.elt[s].setLocations(u,l,c)}}function Re(){this.startDe=null,this.maxNodeDegree=-1,this.edges=new _,this.pts=new _,this.label=new ke(S.NONE),this.ring=null,this._isHole=null,this.shell=null,this.holes=new _,this.geometryFactory=null;var t=arguments[0],e=arguments[1];this.geometryFactory=e,this.computePoints(t),this.computeRing()}function De(){var t=arguments[0],e=arguments[1];Re.call(this,t,e)}function Fe(){var t=arguments[0],e=arguments[1];Re.call(this,t,e)}function Be(){}function je(){this.geom=null;var t=arguments[0];this.geom=t}function Ue(){this.edgeMap=new et,this.edgeList=null,this.ptInAreaLocation=[S.NONE,S.NONE]}function ze(){}function Ge(){Ue.apply(this),this.resultAreaEdgeList=null,this.label=null,this.SCANNING_FOR_INCOMING=1,this.LINKING_TO_OUTGOING=2}function Ve(){if(this.label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.label=t}}function Xe(){Ve.apply(this),this.coord=null,this.edges=null;var t=arguments[0],e=arguments[1];this.coord=t,this.edges=e,this.label=new ke(0,S.NONE)}function He(){}function qe(){He.apply(this)}function Ye(){this.nodeMap=new et,this.nodeFact=null;var t=arguments[0];this.nodeFact=t}function We(){if(this.edge=null,this.label=null,this.node=null,this.p0=null,this.p1=null,this.dx=null,this.dy=null,this.quadrant=null,1===arguments.length){var t=arguments[0];this.edge=t}else if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];We.call(this,e,n,i,null)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];We.call(this,r),this.init(o,a),this.label=s}}function Ze(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this.sym=null,this.next=null,this.nextMin=null,this.edgeRing=null,this.minEdgeRing=null,this.depth=[0,-999,-999];var t=arguments[0],e=arguments[1];if(We.call(this,t),this._isForward=e,e)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var n=t.getNumPoints()-1;this.init(t.getCoordinate(n),t.getCoordinate(n-1))}this.computeDirectedLabel()}function Je(){if(this.edges=new _,this.nodes=null,this.edgeEndList=new _,0===arguments.length)this.nodes=new Ye(new He);else if(1===arguments.length){var t=arguments[0];this.nodes=new Ye(t)}}function Ke(){this.geometryFactory=new $t,this.geomGraph=null,this.disconnectedRingcoord=null;var t=arguments[0];this.geomGraph=t}function Qe(){this.tempEnv1=new x,this.selectedSegment=new se}function $e(){this.items=new _,this.subnode=[null,null]}function tn(){if(this.min=null,this.max=null,0===arguments.length)this.min=0,this.max=0;else if(1===arguments.length){var t=arguments[0];this.init(t.min,t.max)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.init(e,n)}}function en(){this.pt=0,this.level=0,this.interval=null;var t=arguments[0];this.computeKey(t)}function nn(){$e.apply(this),this.interval=null,this.centre=null,this.level=null;var t=arguments[0],e=arguments[1];this.interval=t,this.level=e,this.centre=(t.getMin()+t.getMax())/2}function rn(){$e.apply(this)}function on(){this.root=null,this.minExtent=1,this.root=new rn}function an(){this.pts=null,this.start=null,this.end=null,this.env=null,this.context=null,this.id=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.pts=t,this.start=e,this.end=n,this.context=i}function sn(){}function un(){}function ln(){this.ring=null,this.tree=null,this.crossings=0,this.interval=new tn;var t=arguments[0];this.ring=t,this.buildIndex()}function cn(){Qe.apply(this),this.mcp=null,this.p=null;var t=arguments[0],e=arguments[1];this.mcp=t,this.p=e}function hn(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e}function fn(){if(this.label=null,this.xValue=null,this.eventType=null,this.insertEvent=null,this.deleteEventIndex=null,this.obj=null,2===arguments.length){var t=arguments[0],e=arguments[1];this.eventType=fn.DELETE,this.xValue=t,this.insertEvent=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.eventType=fn.INSERT,this.label=n,this.xValue=i,this.obj=r}}function dn(){}function pn(){this._hasIntersection=!1,this.hasProper=!1,this.hasProperInterior=!1,this.properIntersectionPoint=null,this.li=null,this.includeProper=null,this.recordIsolated=null,this.isSelfIntersection=null,this.numIntersections=0,this.numTests=0,this.bdyNodes=null,this._isDone=!1,this.isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.li=t,this.includeProper=e,this.recordIsolated=n}function gn(){dn.apply(this),this.events=new _,this.nOverlaps=null}function vn(){this.min=i.POSITIVE_INFINITY,this.max=i.NEGATIVE_INFINITY}function mn(){}function yn(){vn.apply(this),this.item=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.min=t,this.max=e,this.item=n}function _n(){vn.apply(this),this.node1=null,this.node2=null;var t=arguments[0],e=arguments[1];this.node1=t,this.node2=e,this.buildExtent(this.node1,this.node2)}function bn(){this.leaves=new _,this.root=null,this.level=0}function xn(){this.index=null;var t=arguments[0];if(!Lr(t,St))throw new n("Argument must be Polygonal");this.index=new En(t)}function wn(){this.counter=null;var t=arguments[0];this.counter=t}function En(){this.index=new bn;var t=arguments[0];this.init(t)}function Sn(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new h(t),this.segmentIndex=e,this.dist=n}function Mn(){this.nodeMap=new et,this.edge=null;var t=arguments[0];this.edge=t}function Cn(){}function In(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new x,this.env2=new x;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Cn;this.startIndex=e.getChainStartIndices(this.pts)}function On(){this.depth=Array(2).fill().map(function(){return Array(3)});for(var t=0;t<2;t++)for(var e=0;e<3;e++)this.depth[t][e]=On.NULL_VALUE}function Tn(){if(Ve.apply(this),this.pts=null,this.env=null,this.eiList=new Mn(this),this.name=null,this.mce=null,this._isIsolated=!0,this.depth=new On,this.depthDelta=0,1===arguments.length){var t=arguments[0];Tn.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.pts=e,this.label=n}}function Pn(){if(Je.apply(this),this.parentGeom=null,this.lineEdgeMap=new Jt,this.boundaryNodeRule=null,this.useBoundaryDeterminationRule=!0,this.argIndex=null,this.boundaryNodes=null,this._hasTooFewPoints=!1,this.invalidPoint=null,this.areaPtLocator=null,this.ptLocator=new Ee,2===arguments.length){var t=arguments[0],e=arguments[1];Pn.call(this,t,e,B.OGC_SFS_BOUNDARY_RULE)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.argIndex=n,this.parentGeom=i,this.boundaryNodeRule=r,null!==i&&this.add(i)}}function An(){}function Ln(){if(this.edgeEnds=new _,1===arguments.length){var t=arguments[0];Ln.call(this,null,t)}else if(2===arguments.length){var e=(arguments[0],arguments[1]);We.call(this,e.getEdge(),e.getCoordinate(),e.getDirectedCoordinate(),new ke(e.getLabel())),this.insert(e)}}function Nn(){Ue.apply(this)}function kn(){var t=arguments[0],e=arguments[1];Xe.call(this,t,e)}function Rn(){He.apply(this)}function Dn(){this.nodes=new Ye(new Rn)}function Fn(){this.li=new ie,this.geomGraph=null,this.nodeGraph=new Dn,this.invalidPoint=null;var t=arguments[0];this.geomGraph=t}function Bn(){}function jn(){this.bounds=null,this.item=null;var t=arguments[0],e=arguments[1];this.bounds=t,this.item=e}function Un(){this._size=null,this.items=null,this._size=0,this.items=new _,this.items.add(null)}function zn(){if(this.childBoundables=new _,this.bounds=null,this.level=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.level=t}}function Gn(){this.boundable1=null,this.boundable2=null,this._distance=null,this.itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.boundable1=t,this.boundable2=e,this.itemDistance=n,this._distance=this.distance()}function Vn(){if(this.root=null,this.built=!1,this.itemBoundables=new _,this.nodeCapacity=null,0===arguments.length)Vn.call(this,Vn.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];c.isTrue(t>1,"Node capacity must be greater than 1"),this.nodeCapacity=t}}function Xn(){}function Hn(){}function qn(){if(0===arguments.length)qn.call(this,qn.DEFAULT_NODE_CAPACITY);else if(1===arguments.length){var t=arguments[0];Vn.call(this,t)}}function Yn(){var t=arguments[0];zn.call(this,t)}function Wn(){this.graph=null,this.rings=new _,this.totalEnv=new x,this.index=null,this.nestedPt=null;var t=arguments[0];this.graph=t}function Zn(){if(this.errorType=null,this.pt=null,1===arguments.length){var t=arguments[0];Zn.call(this,t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.errorType=e,null!==n&&(this.pt=n.copy())}}function Jn(){this.parentGeometry=null,this.isSelfTouchingRingFormingHoleValid=!1,this.validErr=null;var t=arguments[0];this.parentGeometry=t}function Kn(){this.inputGeom=null,this.factory=null,this.pruneEmptyGeometry=!0,this.preserveGeometryCollectionType=!0,this.preserveCollections=!1,this.preserveType=!1}function Qn(){if(this.snapTolerance=0,this.srcPts=null,this.seg=new se,this.allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof xt&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];Qn.call(this,t.getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.srcPts=n,this._isClosed=Qn.isClosed(n),this.snapTolerance=i}}function $n(){this.srcGeom=null;var t=arguments[0];this.srcGeom=t}function ti(){if(Kn.apply(this),this.snapTolerance=null,this.snapPts=null,this.isSelfSnap=!1,2===arguments.length){var t=arguments[0],e=arguments[1];this.snapTolerance=t,this.snapPts=e}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.snapTolerance=n,this.snapPts=i,this.isSelfSnap=r}}function ei(){this.isFirst=!0,this.commonMantissaBitsCount=53,this.commonBits=0,this.commonSignExp=null}function ni(){this.commonCoord=null,this.ccFilter=new ii}function ii(){this.commonBitsX=new ei,this.commonBitsY=new ei}function ri(){this.trans=null;var t=arguments[0];this.trans=t}function oi(){}function ai(){}function si(){this.pts=null,this.data=null;var t=arguments[0],e=arguments[1];this.pts=t,this.data=e}function ui(){}function li(){this.segString=null,this.coord=null,this.segmentIndex=null,this.segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.segString=t,this.coord=new h(e),this.segmentIndex=n,this.segmentOctant=i,this._isInterior=!e.equals2D(t.getCoordinate(n))}function ci(){this.nodeMap=new et,this.edge=null;var t=arguments[0];this.edge=t}function hi(){this.nodeList=null,this.edge=null,this.nodeIt=null,this.currNode=null,this.nextNode=null,this.currSegIndex=0;var t=arguments[0];this.nodeList=t,this.edge=t.getEdge(),this.nodeIt=t.iterator(),this.readNextNode()}function fi(){}function di(){this.nodeList=new ci(this),this.pts=null,this.data=null;var t=arguments[0],e=arguments[1];this.pts=t,this.data=e}function pi(){this.tempEnv1=new x,this.tempEnv2=new x,this.overlapSeg1=new se,this.overlapSeg2=new se}function gi(){}function vi(){if(this.segInt=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setSegmentIntersector(t)}}function mi(){if(this.monoChains=new _,this.index=new qn,this.idCounter=0,this.nodedSegStrings=null,this.nOverlaps=0,0===arguments.length);else if(1===arguments.length){var t=arguments[0];vi.call(this,t)}}function yi(){pi.apply(this),this.si=null;var t=arguments[0];this.si=t}function _i(){}function bi(){this.findAllIntersections=!1,this.isCheckEndSegmentsOnly=!1,this.li=null,this.interiorIntersection=null,this.intSegments=null,this.intersections=new _,this.intersectionCount=0,this.keepIntersections=!0;var t=arguments[0];this.li=t,this.interiorIntersection=null}function xi(){this.li=new ie,this.segStrings=null,this.findAllIntersections=!1,this.segInt=null,this._isValid=!0;var t=arguments[0];this.segStrings=t}function wi(){this.nv=null;var t=arguments[0];this.nv=new xi(wi.toSegmentStrings(t))}function Ei(){this.geometryFactory=null,this.shellList=new _;var t=arguments[0];this.geometryFactory=t}function Si(){this.op=null,this.geometryFactory=null,this.ptLocator=null,this.lineEdgesList=new _,this.resultLineList=new _;var t=arguments[0],e=arguments[1],n=arguments[2];this.op=t,this.geometryFactory=e,this.ptLocator=n}function Mi(){this.op=null,this.geometryFactory=null,this.resultPointList=new _;var t=arguments[0],e=arguments[1];arguments[2],this.op=t,this.geometryFactory=e}function Ci(){if(this.li=new ie,this.resultPrecisionModel=null,this.arg=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this.arg=new Array(1).fill(null),this.arg[0]=new Pn(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Ci.call(this,e,n,B.OGC_SFS_BOUNDARY_RULE)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];i.getPrecisionModel().compareTo(r.getPrecisionModel())>=0?this.setComputationPrecision(i.getPrecisionModel()):this.setComputationPrecision(r.getPrecisionModel()),this.arg=new Array(2).fill(null),this.arg[0]=new Pn(0,i,o),this.arg[1]=new Pn(1,r,o)}}function Ii(){this.pts=null,this._orientation=null;var t=arguments[0];this.pts=t,this._orientation=Ii.orientation(t)}function Oi(){this.edges=new _,this.ocaMap=new et}function Ti(){this.ptLocator=new Ee,this.geomFact=null,this.resultGeom=null,this.graph=null,this.edgeList=new Oi,this.resultPolyList=new _,this.resultLineList=new _,this.resultPointList=new _;var t=arguments[0],e=arguments[1];Ci.call(this,t,e),this.graph=new Je(new qe),this.geomFact=t.getFactory()}function Pi(){this.geom=new Array(2).fill(null),this.snapTolerance=null,this.cbr=null;var t=arguments[0],e=arguments[1];this.geom[0]=t,this.geom[1]=e,this.computeSnapTolerance()}function Ai(){this.geom=new Array(2).fill(null);var t=arguments[0],e=arguments[1];this.geom[0]=t,this.geom[1]=e}function Li(){this.factory=null,this.interiorPoint=null,this.maxWidth=0;var t=arguments[0];this.factory=t.getFactory(),this.add(t)}function Ni(){this.poly=null,this.centreY=null,this.hiY=i.MAX_VALUE,this.loY=-i.MAX_VALUE;var t=arguments[0];this.poly=t,this.hiY=t.getEnvelopeInternal().getMaxY(),this.loY=t.getEnvelopeInternal().getMinY(),this.centreY=Li.avg(this.loY,this.hiY)}function ki(){this.geomFactory=null,this.skipEmpty=!1,this.inputGeoms=null;var t=arguments[0];this.geomFactory=ki.extractFactory(t),this.inputGeoms=t}function Ri(){this.pointGeom=null,this.otherGeom=null,this.geomFact=null;var t=arguments[0],e=arguments[1];this.pointGeom=t,this.otherGeom=e,this.geomFact=e.getFactory()}function Di(){this.sortIndex=-1,this.comps=null;var t=arguments[0],e=arguments[1];this.sortIndex=t,this.comps=e}function Fi(){this.inputPolys=null,this.geomFactory=null;var t=arguments[0];this.inputPolys=t,null===this.inputPolys&&(this.inputPolys=new _)}function Bi(){if(this.polygons=new _,this.lines=new _,this.points=new _,this.geomFact=null,1===arguments.length){if(Lr(arguments[0],p)){var t=arguments[0];this.extract(t)}else if(arguments[0]instanceof D){var e=arguments[0];this.extract(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.geomFact=i,this.extract(n)}}function ji(){}function Ui(){this.centroid=null,this.minDistance=i.MAX_VALUE,this.interiorPoint=null;var t=arguments[0];this.centroid=t.getCentroid().getCoordinate(),this.addInterior(t),null===this.interiorPoint&&this.addEndpoints(t)}function zi(){if(this.inputGeom=null,this.isClosedEndpointsInInterior=!0,this.nonSimpleLocation=null,1===arguments.length){var t=arguments[0];this.inputGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.inputGeom=e,this.isClosedEndpointsInInterior=!n.isInBoundary(2)}}function Gi(){this.pt=null,this.isClosed=null,this.degree=null;var t=arguments[0];this.pt=t,this.isClosed=!1,this.degree=0}function Vi(){if(this.quadrantSegments=Vi.DEFAULT_QUADRANT_SEGMENTS,this.endCapStyle=Vi.CAP_ROUND,this.joinStyle=Vi.JOIN_ROUND,this.mitreLimit=Vi.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this.simplifyFactor=Vi.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.setQuadrantSegments(e),this.setEndCapStyle(n)}else if(4===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],a=arguments[3];this.setQuadrantSegments(i),this.setEndCapStyle(r),this.setJoinStyle(o),this.setMitreLimit(a)}}function Xi(t){this.message=t||""}function Hi(){this.array_=[]}function qi(){this.minIndex=-1,this.minCoord=null,this.minDe=null,this.orientedDe=null}function Yi(){this.array_=[]}function Wi(){this.finder=null,this.dirEdgeList=new _,
this.nodes=new _,this.rightMostCoord=null,this.env=null,this.finder=new qi}function Zi(){this.inputLine=null,this.distanceTol=null,this.isDeleted=null,this.angleOrientation=ae.COUNTERCLOCKWISE;var t=arguments[0];this.inputLine=t}function Ji(){this.ptList=null,this.precisionModel=null,this.minimimVertexDistance=0,this.ptList=new _}function Ki(){}function Qi(){this.maxCurveSegmentError=0,this.filletAngleQuantum=null,this.closingSegLengthFactor=1,this.segList=null,this.distance=0,this.precisionModel=null,this.bufParams=null,this.li=null,this.s0=null,this.s1=null,this.s2=null,this.seg0=new se,this.seg1=new se,this.offset0=new se,this.offset1=new se,this.side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.precisionModel=t,this.bufParams=e,this.li=new ie,this.filletAngleQuantum=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===Vi.JOIN_ROUND&&(this.closingSegLengthFactor=Qi.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)}function $i(){this.distance=0,this.precisionModel=null,this.bufParams=null;var t=arguments[0],e=arguments[1];this.precisionModel=t,this.bufParams=e}function tr(){this.subgraphs=null,this.seg=new se,this.cga=new ae;var t=arguments[0];this.subgraphs=t}function er(){this.upwardSeg=null,this.leftDepth=null;var t=arguments[0],e=arguments[1];this.upwardSeg=new se(t),this.leftDepth=e}function nr(){this.p0=null,this.p1=null,this.p2=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.p0=t,this.p1=e,this.p2=n}function ir(){this.inputGeom=null,this.distance=null,this.curveBuilder=null,this.curveList=new _;var t=arguments[0],e=arguments[1],n=arguments[2];this.inputGeom=t,this.distance=e,this.curveBuilder=n}function rr(){this._hasIntersection=!1,this.hasProper=!1,this.hasProperInterior=!1,this.hasInterior=!1,this.properIntersectionPoint=null,this.li=null,this.isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this.li=t}function or(){this.bufParams=null,this.workingPrecisionModel=null,this.workingNoder=null,this.geomFact=null,this.graph=null,this.edgeList=new Oi;var t=arguments[0];this.bufParams=t}function ar(){if(this.noder=null,this.scaleFactor=null,this.offsetX=null,this.offsetY=null,this.isScaled=!1,2===arguments.length){var t=arguments[0],e=arguments[1];ar.call(this,t,e,0,0)}else if(4===arguments.length){var n=arguments[0],i=arguments[1];arguments[2],arguments[3],this.noder=n,this.scaleFactor=i,this.isScaled=!this.isIntegerPrecision()}}function sr(){this.li=new ie,this.segStrings=null;var t=arguments[0];this.segStrings=t}function ur(){this.li=null,this.pt=null,this.originalPt=null,this.ptScaled=null,this.p0Scaled=null,this.p1Scaled=null,this.scaleFactor=null,this.minx=null,this.maxx=null,this.miny=null,this.maxy=null,this.corner=new Array(4).fill(null),this.safeEnv=null;var t=arguments[0],e=arguments[1],i=arguments[2];if(this.originalPt=t,this.pt=t,this.scaleFactor=e,this.li=i,e<=0)throw new n("Scale factor must be non-zero");1!==e&&(this.pt=new h(this.scale(t.x),this.scale(t.y)),this.p0Scaled=new h,this.p1Scaled=new h),this.initCorners(this.pt)}function lr(){this.index=null;var t=arguments[0];this.index=t}function cr(){Qe.apply(this),this.hotPixel=null,this.parentEdge=null,this.hotPixelVertexIndex=null,this._isNodeAdded=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this.hotPixel=t,this.parentEdge=e,this.hotPixelVertexIndex=n}function hr(){this.li=null,this.interiorIntersections=null;var t=arguments[0];this.li=t,this.interiorIntersections=new _}function fr(){this.pm=null,this.li=null,this.scaleFactor=null,this.noder=null,this.pointSnapper=null,this.nodedSegStrings=null;var t=arguments[0];this.pm=t,this.li=new ie,this.li.setPrecisionModel(t),this.scaleFactor=t.getScale()}function dr(){if(this.argGeom=null,this.distance=null,this.bufParams=new Vi,this.resultGeometry=null,this.saveException=null,1===arguments.length){var t=arguments[0];this.argGeom=t}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.argGeom=e,this.bufParams=n}}function pr(){this.treeSet=new rt,this.list=new _}function gr(){if(this.geomFactory=null,this.inputPts=null,1===arguments.length){var t=arguments[0];gr.call(this,gr.extractCoordinates(t),t.getFactory())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.inputPts=pr.filterCoordinates(e),this.geomFactory=n}}function vr(){this.origin=null;var t=arguments[0];this.origin=t}function mr(){this.areaBasePt=null,this.triangleCent3=new h,this.areasum2=0,this.cg3=new h,this.lineCentSum=new h,this.totalLength=0,this.ptCount=0,this.ptCentSum=new h;var t=arguments[0];this.areaBasePt=null,this.add(t)}function yr(){if(this.matrix=null,0===arguments.length)this.matrix=Array(3).fill().map(function(){return Array(3)}),this.setAll(at.FALSE);else if(1===arguments.length)if("string"==typeof arguments[0]){var t=arguments[0];yr.call(this),this.set(t)}else if(arguments[0]instanceof yr){var e=arguments[0];yr.call(this),this.matrix[S.INTERIOR][S.INTERIOR]=e.matrix[S.INTERIOR][S.INTERIOR],this.matrix[S.INTERIOR][S.BOUNDARY]=e.matrix[S.INTERIOR][S.BOUNDARY],this.matrix[S.INTERIOR][S.EXTERIOR]=e.matrix[S.INTERIOR][S.EXTERIOR],this.matrix[S.BOUNDARY][S.INTERIOR]=e.matrix[S.BOUNDARY][S.INTERIOR],this.matrix[S.BOUNDARY][S.BOUNDARY]=e.matrix[S.BOUNDARY][S.BOUNDARY],this.matrix[S.BOUNDARY][S.EXTERIOR]=e.matrix[S.BOUNDARY][S.EXTERIOR],this.matrix[S.EXTERIOR][S.INTERIOR]=e.matrix[S.EXTERIOR][S.INTERIOR],this.matrix[S.EXTERIOR][S.BOUNDARY]=e.matrix[S.EXTERIOR][S.BOUNDARY],this.matrix[S.EXTERIOR][S.EXTERIOR]=e.matrix[S.EXTERIOR][S.EXTERIOR]}}function _r(){this.li=new ie,this.ptLocator=new Ee,this.arg=null,this.nodes=new Ye(new Rn),this.im=null,this.isolatedEdges=new _,this.invalidPoint=null;var t=arguments[0];this.arg=t}function br(){this.rectEnv=null;var t=arguments[0];this.rectEnv=t.getEnvelopeInternal()}function xr(){this.li=new ie,this.rectEnv=null,this.diagUp0=null,this.diagUp1=null,this.diagDown0=null,this.diagDown1=null;var t=arguments[0];this.rectEnv=t,this.diagUp0=new h(t.getMinX(),t.getMinY()),this.diagUp1=new h(t.getMaxX(),t.getMaxY()),this.diagDown0=new h(t.getMinX(),t.getMaxY()),this.diagDown1=new h(t.getMaxX(),t.getMinY())}function wr(){this._isDone=!1}function Er(){this.rectangle=null,this.rectEnv=null;var t=arguments[0];this.rectangle=t,this.rectEnv=t.getEnvelopeInternal()}function Sr(){wr.apply(this),this.rectEnv=null,this._intersects=!1;var t=arguments[0];this.rectEnv=t}function Mr(){wr.apply(this),this.rectSeq=null,this.rectEnv=null,this._containsPoint=!1;var t=arguments[0];this.rectSeq=t.getExteriorRing().getCoordinateSequence(),this.rectEnv=t.getEnvelopeInternal()}function Cr(){wr.apply(this),this.rectEnv=null,this.rectIntersector=null,this.hasIntersection=!1,this.p0=new h,this.p1=new h;var t=arguments[0];this.rectEnv=t.getEnvelopeInternal(),this.rectIntersector=new xr(this.rectEnv)}function Ir(){if(this._relate=null,2===arguments.length){var t=arguments[0],e=arguments[1];Ci.call(this,t,e),this._relate=new _r(this.arg)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];Ci.call(this,n,i,r),this._relate=new _r(this.arg)}}function Or(){this.centroid=null,this.minDistance=i.MAX_VALUE,this.interiorPoint=null;var t=arguments[0];this.centroid=t.getCentroid().getCoordinate(),this.add(t)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(void 0===this||null===this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,i=1 in arguments?parseInt(Number(arguments[1]),10)||0:0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)e[i]=t,++i;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!==t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Tr=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};Tr(e.prototype,{interfaces_:function(){return[]},getClass:function(){return e}}),e.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n},i.isNaN=function(t){return Number.isNaN(t)},i.doubleToLongBits=function(t){return t},i.longBitsToDouble=function(t){return t},i.isInfinite=function(t){return!Number.isFinite(t)},i.MAX_VALUE=Number.MAX_VALUE,u.prototype=Object.create(Error.prototype),u.prototype.constructor=Error;var Pr=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t};Pr(l,u),Tr(l.prototype,{interfaces_:function(){return[]},getClass:function(){return l}}),Tr(c.prototype,{interfaces_:function(){return[]},getClass:function(){return c}}),c.shouldNeverReachHere=function(){if(0===arguments.length)c.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new l("Should never reach here"+(null!==t?": "+t:""))}},c.isTrue=function(){if(1===arguments.length){var t=arguments[0];c.isTrue(t,null)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!e)throw null===n?new l:new l(n)}},c.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];c.equals(t,e,null)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(!i.equals(n))throw new l("Expected "+n+" but encountered "+i+(null!==r?": "+r:""))}},Tr(h.prototype,{setOrdinate:function(t,e){switch(t){case h.X:this.x=e;break;case h.Y:this.y=e;break;case h.Z:this.z=e;break;default:throw new n("Invalid ordinate index: "+t)}},equals2D:function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var n=arguments[0],i=arguments[1];return!!e.equalsWithTolerance(this.x,n.x,i)&&!!e.equalsWithTolerance(this.y,n.y,i)}},getOrdinate:function(t){switch(t){case h.X:return this.x;case h.Y:return this.y;case h.Z:return this.z}throw new n("Invalid ordinate index: "+t)},equals3D:function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||i.isNaN(this.z)&&i.isNaN(t.z))},equals:function(t){return t instanceof h&&this.equals2D(t)},equalInZ:function(t,n){return e.equalsWithTolerance(this.z,t.z,n)},compareTo:function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0},clone:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return c.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw t}finally{}},copy:function(){return new h(this)},toString:function(){return"("+this.x+", "+this.y+", "+this.z+")"},distance3D:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+n*n+i*i)},distance:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},hashCode:function(){var t=17;return t=37*t+h.hashCode(this.x),t=37*t+h.hashCode(this.y)},setCoordinate:function(t){this.x=t.x,this.y=t.y,this.z=t.z},interfaces_:function(){return[r,o,s]},getClass:function(){return h}}),h.hashCode=function(){if(1===arguments.length){var t=arguments[0],e=i.doubleToLongBits(t);return Math.trunc(e^e>>>32)}},Tr(f.prototype,{compare:function(t,e){var n=t,i=e,r=f.compare(n.x,i.x);if(0!==r)return r;var o=f.compare(n.y,i.y);return 0!==o?o:this.dimensionsToTest<=2?0:f.compare(n.z,i.z)},interfaces_:function(){return[a]},getClass:function(){return f}}),f.compare=function(t,e){return t<e?-1:t>e?1:i.isNaN(t)?i.isNaN(e)?0:-1:i.isNaN(e)?1:0},h.DimensionalComparator=f,h.serialVersionUID=0x5cbf2c235c7e5800,h.NULL_ORDINATE=i.NaN,h.X=0,h.Y=1,h.Z=2,d.prototype.hasNext=function(){},d.prototype.next=function(){},d.prototype.remove=function(){},p.prototype.add=function(){},p.prototype.addAll=function(){},p.prototype.isEmpty=function(){},p.prototype.iterator=function(){},p.prototype.size=function(){},p.prototype.toArray=function(){},p.prototype.remove=function(){},g.prototype=new Error,g.prototype.name="IndexOutOfBoundsException",v.prototype=Object.create(p.prototype),v.prototype.constructor=v,v.prototype.get=function(){},v.prototype.set=function(){},v.prototype.isEmpty=function(){},m.prototype=new Error,m.prototype.name="NoSuchElementException",y.prototype=new Error,y.prototype.name="OperationNotSupported",_.prototype=Object.create(v.prototype),_.prototype.constructor=_,_.prototype.ensureCapacity=function(){},_.prototype.interfaces_=function(){return[v,p]},_.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},_.prototype.clear=function(){this.array_=[]},_.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},_.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},_.prototype.iterator=function(){return new Ar(this)},_.prototype.get=function(t){if(t<0||t>=this.size())throw new g;return this.array_[t]},_.prototype.isEmpty=function(){return 0===this.array_.length},_.prototype.size=function(){return this.array_.length},_.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},_.prototype.remove=function(t){for(var e=!1,n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e};var Ar=function(t){this.arrayList_=t,this.position_=0};Ar.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new m;return this.arrayList_.get(this.position_++)},Ar.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},Ar.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},Ar.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},Pr(b,_),Tr(b.prototype,{getCoordinate:function(t){return this.get(t)},addAll:function(){if(2===arguments.length){for(var t=arguments[0],e=arguments[1],n=!1,i=t.iterator();i.hasNext();)this.add(i.next(),e),n=!0;return n}return _.prototype.addAll.apply(this,arguments)},clone:function(){for(var t=_.prototype.clone.call(this),e=0;e<this.size();e++)t.add(e,this.get(e).copy());return t},toCoordinateArray:function(){return this.toArray(b.coordArrayType)},add:function(){if(1===arguments.length){var t=arguments[0];_.prototype.add.call(this,t)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var e=arguments[0],n=arguments[1];return this.add(e,n,!0),!0}if(arguments[0]instanceof h&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];if(!r&&this.size()>=1){var o=this.get(this.size()-1);if(o.equals2D(i))return null}_.prototype.add.call(this,i)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var a=arguments[0],s=arguments[1];return this.add(a,s),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var u=arguments[0],l=arguments[1],c=arguments[2];if(c)for(var f=0;f<u.length;f++)this.add(u[f],l);else for(var f=u.length-1;f>=0;f--)this.add(u[f],l);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof h){var d=arguments[0],p=arguments[1],g=arguments[2];if(!g){var v=this.size();if(v>0){if(d>0){var m=this.get(d-1);if(m.equals2D(p))return null}if(d<v){var y=this.get(d);if(y.equals2D(p))return null}}}_.prototype.add.call(this,d,p)}}else if(4===arguments.length){var b=arguments[0],x=arguments[1],w=arguments[2],E=arguments[3],S=1;w>E&&(S=-1);for(var f=w;f!==E;f+=S)this.add(b[f],x);return!0}},closeRing:function(){this.size()>0&&this.add(new h(this.get(0)),!1)},interfaces_:function(){return[]},getClass:function(){return b}}),b.coordArrayType=new Array(0).fill(null),Tr(x.prototype,{getArea:function(){return this.getWidth()*this.getHeight()},equals:function(t){if(!(t instanceof x))return!1;var e=t;return this.isNull()?e.isNull():this.maxx===e.getMaxX()&&this.maxy===e.getMaxY()&&this.minx===e.getMinX()&&this.miny===e.getMinY()},intersection:function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new x;var e=this.minx>t.minx?this.minx:t.minx,n=this.miny>t.miny?this.miny:t.miny;return new x(e,this.maxx<t.maxx?this.maxx:t.maxx,n,this.maxy<t.maxy?this.maxy:t.maxy)},isNull:function(){return this.maxx<this.minx},getMaxX:function(){return this.maxx},covers:function(){if(1===arguments.length){if(arguments[0]instanceof h){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof x){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this.minx&&e.getMaxX()<=this.maxx&&e.getMinY()>=this.miny&&e.getMaxY()<=this.maxy}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&n>=this.minx&&n<=this.maxx&&i>=this.miny&&i<=this.maxy}},intersects:function(){if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t.minx>this.maxx||t.maxx<this.minx||t.miny>this.maxy||t.maxy<this.miny)}if(arguments[0]instanceof h){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&!(n>this.maxx||n<this.minx||i>this.maxy||i<this.miny)}},getMinY:function(){return this.miny},getMinX:function(){return this.minx},expandToInclude:function(){if(1===arguments.length){if(arguments[0]instanceof h){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof x){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this.minx=e.getMinX(),this.maxx=e.getMaxX(),this.miny=e.getMinY(),this.maxy=e.getMaxY()):(e.minx<this.minx&&(this.minx=e.minx),e.maxx>this.maxx&&(this.maxx=e.maxx),e.miny<this.miny&&(this.miny=e.miny),e.maxy>this.maxy&&(this.maxy=e.maxy))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this.minx=n,this.maxx=n,this.miny=i,this.maxy=i):(n<this.minx&&(this.minx=n),n>this.maxx&&(this.maxx=n),i<this.miny&&(this.miny=i),i>this.maxy&&(this.maxy=i))}},minExtent:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},getWidth:function(){return this.isNull()?0:this.maxx-this.minx},compareTo:function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this.minx<e.minx?-1:this.minx>e.minx?1:this.miny<e.miny?-1:this.miny>e.miny?1:this.maxx<e.maxx?-1:this.maxx>e.maxx?1:this.maxy<e.maxy?-1:this.maxy>e.maxy?1:0},translate:function(t,e){return this.isNull()?null:void this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},toString:function(){return"Env["+this.minx+" : "+this.maxx+", "+this.miny+" : "+this.maxy+"]"},setToNull:function(){this.minx=0,this.maxx=-1,this.miny=0,this.maxy=-1},getHeight:function(){return this.isNull()?0:this.maxy-this.miny},maxExtent:function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},expandBy:function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this.minx-=e,this.maxx+=e,this.miny-=n,this.maxy+=n,(this.minx>this.maxx||this.miny>this.maxy)&&this.setToNull()}},contains:function(){if(1===arguments.length){if(arguments[0]instanceof x){var t=arguments[0];return this.covers(t)}if(arguments[0]instanceof h){var e=arguments[0];return this.covers(e)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.covers(n,i)}},centre:function(){return this.isNull()?null:new h((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},init:function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof h){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof x){var e=arguments[0];this.minx=e.minx,this.maxx=e.maxx,this.miny=e.miny,this.maxy=e.maxy}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3];r<o?(this.minx=r,this.maxx=o):(this.minx=o,this.maxx=r),a<s?(this.miny=a,this.maxy=s):(this.miny=s,this.maxy=a)}},getMaxY:function(){return this.maxy},distance:function(t){if(this.intersects(t))return 0;var e=0;this.maxx<t.minx?e=t.minx-this.maxx:this.minx>t.maxx&&(e=this.minx-t.maxx);var n=0;return this.maxy<t.miny?n=t.miny-this.maxy:this.miny>t.maxy&&(n=this.miny-t.maxy),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},hashCode:function(){var t=17;return t=37*t+h.hashCode(this.minx),t=37*t+h.hashCode(this.maxx),t=37*t+h.hashCode(this.miny),t=37*t+h.hashCode(this.maxy)},interfaces_:function(){return[r,s]},getClass:function(){return x}}),x.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],a=arguments[3],s=Math.min(o.x,a.x),u=Math.max(o.x,a.x),l=Math.min(i.x,r.x),c=Math.max(i.x,r.x);return!(l>u||c<s||(s=Math.min(o.y,a.y),u=Math.max(o.y,a.y),l=Math.min(i.y,r.y),c=Math.max(i.y,r.y),l>u||c<s))}},x.serialVersionUID=0x51845cd552189800,Pr(E,w),Tr(E.prototype,{interfaces_:function(){return[]},getClass:function(){return E}}),Tr(S.prototype,{interfaces_:function(){return[]},getClass:function(){return S}}),S.toLocationSymbol=function(t){switch(t){case S.EXTERIOR:return"e";case S.BOUNDARY:return"b";case S.INTERIOR:return"i";case S.NONE:return"-"}throw new n("Unknown location value: "+t)},S.INTERIOR=0,S.BOUNDARY=1,S.EXTERIOR=2,S.NONE=-1;var Lr=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1};Tr(M.prototype,{interfaces_:function(){return[]},getClass:function(){return M}}),M.log10=function(t){var e=Math.log(t);return i.isInfinite(e)?e:i.isNaN(e)?e:e/M.LOG_10},M.min=function(t,e,n,i){var r=t;return e<r&&(r=e),n<r&&(r=n),i<r&&(r=i),r},M.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],o=arguments[2];return i<r?r:i>o?o:i}},M.wrap=function(t,e){return t<0?e- -t%e:t%e},M.max=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=t;return e>i&&(i=e),n>i&&(i=n),i}if(4===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],i=r;return o>i&&(i=o),a>i&&(i=a),s>i&&(i=s),i}},M.average=function(t,e){return(t+e)/2},M.LOG_10=Math.log(10),C.prototype.append=function(t){this.str+=t},C.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},C.prototype.toString=function(t){return this.str},I.prototype.intValue=function(){return this.value},I.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},I.isNaN=function(t){return Number.isNaN(t)},O.isWhitespace=function(t){return t<=32&&t>=0||127==t},O.toUpperCase=function(t){return t.toUpperCase()},Tr(T.prototype,{le:function(t){return this.hi<t.hi||this.hi===t.hi&&this.lo<=t.lo},extractSignificantDigits:function(t,e){var n=this.abs(),i=T.magnitude(n.hi),r=T.TEN.pow(i);n=n.divide(r),n.gt(T.TEN)?(n=n.divide(T.TEN),i+=1):n.lt(T.ONE)&&(n=n.multiply(T.TEN),i-=1);for(var o=i+1,a=new C,s=T.MAX_PRINT_DIGITS-1,u=0;u<=s;u++){t&&u===o&&a.append(".");var l=Math.trunc(n.hi);if(l<0)break;var c=!1,h=0;l>9?(c=!0,h="9"):h="0"+l,a.append(h),n=n.subtract(T.valueOf(l)).multiply(T.TEN),c&&n.selfAdd(T.TEN);var f=!0,d=T.magnitude(n.hi);if(d<0&&Math.abs(d)>=s-u&&(f=!1),!f)break}return e[0]=i,a.toString()},sqr:function(){return this.multiply(this)},doubleValue:function(){return this.hi+this.lo},subtract:function(){if(arguments[0]instanceof T){var t=arguments[0];return this.add(t.negate())}if("number"==typeof arguments[0]){var e=arguments[0];return this.add(-e)}},equals:function(){if(1===arguments.length){var t=arguments[0];return this.hi===t.hi&&this.lo===t.lo}},isZero:function(){return 0===this.hi&&0===this.lo},selfSubtract:function(){if(arguments[0]instanceof T){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t.hi,-t.lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},getSpecialNumberString:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},min:function(t){return this.le(t)?this:t},selfDivide:function(){if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];return this.selfDivide(t.hi,t.lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfDivide(e,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,o=null,a=null,s=null,u=null,l=null,c=null,h=null;return u=this.hi/n,l=T.SPLIT*u,r=l-u,h=T.SPLIT*n,r=l-r,o=u-r,a=h-n,c=u*n,a=h-a,s=n-a,h=r*a-c+r*s+o*a+o*s,l=(this.hi-c-h+this.lo-u*i)/n,h=u+l,this.hi=h,this.lo=u-h+l,this}},dump:function(){return"DD<"+this.hi+", "+this.lo+">"},divide:function(){if(arguments[0]instanceof T){var t=arguments[0],e=null,n=null,r=null,o=null,a=null,s=null,u=null,l=null;return a=this.hi/t.hi,s=T.SPLIT*a,e=s-a,l=T.SPLIT*t.hi,e=s-e,n=a-e,r=l-t.hi,u=a*t.hi,r=l-r,o=t.hi-r,l=e*r-u+e*o+n*r+n*o,s=(this.hi-u-l+this.lo-a*t.lo)/t.hi,l=a+s,new T(l,a-l+s)}if("number"==typeof arguments[0]){var c=arguments[0];return i.isNaN(c)?T.createNaN():T.copy(this).selfDivide(c,0)}},ge:function(t){return this.hi>t.hi||this.hi===t.hi&&this.lo>=t.lo},pow:function(t){if(0===t)return T.valueOf(1);var e=new T(this),n=T.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2==1&&n.selfMultiply(e),(i/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},ceil:function(){if(this.isNaN())return T.NaN;var t=Math.ceil(this.hi),e=0;return t===this.hi&&(e=Math.ceil(this.lo)),new T(t,e)},compareTo:function(t){var e=t;return this.hi<e.hi?-1:this.hi>e.hi?1:this.lo<e.lo?-1:this.lo>e.lo?1:0},rint:function(){return this.isNaN()?this:this.add(.5).floor()},setValue:function(){if(arguments[0]instanceof T){var t=arguments[0];return this.init(t),this}if("number"==typeof arguments[0]){var e=arguments[0];return this.init(e),this}},max:function(t){return this.ge(t)?this:t},sqrt:function(){if(this.isZero())return T.valueOf(0);if(this.isNegative())return T.NaN;var t=1/Math.sqrt(this.hi),e=this.hi*t,n=T.valueOf(e),i=this.subtract(n.sqr()),r=i.hi*(.5*t);return n.add(r)},selfAdd:function(){if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];return this.selfAdd(t.hi,t.lo)}if("number"==typeof arguments[0]){var e=arguments[0],n=null,i=null,r=null,o=null,a=null,s=null;return r=this.hi+e,a=r-this.hi,o=r-a,o=e-a+(this.hi-o),s=o+this.lo,n=r+s,i=s+(r-n),this.hi=n+i,this.lo=i+(n-this.hi),this}}else if(2===arguments.length){var u=arguments[0],l=arguments[1],n=null,i=null,c=null,h=null,r=null,o=null,a=null,s=null;r=this.hi+u,c=this.lo+l,a=r-this.hi,s=c-this.lo,o=r-a,h=c-s,o=u-a+(this.hi-o),h=l-s+(this.lo-h),a=o+c,n=r+a,i=a+(r-n),a=h+i;var f=n+a,d=a+(n-f);return this.hi=f,this.lo=d,this}},selfMultiply:function(){if(1===arguments.length){if(arguments[0]instanceof T){var t=arguments[0];return this.selfMultiply(t.hi,t.lo)}if("number"==typeof arguments[0]){var e=arguments[0];return this.selfMultiply(e,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,o=null,a=null,s=null,u=null,l=null;u=T.SPLIT*this.hi,r=u-this.hi,l=T.SPLIT*n,r=u-r,o=this.hi-r,a=l-n,u=this.hi*n,a=l-a,s=n-a,l=r*a-u+r*s+o*a+o*s+(this.hi*i+this.lo*n);var c=u+l;r=u-c;var h=l+r;return this.hi=c,this.lo=h,this}},selfSqr:function(){return this.selfMultiply(this)},floor:function(){if(this.isNaN())return T.NaN;var t=Math.floor(this.hi),e=0;return t===this.hi&&(e=Math.floor(this.lo)),new T(t,e)},negate:function(){return this.isNaN()?this:new T(-this.hi,-this.lo)},clone:function(){try{return null}catch(t){if(t instanceof CloneNotSupportedException)return null;throw t}finally{}},multiply:function(){if(arguments[0]instanceof T){var t=arguments[0];return t.isNaN()?T.createNaN():T.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return i.isNaN(e)?T.createNaN():T.copy(this).selfMultiply(e,0)}},isNaN:function(){return i.isNaN(this.hi)},intValue:function(){return Math.trunc(this.hi)},toString:function(){var t=T.magnitude(this.hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},toStandardNotation:function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),i=e[0]+1,r=n;if("."===n.charAt(0))r="0"+n;else if(i<0)r="0."+T.stringOfChar("0",-i)+n;else if(n.indexOf(".")===-1){var o=i-n.length,a=T.stringOfChar("0",o);r=n+a+".0"}return this.isNegative()?"-"+r:r},reciprocal:function(){var t=null,e=null,n=null,i=null,r=null,o=null,a=null,s=null;r=1/this.hi,o=T.SPLIT*r,t=o-r,s=T.SPLIT*this.hi,t=o-t,e=r-t,n=s-this.hi,a=r*this.hi,n=s-n,i=this.hi-n,s=t*n-a+t*i+e*n+e*i,o=(1-a-s-r*this.lo)/this.hi;var u=r+o;return new T(u,r-u+o)},toSciNotation:function(){if(this.isZero())return T.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),i=T.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new IllegalStateException("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var o=n.charAt(0)+"."+r;return this.isNegative()?"-"+o+i:o+i},abs:function(){return this.isNaN()?T.NaN:this.isNegative()?this.negate():new T(this)},isPositive:function(){return this.hi>0||0===this.hi&&this.lo>0},lt:function(t){return this.hi<t.hi||this.hi===t.hi&&this.lo<t.lo},add:function(){if(arguments[0]instanceof T){var t=arguments[0];return T.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return T.copy(this).selfAdd(e)}},init:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.hi=t,this.lo=0}else if(arguments[0]instanceof T){var e=arguments[0];this.hi=e.hi,this.lo=e.lo}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.hi=n,this.lo=i}},gt:function(t){return this.hi>t.hi||this.hi===t.hi&&this.lo>t.lo},isNegative:function(){return this.hi<0||0===this.hi&&this.lo<0},trunc:function(){return this.isNaN()?T.NaN:this.isPositive()?this.floor():this.ceil()},signum:function(){return this.hi>0?1:this.hi<0?-1:this.lo>0?1:this.lo<0?-1:0},interfaces_:function(){return[s,r,o]},getClass:function(){return T}}),T.sqr=function(t){return T.valueOf(t).selfMultiply(t)},T.valueOf=function(){if("string"==typeof arguments[0]){var t=arguments[0];return T.parse(t)}if("number"==typeof arguments[0])return new T(arguments[0])},T.sqrt=function(t){return T.valueOf(t).sqrt()},T.parse=function(t){for(var e=0,n=t.length;O.isWhitespace(t.charAt(e));)e++;var i=!1;if(e<n){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(i=!0))}for(var o=new T,a=0,s=0,u=0;!(e>=n);){var l=t.charAt(e);if(e++,O.isDigit(l)){var c=l-"0";o.selfMultiply(T.TEN),o.selfAdd(c),a++}else{if("."!==l){if("e"===l||"E"===l){var h=t.substring(e);try{u=I.parseInt(h)}catch(e){throw e instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+h+" in string "+t):e}finally{}break}throw new NumberFormatException("Unexpected character '"+l+"' at position "+e+" in string "+t)}s=a}}var f=o,d=a-s-u;if(0===d)f=o;else if(d>0){var p=T.TEN.pow(d);f=o.divide(p)}else if(d<0){var p=T.TEN.pow(-d);f=o.multiply(p)}return i?f.negate():f},T.createNaN=function(){return new T(i.NaN,i.NaN)},T.copy=function(t){return new T(t)},T.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=e&&(i+=1),i},T.stringOfChar=function(t,e){for(var n=new C,i=0;i<e;i++)n.append(t);return n.toString()},T.PI=new T(3.141592653589793,1.2246467991473532e-16),T.TWO_PI=new T(6.283185307179586,2.4492935982947064e-16),T.PI_2=new T(1.5707963267948966,6.123233995736766e-17),T.E=new T(2.718281828459045,1.4456468917292502e-16),
T.NaN=new T(i.NaN,i.NaN),T.EPS=1.23259516440783e-32,T.SPLIT=134217729,T.MAX_PRINT_DIGITS=32,T.TEN=T.valueOf(10),T.ONE=T.valueOf(1),T.SCI_NOT_EXPONENT_CHAR="E",T.SCI_NOT_ZERO="0.0E0",Tr(P.prototype,{interfaces_:function(){return[]},getClass:function(){return P}}),P.orientationIndex=function(t,e,n){var i=P.orientationIndexFilter(t,e,n);if(i<=1)return i;var r=T.valueOf(e.x).selfAdd(-t.x),o=T.valueOf(e.y).selfAdd(-t.y),a=T.valueOf(n.x).selfAdd(-e.x),s=T.valueOf(n.y).selfAdd(-e.y);return r.selfMultiply(s).selfSubtract(o.selfMultiply(a)).signum()},P.signOfDet2x2=function(t,e,n,i){return t.multiply(i).selfSubtract(e.multiply(n)).signum()},P.intersection=function(t,e,n,i){var r=T.valueOf(i.y).selfSubtract(n.y).selfMultiply(T.valueOf(e.x).selfSubtract(t.x)),o=T.valueOf(i.x).selfSubtract(n.x).selfMultiply(T.valueOf(e.y).selfSubtract(t.y)),a=r.subtract(o),s=T.valueOf(i.x).selfSubtract(n.x).selfMultiply(T.valueOf(t.y).selfSubtract(n.y)),u=T.valueOf(i.y).selfSubtract(n.y).selfMultiply(T.valueOf(t.x).selfSubtract(n.x)),l=s.subtract(u),c=l.selfDivide(a).doubleValue(),f=T.valueOf(t.x).selfAdd(T.valueOf(e.x).selfSubtract(t.x).selfMultiply(c)).doubleValue(),d=T.valueOf(e.x).selfSubtract(t.x).selfMultiply(T.valueOf(t.y).selfSubtract(n.y)),p=T.valueOf(e.y).selfSubtract(t.y).selfMultiply(T.valueOf(t.x).selfSubtract(n.x)),g=d.subtract(p),v=g.selfDivide(a).doubleValue();return new h(f,T.valueOf(n.y).selfAdd(T.valueOf(i.y).selfSubtract(n.y).selfMultiply(v)).doubleValue())},P.orientationIndexFilter=function(t,e,n){var i=null,r=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),a=r-o;if(r>0){if(o<=0)return P.signum(a);i=r+o}else{if(!(r<0))return P.signum(a);if(o>=0)return P.signum(a);i=-r-o}var s=P.DP_SAFE_EPSILON*i;return a>=s||-a>=s?P.signum(a):2},P.signum=function(t){return t>0?1:t<0?-1:0},P.DP_SAFE_EPSILON=1e-15,Tr(A.prototype,{setOrdinate:function(t,e,n){},size:function(){},getOrdinate:function(t,e){},getCoordinate:function(){1===arguments.length?arguments[0]:2===arguments.length&&(arguments[0],arguments[1])},getCoordinateCopy:function(t){},getDimension:function(){},getX:function(t){},clone:function(){},expandEnvelope:function(t){},copy:function(){},getY:function(t){},toCoordinateArray:function(){},interfaces_:function(){return[o]},getClass:function(){return A}}),A.X=0,A.Y=1,A.Z=2,A.M=3,L.arraycopy=function(t,e,n,i,r){for(var o=0,a=e;a<e+r;a++)n[i+o]=t[a],o++},L.getProperty=function(t){return{"line.separator":"\n"}[t]},Tr(N.prototype,{getY:function(){var t=this.y/this.w;if(i.isNaN(t)||i.isInfinite(t))throw new E;return t},getX:function(){var t=this.x/this.w;if(i.isNaN(t)||i.isInfinite(t))throw new E;return t},getCoordinate:function(){var t=new h;return t.x=this.getX(),t.y=this.getY(),t},interfaces_:function(){return[]},getClass:function(){return N}}),N.intersection=function(t,e,n,r){var o=t.y-e.y,a=e.x-t.x,s=t.x*e.y-e.x*t.y,u=n.y-r.y,l=r.x-n.x,c=n.x*r.y-r.x*n.y,f=a*c-l*s,d=u*s-o*c,p=o*l-u*a,g=f/p,v=d/p;if(i.isNaN(g)||i.isInfinite(g)||i.isNaN(v)||i.isInfinite(v))throw new E;return new h(g,v)},Tr(k.prototype,{create:function(){1===arguments.length?arguments[0]instanceof Array?arguments[0]:Lr(arguments[0],A)&&arguments[0]:2===arguments.length&&(arguments[0],arguments[1])},interfaces_:function(){return[]},getClass:function(){return k}}),Tr(R.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return R}}),Tr(D.prototype,{isGeometryCollection:function(){return this.getSortIndex()===D.SORTINDEX_GEOMETRYCOLLECTION},getFactory:function(){return this.factory},getGeometryN:function(t){return this},getArea:function(){return 0},isRectangle:function(){return!1},equals:function(){if(1===arguments.length){if(arguments[0]instanceof D){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof D))return!1;var n=e;return this.equalsExact(n)}}},equalsExact:function(t){return this===t||this.equalsExact(t,0)},geometryChanged:function(){this.apply(D.geometryChangedFilter)},geometryChangedAction:function(){this.envelope=null},equalsNorm:function(t){return null!==t&&this.norm().equalsExact(t.norm())},getLength:function(){return 0},getNumGeometries:function(){return 1},compareTo:function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=n;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(n,i)}},getUserData:function(){return this.userData},getSRID:function(){return this.SRID},getEnvelope:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},checkNotGeometryCollection:function(t){if(t.getSortIndex()===D.SORTINDEX_GEOMETRYCOLLECTION)throw new n("This method does not support GeometryCollection arguments")},equal:function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},norm:function(){var t=this.copy();return t.normalize(),t},getPrecisionModel:function(){return this.factory.getPrecisionModel()},getEnvelopeInternal:function(){return null===this.envelope&&(this.envelope=this.computeEnvelopeInternal()),new x(this.envelope)},setSRID:function(t){this.SRID=t},setUserData:function(t){this.userData=t},compare:function(t,e){for(var n=t.iterator(),i=e.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),o=i.next(),a=r.compareTo(o);if(0!==a)return a}return n.hasNext()?1:i.hasNext()?-1:0},hashCode:function(){return this.getEnvelopeInternal().hashCode()},isGeometryCollectionOrDerived:function(){return this.getSortIndex()===D.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===D.SORTINDEX_MULTIPOINT||this.getSortIndex()===D.SORTINDEX_MULTILINESTRING||this.getSortIndex()===D.SORTINDEX_MULTIPOLYGON},interfaces_:function(){return[o,r,s]},getClass:function(){return D}}),D.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},D.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},D.serialVersionUID=0x799ea46522854c00,D.SORTINDEX_POINT=0,D.SORTINDEX_MULTIPOINT=1,D.SORTINDEX_LINESTRING=2,D.SORTINDEX_LINEARRING=3,D.SORTINDEX_MULTILINESTRING=4,D.SORTINDEX_POLYGON=5,D.SORTINDEX_MULTIPOLYGON=6,D.SORTINDEX_GEOMETRYCOLLECTION=7,D.geometryChangedFilter={interfaces_:function(){return[R]},filter:function(t){t.geometryChangedAction()}},Tr(F.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return F}}),Tr(B.prototype,{isInBoundary:function(t){},interfaces_:function(){return[]},getClass:function(){return B}}),Tr(j.prototype,{isInBoundary:function(t){return t%2==1},interfaces_:function(){return[B]},getClass:function(){return j}}),Tr(U.prototype,{isInBoundary:function(t){return t>0},interfaces_:function(){return[B]},getClass:function(){return U}}),Tr(z.prototype,{isInBoundary:function(t){return t>1},interfaces_:function(){return[B]},getClass:function(){return z}}),Tr(G.prototype,{isInBoundary:function(t){return 1===t},interfaces_:function(){return[B]},getClass:function(){return G}}),B.Mod2BoundaryNodeRule=j,B.EndPointBoundaryNodeRule=U,B.MultiValentEndPointBoundaryNodeRule=z,B.MonoValentEndPointBoundaryNodeRule=G,B.MOD2_BOUNDARY_RULE=new j,B.ENDPOINT_BOUNDARY_RULE=new U,B.MULTIVALENT_ENDPOINT_BOUNDARY_RULE=new z,B.MONOVALENT_ENDPOINT_BOUNDARY_RULE=new G,B.OGC_SFS_BOUNDARY_RULE=B.MOD2_BOUNDARY_RULE,Tr(V.prototype,{interfaces_:function(){return[]},getClass:function(){return V}}),V.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},V.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(V.indexOf(i,e)<0)return i}return null},V.scroll=function(t,e){var n=V.indexOf(e,t);if(n<0)return null;var i=new Array(t.length).fill(null);L.arraycopy(t,n,i,0,t.length-n),L.arraycopy(t,0,i,t.length-n,n),L.arraycopy(i,0,t,0,t.length)},V.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var n=0;n<i.length;n++)if(0!==o.compare(i[n],r[n]))return!1;return!0}},V.intersection=function(t,e){for(var n=new b,i=0;i<t.length;i++)e.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()},V.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},V.removeRepeatedPoints=function(t){return V.hasRepeatedPoints(t)?new b(t,!1).toCoordinateArray():t},V.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),i=0;i<=n;i++){var r=t[i];t[i]=t[e-i],t[e-i]=r}},V.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var i=new Array(e).fill(null);if(0===e)return i;for(var r=0,n=0;n<t.length;n++)null!==t[n]&&(i[r++]=t[n]);return i},V.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new h(t[n]);return e}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],o=arguments[2],a=arguments[3],s=arguments[4],n=0;n<s;n++)o[a+n]=new h(i[r+n])},V.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=e[t.length-n-1];if(0!==i.compareTo(r))return!1}return!0},V.envelope=function(t){for(var e=new x,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},V.toCoordinateArray=function(t){return t.toArray(V.coordArrayType)},V.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},V.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},V.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,i=t[e].compareTo(t[n]);if(0!==i)return i}return 1},V.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var i=t[n].compareTo(e[n]);if(0!==i)return i;n++}return n<e.length?-1:n<t.length?1:0},V.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},V.extract=function(t,e,n){e=M.clamp(e,0,t.length),n=M.clamp(n,-1,t.length);var i=n-e+1;n<0&&(i=0),e>=t.length&&(i=0),n<e&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var o=0,a=e;a<=n;a++)r[o++]=t[a];return r},Tr(X.prototype,{compare:function(t,e){var n=t,i=e;return V.compare(n,i)},interfaces_:function(){return[a]},getClass:function(){return X}}),Tr(H.prototype,{compare:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=V.compare(n,i);return V.isEqualReversed(n,i)?0:r},OLDcompare:function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=V.increasingDirection(n),o=V.increasingDirection(i),a=r>0?0:n.length-1,s=o>0?0:n.length-1,u=0;u<n.length;u++){var l=n[a].compareTo(i[s]);if(0!==l)return l;a+=r,s+=o}return 0},interfaces_:function(){return[a]},getClass:function(){return H}}),V.ForwardComparator=X,V.BidirectionalComparator=H,V.coordArrayType=new Array(0).fill(null),q.prototype.get=function(){},q.prototype.put=function(){},q.prototype.size=function(){},q.prototype.values=function(){},q.prototype.entrySet=function(){},Y.prototype=new q,W.prototype=new p,W.prototype.contains=function(){},Z.prototype=new W,Z.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(this.array_[e]===t)return!0;return!1},Z.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},Z.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},Z.prototype.remove=function(t){throw new javascript.util.OperationNotSupported},Z.prototype.size=function(){return this.array_.length},Z.prototype.isEmpty=function(){return 0===this.array_.length},Z.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},Z.prototype.iterator=function(){return new Nr(this)};var Nr=function(t){this.hashSet_=t,this.position_=0};Nr.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new m;return this.hashSet_.array_[this.position_++]},Nr.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},Nr.prototype.remove=function(){throw new y};var kr=0;et.prototype=new Y,et.prototype.get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},et.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:kr,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do if(n=r,(i=t.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var o=r.value;return r.value=e,o}r=r.right}while(null!==r);var a={key:t,left:null,right:null,value:e,parent:n,color:kr,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=a:n.right=a,this.fixAfterInsertion(a),this.size_++,null},et.prototype.fixAfterInsertion=function(t){for(t.color=1;null!=t&&t!=this.root_&&1==t.parent.color;)if(K(t)==$(K(K(t)))){var e=tt(K(K(t)));1==J(e)?(Q(K(t),kr),Q(e,kr),Q(K(K(t)),1),t=K(K(t))):(t==tt(K(t))&&(t=K(t),this.rotateLeft(t)),Q(K(t),kr),Q(K(K(t)),1),this.rotateRight(K(K(t))))}else{var e=$(K(K(t)));1==J(e)?(Q(K(t),kr),Q(e,kr),Q(K(K(t)),1),t=K(K(t))):(t==$(K(t))&&(t=K(t),this.rotateRight(t)),Q(K(t),kr),Q(K(K(t)),1),this.rotateLeft(K(K(t))))}this.root_.color=kr},et.prototype.values=function(){var t=new _,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=et.successor(e));)t.add(e.value);return t},et.prototype.entrySet=function(){var t=new Z,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=et.successor(e));)t.add(e);return t},et.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.left==t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},et.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null==t.parent?this.root_=e:t.parent.right==t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},et.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},et.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var e=t.parent,n=t;null!==e&&n===e.right;)n=e,e=e.parent;return e},et.prototype.size=function(){return this.size_},Tr(nt.prototype,{interfaces_:function(){return[]},getClass:function(){return nt}}),it.prototype=new W,rt.prototype=new it,rt.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},rt.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},rt.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},rt.prototype.remove=function(t){throw new y},rt.prototype.size=function(){return this.array_.length},rt.prototype.isEmpty=function(){return 0===this.array_.length},rt.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},rt.prototype.iterator=function(){return new Rr(this)};var Rr=function(t){this.treeSet_=t,this.position_=0};Rr.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new m;return this.treeSet_.array_[this.position_++]},Rr.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Rr.prototype.remove=function(){throw new y},ot.sort=function(){var t,e,n,i,r=arguments[0];if(1===arguments.length)return i=function(t,e){return t.compareTo(e)},void r.sort(i);if(2===arguments.length)n=arguments[1],i=function(t,e){return n.compare(t,e)},r.sort(i);else{if(3===arguments.length){e=r.slice(arguments[1],arguments[2]),e.sort();var o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t]);return}if(4===arguments.length){for(e=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(t,e){return n.compare(t,e)},e.sort(i),o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t]);return}}},ot.asList=function(t){for(var e=new _,n=0,i=t.length;n<i;n++)e.add(t[n]);return e},Tr(at.prototype,{interfaces_:function(){return[]},getClass:function(){return at}}),at.toDimensionSymbol=function(t){switch(t){case at.FALSE:return at.SYM_FALSE;case at.TRUE:return at.SYM_TRUE;case at.DONTCARE:return at.SYM_DONTCARE;case at.P:return at.SYM_P;case at.L:return at.SYM_L;case at.A:return at.SYM_A}throw new n("Unknown dimension value: "+t)},at.toDimensionValue=function(t){switch(O.toUpperCase(t)){case at.SYM_FALSE:return at.FALSE;case at.SYM_TRUE:return at.TRUE;case at.SYM_DONTCARE:return at.DONTCARE;case at.SYM_P:return at.P;case at.SYM_L:return at.L;case at.SYM_A:return at.A}throw new n("Unknown dimension symbol: "+t)},at.P=0,at.L=1,at.A=2,at.FALSE=-1,at.TRUE=-2,at.DONTCARE=-3,at.SYM_FALSE="F",at.SYM_TRUE="T",at.SYM_DONTCARE="*",at.SYM_P="0",at.SYM_L="1",at.SYM_A="2",Tr(st.prototype,{filter:function(t){},interfaces_:function(){return[]},getClass:function(){return st}}),Tr(ut.prototype,{filter:function(t,e){},isDone:function(){},isGeometryChanged:function(){},interfaces_:function(){return[]},getClass:function(){return ut}}),Pr(lt,D),Tr(lt.prototype,{computeEnvelopeInternal:function(){for(var t=new x,e=0;e<this.geometries.length;e++)t.expandToInclude(this.geometries[e].getEnvelopeInternal());return t},getGeometryN:function(t){return this.geometries[t]},getSortIndex:function(){return D.SORTINDEX_GEOMETRYCOLLECTION},getCoordinates:function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this.geometries.length;n++)for(var i=this.geometries[n].getCoordinates(),r=0;r<i.length;r++)e++,t[e]=i[r];return t},getArea:function(){for(var t=0,e=0;e<this.geometries.length;e++)t+=this.geometries[e].getArea();return t},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this.geometries.length!==n.geometries.length)return!1;for(var i=0;i<this.geometries.length;i++)if(!this.geometries[i].equalsExact(n.geometries[i],e))return!1;return!0}return D.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var t=0;t<this.geometries.length;t++)this.geometries[t].normalize();ot.sort(this.geometries)},getCoordinate:function(){return this.isEmpty()?null:this.geometries[0].getCoordinate()},getBoundaryDimension:function(){for(var t=at.FALSE,e=0;e<this.geometries.length;e++)t=Math.max(t,this.geometries[e].getBoundaryDimension());return t},getDimension:function(){for(var t=at.FALSE,e=0;e<this.geometries.length;e++)t=Math.max(t,this.geometries[e].getDimension());return t},getLength:function(){for(var t=0,e=0;e<this.geometries.length;e++)t+=this.geometries[e].getLength();return t},getNumPoints:function(){for(var t=0,e=0;e<this.geometries.length;e++)t+=this.geometries[e].getNumPoints();return t},getNumGeometries:function(){return this.geometries.length},reverse:function(){for(var t=this.geometries.length,e=new Array(t).fill(null),n=0;n<this.geometries.length;n++)e[n]=this.geometries[n].reverse();return this.getFactory().createGeometryCollection(e)},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=new rt(ot.asList(this.geometries)),n=new rt(ot.asList(t.geometries));return this.compare(e,n)}if(2===arguments.length){for(var i=arguments[0],r=arguments[1],o=i,a=this.getNumGeometries(),s=o.getNumGeometries(),u=0;u<a&&u<s;){var l=this.getGeometryN(u),c=o.getGeometryN(u),h=l.compareToSameClass(c,r);if(0!==h)return h;u++}return u<a?1:u<s?-1:0}},apply:function(){if(Lr(arguments[0],F))for(var t=arguments[0],e=0;e<this.geometries.length;e++)this.geometries[e].apply(t);else if(Lr(arguments[0],ut)){var n=arguments[0];if(0===this.geometries.length)return null;for(var e=0;e<this.geometries.length&&(this.geometries[e].apply(n),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(Lr(arguments[0],st)){var i=arguments[0];i.filter(this);for(var e=0;e<this.geometries.length;e++)this.geometries[e].apply(i)}else if(Lr(arguments[0],R)){var r=arguments[0];r.filter(this);for(var e=0;e<this.geometries.length;e++)this.geometries[e].apply(r)}},getBoundary:function(){return this.checkNotGeometryCollection(this),c.shouldNeverReachHere(),null},clone:function(){var t=D.prototype.clone.call(this);t.geometries=new Array(this.geometries.length).fill(null);for(var e=0;e<this.geometries.length;e++)t.geometries[e]=this.geometries[e].clone();return t},getGeometryType:function(){return"GeometryCollection"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new lt(t,this.factory)},isEmpty:function(){for(var t=0;t<this.geometries.length;t++)if(!this.geometries[t].isEmpty())return!1;return!0},interfaces_:function(){return[]},getClass:function(){return lt}}),lt.serialVersionUID=-0x4f07bcb1f857d800,Pr(ct,lt),Tr(ct.prototype,{getSortIndex:function(){return D.SORTINDEX_MULTILINESTRING},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&lt.prototype.equalsExact.call(this,t,e)}return lt.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return this.isClosed()?at.FALSE:0},isClosed:function(){if(this.isEmpty())return!1;for(var t=0;t<this.geometries.length;t++)if(!this.geometries[t].isClosed())return!1;return!0},getDimension:function(){return 1},reverse:function(){for(var t=this.geometries.length,e=new Array(t).fill(null),n=0;n<this.geometries.length;n++)e[t-1-n]=this.geometries[n].reverse();return this.getFactory().createMultiLineString(e)},getBoundary:function(){return new ht(this).getBoundary()},getGeometryType:function(){return"MultiLineString"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new ct(t,this.factory)},interfaces_:function(){return[nt]},getClass:function(){return ct}}),ct.serialVersionUID=0x7155d2ab4afa8000,Tr(ht.prototype,{boundaryMultiLineString:function(t){if(this.geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this.geomFact.createPoint(e[0]):this.geomFact.createMultiPointFromCoords(e)},getBoundary:function(){return this.geom instanceof xt?this.boundaryLineString(this.geom):this.geom instanceof ct?this.boundaryMultiLineString(this.geom):this.geom.getBoundary()},boundaryLineString:function(t){return this.geom.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this.bnRule.isInBoundary(2)?t.getStartPoint():this.geomFact.createMultiPoint():this.geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},getEmptyMultiPoint:function(){return this.geomFact.createMultiPoint()},computeBoundaryCoordinates:function(t){var e=new _;this.endpointMap=new et;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);0!==i.getNumPoints()&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var r=this.endpointMap.entrySet().iterator();r.hasNext();){var o=r.next(),a=o.getValue(),s=a.count;this.bnRule.isInBoundary(s)&&e.add(o.getKey())}return V.toCoordinateArray(e)},addEndpoint:function(t){var e=this.endpointMap.get(t);null===e&&(e=new ft,this.endpointMap.put(t,e)),e.count++},interfaces_:function(){return[]},getClass:function(){return ht}}),ht.getBoundary=function(){if(1===arguments.length){var t=arguments[0],e=new ht(t);return e.getBoundary()}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=new ht(n,i);return e.getBoundary()}},Tr(ft.prototype,{interfaces_:function(){return[]},getClass:function(){return ft}}),Tr(_t.prototype,{interfaces_:function(){return[]},getClass:function(){return _t}}),_t.chars=function(t,e){for(var n=new Array(e).fill(null),i=0;i<e;i++)n[i]=t;return new String(n)},_t.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new vt,n=new dt(e);return t.printStackTrace(n),e.toString()}if(2===arguments.length){for(var i=arguments[0],r=arguments[1],o="",a=new pt(_t.getStackTrace(i)),s=new yt(a),u=0;u<r;u++)try{o+=s.readLine()+_t.NEWLINE}catch(t){if(!(t instanceof mt))throw t;c.shouldNeverReachHere()}finally{}return o}},_t.split=function(t,e){for(var n=e.length,i=new _,r=""+t,o=r.indexOf(e);o>=0;){var a=r.substring(0,o);i.add(a),r=r.substring(o+n),o=r.indexOf(e)}r.length>0&&i.add(r);for(var s=new Array(i.size()).fill(null),u=0;u<s.length;u++)s[u]=i.get(u);return s},_t.toString=function(){if(1===arguments.length){var t=arguments[0];return _t.SIMPLE_ORDINATE_FORMAT.format(t)}},_t.spaces=function(t){return _t.chars(" ",t)},_t.NEWLINE=L.getProperty("line.separator"),_t.SIMPLE_ORDINATE_FORMAT=new gt("0.#"),Tr(bt.prototype,{interfaces_:function(){return[]},getClass:function(){return bt}}),bt.copyCoord=function(t,e,n,i){for(var r=Math.min(t.getDimension(),n.getDimension()),o=0;o<r;o++)n.setOrdinate(i,o,t.getOrdinate(e,o))},bt.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,A.X)===t.getOrdinate(e-1,A.X)&&t.getOrdinate(0,A.Y)===t.getOrdinate(e-1,A.Y)},bt.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var r=Math.min(t.getDimension(),e.getDimension()),o=0;o<n;o++)for(var a=0;a<r;a++){var s=t.getOrdinate(o,a),u=e.getOrdinate(o,a);if(!(t.getOrdinate(o,a)===e.getOrdinate(o,a)||i.isNaN(s)&&i.isNaN(u)))return!1}return!0},bt.extend=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();if(bt.copy(e,0,i,0,r),r>0)for(var o=r;o<n;o++)bt.copy(e,r-1,i,o,1);return i},bt.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),i=0;i<=n;i++)bt.swap(t,i,e-i)},bt.swap=function(t,e,n){if(e===n)return null;for(var i=0;i<t.getDimension();i++){var r=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,r)}},bt.copy=function(t,e,n,i,r){for(var o=0;o<r;o++)bt.copyCoord(t,e+o,n,i+o)},bt.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),i=new C;i.append("(");for(var r=0;r<e;r++){r>0&&i.append(" ");for(var o=0;o<n;o++)o>0&&i.append(","),i.append(_t.toString(t.getOrdinate(r,o)))}return i.append(")"),i.toString()}},bt.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?bt.createClosedRing(t,e,4):e.getOrdinate(0,A.X)===e.getOrdinate(n-1,A.X)&&e.getOrdinate(0,A.Y)===e.getOrdinate(n-1,A.Y)?e:bt.createClosedRing(t,e,n+1)},bt.createClosedRing=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();bt.copy(e,0,i,0,r);for(var o=r;o<n;o++)bt.copy(e,0,i,o,1);return i},Pr(xt,D),Tr(xt.prototype,{computeEnvelopeInternal:function(){return this.isEmpty()?new x:this.points.expandEnvelope(new x)},isRing:function(){return this.isClosed()&&this.isSimple()},getSortIndex:function(){return D.SORTINDEX_LINESTRING},getCoordinates:function(){return this.points.toCoordinateArray()},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t;if(this.points.size()!==n.points.size())return!1;for(var i=0;i<this.points.size();i++)if(!this.equal(this.points.getCoordinate(i),n.points.getCoordinate(i),e))return!1;return!0}return D.prototype.equalsExact.apply(this,arguments)},normalize:function(){for(var t=0;t<Math.trunc(this.points.size()/2);t++){var e=this.points.size()-1-t;if(!this.points.getCoordinate(t).equals(this.points.getCoordinate(e)))return this.points.getCoordinate(t).compareTo(this.points.getCoordinate(e))>0&&bt.reverse(this.points),null}},getCoordinate:function(){return this.isEmpty()?null:this.points.getCoordinate(0)},getBoundaryDimension:function(){return this.isClosed()?at.FALSE:0},isClosed:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},getEndPoint:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},getDimension:function(){return 1},getLength:function(){return ae.computeLength(this.points)},getNumPoints:function(){return this.points.size()},reverse:function(){var t=this.points.copy();return bt.reverse(t),this.getFactory().createLineString(t)},compareToSameClass:function(){if(1===arguments.length){for(var t=arguments[0],e=t,n=0,i=0;n<this.points.size()&&i<e.points.size();){var r=this.points.getCoordinate(n).compareTo(e.points.getCoordinate(i));if(0!==r)return r;n++,i++}return n<this.points.size()?1:i<e.points.size()?-1:0}if(2===arguments.length){var o=arguments[0],a=arguments[1],e=o;return a.compare(this.points,e.points)}},apply:function(){if(Lr(arguments[0],F))for(var t=arguments[0],e=0;e<this.points.size();e++)t.filter(this.points.getCoordinate(e));else if(Lr(arguments[0],ut)){var n=arguments[0];if(0===this.points.size())return null;for(var e=0;e<this.points.size()&&(n.filter(this.points,e),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(Lr(arguments[0],st)){var i=arguments[0];i.filter(this)}else if(Lr(arguments[0],R)){var r=arguments[0];r.filter(this)}},getBoundary:function(){return new ht(this).getBoundary()},isEquivalentClass:function(t){return t instanceof xt},clone:function(){var t=D.prototype.clone.call(this);return t.points=this.points.clone(),t},getCoordinateN:function(t){return this.points.getCoordinate(t)},getGeometryType:function(){return"LineString"},copy:function(){return new xt(this.points.copy(),this.factory)},getCoordinateSequence:function(){return this.points},isEmpty:function(){return 0===this.points.size()},init:function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new n("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this.points=t},isCoordinate:function(t){for(var e=0;e<this.points.size();e++)if(this.points.getCoordinate(e).equals(t))return!0;return!1},getStartPoint:function(){return this.isEmpty()?null:this.getPointN(0)},getPointN:function(t){return this.getFactory().createPoint(this.points.getCoordinate(t))},interfaces_:function(){return[nt]},getClass:function(){return xt}}),xt.serialVersionUID=0x2b2b51ba435c8e00,Tr(wt.prototype,{interfaces_:function(){return[]},getClass:function(){return wt}}),Pr(Et,D),Tr(Et.prototype,{computeEnvelopeInternal:function(){if(this.isEmpty())return new x;var t=new x;return t.expandToInclude(this.coordinates.getX(0),this.coordinates.getY(0)),t},getSortIndex:function(){return D.SORTINDEX_POINT},getCoordinates:function(){return this.isEmpty()?[]:[this.getCoordinate()]},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),e))}return D.prototype.equalsExact.apply(this,arguments)},normalize:function(){},getCoordinate:function(){return 0!==this.coordinates.size()?this.coordinates.getCoordinate(0):null},getBoundaryDimension:function(){return at.FALSE},getDimension:function(){return 0},getNumPoints:function(){return this.isEmpty()?0:1},reverse:function(){return this.copy()},getX:function(){if(null===this.getCoordinate())throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getCoordinate().compareTo(e.getCoordinate())}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=n;return i.compare(this.coordinates,e.coordinates)}},apply:function(){if(Lr(arguments[0],F)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate());
}else if(Lr(arguments[0],ut)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.coordinates,0),e.isGeometryChanged()&&this.geometryChanged()}else if(Lr(arguments[0],st)){var n=arguments[0];n.filter(this)}else if(Lr(arguments[0],R)){var i=arguments[0];i.filter(this)}},getBoundary:function(){return this.getFactory().createGeometryCollection(null)},clone:function(){var t=D.prototype.clone.call(this);return t.coordinates=this.coordinates.clone(),t},getGeometryType:function(){return"Point"},copy:function(){return new Et(this.coordinates.copy(),this.factory)},getCoordinateSequence:function(){return this.coordinates},getY:function(){if(null===this.getCoordinate())throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y},isEmpty:function(){return 0===this.coordinates.size()},init:function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),c.isTrue(t.size()<=1),this.coordinates=t},isSimple:function(){return!0},interfaces_:function(){return[wt]},getClass:function(){return Et}}),Et.serialVersionUID=0x44077bad161cbc00,Tr(St.prototype,{interfaces_:function(){return[]},getClass:function(){return St}}),Pr(Mt,D),Tr(Mt.prototype,{computeEnvelopeInternal:function(){return this.shell.getEnvelopeInternal()},getSortIndex:function(){return D.SORTINDEX_POLYGON},getCoordinates:function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this.shell.getCoordinates(),i=0;i<n.length;i++)e++,t[e]=n[i];for(var r=0;r<this.holes.length;r++)for(var o=this.holes[r].getCoordinates(),a=0;a<o.length;a++)e++,t[e]=o[a];return t},getArea:function(){var t=0;t+=Math.abs(ae.signedArea(this.shell.getCoordinateSequence()));for(var e=0;e<this.holes.length;e++)t-=Math.abs(ae.signedArea(this.holes[e].getCoordinateSequence()));return t},isRectangle:function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.shell)return!1;if(5!==this.shell.getNumPoints())return!1;for(var t=this.shell.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var i=t.getX(n);if(i!==e.getMinX()&&i!==e.getMaxX())return!1;var r=t.getY(n);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var o=t.getX(0),a=t.getY(0),n=1;n<=4;n++){var i=t.getX(n),r=t.getY(n);if(i!==o==(r!==a))return!1;o=i,a=r}return!0},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(!this.isEquivalentClass(t))return!1;var n=t,i=this.shell,r=n.shell;if(!i.equalsExact(r,e))return!1;if(this.holes.length!==n.holes.length)return!1;for(var o=0;o<this.holes.length;o++)if(!this.holes[o].equalsExact(n.holes[o],e))return!1;return!0}return D.prototype.equalsExact.apply(this,arguments)},normalize:function(){if(0===arguments.length){this.normalize(this.shell,!0);for(var t=0;t<this.holes.length;t++)this.normalize(this.holes[t],!1);ot.sort(this.holes)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var i=new Array(e.getCoordinates().length-1).fill(null);L.arraycopy(e.getCoordinates(),0,i,0,i.length);var r=V.minCoordinate(e.getCoordinates());V.scroll(i,r),L.arraycopy(i,0,e.getCoordinates(),0,i.length),e.getCoordinates()[i.length]=i[0],ae.isCCW(e.getCoordinates())===n&&V.reverse(e.getCoordinates())}},getCoordinate:function(){return this.shell.getCoordinate()},getNumInteriorRing:function(){return this.holes.length},getBoundaryDimension:function(){return 1},getDimension:function(){return 2},getLength:function(){var t=0;t+=this.shell.getLength();for(var e=0;e<this.holes.length;e++)t+=this.holes[e].getLength();return t},getNumPoints:function(){for(var t=this.shell.getNumPoints(),e=0;e<this.holes.length;e++)t+=this.holes[e].getNumPoints();return t},reverse:function(){var t=this.copy();t.shell=this.shell.copy().reverse(),t.holes=new Array(this.holes.length).fill(null);for(var e=0;e<this.holes.length;e++)t.holes[e]=this.holes[e].copy().reverse();return t},convexHull:function(){return this.getExteriorRing().convexHull()},compareToSameClass:function(){if(1===arguments.length){var t=arguments[0],e=this.shell,n=t.shell;return e.compareToSameClass(n)}if(2===arguments.length){var i=arguments[0],r=arguments[1],o=i,e=this.shell,n=o.shell,a=e.compareToSameClass(n,r);if(0!==a)return a;for(var s=this.getNumInteriorRing(),u=o.getNumInteriorRing(),l=0;l<s&&l<u;){var c=this.getInteriorRingN(l),h=o.getInteriorRingN(l),f=c.compareToSameClass(h,r);if(0!==f)return f;l++}return l<s?1:l<u?-1:0}},apply:function(){if(Lr(arguments[0],F)){var t=arguments[0];this.shell.apply(t);for(var e=0;e<this.holes.length;e++)this.holes[e].apply(t)}else if(Lr(arguments[0],ut)){var n=arguments[0];if(this.shell.apply(n),!n.isDone())for(var e=0;e<this.holes.length&&(this.holes[e].apply(n),!n.isDone());e++);n.isGeometryChanged()&&this.geometryChanged()}else if(Lr(arguments[0],st)){var i=arguments[0];i.filter(this)}else if(Lr(arguments[0],R)){var r=arguments[0];r.filter(this),this.shell.apply(r);for(var e=0;e<this.holes.length;e++)this.holes[e].apply(r)}},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this.holes.length+1).fill(null);t[0]=this.shell;for(var e=0;e<this.holes.length;e++)t[e+1]=this.holes[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},clone:function(){var t=D.prototype.clone.call(this);t.shell=this.shell.clone(),t.holes=new Array(this.holes.length).fill(null);for(var e=0;e<this.holes.length;e++)t.holes[e]=this.holes[e].clone();return t},getGeometryType:function(){return"Polygon"},copy:function(){for(var t=this.shell.copy(),e=new Array(this.holes.length).fill(null),n=0;n<e.length;n++)e[n]=this.holes[n].copy();return new Mt(t,e,this.factory)},getExteriorRing:function(){return this.shell},isEmpty:function(){return this.shell.isEmpty()},getInteriorRingN:function(t){return this.holes[t]},interfaces_:function(){return[St]},getClass:function(){return Mt}}),Mt.serialVersionUID=-0x307ffefd8dc97200,Pr(Ct,lt),Tr(Ct.prototype,{getSortIndex:function(){return D.SORTINDEX_MULTIPOINT},isValid:function(){return!0},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&lt.prototype.equalsExact.call(this,t,e)}return lt.prototype.equalsExact.apply(this,arguments)},getCoordinate:function(){if(1===arguments.length){var t=arguments[0];return this.geometries[t].getCoordinate()}return lt.prototype.getCoordinate.apply(this,arguments)},getBoundaryDimension:function(){return at.FALSE},getDimension:function(){return 0},getBoundary:function(){return this.getFactory().createGeometryCollection(null)},getGeometryType:function(){return"MultiPoint"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new Ct(t,this.factory)},interfaces_:function(){return[wt]},getClass:function(){return Ct}}),Ct.serialVersionUID=-0x6fb1ed4162e0fc00,Pr(It,xt),Tr(It.prototype,{getSortIndex:function(){return D.SORTINDEX_LINEARRING},getBoundaryDimension:function(){return at.FALSE},isClosed:function(){return!!this.isEmpty()||xt.prototype.isClosed.call(this)},reverse:function(){var t=this.points.copy();return bt.reverse(t),this.getFactory().createLinearRing(t)},validateConstruction:function(){if(!this.isEmpty()&&!xt.prototype.isClosed.call(this))throw new n("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<It.MINIMUM_VALID_SIZE)throw new n("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},getGeometryType:function(){return"LinearRing"},copy:function(){return new It(this.points.copy(),this.factory)},interfaces_:function(){return[]},getClass:function(){return It}}),It.MINIMUM_VALID_SIZE=4,It.serialVersionUID=-0x3b229e262367a600,Pr(Ot,lt),Tr(Ot.prototype,{getSortIndex:function(){return D.SORTINDEX_MULTIPOLYGON},equalsExact:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return!!this.isEquivalentClass(t)&&lt.prototype.equalsExact.call(this,t,e)}return lt.prototype.equalsExact.apply(this,arguments)},getBoundaryDimension:function(){return 1},getDimension:function(){return 2},reverse:function(){for(var t=this.geometries.length,e=new Array(t).fill(null),n=0;n<this.geometries.length;n++)e[n]=this.geometries[n].reverse();return this.getFactory().createMultiPolygon(e)},getBoundary:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new _,e=0;e<this.geometries.length;e++)for(var n=this.geometries[e],i=n.getBoundary(),r=0;r<i.getNumGeometries();r++)t.add(i.getGeometryN(r));var o=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(o))},getGeometryType:function(){return"MultiPolygon"},copy:function(){for(var t=new Array(this.geometries.length).fill(null),e=0;e<t.length;e++)t[e]=this.geometries[e].copy();return new Ot(t,this.factory)},interfaces_:function(){return[St]},getClass:function(){return Ot}}),Ot.serialVersionUID=-0x7a5aa1369171980,Tr(Tt.prototype,{setCopyUserData:function(t){this.isUserDataCopied=t},edit:function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this.isUserDataCopied&&n.setUserData(t.getUserData()),n},editInternal:function(t,e){return null===this.factory&&(this.factory=t.getFactory()),t instanceof lt?this.editGeometryCollection(t,e):t instanceof Mt?this.editPolygon(t,e):t instanceof Et?e.edit(t,this.factory):t instanceof xt?e.edit(t,this.factory):(c.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},editGeometryCollection:function(t,e){for(var n=e.edit(t,this.factory),i=new _,r=0;r<n.getNumGeometries();r++){var o=this.edit(n.getGeometryN(r),e);null===o||o.isEmpty()||i.add(o)}return n.getClass()===Ct?this.factory.createMultiPoint(i.toArray([])):n.getClass()===ct?this.factory.createMultiLineString(i.toArray([])):n.getClass()===Ot?this.factory.createMultiPolygon(i.toArray([])):this.factory.createGeometryCollection(i.toArray([]))},editPolygon:function(t,e){var n=e.edit(t,this.factory);if(null===n&&(n=this.factory.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),e);if(null===i||i.isEmpty())return this.factory.createPolygon();for(var r=new _,o=0;o<n.getNumInteriorRing();o++){var a=this.edit(n.getInteriorRingN(o),e);null===a||a.isEmpty()||r.add(a)}return this.factory.createPolygon(i,r.toArray([]))},interfaces_:function(){return[]},getClass:function(){return Tt}}),Tt.GeometryEditorOperation=Pt,Tr(At.prototype,{edit:function(t,e){return t},interfaces_:function(){return[Pt]},getClass:function(){return At}}),Tr(Lt.prototype,{edit:function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof It?e.createLinearRing(n):t instanceof xt?e.createLineString(n):t instanceof Et?n.length>0?e.createPoint(n[0]):e.createPoint():t},interfaces_:function(){return[Pt]},getClass:function(){return Lt}}),Tr(Nt.prototype,{edit:function(t,e){return t instanceof It?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof xt?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Et?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},interfaces_:function(){return[Pt]},getClass:function(){return Nt}}),Tt.NoOpGeometryOperation=At,Tt.CoordinateOperation=Lt,Tt.CoordinateSequenceOperation=Nt,Tr(kt.prototype,{setOrdinate:function(t,e,i){switch(e){case A.X:this.coordinates[t].x=i;break;case A.Y:this.coordinates[t].y=i;break;case A.Z:this.coordinates[t].z=i;break;default:throw new n("invalid ordinateIndex")}},size:function(){return this.coordinates.length},getOrdinate:function(t,e){switch(e){case A.X:return this.coordinates[t].x;case A.Y:return this.coordinates[t].y;case A.Z:return this.coordinates[t].z}return i.NaN},getCoordinate:function(){if(1===arguments.length){var t=arguments[0];return this.coordinates[t]}if(2===arguments.length){var e=arguments[0],n=arguments[1];n.x=this.coordinates[e].x,n.y=this.coordinates[e].y,n.z=this.coordinates[e].z}},getCoordinateCopy:function(t){return new h(this.coordinates[t])},getDimension:function(){return this.dimension},getX:function(t){return this.coordinates[t].x},clone:function(){for(var t=new Array(this.size()).fill(null),e=0;e<this.coordinates.length;e++)t[e]=this.coordinates[e].clone();return new kt(t,this.dimension)},expandEnvelope:function(t){for(var e=0;e<this.coordinates.length;e++)t.expandToInclude(this.coordinates[e]);return t},copy:function(){for(var t=new Array(this.size()).fill(null),e=0;e<this.coordinates.length;e++)t[e]=this.coordinates[e].copy();return new kt(t,this.dimension)},toString:function(){if(this.coordinates.length>0){var t=new C(17*this.coordinates.length);t.append("("),t.append(this.coordinates[0]);for(var e=1;e<this.coordinates.length;e++)t.append(", "),t.append(this.coordinates[e]);return t.append(")"),t.toString()}return"()"},getY:function(t){return this.coordinates[t].y},toCoordinateArray:function(){return this.coordinates},interfaces_:function(){return[A,s]},getClass:function(){return kt}}),kt.serialVersionUID=-0xcb44a778db18e00,Tr(Rt.prototype,{readResolve:function(){return Rt.instance()},create:function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new kt(arguments[0]);if(Lr(arguments[0],A))return new kt(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new kt(t):new kt(t,e)}},interfaces_:function(){return[k,s]},getClass:function(){return Rt}}),Rt.instance=function(){return Rt.instanceObject},Rt.serialVersionUID=-0x38e49fa6cf6f2e00,Rt.instanceObject=new Rt;var Dr,Fr=Object.defineProperty,Br=function(t,e){function n(t){return this&&this.constructor===n?(this._keys=[],this._values=[],this._itp=[],this.objectOnly=e,t&&Ft.call(this,t),void 0):new n(t)}return e||Fr(t,"size",{get:Wt}),t.constructor=n,n.prototype=t,n}({delete:Bt,has:zt,get:jt,set:Gt,keys:Xt,values:Ht,entries:qt,forEach:Zt,clear:Vt}),jr="undefined"!=typeof Map&&Map.prototype.values?Map:Br;Jt.prototype=new q,Jt.prototype.get=function(t){return this.map_.get(t)||null},Jt.prototype.put=function(t,e){return this.map_.set(t,e),e},Jt.prototype.values=function(){for(var t=new _,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},Jt.prototype.entrySet=function(){var t=new Z;return this.map_.entries().forEach(function(e){return t.add(e)}),t},Jt.prototype.size=function(){return this.map_.size()},Tr(Kt.prototype,{equals:function(t){if(!(t instanceof Kt))return!1;var e=t;return this.modelType===e.modelType&&this.scale===e.scale},compareTo:function(t){var e=t,n=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return new I(n).compareTo(new I(i))},getScale:function(){return this.scale},isFloating:function(){return this.modelType===Kt.FLOATING||this.modelType===Kt.FLOATING_SINGLE},getType:function(){return this.modelType},toString:function(){var t="UNKNOWN";return this.modelType===Kt.FLOATING?t="Floating":this.modelType===Kt.FLOATING_SINGLE?t="Floating-Single":this.modelType===Kt.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},makePrecise:function(){if("number"==typeof arguments[0]){var t=arguments[0];return i.isNaN(t)?t:this.modelType===Kt.FLOATING_SINGLE?t:this.modelType===Kt.FIXED?Math.round(t*this.scale)/this.scale:t}if(arguments[0]instanceof h){var e=arguments[0];if(this.modelType===Kt.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},getMaximumSignificantDigits:function(){var t=16;return this.modelType===Kt.FLOATING?t=16:this.modelType===Kt.FLOATING_SINGLE?t=6:this.modelType===Kt.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},setScale:function(t){this.scale=Math.abs(t)},interfaces_:function(){return[s,r]},getClass:function(){return Kt}}),Kt.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},Tr(Qt.prototype,{readResolve:function(){return Qt.nameToTypeMap.get(this.name)},toString:function(){return this.name},interfaces_:function(){return[s]},getClass:function(){return Qt}}),Qt.serialVersionUID=-552860263173159e4,Qt.nameToTypeMap=new Jt,Kt.Type=Qt,Kt.serialVersionUID=0x6bee6404e9a25c00,Kt.FIXED=new Qt("FIXED"),Kt.FLOATING=new Qt("FLOATING"),Kt.FLOATING_SINGLE=new Qt("FLOATING SINGLE"),Kt.maximumPreciseValue=9007199254740992,Tr($t.prototype,{toGeometry:function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new h(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new h(t.getMinX(),t.getMinY()),new h(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new h(t.getMinX(),t.getMinY()),new h(t.getMinX(),t.getMaxY()),new h(t.getMaxX(),t.getMaxY()),new h(t.getMaxX(),t.getMinY()),new h(t.getMinX(),t.getMinY())]),null)},createLineString:function(){if(0===arguments.length)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLineString(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Lr(arguments[0],A))return new xt(arguments[0],this)}},createMultiLineString:function(){return 0===arguments.length?new ct(null,this):1===arguments.length?new ct(arguments[0],this):void 0},buildGeometry:function(t){for(var e=null,n=!1,i=!1,r=t.iterator();r.hasNext();){var o=r.next(),a=o.getClass();null===e&&(e=a),a!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(i=!0)}if(null===e)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection($t.toGeometryArray(t));var s=t.iterator().next();if(t.size()>1){if(s instanceof Mt)return this.createMultiPolygon($t.toPolygonArray(t));if(s instanceof xt)return this.createMultiLineString($t.toLineStringArray(t));if(s instanceof Et)return this.createMultiPoint($t.toPointArray(t));c.shouldNeverReachHere("Unhandled class: "+s.getClass().getName())}return s},createMultiPointFromCoords:function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},createPoint:function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof h){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(Lr(arguments[0],A))return new Et(arguments[0],this)}},getCoordinateSequenceFactory:function(){return this.coordinateSequenceFactory},createPolygon:function(){if(0===arguments.length)return new Mt(null,null,this);if(1===arguments.length){if(Lr(arguments[0],A)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}if(arguments[0]instanceof It){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return new Mt(i,r,this)}},getSRID:function(){return this.SRID},createGeometryCollection:function(){return 0===arguments.length?new lt(null,this):1===arguments.length?new lt(arguments[0],this):void 0},createGeometry:function(t){return new Tt(this).edit(t,{edit:function(){if(2===arguments.length){var t=arguments[0];return arguments[1],this.coordinateSequenceFactory.create(t)}}})},getPrecisionModel:function(){return this.precisionModel},createLinearRing:function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Lr(arguments[0],A))return new It(arguments[0],this)}},createMultiPolygon:function(){return 0===arguments.length?new Ot(null,this):1===arguments.length?new Ot(arguments[0],this):void 0},createMultiPoint:function(){if(0===arguments.length)return new Ct(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Ct(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(Lr(arguments[0],A)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var n=new Array(e.size()).fill(null),i=0;i<e.size();i++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension());bt.copy(e,i,r,0,1),n[i]=this.createPoint(r)}return this.createMultiPoint(n)}}},interfaces_:function(){return[s]},getClass:function(){return $t}}),$t.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.getDefaultCoordinateSequenceFactory=function(){return Rt.instance()},$t.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},$t.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},$t.serialVersionUID=-0x5ea75f2051eeb400;var Ur={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/};Tr(te.prototype,{read:function(t){var e,n,i;t=t.replace(/[\n\r]/g," ");var r=Ur.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(r=Ur.emptyTypeStr.exec(t),r[2]=void 0),r&&(n=r[1].toLowerCase(),i=r[2],Gr[n]&&(e=Gr[n].apply(this,[i]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},write:function(t){return this.extractGeometry(t)},extractGeometry:function(t){var e=t.getGeometryType().toLowerCase();if(!zr[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+zr[e].apply(this,[t])+")"}});var zr={coordinate:function(t){return t.x+" "+t.y},point:function(t){return zr.coordinate.call(this,t.coordinates.coordinates[0])},multipoint:function(t){for(var e=[],n=0,i=t.geometries.length;n<i;++n)e.push("("+zr.point.apply(this,[t.geometries[n]])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,i=t.points.coordinates.length;n<i;++n)e.push(zr.coordinate.apply(this,[t.points.coordinates[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,i=t.points.coordinates.length;n<i;++n)e.push(zr.coordinate.apply(this,[t.points.coordinates[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,i=t.geometries.length;n<i;++n)e.push("("+zr.linestring.apply(this,[t.geometries[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+zr.linestring.apply(this,[t.shell])+")");for(var n=0,i=t.holes.length;n<i;++n)e.push("("+zr.linestring.apply(this,[t.holes[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,i=t.geometries.length;n<i;++n)e.push("("+zr.polygon.apply(this,[t.geometries[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,i=t.geometries.length;n<i;++n)e.push(this.extractGeometry(t.geometries[n]));return e.join(",")}},Gr={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(Ur.spaces);return this.geometryFactory.createPoint(new h(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){if(void 0===t)return this.geometryFactory.createMultiPoint();for(var e,n=t.trim().split(","),i=[],r=0,o=n.length;r<o;++r)e=n[r].replace(Ur.trimParens,"$1"),i.push(Gr.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),i=[],r=0,o=n.length;r<o;++r)e=n[r].trim().split(Ur.spaces),i.push(new h(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(i)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),i=[],r=0,o=n.length;r<o;++r)e=n[r].trim().split(Ur.spaces),i.push(new h(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(t){if(void 0===t)return this.geometryFactory.createMultiLineString();for(var e,n=t.trim().split(Ur.parenComma),i=[],r=0,o=n.length;r<o;++r)e=n[r].replace(Ur.trimParens,"$1"),i.push(Gr.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){if(void 0===t)return this.geometryFactory.createPolygon();for(var e,n,i,r,o=t.trim().split(Ur.parenComma),a=[],s=0,u=o.length;s<u;++s)e=o[s].replace(Ur.trimParens,"$1"),n=Gr.linestring.apply(this,[e]),i=this.geometryFactory.createLinearRing(n.points),0===s?r=i:a.push(i);return this.geometryFactory.createPolygon(r,a)},multipolygon:function(t){if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var e,n=t.trim().split(Ur.doubleParenComma),i=[],r=0,o=n.length;r<o;++r)e=n[r].replace(Ur.trimParens,"$1"),i.push(Gr.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var e=t.trim().split("|"),n=[],i=0,r=e.length;i<r;++i)n.push(this.read(e[i]));return this.geometryFactory.createGeometryCollection(n)}};Tr(ee.prototype,{write:function(t){return this.parser.write(t)}}),Tr(ee,{toLineString:function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"}}),Tr(ne.prototype,{getIndexAlongSegment:function(t,e){return this.computeIntLineIndex(),this.intLineIndex[t][e]},getTopologySummary:function(){var t=new C;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},computeIntersection:function(t,e,n,i){this.inputLines[0][0]=t,this.inputLines[0][1]=e,this.inputLines[1][0]=n,this.inputLines[1][1]=i,this.result=this.computeIntersect(t,e,n,i)},getIntersectionNum:function(){return this.result},computeIntLineIndex:function(){if(0===arguments.length)null===this.intLineIndex&&(this.intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this.intLineIndex[t][0]=0,this.intLineIndex[t][1]=1):(this.intLineIndex[t][0]=1,this.intLineIndex[t][1]=0)}},isProper:function(){return this.hasIntersection()&&this._isProper},setPrecisionModel:function(t){this.precisionModel=t},isInteriorIntersection:function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],e=0;e<this.result;e++)if(!this.intPt[e].equals2D(this.inputLines[t][0])&&!this.intPt[e].equals2D(this.inputLines[t][1]))return!0;return!1}},getIntersection:function(t){return this.intPt[t]},isEndPoint:function(){return this.hasIntersection()&&!this._isProper},hasIntersection:function(){return this.result!==ne.NO_INTERSECTION},getEdgeDistance:function(t,e){return ne.computeEdgeDistance(this.intPt[e],this.inputLines[t][0],this.inputLines[t][1])},isCollinear:function(){return this.result===ne.COLLINEAR_INTERSECTION},toString:function(){return ee.toLineString(this.inputLines[0][0],this.inputLines[0][1])+" - "+ee.toLineString(this.inputLines[1][0],this.inputLines[1][1])+this.getTopologySummary()},getEndpoint:function(t,e){return this.inputLines[t][e]},isIntersection:function(t){for(var e=0;e<this.result;e++)if(this.intPt[e].equals2D(t))return!0;return!1},getIntersectionAlongSegment:function(t,e){return this.computeIntLineIndex(),this.intPt[this.intLineIndex[t][e]]},interfaces_:function(){return[]},getClass:function(){return ne}}),ne.computeEdgeDistance=function(t,e,n){var i=Math.abs(n.x-e.x),r=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=i>r?i:r;else{var a=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y);o=i>r?a:s,0!==o||t.equals(e)||(o=Math.max(a,s))}return c.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},ne.nonRobustComputeEdgeDistance=function(t,e,n){var i=t.x-e.x,r=t.y-e.y,o=Math.sqrt(i*i+r*r);return c.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},ne.DONT_INTERSECT=0,ne.DO_INTERSECT=1,ne.COLLINEAR=2,ne.NO_INTERSECTION=0,ne.POINT_INTERSECTION=1,ne.COLLINEAR_INTERSECTION=2,Pr(ie,ne),Tr(ie.prototype,{isInSegmentEnvelopes:function(t){var e=new x(this.inputLines[0][0],this.inputLines[0][1]),n=new x(this.inputLines[1][0],this.inputLines[1][1]);return e.contains(t)&&n.contains(t)},computeIntersection:function(){if(3!==arguments.length)return ne.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],e=arguments[1],n=arguments[2];return this._isProper=!1,x.intersects(e,n,t)&&0===ae.orientationIndex(e,n,t)&&0===ae.orientationIndex(n,e,t)?(this._isProper=!0,(t.equals(e)||t.equals(n))&&(this._isProper=!1),this.result=ne.POINT_INTERSECTION,null):void(this.result=ne.NO_INTERSECTION)},normalizeToMinimum:function(t,e,n,i,r){r.x=this.smallestInAbsValue(t.x,e.x,n.x,i.x),r.y=this.smallestInAbsValue(t.y,e.y,n.y,i.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},safeHCoordinateIntersection:function(t,e,n,i){var r=null;try{r=N.intersection(t,e,n,i)}catch(o){if(!(o instanceof E))throw o;r=ie.nearestEndpoint(t,e,n,i)}finally{}return r},intersection:function(t,e,n,i){var r=this.intersectionWithNormalization(t,e,n,i);return this.isInSegmentEnvelopes(r)||(r=new h(ie.nearestEndpoint(t,e,n,i))),null!==this.precisionModel&&this.precisionModel.makePrecise(r),r},smallestInAbsValue:function(t,e,n,i){var r=t,o=Math.abs(r);return Math.abs(e)<o&&(r=e,o=Math.abs(e)),Math.abs(n)<o&&(r=n,o=Math.abs(n)),Math.abs(i)<o&&(r=i),r},checkDD:function(t,e,n,i,r){var o=P.intersection(t,e,n,i),a=this.isInSegmentEnvelopes(o);L.out.println("DD in env = "+a+"  --------------------- "+o),r.distance(o)>1e-4&&L.out.println("Distance = "+r.distance(o))},intersectionWithNormalization:function(t,e,n,i){var r=new h(t),o=new h(e),a=new h(n),s=new h(i),u=new h;this.normalizeToEnvCentre(r,o,a,s,u);var l=this.safeHCoordinateIntersection(r,o,a,s);return l.x+=u.x,l.y+=u.y,l},computeCollinearIntersection:function(t,e,n,i){var r=x.intersects(t,e,n),o=x.intersects(t,e,i),a=x.intersects(n,i,t),s=x.intersects(n,i,e);return r&&o?(this.intPt[0]=n,this.intPt[1]=i,ne.COLLINEAR_INTERSECTION):a&&s?(this.intPt[0]=t,this.intPt[1]=e,ne.COLLINEAR_INTERSECTION):r&&a?(this.intPt[0]=n,this.intPt[1]=t,!n.equals(t)||o||s?ne.COLLINEAR_INTERSECTION:ne.POINT_INTERSECTION):r&&s?(this.intPt[0]=n,this.intPt[1]=e,!n.equals(e)||o||a?ne.COLLINEAR_INTERSECTION:ne.POINT_INTERSECTION):o&&a?(this.intPt[0]=i,this.intPt[1]=t,!i.equals(t)||r||s?ne.COLLINEAR_INTERSECTION:ne.POINT_INTERSECTION):o&&s?(this.intPt[0]=i,this.intPt[1]=e,!i.equals(e)||r||a?ne.COLLINEAR_INTERSECTION:ne.POINT_INTERSECTION):ne.NO_INTERSECTION},normalizeToEnvCentre:function(t,e,n,i,r){var o=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,s=t.x>e.x?t.x:e.x,u=t.y>e.y?t.y:e.y,l=n.x<i.x?n.x:i.x,c=n.y<i.y?n.y:i.y,h=n.x>i.x?n.x:i.x,f=n.y>i.y?n.y:i.y,d=o>l?o:l,p=s<h?s:h,g=a>c?a:c,v=u<f?u:f,m=(d+p)/2,y=(g+v)/2;r.x=m,r.y=y,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},computeIntersect:function(t,e,n,i){if(this._isProper=!1,!x.intersects(t,e,n,i))return ne.NO_INTERSECTION;var r=ae.orientationIndex(t,e,n),o=ae.orientationIndex(t,e,i);if(r>0&&o>0||r<0&&o<0)return ne.NO_INTERSECTION;var a=ae.orientationIndex(n,i,t),s=ae.orientationIndex(n,i,e);
return a>0&&s>0||a<0&&s<0?ne.NO_INTERSECTION:0===r&&0===o&&0===a&&0===s?this.computeCollinearIntersection(t,e,n,i):(0===r||0===o||0===a||0===s?(this._isProper=!1,t.equals2D(n)||t.equals2D(i)?this.intPt[0]=t:e.equals2D(n)||e.equals2D(i)?this.intPt[0]=e:0===r?this.intPt[0]=new h(n):0===o?this.intPt[0]=new h(i):0===a?this.intPt[0]=new h(t):0===s&&(this.intPt[0]=new h(e))):(this._isProper=!0,this.intPt[0]=this.intersection(t,e,n,i)),ne.POINT_INTERSECTION)},interfaces_:function(){return[]},getClass:function(){return ie}}),ie.nearestEndpoint=function(t,e,n,i){var r=t,o=ae.distancePointLine(t,n,i),a=ae.distancePointLine(e,n,i);return a<o&&(o=a,r=e),a=ae.distancePointLine(n,t,e),a<o&&(o=a,r=n),a=ae.distancePointLine(i,t,e),a<o&&(o=a,r=i),r},Tr(re.prototype,{interfaces_:function(){return[]},getClass:function(){return re}}),re.orientationIndex=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,o=n.x-e.x,a=n.y-e.y;return re.signOfDet2x2(i,r,o,a)},re.signOfDet2x2=function(t,e,n,i){var r=null,o=null,a=null,s=0;if(r=1,0===t||0===i)return 0===e||0===n?0:e>0?n>0?-r:r:n>0?r:-r;if(0===e||0===n)return i>0?t>0?r:-r:t>0?-r:r;if(0<e?0<i?e<=i||(r=-r,o=t,t=n,n=o,o=e,e=i,i=o):e<=-i?(r=-r,n=-n,i=-i):(o=t,t=-n,n=o,o=e,e=-i,i=o):0<i?-e<=i?(r=-r,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=i,i=o):e>=i?(t=-t,e=-e,n=-n,i=-i):(r=-r,o=-t,t=-n,n=o,o=-e,e=-i,i=o),0<t){if(!(0<n))return r;if(!(t<=n))return r}else{if(0<n)return-r;if(!(t>=n))return-r;r=-r,t=-t,n=-n}for(;;){if(s+=1,a=Math.floor(n/t),n-=a*t,(i-=a*e)<0)return-r;if(i>e)return r;if(t>n+n){if(e<i+i)return r}else{if(e>i+i)return-r;n=t-n,i=e-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if(a=Math.floor(t/n),t-=a*n,(e-=a*i)<0)return r;if(e>i)return-r;if(n>t+t){if(i<e+e)return-r}else{if(i>e+e)return r;t=n-t,e=i-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}},Tr(oe.prototype,{countSegment:function(t,e){if(t.x<this.p.x&&e.x<this.p.x)return null;if(this.p.x===e.x&&this.p.y===e.y)return this.isPointOnSegment=!0,null;if(t.y===this.p.y&&e.y===this.p.y){var n=t.x,i=e.x;return n>i&&(n=e.x,i=t.x),this.p.x>=n&&this.p.x<=i&&(this.isPointOnSegment=!0),null}if(t.y>this.p.y&&e.y<=this.p.y||e.y>this.p.y&&t.y<=this.p.y){var r=t.x-this.p.x,o=t.y-this.p.y,a=e.x-this.p.x,s=e.y-this.p.y,u=re.signOfDet2x2(r,o,a,s);if(0===u)return this.isPointOnSegment=!0,null;s<o&&(u=-u),u>0&&this.crossingCount++}},isPointInPolygon:function(){return this.getLocation()!==S.EXTERIOR},getLocation:function(){return this.isPointOnSegment?S.BOUNDARY:this.crossingCount%2==1?S.INTERIOR:S.EXTERIOR},isOnSegment:function(){return this.isPointOnSegment},interfaces_:function(){return[]},getClass:function(){return oe}}),oe.locatePointInRing=function(){if(arguments[0]instanceof h&&Lr(arguments[1],A)){for(var t=arguments[0],e=arguments[1],n=new oe(t),i=new h,r=new h,o=1;o<e.size();o++)if(e.getCoordinate(o,i),e.getCoordinate(o-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof h&&arguments[1]instanceof Array){for(var a=arguments[0],s=arguments[1],n=new oe(a),o=1;o<s.length;o++){var i=s[o],r=s[o-1];if(n.countSegment(i,r),n.isOnSegment())return n.getLocation()}return n.getLocation()}},Tr(ae.prototype,{interfaces_:function(){return[]},getClass:function(){return ae}}),ae.orientationIndex=function(t,e,n){return P.orientationIndex(t,e,n)},ae.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,i=1;i<t.length-1;i++){var r=t[i].x-n,o=t[i+1].y;e+=r*(t[i-1].y-o)}return e/2}if(Lr(arguments[0],A)){var a=arguments[0],s=a.size();if(s<3)return 0;var u=new h,l=new h,c=new h;a.getCoordinate(0,l),a.getCoordinate(1,c);var n=l.x;c.x-=n;for(var e=0,i=1;i<s-1;i++)u.y=l.y,l.x=c.x,l.y=c.y,a.getCoordinate(i+1,c),c.x-=n,e+=l.x*(u.y-c.y);return e/2}},ae.distanceLineLine=function(t,e,n,i){if(t.equals(e))return ae.distancePointLine(t,n,i);if(n.equals(i))return ae.distancePointLine(i,t,e);var r=!1;if(x.intersects(t,e,n,i)){var o=(e.x-t.x)*(i.y-n.y)-(e.y-t.y)*(i.x-n.x);if(0===o)r=!0;else{var a=(t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y),s=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),u=s/o,l=a/o;(l<0||l>1||u<0||u>1)&&(r=!0)}}else r=!0;return r?M.min(ae.distancePointLine(t,n,i),ae.distancePointLine(e,n,i),ae.distancePointLine(n,t,e),ae.distancePointLine(i,t,e)):0},ae.isPointInRing=function(t,e){return ae.locatePointInRing(t,e)!==S.EXTERIOR},ae.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,i=new h;t.getCoordinate(0,i);for(var r=i.x,o=i.y,a=1;a<e;a++){t.getCoordinate(a,i);var s=i.x,u=i.y,l=s-r,c=u-o;n+=Math.sqrt(l*l+c*c),r=s,o=u}return n},ae.isCCW=function(t){var e=t.length-1;if(e<3)throw new n("Ring has fewer than 4 points, so orientation cannot be determined");for(var i=t[0],r=0,o=1;o<=e;o++){var a=t[o];a.y>i.y&&(i=a,r=o)}var s=r;do(s-=1)<0&&(s=e);while(t[s].equals2D(i)&&s!==r);var u=r;do u=(u+1)%e;while(t[u].equals2D(i)&&u!==r);var l=t[s],c=t[u];if(l.equals2D(i)||c.equals2D(i)||l.equals2D(c))return!1;var h=ae.computeOrientation(l,i,c);return 0===h?l.x>c.x:h>0},ae.locatePointInRing=function(t,e){return oe.locatePointInRing(t,e)},ae.distancePointLinePerpendicular=function(t,e,n){var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),r=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i;return Math.abs(r)*Math.sqrt(i)},ae.computeOrientation=function(t,e,n){return ae.orientationIndex(t,e,n)},ae.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new n("Line array must contain at least one vertex");for(var i=t.distance(e[0]),r=0;r<e.length-1;r++){var o=ae.distancePointLine(t,e[r],e[r+1]);o<i&&(i=o)}return i}if(3===arguments.length){var a=arguments[0],s=arguments[1],u=arguments[2];if(s.x===u.x&&s.y===u.y)return a.distance(s);var l=(u.x-s.x)*(u.x-s.x)+(u.y-s.y)*(u.y-s.y),c=((a.x-s.x)*(u.x-s.x)+(a.y-s.y)*(u.y-s.y))/l;if(c<=0)return a.distance(s);if(c>=1)return a.distance(u);var h=((s.y-a.y)*(u.x-s.x)-(s.x-a.x)*(u.y-s.y))/l;return Math.abs(h)*Math.sqrt(l)}},ae.isOnLine=function(t,e){for(var n=new ie,i=1;i<e.length;i++){var r=e[i-1],o=e[i];if(n.computeIntersection(t,r,o),n.hasIntersection())return!0}return!1},ae.CLOCKWISE=-1,ae.RIGHT=ae.CLOCKWISE,ae.COUNTERCLOCKWISE=1,ae.LEFT=ae.COUNTERCLOCKWISE,ae.COLLINEAR=0,ae.STRAIGHT=ae.COLLINEAR,Tr(se.prototype,{minX:function(){return Math.min(this.p0.x,this.p1.x)},orientationIndex:function(){if(arguments[0]instanceof se){var t=arguments[0],e=ae.orientationIndex(this.p0,this.p1,t.p0),n=ae.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0?Math.max(e,n):e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof h){var i=arguments[0];return ae.orientationIndex(this.p0,this.p1,i)}},toGeometry:function(t){return t.createLineString([this.p0,this.p1])},isVertical:function(){return this.p0.x===this.p1.x},equals:function(t){if(!(t instanceof se))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},intersection:function(t){var e=new ie;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},project:function(){if(arguments[0]instanceof h){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new h(t);var e=this.projectionFactor(t),n=new h;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof se){var i=arguments[0],r=this.projectionFactor(i.p0),o=this.projectionFactor(i.p1);if(r>=1&&o>=1)return null;if(r<=0&&o<=0)return null;var a=this.project(i.p0);r<0&&(a=this.p0),r>1&&(a=this.p1);var s=this.project(i.p1);return o<0&&(s=this.p0),o>1&&(s=this.p1),new se(a,s)}},normalize:function(){this.p1.compareTo(this.p0)<0&&this.reverse()},angle:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},getCoordinate:function(t){return 0===t?this.p0:this.p1},distancePerpendicular:function(t){return ae.distancePointLinePerpendicular(t,this.p0,this.p1)},minY:function(){return Math.min(this.p0.y,this.p1.y)},midPoint:function(){return se.midPoint(this.p0,this.p1)},projectionFactor:function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=e*e+n*n;return r<=0?i.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/r},closestPoints:function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),r=i.MAX_VALUE,o=null,a=this.closestPoint(t.p0);r=a.distance(t.p0),n[0]=a,n[1]=t.p0;var s=this.closestPoint(t.p1);(o=s.distance(t.p1))<r&&(r=o,n[0]=s,n[1]=t.p1);var u=t.closestPoint(this.p0);(o=u.distance(this.p0))<r&&(r=o,n[0]=this.p0,n[1]=u);var l=t.closestPoint(this.p1);return o=l.distance(this.p1),o<r&&(r=o,n[0]=this.p1,n[1]=l),n},closestPoint:function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},maxX:function(){return Math.max(this.p0.x,this.p1.x)},getLength:function(){return this.p0.distance(this.p1)},compareTo:function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},reverse:function(){var t=this.p0;this.p0=this.p1,this.p1=t},equalsTopo:function(t){return this.p0.equals(t.p0)&&this.p1.equals(t.p1)||this.p0.equals(t.p1)&&this.p1.equals(t.p0)},lineIntersection:function(t){try{return N.intersection(this.p0,this.p1,t.p0,t.p1)}catch(t){if(!(t instanceof E))throw t}finally{}return null},maxY:function(){return Math.max(this.p0.y,this.p1.y)},pointAlongOffset:function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,a=Math.sqrt(r*r+o*o),s=0,u=0;if(0!==e){if(a<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");s=e*r/a,u=e*o/a}return new h(n-u,i+s)},setCoordinates:function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},segmentFraction:function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||i.isNaN(e))&&(e=1),e},toString:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},isHorizontal:function(){return this.p0.y===this.p1.y},distance:function(){if(arguments[0]instanceof se){var t=arguments[0];return ae.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof h){var e=arguments[0];return ae.distancePointLine(e,this.p0,this.p1)}},pointAlong:function(t){var e=new h;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},hashCode:function(){var t=java.lang.Double.doubleToLongBits(this.p0.x);t^=31*java.lang.Double.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=java.lang.Double.doubleToLongBits(this.p1.x);return n^=31*java.lang.Double.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},interfaces_:function(){return[r,s]},getClass:function(){return se}}),se.midPoint=function(t,e){return new h((t.x+e.x)/2,(t.y+e.y)/2)},se.serialVersionUID=0x2d2172135f411c00;var Vr=Object.freeze({Coordinate:h,CoordinateList:b,Envelope:x,LineSegment:se,GeometryFactory:$t,Geometry:D,Point:Et,LineString:xt,LinearRing:It,Polygon:Mt,GeometryCollection:lt,MultiPoint:Ct,MultiLineString:ct,MultiPolygon:Ot});Tr(ue.prototype,{hasChildren:function(){for(var t=0;t<4;t++)if(null!==this.subnode[t])return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(t){t.addAll(this.items);for(var e=0;e<4;e++)null!==this.subnode[e]&&this.subnode[e].addAllItems(t);return t},getNodeCount:function(){for(var t=0,e=0;e<4;e++)null!==this.subnode[e]&&(t+=this.subnode[e].size());return t+1},size:function(){for(var t=0,e=0;e<4;e++)null!==this.subnode[e]&&(t+=this.subnode[e].size());return t+this.items.size()},addAllItemsFromOverlapping:function(t,e){if(!this.isSearchMatch(t))return null;e.addAll(this.items);for(var n=0;n<4;n++)null!==this.subnode[n]&&this.subnode[n].addAllItemsFromOverlapping(t,e)},visitItems:function(t,e){for(var n=this.items.iterator();n.hasNext();)e.visitItem(n.next())},hasItems:function(){return!this.items.isEmpty()},remove:function(t,e){if(!this.isSearchMatch(t))return!1;for(var n=!1,i=0;i<4;i++)if(null!==this.subnode[i]&&(n=this.subnode[i].remove(t,e))){this.subnode[i].isPrunable()&&(this.subnode[i]=null);break}return n||(n=this.items.remove(e))},visit:function(t,e){if(!this.isSearchMatch(t))return null;this.visitItems(t,e);for(var n=0;n<4;n++)null!==this.subnode[n]&&this.subnode[n].visit(t,e)},getItems:function(){return this.items},depth:function(){for(var t=0,e=0;e<4;e++)if(null!==this.subnode[e]){var n=this.subnode[e].depth();n>t&&(t=n)}return t+1},isEmpty:function(){var t=!0;this.items.isEmpty()||(t=!1);for(var e=0;e<4;e++)null!==this.subnode[e]&&(this.subnode[e].isEmpty()||(t=!1));return t},add:function(t){this.items.add(t)},interfaces_:function(){return[s]},getClass:function(){return ue}}),ue.getSubnodeIndex=function(t,e,n){var i=-1;return t.getMinX()>=e&&(t.getMinY()>=n&&(i=3),t.getMaxY()<=n&&(i=1)),t.getMaxX()<=e&&(t.getMinY()>=n&&(i=2),t.getMaxY()<=n&&(i=0)),i},le.exponent=function(t){return ce(64,t)-1023},le.powerOf2=function(t){return Math.pow(2,t)},Tr(he.prototype,{getLevel:function(){return this.level},computeKey:function(){if(1===arguments.length){var t=arguments[0];for(this.level=he.computeQuadLevel(t),this.env=new x,this.computeKey(this.level,t);!this.env.contains(t);)this.level+=1,this.computeKey(this.level,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=le.powerOf2(e);this.pt.x=Math.floor(n.getMinX()/i)*i,this.pt.y=Math.floor(n.getMinY()/i)*i,this.env.init(this.pt.x,this.pt.x+i,this.pt.y,this.pt.y+i)}},getEnvelope:function(){return this.env},getCentre:function(){return new h((this.env.getMinX()+this.env.getMaxX())/2,(this.env.getMinY()+this.env.getMaxY())/2)},getPoint:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return he}}),he.computeQuadLevel=function(t){var e=t.getWidth(),n=t.getHeight(),i=e>n?e:n;return le.exponent(i)+1},Pr(fe,ue),Tr(fe.prototype,{find:function(t){var e=ue.getSubnodeIndex(t,this.centrex,this.centrey);return e===-1?this:null!==this.subnode[e]?this.subnode[e].find(t):this},isSearchMatch:function(t){return this.env.intersects(t)},getSubnode:function(t){return null===this.subnode[t]&&(this.subnode[t]=this.createSubnode(t)),this.subnode[t]},getEnvelope:function(){return this.env},getNode:function(t){var e=ue.getSubnodeIndex(t,this.centrex,this.centrey);return e!==-1?this.getSubnode(e).getNode(t):this},createSubnode:function(t){var e=0,n=0,i=0,r=0;switch(t){case 0:e=this.env.getMinX(),n=this.centrex,i=this.env.getMinY(),r=this.centrey;break;case 1:e=this.centrex,n=this.env.getMaxX(),i=this.env.getMinY(),r=this.centrey;break;case 2:e=this.env.getMinX(),n=this.centrex,i=this.centrey,r=this.env.getMaxY();break;case 3:e=this.centrex,n=this.env.getMaxX(),i=this.centrey,r=this.env.getMaxY()}return new fe(new x(e,n,i,r),this.level-1)},insertNode:function(t){c.isTrue(null===this.env||this.env.contains(t.env));var e=ue.getSubnodeIndex(t.env,this.centrex,this.centrey);if(t.level===this.level-1)this.subnode[e]=t;else{var n=this.createSubnode(e);n.insertNode(t),this.subnode[e]=n}},interfaces_:function(){return[]},getClass:function(){return fe}}),fe.createNode=function(t){var e=new he(t);return new fe(e.getEnvelope(),e.getLevel())},fe.createExpanded=function(t,e){var n=new x(e);null!==t&&n.expandToInclude(t.env);var i=fe.createNode(n);return null!==t&&i.insertNode(t),i},Tr(de.prototype,{interfaces_:function(){return[]},getClass:function(){return de}}),de.isZeroWidth=function(t,e){var n=e-t;if(0===n)return!0;var i=Math.max(Math.abs(t),Math.abs(e)),r=n/i;return le.exponent(r)<=de.MIN_BINARY_EXPONENT},de.MIN_BINARY_EXPONENT=-50,Pr(pe,ue),Tr(pe.prototype,{insert:function(t,e){var n=ue.getSubnodeIndex(t,pe.origin.x,pe.origin.y);if(n===-1)return this.add(e),null;var i=this.subnode[n];if(null===i||!i.getEnvelope().contains(t)){var r=fe.createExpanded(i,t);this.subnode[n]=r}this.insertContained(this.subnode[n],t,e)},isSearchMatch:function(t){return!0},insertContained:function(t,e,n){c.isTrue(t.getEnvelope().contains(e));var i=de.isZeroWidth(e.getMinX(),e.getMaxX()),r=de.isZeroWidth(e.getMinY(),e.getMaxY()),o=null;o=i||r?t.find(e):t.getNode(e),o.add(n)},interfaces_:function(){return[]},getClass:function(){return pe}}),pe.origin=new h(0,0),Tr(ge.prototype,{insert:function(t,e){},remove:function(t,e){},query:function(){1===arguments.length?arguments[0]:2===arguments.length&&(arguments[0],arguments[1])},interfaces_:function(){return[]},getClass:function(){return ge}}),Tr(ve.prototype,{visitItem:function(t){},interfaces_:function(){return[]},getClass:function(){return ve}}),Tr(me.prototype,{visitItem:function(t){this.items.add(t)},getItems:function(){return this.items},interfaces_:function(){return[ve]},getClass:function(){return me}}),Tr(ye.prototype,{size:function(){return null!==this.root?this.root.size():0},insert:function(t,e){this.collectStats(t);var n=ye.ensureExtent(t,this.minExtent);this.root.insert(n,e)},query:function(){if(1===arguments.length){var t=arguments[0],e=new me;return this.query(t,e),e.getItems()}if(2===arguments.length){var n=arguments[0],i=arguments[1];this.root.visit(n,i)}},queryAll:function(){var t=new _;return this.root.addAllItems(t),t},remove:function(t,e){var n=ye.ensureExtent(t,this.minExtent);return this.root.remove(n,e)},collectStats:function(t){var e=t.getWidth();e<this.minExtent&&e>0&&(this.minExtent=e);var n=t.getHeight();n<this.minExtent&&n>0&&(this.minExtent=n)},depth:function(){return null!==this.root?this.root.depth():0},isEmpty:function(){return null===this.root},interfaces_:function(){return[ge,s]},getClass:function(){return ye}}),ye.ensureExtent=function(t,e){var n=t.getMinX(),i=t.getMaxX(),r=t.getMinY(),o=t.getMaxY();return n!==i&&r!==o?t:(n===i&&(n-=e/2,i=n+e/2),r===o&&(r-=e/2,o=r+e/2),new x(n,i,r,o))},ye.serialVersionUID=-0x678b60c967a25400;var Xr=Object.freeze({Quadtree:ye}),Hr=Object.freeze({quadtree:Xr}),qr=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"];Tr(_e.prototype,{read:function(t){var e=void 0;e="string"==typeof t?JSON.parse(t):t;var n=e.type;if(!Yr[n])throw new Error("Unknown GeoJSON type: "+e.type);return qr.indexOf(n)!==-1?Yr[n].apply(this,[e.coordinates]):"GeometryCollection"===n?Yr[n].apply(this,[e.geometries]):Yr[n].apply(this,[e])},write:function(t){var e=t.getGeometryType();if(!Wr[e])throw new Error("Geometry is not supported");return Wr[e].apply(this,[t])}});var Yr={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var i=t.geometry.type;if(!Yr[i])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=Yr.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(new h(i[0],i[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new h(t[0],t[1]),new h(t[2],t[1]),new h(t[2],t[3]),new h(t[0],t[3]),new h(t[0],t[1])])},Point:function(t){var e=new h(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Yr.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=Yr.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(Yr.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=Yr.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),i=[],r=1;r<t.length;++r){var o=t[r],a=Yr.coordinates.apply(this,[o]),s=this.geometryFactory.createLinearRing(a);i.push(s)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(Yr.Polygon.apply(this,[i]))}return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(this.read(i))}return this.geometryFactory.createGeometryCollection(e)}},Wr={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:Wr.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=Wr.Point.apply(this,[i]);e.push(r.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),i=0;i<n.length;++i){var r=n[i];e.push(Wr.coordinate.apply(this,[r]))}return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=Wr.LineString.apply(this,[i]);e.push(r.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=Wr.LineString.apply(this,[t.shell]);e.push(n.coordinates);for(var i=0;i<t.holes.length;++i){var r=t.holes[i],o=Wr.LineString.apply(this,[r]);e.push(o.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=Wr.Polygon.apply(this,[i]);e.push(r.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t.geometries.length;++n){var i=t.geometries[n],r=i.getGeometryType();e.push(Wr[r].apply(this,[i]))}return{type:"GeometryCollection",geometries:e}}};Tr(be.prototype,{read:function(t){var e=this.parser.read(t);return this.precisionModel.getType()===Kt.FIXED&&this.reducePrecision(e),e},reducePrecision:function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)this.reducePrecision(t.geometries[e])}}),Tr(xe.prototype,{write:function(t){return this.parser.write(t)}});var Zr=Object.freeze({GeoJSONReader:be,GeoJSONWriter:xe});Tr(we.prototype,{next:function(){if(this.atStart)return this.atStart=!1,we.isAtomic(this.parent)&&this.index++,this.parent;if(null!==this.subcollectionIterator){if(this.subcollectionIterator.hasNext())return this.subcollectionIterator.next();this.subcollectionIterator=null}if(this.index>=this.max)throw new m;var t=this.parent.getGeometryN(this.index++);return t instanceof lt?(this.subcollectionIterator=new we(t),this.subcollectionIterator.next()):t},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){if(this.atStart)return!0;if(null!==this.subcollectionIterator){if(this.subcollectionIterator.hasNext())return!0;this.subcollectionIterator=null}return!(this.index>=this.max)},interfaces_:function(){return[d]},getClass:function(){return we}}),we.isAtomic=function(t){return!(t instanceof lt)},Tr(Ee.prototype,{locateInternal:function(){if(arguments[0]instanceof h&&arguments[1]instanceof Mt){var t=arguments[0],e=arguments[1];if(e.isEmpty())return S.EXTERIOR;var n=e.getExteriorRing(),i=this.locateInPolygonRing(t,n);if(i===S.EXTERIOR)return S.EXTERIOR;if(i===S.BOUNDARY)return S.BOUNDARY;for(var r=0;r<e.getNumInteriorRing();r++){var o=e.getInteriorRingN(r),a=this.locateInPolygonRing(t,o);if(a===S.INTERIOR)return S.EXTERIOR;if(a===S.BOUNDARY)return S.BOUNDARY}return S.INTERIOR}if(arguments[0]instanceof h&&arguments[1]instanceof xt){var s=arguments[0],u=arguments[1];if(!u.getEnvelopeInternal().intersects(s))return S.EXTERIOR;var l=u.getCoordinates();return u.isClosed()||!s.equals(l[0])&&!s.equals(l[l.length-1])?ae.isOnLine(s,l)?S.INTERIOR:S.EXTERIOR:S.BOUNDARY}if(arguments[0]instanceof h&&arguments[1]instanceof Et){var c=arguments[0];return arguments[1].getCoordinate().equals2D(c)?S.INTERIOR:S.EXTERIOR}},locateInPolygonRing:function(t,e){return e.getEnvelopeInternal().intersects(t)?ae.locatePointInRing(t,e.getCoordinates()):S.EXTERIOR},intersects:function(t,e){return this.locate(t,e)!==S.EXTERIOR},updateLocationInfo:function(t){t===S.INTERIOR&&(this.isIn=!0),t===S.BOUNDARY&&this.numBoundaries++},computeLocation:function(t,e){if(e instanceof Et&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof xt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Mt)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof ct)for(var n=e,i=0;i<n.getNumGeometries();i++){var r=n.getGeometryN(i);this.updateLocationInfo(this.locateInternal(t,r))}else if(e instanceof Ot)for(var o=e,i=0;i<o.getNumGeometries();i++){var a=o.getGeometryN(i);this.updateLocationInfo(this.locateInternal(t,a))}else if(e instanceof lt)for(var s=new we(e);s.hasNext();){var u=s.next();u!==e&&this.computeLocation(t,u)}},locate:function(t,e){return e.isEmpty()?S.EXTERIOR:e instanceof xt?this.locateInternal(t,e):e instanceof Mt?this.locateInternal(t,e):(this.isIn=!1,this.numBoundaries=0,this.computeLocation(t,e),this.boundaryRule.isInBoundary(this.numBoundaries)?S.BOUNDARY:this.numBoundaries>0||this.isIn?S.INTERIOR:S.EXTERIOR)},interfaces_:function(){return[]},getClass:function(){return Ee}}),Tr(Se.prototype,{filter:function(t){t instanceof Mt&&this.comps.add(t)},interfaces_:function(){return[st]},getClass:function(){return Se}}),Se.getPolygons=function(){if(1===arguments.length){var t=arguments[0];return Se.getPolygons(t,new _)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Mt?n.add(e):e instanceof lt&&e.apply(new Se(n)),n}},Tr(Me.prototype,{isInsideArea:function(){return this.segIndex===Me.INSIDE_AREA},getCoordinate:function(){return this.pt},getGeometryComponent:function(){return this.component},getSegmentIndex:function(){return this.segIndex},interfaces_:function(){return[]},getClass:function(){return Me}}),Me.INSIDE_AREA=-1;var Jr={reverseOrder:function(){return{compare:function(t,e){return e.compareTo(t)}}},min:function(t){return Jr.sort(t),t.get(0)},sort:function(t,e){var n=t.toArray();e?ot.sort(n,e):ot.sort(n);for(var i=t.iterator(),r=0,o=n.length;r<o;r++)i.next(),i.set(n[r])},singletonList:function(t){var e=new _;return e.add(t),e}};Tr(Ce.prototype,{filter:function(t){t instanceof Et&&this.pts.add(t)},interfaces_:function(){return[st]},getClass:function(){return Ce}}),Ce.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Et?Jr.singletonList(t):Ce.getPoints(t,new _)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Et?n.add(e):e instanceof lt&&e.apply(new Ce(n)),n}},Tr(Ie.prototype,{filter:function(t){(t instanceof Et||t instanceof xt||t instanceof Mt)&&this.locations.add(new Me(t,0,t.getCoordinate()))},interfaces_:function(){return[st]},getClass:function(){return Ie}}),Ie.getLocations=function(t){var e=new _;return t.apply(new Ie(e)),e},Tr(Oe.prototype,{filter:function(t){if(this.isForcedToLineString&&t instanceof It){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this.lines.add(e),null}t instanceof xt&&this.lines.add(t)},setForceToLineString:function(t){this.isForcedToLineString=t},interfaces_:function(){return[R]},getClass:function(){return Oe}}),Oe.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(Oe.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(Oe.getLines(e,n))}},Oe.getLines=function(){if(1===arguments.length){var t=arguments[0];return Oe.getLines(t,!1)}if(2===arguments.length){if(Lr(arguments[0],p)&&Lr(arguments[1],p)){for(var e=arguments[0],n=arguments[1],i=e.iterator();i.hasNext();){var r=i.next();Oe.getLines(r,n)}return n}if(arguments[0]instanceof D&&"boolean"==typeof arguments[1]){var o=arguments[0],a=arguments[1],s=new _;return o.apply(new Oe(s,a)),s}if(arguments[0]instanceof D&&Lr(arguments[1],p)){var u=arguments[0],l=arguments[1];return u instanceof xt?l.add(u):u.apply(new Oe(l)),l}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Lr(arguments[0],p)&&Lr(arguments[1],p)){for(var c=arguments[0],h=arguments[1],f=arguments[2],i=c.iterator();i.hasNext();){var r=i.next();Oe.getLines(r,h,f)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof D&&Lr(arguments[1],p)){var d=arguments[0],g=arguments[1],v=arguments[2];return d.apply(new Oe(g,v)),g}}},Tr(Te.prototype,{computeContainmentDistance:function(){if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this.minDistance<=this.terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=1-e,r=Se.getPolygons(this.geom[e]);if(r.size()>0){var o=Ie.getLocations(this.geom[i]);if(this.computeContainmentDistance(o,r,n),this.minDistance<=this.terminateDistance)return this.minDistanceLocation[i]=n[0],this.minDistanceLocation[e]=n[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Lr(arguments[0],v)&&Lr(arguments[1],v)){for(var a=arguments[0],s=arguments[1],u=arguments[2],l=0;l<a.size();l++)for(var c=a.get(l),h=0;h<s.size();h++)if(this.computeContainmentDistance(c,s.get(h),u),this.minDistance<=this.terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Me&&arguments[1]instanceof Mt){var f=arguments[0],d=arguments[1],p=arguments[2],g=f.getCoordinate();if(S.EXTERIOR!==this.ptLocator.locate(g,d))return this.minDistance=0,p[0]=f,p[1]=new Me(d,g),null}},computeMinDistanceLinesPoints:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(r,a,n),this.minDistance<=this.terminateDistance)return null}},computeFacetDistance:function(){var t=new Array(2).fill(null),e=Oe.getLines(this.geom[0]),n=Oe.getLines(this.geom[1]),i=Ce.getPoints(this.geom[0]),r=Ce.getPoints(this.geom[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this.minDistance<=this.terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this.minDistance<=this.terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,i,t),this.updateMinDistance(t,!0),this.minDistance<=this.terminateDistance?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(i,r,t),void this.updateMinDistance(t,!1))))},nearestLocations:function(){return this.computeMinDistance(),this.minDistanceLocation},updateMinDistance:function(t,e){return null===t[0]?null:void(e?(this.minDistanceLocation[0]=t[1],this.minDistanceLocation[1]=t[0]):(this.minDistanceLocation[0]=t[0],this.minDistanceLocation[1]=t[1]))},nearestPoints:function(){return this.computeMinDistance(),[this.minDistanceLocation[0].getCoordinate(),this.minDistanceLocation[1].getCoordinate()]},computeMinDistance:function(){if(0===arguments.length){if(null!==this.minDistanceLocation)return null;if(this.minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this.minDistance<=this.terminateDistance)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof xt&&arguments[1]instanceof Et){var t=arguments[0],e=arguments[1],n=arguments[2];if(t.getEnvelopeInternal().distance(e.getEnvelopeInternal())>this.minDistance)return null;for(var i=t.getCoordinates(),r=e.getCoordinate(),o=0;o<i.length-1;o++){var a=ae.distancePointLine(r,i[o],i[o+1]);if(a<this.minDistance){this.minDistance=a;var s=new se(i[o],i[o+1]),u=s.closestPoint(r);n[0]=new Me(t,o,u),n[1]=new Me(e,0,r)}if(this.minDistance<=this.terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof xt&&arguments[1]instanceof xt){var l=arguments[0],c=arguments[1],h=arguments[2];if(l.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this.minDistance)return null;for(var i=l.getCoordinates(),f=c.getCoordinates(),o=0;o<i.length-1;o++)for(var d=0;d<f.length-1;d++){var a=ae.distanceLineLine(i[o],i[o+1],f[d],f[d+1]);
if(a<this.minDistance){this.minDistance=a;var p=new se(i[o],i[o+1]),g=new se(f[d],f[d+1]),v=p.closestPoints(g);h[0]=new Me(l,o,v[0]),h[1]=new Me(c,d,v[1])}if(this.minDistance<=this.terminateDistance)return null}}},computeMinDistancePoints:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),o=0;o<e.size();o++){var a=e.get(o),s=r.getCoordinate().distance(a.getCoordinate());if(s<this.minDistance&&(this.minDistance=s,n[0]=new Me(r,0,r.getCoordinate()),n[1]=new Me(a,0,a.getCoordinate())),this.minDistance<=this.terminateDistance)return null}},distance:function(){if(null===this.geom[0]||null===this.geom[1])throw new n("null geometries are not supported");return this.geom[0].isEmpty()||this.geom[1].isEmpty()?0:(this.computeMinDistance(),this.minDistance)},computeMinDistanceLines:function(t,e,n){for(var i=0;i<t.size();i++)for(var r=t.get(i),o=0;o<e.size();o++){var a=e.get(o);if(this.computeMinDistance(r,a,n),this.minDistance<=this.terminateDistance)return null}},interfaces_:function(){return[]},getClass:function(){return Te}}),Te.distance=function(t,e){return new Te(t,e).distance()},Te.isWithinDistance=function(t,e,n){return new Te(t,e,n).distance()<=n},Te.nearestPoints=function(t,e){return new Te(t,e).nearestPoints()};var Kr=Object.freeze({DistanceOp:Te}),Qr=Object.freeze({distance:Kr});Tr(Pe.prototype,{map:function(t){for(var e=new _,n=0;n<t.getNumGeometries();n++){var i=this.mapOp.map(t.getGeometryN(n));i.isEmpty()||e.add(i)}return t.getFactory().createGeometryCollection($t.toGeometryArray(e))},interfaces_:function(){return[]},getClass:function(){return Pe}}),Pe.map=function(t,e){return new Pe(e).map(t)},Tr(Ae.prototype,{interfaces_:function(){return[]},getClass:function(){return Ae}}),Ae.opposite=function(t){return t===Ae.LEFT?Ae.RIGHT:t===Ae.RIGHT?Ae.LEFT:t},Ae.ON=0,Ae.LEFT=1,Ae.RIGHT=2,Pr(Le,u),Tr(Le.prototype,{getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Le}}),Le.msgWithCoord=function(t,e){return null!==e?t+" [ "+e+" ]":t},Tr(Ne.prototype,{setAllLocations:function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},isNull:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==S.NONE)return!1;return!0},setAllLocationsIfNull:function(t){for(var e=0;e<this.location.length;e++)this.location[e]===S.NONE&&(this.location[e]=t)},isLine:function(){return 1===this.location.length},merge:function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[Ae.ON]=this.location[Ae.ON],e[Ae.LEFT]=S.NONE,e[Ae.RIGHT]=S.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===S.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},getLocations:function(){return this.location},flip:function(){if(this.location.length<=1)return null;var t=this.location[Ae.LEFT];this.location[Ae.LEFT]=this.location[Ae.RIGHT],this.location[Ae.RIGHT]=t},toString:function(){var t=new C;return this.location.length>1&&t.append(S.toLocationSymbol(this.location[Ae.LEFT])),t.append(S.toLocationSymbol(this.location[Ae.ON])),this.location.length>1&&t.append(S.toLocationSymbol(this.location[Ae.RIGHT])),t.toString()},setLocations:function(t,e,n){this.location[Ae.ON]=t,this.location[Ae.LEFT]=e,this.location[Ae.RIGHT]=n},get:function(t){return t<this.location.length?this.location[t]:S.NONE},isArea:function(){return this.location.length>1},isAnyNull:function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===S.NONE)return!0;return!1},setLocation:function(){if(1===arguments.length){var t=arguments[0];this.setLocation(Ae.ON,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.location[e]=n}},init:function(t){this.location=new Array(t).fill(null),this.setAllLocations(S.NONE)},isEqualOnSide:function(t,e){return this.location[e]===t.location[e]},allPositionsEqual:function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},interfaces_:function(){return[]},getClass:function(){return Ne}}),Tr(ke.prototype,{getGeometryCount:function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},setAllLocations:function(t,e){this.elt[t].setAllLocations(e)},isNull:function(t){return this.elt[t].isNull()},setAllLocationsIfNull:function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}},isLine:function(t){return this.elt[t].isLine()},merge:function(t){for(var e=0;e<2;e++)null===this.elt[e]&&null!==t.elt[e]?this.elt[e]=new Ne(t.elt[e]):this.elt[e].merge(t.elt[e])},flip:function(){this.elt[0].flip(),this.elt[1].flip()},getLocation:function(){if(1===arguments.length){var t=arguments[0];return this.elt[t].get(Ae.ON)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}},toString:function(){var t=new C;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},isArea:function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var t=arguments[0];return this.elt[t].isArea()}},isAnyNull:function(t){return this.elt[t].isAnyNull()},setLocation:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Ae.ON,e)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}},isEqualOnSide:function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},allPositionsEqual:function(t,e){return this.elt[t].allPositionsEqual(e)},toLine:function(t){this.elt[t].isArea()&&(this.elt[t]=new Ne(this.elt[t].location[0]))},interfaces_:function(){return[]},getClass:function(){return ke}}),ke.toLineLabel=function(t){for(var e=new ke(S.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e},Tr(Re.prototype,{computeRing:function(){if(null!==this.ring)return null;for(var t=new Array(this.pts.size()).fill(null),e=0;e<this.pts.size();e++)t[e]=this.pts.get(e);this.ring=this.geometryFactory.createLinearRing(t),this._isHole=ae.isCCW(this.ring.getCoordinates())},isIsolated:function(){return 1===this.label.getGeometryCount()},computePoints:function(t){this.startDe=t;var e=t,n=!0;do{if(null===e)throw new Le("Found null DirectedEdge");if(e.getEdgeRing()===this)throw new Le("Directed Edge visited twice during ring-building at "+e.getCoordinate());this.edges.add(e);var i=e.getLabel();c.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(e.getEdge(),e.isForward(),n),n=!1,this.setEdgeRing(e,this),e=this.getNext(e)}while(e!==this.startDe)},getLinearRing:function(){return this.ring},getCoordinate:function(t){return this.pts.get(t)},computeMaxNodeDegree:function(){this.maxNodeDegree=0;var t=this.startDe;do{var e=t.getNode(),n=e.getEdges().getOutgoingDegree(this);n>this.maxNodeDegree&&(this.maxNodeDegree=n),t=this.getNext(t)}while(t!==this.startDe);this.maxNodeDegree*=2},addPoints:function(t,e,n){var i=t.getCoordinates();if(e){var r=1;n&&(r=0);for(var o=r;o<i.length;o++)this.pts.add(i[o])}else{var r=i.length-2;n&&(r=i.length-1);for(var o=r;o>=0;o--)this.pts.add(i[o])}},isHole:function(){return this._isHole},setInResult:function(){var t=this.startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this.startDe)},containsPoint:function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!ae.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this.holes.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0},addHole:function(t){this.holes.add(t)},isShell:function(){return null===this.shell},getLabel:function(){return this.label},getEdges:function(){return this.edges},getMaxNodeDegree:function(){return this.maxNodeDegree<0&&this.computeMaxNodeDegree(),this.maxNodeDegree},getShell:function(){return this.shell},mergeLabel:function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=e.getLocation(n,Ae.RIGHT);if(i===S.NONE)return null;if(this.label.getLocation(n)===S.NONE)return this.label.setLocation(n,i),null}},setShell:function(t){this.shell=t,null!==t&&t.addHole(this)},toPolygon:function(t){for(var e=new Array(this.holes.size()).fill(null),n=0;n<this.holes.size();n++)e[n]=this.holes.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},interfaces_:function(){return[]},getClass:function(){return Re}}),Pr(De,Re),Tr(De.prototype,{setEdgeRing:function(t,e){t.setMinEdgeRing(e)},getNext:function(t){return t.getNextMin()},interfaces_:function(){return[]},getClass:function(){return De}}),Pr(Fe,Re),Tr(Fe.prototype,{buildMinimalRings:function(){var t=new _,e=this.startDe;do{if(null===e.getMinEdgeRing()){var n=new De(e,this.geometryFactory);t.add(n)}e=e.getNext()}while(e!==this.startDe);return t},setEdgeRing:function(t,e){t.setEdgeRing(e)},linkDirectedEdgesForMinimalEdgeRings:function(){var t=this.startDe;do t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext();while(t!==this.startDe)},getNext:function(t){return t.getNext()},interfaces_:function(){return[]},getClass:function(){return Fe}}),Tr(Be.prototype,{locate:function(t){},interfaces_:function(){return[]},getClass:function(){return Be}}),Tr(je.prototype,{locate:function(t){return je.locate(t,this.geom)},interfaces_:function(){return[Be]},getClass:function(){return je}}),je.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&ae.isPointInRing(t,e.getCoordinates())},je.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!je.isPointInRing(t,n))return!1;for(var i=0;i<e.getNumInteriorRing();i++){var r=e.getInteriorRingN(i);if(je.isPointInRing(t,r))return!1}return!0},je.containsPoint=function(t,e){if(e instanceof Mt)return je.containsPointInPolygon(t,e);if(e instanceof lt)for(var n=new we(e);n.hasNext();){var i=n.next();if(i!==e&&je.containsPoint(t,i))return!0}return!1},je.locate=function(t,e){return e.isEmpty()?S.EXTERIOR:je.containsPoint(t,e)?S.INTERIOR:S.EXTERIOR},Tr(Ue.prototype,{getNextCW:function(t){this.getEdges();var e=this.edgeList.indexOf(t),n=e-1;return 0===e&&(n=this.edgeList.size()-1),this.edgeList.get(n)},propagateSideLabels:function(t){for(var e=S.NONE,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea(t)&&r.getLocation(t,Ae.LEFT)!==S.NONE&&(e=r.getLocation(t,Ae.LEFT))}if(e===S.NONE)return null;for(var o=e,n=this.iterator();n.hasNext();){var i=n.next(),r=i.getLabel();if(r.getLocation(t,Ae.ON)===S.NONE&&r.setLocation(t,Ae.ON,o),r.isArea(t)){var a=r.getLocation(t,Ae.LEFT),s=r.getLocation(t,Ae.RIGHT);if(s!==S.NONE){if(s!==o)throw new Le("side location conflict",i.getCoordinate());a===S.NONE&&c.shouldNeverReachHere("found single null side (at "+i.getCoordinate()+")"),o=a}else c.isTrue(r.getLocation(t,Ae.LEFT)===S.NONE,"found single null side"),r.setLocation(t,Ae.RIGHT,o),r.setLocation(t,Ae.LEFT,o)}}},getCoordinate:function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},print:function(t){L.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},isAreaLabelsConsistent:function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},checkAreaLabelsConsistent:function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,i=e.get(n).getLabel(),r=i.getLocation(t,Ae.LEFT);c.isTrue(r!==S.NONE,"Found unlabelled area edge");for(var o=r,a=this.iterator();a.hasNext();){var s=a.next(),u=s.getLabel();c.isTrue(u.isArea(t),"Found non-area edge");var l=u.getLocation(t,Ae.LEFT),h=u.getLocation(t,Ae.RIGHT);if(l===h)return!1;if(h!==o)return!1;o=l}return!0},findIndex:function(t){this.iterator();for(var e=0;e<this.edgeList.size();e++)if(this.edgeList.get(e)===t)return e;return-1},iterator:function(){return this.getEdges().iterator()},getEdges:function(){return null===this.edgeList&&(this.edgeList=new _(this.edgeMap.values())),this.edgeList},getLocation:function(t,e,n){return this.ptInAreaLocation[t]===S.NONE&&(this.ptInAreaLocation[t]=je.locate(e,n[t].getGeometry())),this.ptInAreaLocation[t]},toString:function(){var t=new C;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},computeEdgeEndLabels:function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},computeLabelling:function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next(),r=i.getLabel(),o=0;o<2;o++)r.isLine(o)&&r.getLocation(o)===S.BOUNDARY&&(e[o]=!0);for(var n=this.iterator();n.hasNext();)for(var i=n.next(),r=i.getLabel(),o=0;o<2;o++)if(r.isAnyNull(o)){var a=S.NONE;if(e[o])a=S.EXTERIOR;else{var s=i.getCoordinate();a=this.getLocation(o,s,t)}r.setAllLocationsIfNull(o,a)}},getDegree:function(){return this.edgeMap.size()},insertEdgeEnd:function(t,e){this.edgeMap.put(t,e),this.edgeList=null},interfaces_:function(){return[]},getClass:function(){return Ue}}),Tr(ze.prototype,{interfaces_:function(){return[]},getClass:function(){return ze}}),ze.isNorthern=function(t){return t===ze.NE||t===ze.NW},ze.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},ze.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=t<e?t:e,i=t>e?t:e;return 0===n&&3===i?3:n},ze.isInHalfPlane=function(t,e){return e===ze.SE?t===ze.SE||t===ze.SW:t===e||t===e+1},ze.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new n("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?ze.NE:ze.SE:e>=0?ze.NW:ze.SW}if(arguments[0]instanceof h&&arguments[1]instanceof h){var i=arguments[0],r=arguments[1];if(r.x===i.x&&r.y===i.y)throw new n("Cannot compute the quadrant for two identical points "+i);return r.x>=i.x?r.y>=i.y?ze.NE:ze.SE:r.y>=i.y?ze.NW:ze.SW}},ze.NE=0,ze.NW=1,ze.SW=2,ze.SE=3,Pr(Ge,Ue),Tr(Ge.prototype,{linkResultDirectedEdges:function(){this.getResultAreaEdges();for(var t=null,e=null,n=this.SCANNING_FOR_INCOMING,i=0;i<this.resultAreaEdgeList.size();i++){var r=this.resultAreaEdgeList.get(i),o=r.getSym();if(r.getLabel().isArea())switch(null===t&&r.isInResult()&&(t=r),n){case this.SCANNING_FOR_INCOMING:if(!o.isInResult())continue;e=o,n=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(!r.isInResult())continue;e.setNext(r),n=this.SCANNING_FOR_INCOMING}}if(n===this.LINKING_TO_OUTGOING){if(null===t)throw new Le("no outgoing dirEdge found",this.getCoordinate());c.isTrue(t.isInResult(),"unable to link last incoming dirEdge"),e.setNext(t)}},insert:function(t){var e=t;this.insertEdgeEnd(e,e)},getRightmostEdge:function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var i=t.get(e-1),r=n.getQuadrant(),o=i.getQuadrant();return ze.isNorthern(r)&&ze.isNorthern(o)?n:ze.isNorthern(r)||ze.isNorthern(o)?0!==n.getDy()?n:0!==i.getDy()?i:(c.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},print:function(t){L.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},getResultAreaEdges:function(){if(null!==this.resultAreaEdgeList)return this.resultAreaEdgeList;this.resultAreaEdgeList=new _;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this.resultAreaEdgeList.add(e)}return this.resultAreaEdgeList},updateLabelling:function(t){for(var e=this.iterator();e.hasNext();){var n=e.next(),i=n.getLabel();i.setAllLocationsIfNull(0,t.getLocation(0)),i.setAllLocationsIfNull(1,t.getLocation(1))}},linkAllDirectedEdges:function(){this.getEdges();for(var t=null,e=null,n=this.edgeList.size()-1;n>=0;n--){var i=this.edgeList.get(n),r=i.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=i}e.setNext(t)},computeDepths:function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=(t.getLabel(),t.getDepth(Ae.LEFT)),i=t.getDepth(Ae.RIGHT),r=this.computeDepths(e+1,this.edgeList.size(),n);if(this.computeDepths(0,e,r)!==i)throw new Le("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[0],a=arguments[1],s=arguments[2],u=s,l=o;l<a;l++){var c=this.edgeList.get(l);c.getLabel(),c.setEdgeDepths(Ae.RIGHT,u),u=c.getDepth(Ae.LEFT)}return u}},mergeSymLabels:function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},linkMinimalDirectedEdges:function(t){for(var e=null,n=null,i=this.SCANNING_FOR_INCOMING,r=this.resultAreaEdgeList.size()-1;r>=0;r--){var o=this.resultAreaEdgeList.get(r),a=o.getSym();switch(null===e&&o.getEdgeRing()===t&&(e=o),i){case this.SCANNING_FOR_INCOMING:if(a.getEdgeRing()!==t)continue;n=a,i=this.LINKING_TO_OUTGOING;break;case this.LINKING_TO_OUTGOING:if(o.getEdgeRing()!==t)continue;n.setNextMin(o),i=this.SCANNING_FOR_INCOMING}}i===this.LINKING_TO_OUTGOING&&(c.isTrue(null!==e,"found null for first outgoing dirEdge"),c.isTrue(e.getEdgeRing()===t,"unable to link last incoming dirEdge"),n.setNextMin(e))},getOutgoingDegree:function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();){var n=e.next();n.isInResult()&&t++}return t}if(1===arguments.length){for(var i=arguments[0],t=0,e=this.iterator();e.hasNext();){var n=e.next();n.getEdgeRing()===i&&t++}return t}},getLabel:function(){return this.label},findCoveredLineEdges:function(){for(var t=S.NONE,e=this.iterator();e.hasNext();){var n=e.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=S.INTERIOR;break}if(i.isInResult()){t=S.EXTERIOR;break}}}if(t===S.NONE)return null;for(var r=t,e=this.iterator();e.hasNext();){var n=e.next(),i=n.getSym();n.isLineEdge()?n.getEdge().setCovered(r===S.INTERIOR):(n.isInResult()&&(r=S.EXTERIOR),i.isInResult()&&(r=S.INTERIOR))}},computeLabelling:function(t){Ue.prototype.computeLabelling.call(this,t),this.label=new ke(S.NONE);for(var e=this.iterator();e.hasNext();)for(var n=e.next(),i=n.getEdge(),r=i.getLabel(),o=0;o<2;o++){var a=r.getLocation(o);a!==S.INTERIOR&&a!==S.BOUNDARY||this.label.setLocation(o,S.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Ge}}),Tr(Ve.prototype,{setVisited:function(t){this._isVisited=t},setInResult:function(t){this._isInResult=t},isCovered:function(){return this._isCovered},isCoveredSet:function(){return this._isCoveredSet},setLabel:function(t){this.label=t},getLabel:function(){return this.label},setCovered:function(t){this._isCovered=t,this._isCoveredSet=!0},updateIM:function(t){c.isTrue(this.label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},isInResult:function(){return this._isInResult},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return Ve}}),Pr(Xe,Ve),Tr(Xe.prototype,{isIncidentEdgeInResult:function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},isIsolated:function(){return 1===this.label.getGeometryCount()},getCoordinate:function(){return this.coord},print:function(t){t.println("node "+this.coord+" lbl: "+this.label)},computeIM:function(t){},computeMergedLocation:function(t,e){var n=S.NONE;if(n=this.label.getLocation(e),!t.isNull(e)){var i=t.getLocation(e);n!==S.BOUNDARY&&(n=i)}return n},setLabel:function(){if(2!==arguments.length)return Ve.prototype.setLabel.apply(this,arguments);var t=arguments[0],e=arguments[1];null===this.label?this.label=new ke(t,e):this.label.setLocation(t,e)},getEdges:function(){return this.edges},mergeLabel:function(){if(arguments[0]instanceof Xe){var t=arguments[0];this.mergeLabel(t.label)}else if(arguments[0]instanceof ke)for(var e=arguments[0],n=0;n<2;n++){var i=this.computeMergedLocation(e,n),r=this.label.getLocation(n);r===S.NONE&&this.label.setLocation(n,i)}},add:function(t){this.edges.insert(t),t.setNode(this)},setLabelBoundary:function(t){if(null===this.label)return null;var e=S.NONE;null!==this.label&&(e=this.label.getLocation(t));var n=null;switch(e){case S.BOUNDARY:n=S.INTERIOR;break;case S.INTERIOR:default:n=S.BOUNDARY}this.label.setLocation(t,n)},interfaces_:function(){return[]},getClass:function(){return Xe}}),Tr(He.prototype,{createNode:function(t){return new Xe(t,null)},interfaces_:function(){return[]},getClass:function(){return He}}),Pr(qe,He),Tr(qe.prototype,{createNode:function(t){return new Xe(t,new Ge)},interfaces_:function(){return[]},getClass:function(){return qe}}),Tr(Ye.prototype,{find:function(t){return this.nodeMap.get(t)},addNode:function(){if(arguments[0]instanceof h){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Xe){var n=arguments[0],e=this.nodeMap.get(n.getCoordinate());return null===e?(this.nodeMap.put(n.getCoordinate(),n),n):(e.mergeLabel(n),e)}},print:function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},iterator:function(){return this.nodeMap.values().iterator()},values:function(){return this.nodeMap.values()},getBoundaryNodes:function(t){for(var e=new _,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(t)===S.BOUNDARY&&e.add(i)}return e},add:function(t){var e=t.getCoordinate();this.addNode(e).add(t)},interfaces_:function(){return[]},getClass:function(){return Ye}}),Tr(We.prototype,{compareDirection:function(t){return this.dx===t.dx&&this.dy===t.dy?0:this.quadrant>t.quadrant?1:this.quadrant<t.quadrant?-1:ae.computeOrientation(t.p0,t.p1,this.p1)},getDy:function(){return this.dy},getCoordinate:function(){return this.p0},setNode:function(t){this.node=t},print:function(t){var e=Math.atan2(this.dy,this.dx),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);t.print("  "+r+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+e+"   "+this.label)},compareTo:function(t){var e=t;return this.compareDirection(e)},getDirectedCoordinate:function(){return this.p1},getDx:function(){return this.dx},getLabel:function(){return this.label},getEdge:function(){return this.edge},getQuadrant:function(){return this.quadrant},getNode:function(){return this.node},toString:function(){var t=Math.atan2(this.dy,this.dx),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this.p0+" - "+this.p1+" "+this.quadrant+":"+t+"   "+this.label},computeLabel:function(t){},init:function(t,e){this.p0=t,this.p1=e,this.dx=e.x-t.x,this.dy=e.y-t.y,this.quadrant=ze.quadrant(this.dx,this.dy),c.isTrue(!(0===this.dx&&0===this.dy),"EdgeEnd with identical endpoints found")},interfaces_:function(){return[r]},getClass:function(){return We}}),Pr(Ze,We),Tr(Ze.prototype,{getNextMin:function(){return this.nextMin},getDepth:function(t){return this.depth[t]},setVisited:function(t){this._isVisited=t},computeDirectedLabel:function(){this.label=new ke(this.edge.getLabel()),this._isForward||this.label.flip()},getNext:function(){return this.next},setDepth:function(t,e){if(this.depth[t]!==-999&&this.depth[t]!==e)throw new Le("assigned depths do not match",this.getCoordinate());this.depth[t]=e},isInteriorAreaEdge:function(){for(var t=!0,e=0;e<2;e++)this.label.isArea(e)&&this.label.getLocation(e,Ae.LEFT)===S.INTERIOR&&this.label.getLocation(e,Ae.RIGHT)===S.INTERIOR||(t=!1);return t},setNextMin:function(t){this.nextMin=t},print:function(t){We.prototype.print.call(this,t),t.print(" "+this.depth[Ae.LEFT]+"/"+this.depth[Ae.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this._isInResult&&t.print(" inResult")},setMinEdgeRing:function(t){this.minEdgeRing=t},isLineEdge:function(){var t=this.label.isLine(0)||this.label.isLine(1),e=!this.label.isArea(0)||this.label.allPositionsEqual(0,S.EXTERIOR),n=!this.label.isArea(1)||this.label.allPositionsEqual(1,S.EXTERIOR);return t&&e&&n},setEdgeRing:function(t){this.edgeRing=t},getMinEdgeRing:function(){return this.minEdgeRing},getDepthDelta:function(){var t=this.edge.getDepthDelta();return this._isForward||(t=-t),t},setInResult:function(t){this._isInResult=t},getSym:function(){return this.sym},isForward:function(){return this._isForward},getEdge:function(){return this.edge},printEdge:function(t){this.print(t),t.print(" "),this._isForward?this.edge.print(t):this.edge.printReverse(t)},setSym:function(t){this.sym=t},setVisitedEdge:function(t){this.setVisited(t),this.sym.setVisited(t)},setEdgeDepths:function(t,e){var n=this.getEdge().getDepthDelta();this._isForward||(n=-n);var i=1;t===Ae.LEFT&&(i=-1);var r=Ae.opposite(t),o=n*i,a=e+o;this.setDepth(t,e),this.setDepth(r,a)},getEdgeRing:function(){return this.edgeRing},isInResult:function(){return this._isInResult},setNext:function(t){this.next=t},isVisited:function(){return this._isVisited},interfaces_:function(){return[]},getClass:function(){return Ze}}),Ze.depthFactor=function(t,e){return t===S.EXTERIOR&&e===S.INTERIOR?1:t===S.INTERIOR&&e===S.EXTERIOR?-1:0},Tr(Je.prototype,{printEdges:function(t){t.println("Edges:");for(var e=0;e<this.edges.size();e++){t.println("edge "+e+":");var n=this.edges.get(e);n.print(t),n.eiList.print(t)}},find:function(t){return this.nodes.find(t)},addNode:function(){if(arguments[0]instanceof Xe){var t=arguments[0];return this.nodes.addNode(t)}if(arguments[0]instanceof h){var e=arguments[0];return this.nodes.addNode(e)}},getNodeIterator:function(){return this.nodes.iterator()},linkResultDirectedEdges:function(){for(var t=this.nodes.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},debugPrintln:function(t){L.out.println(t)},isBoundaryNode:function(t,e){var n=this.nodes.find(e);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(t)===S.BOUNDARY},linkAllDirectedEdges:function(){for(var t=this.nodes.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},matchInSameDirection:function(t,e,n,i){return!!t.equals(n)&&ae.computeOrientation(t,e,i)===ae.COLLINEAR&&ze.quadrant(t,e)===ze.quadrant(n,i)},getEdgeEnds:function(){return this.edgeEndList},debugPrint:function(t){L.out.print(t)},getEdgeIterator:function(){return this.edges.iterator()},findEdgeInSameDirection:function(t,e){for(var n=0;n<this.edges.size();n++){var i=this.edges.get(n),r=i.getCoordinates();if(this.matchInSameDirection(t,e,r[0],r[1]))return i;if(this.matchInSameDirection(t,e,r[r.length-1],r[r.length-2]))return i}return null},insertEdge:function(t){this.edges.add(t)},findEdgeEnd:function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},addEdges:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.edges.add(n);var i=new Ze(n,!0),r=new Ze(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}},add:function(t){this.nodes.add(t),this.edgeEndList.add(t)},getNodes:function(){return this.nodes.values()},findEdge:function(t,e){for(var n=0;n<this.edges.size();n++){var i=this.edges.get(n),r=i.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return i}return null},interfaces_:function(){return[]},getClass:function(){return Je}}),Je.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()},Tr(Ke.prototype,{visitInteriorRing:function(t,e){var n=t.getCoordinates(),i=n[0],r=Ke.findDifferentPoint(n,i),o=e.findEdgeInSameDirection(i,r),a=e.findEdgeEnd(o),s=null;a.getLabel().getLocation(0,Ae.RIGHT)===S.INTERIOR?s=a:a.getSym().getLabel().getLocation(0,Ae.RIGHT)===S.INTERIOR&&(s=a.getSym()),c.isTrue(null!==s,"unable to find dirEdge with Interior on RHS"),this.visitLinkedDirectedEdges(s)},visitShellInteriors:function(t,e){if(t instanceof Mt){var n=t;this.visitInteriorRing(n.getExteriorRing(),e)}if(t instanceof Ot)for(var i=t,r=0;r<i.getNumGeometries();r++){var n=i.getGeometryN(r);this.visitInteriorRing(n.getExteriorRing(),e)}},getCoordinate:function(){return this.disconnectedRingcoord},setInteriorEdgesInResult:function(t){for(var e=t.getEdgeEnds().iterator();e.hasNext();){var n=e.next();n.getLabel().getLocation(0,Ae.RIGHT)===S.INTERIOR&&n.setInResult(!0)}},visitLinkedDirectedEdges:function(t){var e=t,n=t;do c.isTrue(null!==n,"found null Directed Edge"),n.setVisited(!0),n=n.getNext();while(n!==e)},buildEdgeRings:function(t){for(var e=new _,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&null===i.getEdgeRing()){var r=new Fe(i,this.geometryFactory);r.linkDirectedEdgesForMinimalEdgeRings();var o=r.buildMinimalRings();e.addAll(o)}}return e},hasUnvisitedShellEdge:function(t){for(var e=0;e<t.size();e++){var n=t.get(e);if(!n.isHole()){var i=n.getEdges(),r=i.get(0);if(r.getLabel().getLocation(0,Ae.RIGHT)===S.INTERIOR)for(var o=0;o<i.size();o++)if(r=i.get(o),!r.isVisited())return this.disconnectedRingcoord=r.getCoordinate(),!0}}return!1},isInteriorsConnected:function(){var t=new _;this.geomGraph.computeSplitEdges(t);var e=new Je(new qe);e.addEdges(t),this.setInteriorEdgesInResult(e),e.linkResultDirectedEdges();var n=this.buildEdgeRings(e.getEdgeEnds());return this.visitShellInteriors(this.geomGraph.getGeometry(),e),!this.hasUnvisitedShellEdge(n)},interfaces_:function(){return[]},getClass:function(){return Ke}}),Ke.findDifferentPoint=function(t,e){for(var n=0;n<t.length;n++)if(!t[n].equals(e))return t[n];return null},Tr(Qe.prototype,{select:function(){if(1===arguments.length)arguments[0];else if(2===arguments.length){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}},interfaces_:function(){return[]},getClass:function(){return Qe}}),Tr($e.prototype,{hasChildren:function(){for(var t=0;t<2;t++)if(null!==this.subnode[t])return!0;return!1},isPrunable:function(){return!(this.hasChildren()||this.hasItems())},addAllItems:function(t){t.addAll(this.items);for(var e=0;e<2;e++)null!==this.subnode[e]&&this.subnode[e].addAllItems(t);return t},size:function(){for(var t=0,e=0;e<2;e++)null!==this.subnode[e]&&(t+=this.subnode[e].size());return t+this.items.size()},addAllItemsFromOverlapping:function(t,e){return null===t||this.isSearchMatch(t)?(e.addAll(this.items),null!==this.subnode[0]&&this.subnode[0].addAllItemsFromOverlapping(t,e),null!==this.subnode[1]&&this.subnode[1].addAllItemsFromOverlapping(t,e),void 0):null},hasItems:function(){return!this.items.isEmpty()},remove:function(t,e){if(!this.isSearchMatch(t))return!1;for(var n=!1,i=0;i<2;i++)if(null!==this.subnode[i]&&(n=this.subnode[i].remove(t,e))){this.subnode[i].isPrunable()&&(this.subnode[i]=null);break}return n||(n=this.items.remove(e))},getItems:function(){return this.items},depth:function(){for(var t=0,e=0;e<2;e++)if(null!==this.subnode[e]){var n=this.subnode[e].depth();n>t&&(t=n)}return t+1},nodeSize:function(){for(var t=0,e=0;e<2;e++)null!==this.subnode[e]&&(t+=this.subnode[e].nodeSize());return t+1},add:function(t){this.items.add(t)},interfaces_:function(){return[]},getClass:function(){return $e}}),$e.getSubnodeIndex=function(t,e){var n=-1;return t.min>=e&&(n=1),t.max<=e&&(n=0),n},Tr(tn.prototype,{expandToInclude:function(t){t.max>this.max&&(this.max=t.max),t.min<this.min&&(this.min=t.min)},getWidth:function(){return this.max-this.min},overlaps:function(){if(1===arguments.length){var t=arguments[0];return this.overlaps(t.min,t.max)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!(this.min>n||this.max<e)}},getMin:function(){return this.min},toString:function(){return"["+this.min+", "+this.max+"]"},contains:function(){if(1===arguments.length){if(arguments[0]instanceof tn){var t=arguments[0];return this.contains(t.min,t.max)}if("number"==typeof arguments[0]){var e=arguments[0];return e>=this.min&&e<=this.max}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return n>=this.min&&i<=this.max}},init:function(t,e){this.min=t,this.max=e,t>e&&(this.min=e,this.max=t);
},getMax:function(){return this.max},interfaces_:function(){return[]},getClass:function(){return tn}}),Tr(en.prototype,{getInterval:function(){return this.interval},getLevel:function(){return this.level},computeKey:function(t){for(this.level=en.computeLevel(t),this.interval=new tn,this.computeInterval(this.level,t);!this.interval.contains(t);)this.level+=1,this.computeInterval(this.level,t)},computeInterval:function(t,e){var n=le.powerOf2(t);this.pt=Math.floor(e.getMin()/n)*n,this.interval.init(this.pt,this.pt+n)},getPoint:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return en}}),en.computeLevel=function(t){var e=t.getWidth();return le.exponent(e)+1},Pr(nn,$e),Tr(nn.prototype,{getInterval:function(){return this.interval},find:function(t){var e=$e.getSubnodeIndex(t,this.centre);return e===-1?this:null!==this.subnode[e]?this.subnode[e].find(t):this},insert:function(t){c.isTrue(null===this.interval||this.interval.contains(t.interval));var e=$e.getSubnodeIndex(t.interval,this.centre);if(t.level===this.level-1)this.subnode[e]=t;else{var n=this.createSubnode(e);n.insert(t),this.subnode[e]=n}},isSearchMatch:function(t){return t.overlaps(this.interval)},getSubnode:function(t){return null===this.subnode[t]&&(this.subnode[t]=this.createSubnode(t)),this.subnode[t]},getNode:function(t){var e=$e.getSubnodeIndex(t,this.centre);return e!==-1?this.getSubnode(e).getNode(t):this},createSubnode:function(t){var e=0,n=0;switch(t){case 0:e=this.interval.getMin(),n=this.centre;break;case 1:e=this.centre,n=this.interval.getMax()}return new nn(new tn(e,n),this.level-1)},interfaces_:function(){return[]},getClass:function(){return nn}}),nn.createNode=function(t){var e=new en(t);return new nn(e.getInterval(),e.getLevel())},nn.createExpanded=function(t,e){var n=new tn(e);null!==t&&n.expandToInclude(t.interval);var i=nn.createNode(n);return null!==t&&i.insert(t),i},Pr(rn,$e),Tr(rn.prototype,{insert:function(t,e){var n=$e.getSubnodeIndex(t,rn.origin);if(n===-1)return this.add(e),null;var i=this.subnode[n];if(null===i||!i.getInterval().contains(t)){var r=nn.createExpanded(i,t);this.subnode[n]=r}this.insertContained(this.subnode[n],t,e)},isSearchMatch:function(t){return!0},insertContained:function(t,e,n){c.isTrue(t.getInterval().contains(e));var i=de.isZeroWidth(e.getMin(),e.getMax()),r=null;r=i?t.find(e):t.getNode(e),r.add(n)},interfaces_:function(){return[]},getClass:function(){return rn}}),rn.origin=0,Tr(on.prototype,{size:function(){return null!==this.root?this.root.size():0},insert:function(t,e){this.collectStats(t);var n=on.ensureExtent(t,this.minExtent);this.root.insert(n,e)},query:function(){if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];return this.query(new tn(t,t))}if(arguments[0]instanceof tn){var e=arguments[0],n=new _;return this.query(e,n),n}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.root.addAllItemsFromOverlapping(i,r)}},iterator:function(){var t=new _;return this.root.addAllItems(t),t.iterator()},remove:function(t,e){var n=on.ensureExtent(t,this.minExtent);return this.root.remove(n,e)},collectStats:function(t){var e=t.getWidth();e<this.minExtent&&e>0&&(this.minExtent=e)},depth:function(){return null!==this.root?this.root.depth():0},nodeSize:function(){return null!==this.root?this.root.nodeSize():0},interfaces_:function(){return[]},getClass:function(){return on}}),on.ensureExtent=function(t,e){var n=t.getMin(),i=t.getMax();return n!==i?t:(n===i&&(n-=e/2,i=n+e/2),new tn(n,i))},Tr(an.prototype,{getLineSegment:function(t,e){e.p0=this.pts[t],e.p1=this.pts[t+1]},computeSelect:function(t,e,n,i){var r=this.pts[e],o=this.pts[n];if(i.tempEnv1.init(r,o),n-e==1)return i.select(this,e),null;if(!t.intersects(i.tempEnv1))return null;var a=Math.trunc((e+n)/2);e<a&&this.computeSelect(t,e,a,i),a<n&&this.computeSelect(t,a,n,i)},getCoordinates:function(){for(var t=new Array(this.end-this.start+1).fill(null),e=0,n=this.start;n<=this.end;n++)t[e++]=this.pts[n];return t},computeOverlaps:function(t,e){this.computeOverlapsInternal(this.start,this.end,t,t.start,t.end,e)},setId:function(t){this.id=t},select:function(t,e){this.computeSelect(t,this.start,this.end,e)},getEnvelope:function(){if(null===this.env){var t=this.pts[this.start],e=this.pts[this.end];this.env=new x(t,e)}return this.env},getEndIndex:function(){return this.end},getStartIndex:function(){return this.start},getContext:function(){return this.context},getId:function(){return this.id},computeOverlapsInternal:function(t,e,n,i,r,o){var a=this.pts[t],s=this.pts[e],u=n.pts[i],l=n.pts[r];if(e-t==1&&r-i==1)return o.overlap(this,t,n,i),null;if(o.tempEnv1.init(a,s),o.tempEnv2.init(u,l),!o.tempEnv1.intersects(o.tempEnv2))return null;var c=Math.trunc((t+e)/2),h=Math.trunc((i+r)/2);t<c&&(i<h&&this.computeOverlapsInternal(t,c,n,i,h,o),h<r&&this.computeOverlapsInternal(t,c,n,h,r,o)),c<e&&(i<h&&this.computeOverlapsInternal(c,e,n,i,h,o),h<r&&this.computeOverlapsInternal(c,e,n,h,r,o))},interfaces_:function(){return[]},getClass:function(){return an}}),Tr(sn.prototype,{interfaces_:function(){return[]},getClass:function(){return sn}}),sn.getChainStartIndices=function(t){var e=0,n=new _;n.add(new I(e));do{var i=sn.findChainEnd(t,e);n.add(new I(i)),e=i}while(e<t.length-1);return sn.toIntArray(n)},sn.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var i=ze.quadrant(t[n],t[n+1]),r=e+1;r<t.length&&(t[r-1].equals2D(t[r])||ze.quadrant(t[r-1],t[r])===i);)r++;return r-1},sn.getChains=function(){if(1===arguments.length){var t=arguments[0];return sn.getChains(t,null)}if(2===arguments.length){for(var e=arguments[0],n=arguments[1],i=new _,r=sn.getChainStartIndices(e),o=0;o<r.length-1;o++){var a=new an(e,r[o],r[o+1],n);i.add(a)}return i}},sn.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e},Tr(un.prototype,{isInside:function(t){},interfaces_:function(){return[]},getClass:function(){return un}}),Tr(ln.prototype,{testLineSegment:function(t,e){var n=null,i=null,r=null,o=null,a=e.p0,s=e.p1;n=a.x-t.x,i=a.y-t.y,r=s.x-t.x,o=s.y-t.y,(i>0&&o<=0||o>0&&i<=0)&&0<re.signOfDet2x2(n,i,r,o)/(o-i)&&this.crossings++},buildIndex:function(){this.tree=new on;for(var t=V.removeRepeatedPoints(this.ring.getCoordinates()),e=sn.getChains(t),n=0;n<e.size();n++){var i=e.get(n),r=i.getEnvelope();this.interval.min=r.getMinY(),this.interval.max=r.getMaxY(),this.tree.insert(this.interval,i)}},testMonotoneChain:function(t,e,n){n.select(t,e)},isInside:function(t){this.crossings=0;var e=new x(i.NEGATIVE_INFINITY,i.POSITIVE_INFINITY,t.y,t.y);this.interval.min=t.y,this.interval.max=t.y;for(var n=this.tree.query(this.interval),r=new cn(this,t),o=n.iterator();o.hasNext();){var a=o.next();this.testMonotoneChain(e,r,a)}return this.crossings%2==1},interfaces_:function(){return[un]},getClass:function(){return ln}}),Pr(cn,Qe),Tr(cn.prototype,{select:function(){if(1!==arguments.length)return Qe.prototype.select.apply(this,arguments);var t=arguments[0];this.mcp.testLineSegment(this.p,t)},interfaces_:function(){return[]},getClass:function(){return cn}}),ln.MCSelecter=cn,Tr(hn.prototype,{computeIntersections:function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},interfaces_:function(){return[]},getClass:function(){return hn}}),Tr(fn.prototype,{isDelete:function(){return this.eventType===fn.DELETE},setDeleteEventIndex:function(t){this.deleteEventIndex=t},getObject:function(){return this.obj},compareTo:function(t){var e=t;return this.xValue<e.xValue?-1:this.xValue>e.xValue?1:this.eventType<e.eventType?-1:this.eventType>e.eventType?1:0},getInsertEvent:function(){return this.insertEvent},isInsert:function(){return this.eventType===fn.INSERT},isSameLabel:function(t){return null!==this.label&&this.label===t.label},getDeleteEventIndex:function(){return this.deleteEventIndex},interfaces_:function(){return[r]},getClass:function(){return fn}}),fn.INSERT=1,fn.DELETE=2,Tr(dn.prototype,{interfaces_:function(){return[]},getClass:function(){return dn}}),Tr(pn.prototype,{isTrivialIntersection:function(t,e,n,i){if(t===n&&1===this.li.getIntersectionNum()){if(pn.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},getProperIntersectionPoint:function(){return this.properIntersectionPoint},setIsDoneIfProperInt:function(t){this.isDoneWhenProperInt=t},hasProperInteriorIntersection:function(){return this.hasProperInterior},isBoundaryPointInternal:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinate();if(t.isIntersection(r))return!0}return!1},hasProperIntersection:function(){return this.hasProper},hasIntersection:function(){return this._hasIntersection},isDone:function(){return this._isDone},isBoundaryPoint:function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},setBoundaryNodes:function(t,e){this.bdyNodes=new Array(2).fill(null),this.bdyNodes[0]=t,this.bdyNodes[1]=e},addIntersections:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],s=n.getCoordinates()[i+1];this.li.computeIntersection(r,o,a,s),this.li.hasIntersection()&&(this.recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this.numIntersections++,this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,!this.includeProper&&this.li.isProper()||(t.addIntersections(this.li,e,0),n.addIntersections(this.li,i,1)),this.li.isProper()&&(this.properIntersectionPoint=this.li.getIntersection(0).copy(),this.hasProper=!0,this.isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this.li,this.bdyNodes)||(this.hasProperInterior=!0))))},interfaces_:function(){return[]},getClass:function(){return pn}}),pn.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)},Pr(gn,dn),Tr(gn.prototype,{prepareEvents:function(){Jr.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},computeIntersections:function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof pn&&Lr(arguments[0],v)&&Lr(arguments[1],v)){var i=arguments[0],r=arguments[1],o=arguments[2];this.addEdges(i,i),this.addEdges(r,r),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&Lr(arguments[0],v)&&arguments[1]instanceof pn){var a=arguments[0],s=arguments[1],u=arguments[2];u?this.addEdges(a,null):this.addEdges(a),this.computeIntersections(s)}},addEdge:function(t,e){for(var n=t.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var o=new hn(n,r),a=new fn(e,n.getMinX(r),o);this.events.add(a),this.events.add(new fn(n.getMaxX(r),a))}},processOverlaps:function(t,e,n,i){for(var r=n.getObject(),o=t;o<e;o++){var a=this.events.get(o);if(a.isInsert()){var s=a.getObject();n.isSameLabel(a)||(r.computeIntersections(s,i),this.nOverlaps++)}}},addEdges:function(){if(1===arguments.length)for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.addEdge(n,n)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1],e=i.iterator();e.hasNext();){var n=e.next();this.addEdge(n,r)}},interfaces_:function(){return[]},getClass:function(){return gn}}),Tr(vn.prototype,{getMin:function(){return this.min},intersects:function(t,e){return!(this.min>e||this.max<t)},getMax:function(){return this.max},toString:function(){return ee.toLineString(new h(this.min,0),new h(this.max,0))},interfaces_:function(){return[]},getClass:function(){return vn}}),Tr(mn.prototype,{compare:function(t,e){var n=t,i=e,r=(n.min+n.max)/2,o=(i.min+i.max)/2;return r<o?-1:r>o?1:0},interfaces_:function(){return[a]},getClass:function(){return mn}}),vn.NodeComparator=mn,Pr(yn,vn),Tr(yn.prototype,{query:function(t,e,n){return this.intersects(t,e)?void n.visitItem(this.item):null},interfaces_:function(){return[]},getClass:function(){return yn}}),Pr(_n,vn),Tr(_n.prototype,{buildExtent:function(t,e){this.min=Math.min(t.min,e.min),this.max=Math.max(t.max,e.max)},query:function(t,e,n){return this.intersects(t,e)?(null!==this.node1&&this.node1.query(t,e,n),void(null!==this.node2&&this.node2.query(t,e,n))):null},interfaces_:function(){return[]},getClass:function(){return _n}}),Tr(bn.prototype,{buildTree:function(){Jr.sort(this.leaves,new IntervalRTreeNode.NodeComparator);for(var t=this.leaves,e=null,n=new _;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},insert:function(t,e,n){if(null!==this.root)throw new IllegalStateException("Index cannot be added to once it has been queried");this.leaves.add(new yn(t,e,n))},query:function(t,e,n){this.init(),this.root.query(t,e,n)},buildRoot:function(){return null!==this.root?null:void(this.root=this.buildTree())},printNode:function(t){L.out.println(ee.toLineString(new h(t.min,this.level),new h(t.max,this.level)))},init:function(){return null!==this.root?null:void this.buildRoot()},buildLevel:function(t,e){this.level++,e.clear();for(var n=0;n<t.size();n+=2){var i=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(i);else{var r=new _n(t.get(n),t.get(n+1));e.add(r)}}},interfaces_:function(){return[]},getClass:function(){return bn}}),Tr(xn.prototype,{locate:function(t){var e=new oe(t),n=new wn(e);return this.index.query(t.y,t.y,n),e.getLocation()},interfaces_:function(){return[Be]},getClass:function(){return xn}}),Tr(wn.prototype,{visitItem:function(t){var e=t;this.counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))},interfaces_:function(){return[ve]},getClass:function(){return wn}}),Tr(En.prototype,{init:function(t){for(var e=Oe.getLines(t),n=e.iterator();n.hasNext();){var i=n.next(),r=i.getCoordinates();this.addLine(r)}},addLine:function(t){for(var e=1;e<t.length;e++){var n=new se(t[e-1],t[e]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this.index.insert(i,r,n)}},query:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new me;return this.index.query(t,e,n),n.getItems()}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];this.index.query(i,r,o)}},interfaces_:function(){return[]},getClass:function(){return En}}),xn.SegmentVisitor=wn,xn.IntervalIndexedGeometry=En,Tr(Sn.prototype,{getSegmentIndex:function(){return this.segmentIndex},getCoordinate:function(){return this.coord},print:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},compareTo:function(t){var e=t;return this.compare(e.segmentIndex,e.dist)},isEndPoint:function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},toString:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},getDistance:function(){return this.dist},compare:function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},interfaces_:function(){return[r]},getClass:function(){return Sn}}),Tr(Mn.prototype,{print:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},iterator:function(){return this.nodeMap.values().iterator()},addSplitEdges:function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},addEndpoints:function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},createSplitEdge:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.edge.pts[e.segmentIndex],r=e.dist>0||!e.coord.equals2D(i);r||n--;var o=new Array(n).fill(null),a=0;o[a++]=new h(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this.edge.pts[s];return r&&(o[a]=e.coord),new Tn(o,new ke(this.edge.label))},add:function(t,e,n){var i=new Sn(t,e,n),r=this.nodeMap.get(i);return null!==r?r:(this.nodeMap.put(i,i),i)},isIntersection:function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},interfaces_:function(){return[]},getClass:function(){return Mn}}),Tr(Cn.prototype,{getChainStartIndices:function(t){var e=0,n=new _;n.add(new I(e));do{var i=this.findChainEnd(t,e);n.add(new I(i)),e=i}while(e<t.length-1);return Cn.toIntArray(n)},findChainEnd:function(t,e){for(var n=ze.quadrant(t[e],t[e+1]),i=e+1;i<t.length&&ze.quadrant(t[i-1],t[i])===n;)i++;return i-1},interfaces_:function(){return[]},getClass:function(){return Cn}}),Cn.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e},Tr(In.prototype,{getCoordinates:function(){return this.pts},getMaxX:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},getMinX:function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},computeIntersectsForChain:function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2],s=arguments[3],u=arguments[4],l=arguments[5],c=this.pts[r],h=this.pts[o],f=a.pts[s],d=a.pts[u];if(o-r==1&&u-s==1)return l.addIntersections(this.e,r,a.e,s),null;if(this.env1.init(c,h),this.env2.init(f,d),!this.env1.intersects(this.env2))return null;var p=Math.trunc((r+o)/2),g=Math.trunc((s+u)/2);r<p&&(s<g&&this.computeIntersectsForChain(r,p,a,s,g,l),g<u&&this.computeIntersectsForChain(r,p,a,g,u,l)),p<o&&(s<g&&this.computeIntersectsForChain(p,o,a,s,g,l),g<u&&this.computeIntersectsForChain(p,o,a,g,u,l))}},getStartIndexes:function(){return this.startIndex},computeIntersects:function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<t.startIndex.length-1;i++)this.computeIntersectsForChain(n,t,i,e)},interfaces_:function(){return[]},getClass:function(){return In}}),Tr(On.prototype,{getDepth:function(t,e){return this.depth[t][e]},setDepth:function(t,e,n){this.depth[t][e]=n},isNull:function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this.depth[t][e]!==On.NULL_VALUE)return!1;return!0}if(1===arguments.length){var n=arguments[0];return this.depth[n][1]===On.NULL_VALUE}if(2===arguments.length){var i=arguments[0],r=arguments[1];return this.depth[i][r]===On.NULL_VALUE}},normalize:function(){for(var t=0;t<2;t++)if(!this.isNull(t)){var e=this.depth[t][1];this.depth[t][2]<e&&(e=this.depth[t][2]),e<0&&(e=0);for(var n=1;n<3;n++){var i=0;this.depth[t][n]>e&&(i=1),this.depth[t][n]=i}}},getDelta:function(t){return this.depth[t][Ae.RIGHT]-this.depth[t][Ae.LEFT]},getLocation:function(t,e){return this.depth[t][e]<=0?S.EXTERIOR:S.INTERIOR},toString:function(){return"A: "+this.depth[0][1]+","+this.depth[0][2]+" B: "+this.depth[1][1]+","+this.depth[1][2]},add:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<2;e++)for(var n=1;n<3;n++){var i=t.getLocation(e,n);i!==S.EXTERIOR&&i!==S.INTERIOR||(this.isNull(e,n)?this.depth[e][n]=On.depthAtLocation(i):this.depth[e][n]+=On.depthAtLocation(i))}else if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];a===S.INTERIOR&&this.depth[r][o]++}},interfaces_:function(){return[]},getClass:function(){return On}}),On.depthAtLocation=function(t){return t===S.EXTERIOR?0:t===S.INTERIOR?1:On.NULL_VALUE},On.NULL_VALUE=-1,Pr(Tn,Ve),Tr(Tn.prototype,{getDepth:function(){return this.depth},getCollapsedEdge:function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new Tn(t,ke.toLineLabel(this.label))},isIsolated:function(){return this._isIsolated},getCoordinates:function(){return this.pts},setIsolated:function(t){this._isIsolated=t},setName:function(t){this.name=t},equals:function(t){if(!(t instanceof Tn))return!1;var e=t;if(this.pts.length!==e.pts.length)return!1;for(var n=!0,i=!0,r=this.pts.length,o=0;o<this.pts.length;o++)if(this.pts[o].equals2D(e.pts[o])||(n=!1),this.pts[o].equals2D(e.pts[--r])||(i=!1),!n&&!i)return!1;return!0},getCoordinate:function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var t=arguments[0];return this.pts[t]}},print:function(t){t.print("edge "+this.name+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this.label+" "+this.depthDelta)},computeIM:function(t){Tn.updateIM(this.label,t)},isCollapsed:function(){return!!this.label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getMaximumSegmentIndex:function(){return this.pts.length-1},getDepthDelta:function(){return this.depthDelta},getNumPoints:function(){return this.pts.length},printReverse:function(t){t.print("edge "+this.name+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},getMonotoneChainEdge:function(){return null===this.mce&&(this.mce=new In(this)),this.mce},getEnvelope:function(){if(null===this.env){this.env=new x;for(var t=0;t<this.pts.length;t++)this.env.expandToInclude(this.pts[t])}return this.env},addIntersection:function(t,e,n,i){var r=new h(t.getIntersection(i)),o=e,a=t.getEdgeDistance(n,i),s=o+1;if(s<this.pts.length){var u=this.pts[s];r.equals2D(u)&&(o=s,a=0)}this.eiList.add(r,o,a)},toString:function(){var t=new C;t.append("edge "+this.name+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this.label+" "+this.depthDelta),t.toString()},isPointwiseEqual:function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},setDepthDelta:function(t){this.depthDelta=t},getEdgeIntersectionList:function(){return this.eiList},addIntersections:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},interfaces_:function(){return[]},getClass:function(){return Tn}}),Tn.updateIM=function(){if(2!==arguments.length)return Ve.prototype.updateIM.apply(this,arguments);var t=arguments[0],e=arguments[1];e.setAtLeastIfValid(t.getLocation(0,Ae.ON),t.getLocation(1,Ae.ON),1),t.isArea()&&(e.setAtLeastIfValid(t.getLocation(0,Ae.LEFT),t.getLocation(1,Ae.LEFT),2),e.setAtLeastIfValid(t.getLocation(0,Ae.RIGHT),t.getLocation(1,Ae.RIGHT),2))},Pr(Pn,Je),Tr(Pn.prototype,{insertBoundaryPoint:function(t,e){var n=this.nodes.addNode(e),i=n.getLabel(),r=1,o=S.NONE;(o=i.getLocation(t,Ae.ON))===S.BOUNDARY&&r++;var a=Pn.determineBoundary(this.boundaryNodeRule,r);i.setLocation(t,a)},computeSelfNodes:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.computeSelfNodes(t,e,!1)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],o=new pn(n,!0,!1);o.setIsDoneIfProperInt(r);var a=this.createEdgeSetIntersector(),s=this.parentGeom instanceof It||this.parentGeom instanceof Mt||this.parentGeom instanceof Ot,u=i||!s;return a.computeIntersections(this.edges,o,u),this.addSelfIntersectionNodes(this.argIndex),o}},computeSplitEdges:function(t){for(var e=this.edges.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},computeEdgeIntersections:function(t,e,n){var i=new pn(e,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.edges,t.edges,i),i},getGeometry:function(){return this.parentGeom},getBoundaryNodeRule:function(){return this.boundaryNodeRule},hasTooFewPoints:function(){return this._hasTooFewPoints},addPoint:function(){if(arguments[0]instanceof Et){var t=arguments[0],e=t.getCoordinate();this.insertPoint(this.argIndex,e,S.INTERIOR)}else if(arguments[0]instanceof h){var n=arguments[0];this.insertPoint(this.argIndex,n,S.INTERIOR)}},addPolygon:function(t){this.addPolygonRing(t.getExteriorRing(),S.EXTERIOR,S.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,S.INTERIOR,S.EXTERIOR)}},addEdge:function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this.argIndex,e[0],S.BOUNDARY),this.insertPoint(this.argIndex,e[e.length-1],S.BOUNDARY)},addLineString:function(t){var e=V.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this._hasTooFewPoints=!0,this.invalidPoint=e[0],null;var n=new Tn(e,new ke(this.argIndex,S.INTERIOR));this.lineEdgeMap.put(t,n),this.insertEdge(n),c.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.argIndex,e[0]),this.insertBoundaryPoint(this.argIndex,e[e.length-1])},getInvalidPoint:function(){return this.invalidPoint},getBoundaryPoints:function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,i=t.iterator();i.hasNext();){var r=i.next();e[n++]=r.getCoordinate().copy()}return e},getBoundaryNodes:function(){return null===this.boundaryNodes&&(this.boundaryNodes=this.nodes.getBoundaryNodes(this.argIndex)),this.boundaryNodes},addSelfIntersectionNode:function(t,e,n){return this.isBoundaryNode(t,e)?null:void(n===S.BOUNDARY&&this.useBoundaryDeterminationRule?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n))},addPolygonRing:function(t,e,n){if(t.isEmpty())return null;var i=V.removeRepeatedPoints(t.getCoordinates());if(i.length<4)return this._hasTooFewPoints=!0,this.invalidPoint=i[0],null;var r=e,o=n;ae.isCCW(i)&&(r=n,o=e);var a=new Tn(i,new ke(this.argIndex,S.BOUNDARY,r,o));this.lineEdgeMap.put(t,a),this.insertEdge(a),this.insertPoint(this.argIndex,i[0],S.BOUNDARY)},insertPoint:function(t,e,n){var i=this.nodes.addNode(e),r=i.getLabel();null===r?i.label=new ke(t,n):r.setLocation(t,n)},createEdgeSetIntersector:function(){return new gn},addSelfIntersectionNodes:function(t){for(var e=this.edges.iterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.eiList.iterator();r.hasNext();){var o=r.next();this.addSelfIntersectionNode(t,o.coord,i)}},add:function(){if(1!==arguments.length)return Je.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof Ot&&(this.useBoundaryDeterminationRule=!1),t instanceof Mt)this.addPolygon(t);else if(t instanceof xt)this.addLineString(t);else if(t instanceof Et)this.addPoint(t);else if(t instanceof Ct)this.addCollection(t);else if(t instanceof ct)this.addCollection(t);else if(t instanceof Ot)this.addCollection(t);else{if(!(t instanceof lt))throw new UnsupportedOperationException(t.getClass().getName());this.addCollection(t)}},addCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},locate:function(t){return Lr(this.parentGeom,St)&&this.parentGeom.getNumGeometries()>50?(null===this.areaPtLocator&&(this.areaPtLocator=new xn(this.parentGeom)),this.areaPtLocator.locate(t)):this.ptLocator.locate(t,this.parentGeom)},findEdge:function(){if(1===arguments.length){var t=arguments[0];return this.lineEdgeMap.get(t)}return Je.prototype.findEdge.apply(this,arguments)},interfaces_:function(){return[]},getClass:function(){return Pn}}),Pn.determineBoundary=function(t,e){return t.isInBoundary(e)?S.BOUNDARY:S.INTERIOR},Tr(An.prototype,{createEdgeEndForNext:function(t,e,n,i){var r=n.segmentIndex+1;if(r>=t.getNumPoints()&&null===i)return null;var o=t.getCoordinate(r);null!==i&&i.segmentIndex===n.segmentIndex&&(o=i.coord);var a=new We(t,n.coord,o,new ke(t.getLabel()));e.add(a)},createEdgeEndForPrev:function(t,e,n,i){var r=n.segmentIndex;if(0===n.dist){if(0===r)return null;r--}var o=t.getCoordinate(r);null!==i&&i.segmentIndex>=r&&(o=i.coord);var a=new ke(t.getLabel());a.flip();var s=new We(t,n.coord,o,a);e.add(s)},computeEdgeEnds:function(){if(1===arguments.length){for(var t=arguments[0],e=new _,n=t;n.hasNext();){var i=n.next();this.computeEdgeEnds(i,e)}return e}if(2===arguments.length){var r=arguments[0],o=arguments[1],a=r.getEdgeIntersectionList();a.addEndpoints();var s=a.iterator(),u=null,l=null;if(!s.hasNext())return null;var c=s.next();do u=l,l=c,c=null,s.hasNext()&&(c=s.next()),null!==l&&(this.createEdgeEndForPrev(r,o,l,u),this.createEdgeEndForNext(r,o,l,c));while(null!==l)}},interfaces_:function(){return[]},getClass:function(){return An}}),Pr(Ln,We),Tr(Ln.prototype,{insert:function(t){this.edgeEnds.add(t)},print:function(t){t.println("EdgeEndBundle--> Label: "+this.label);for(var e=this.iterator();e.hasNext();)e.next().print(t),t.println()},iterator:function(){return this.edgeEnds.iterator()},getEdgeEnds:function(){return this.edgeEnds},computeLabelOn:function(t,e){for(var n=0,i=!1,r=this.iterator();r.hasNext();){var o=r.next(),a=o.getLabel().getLocation(t);a===S.BOUNDARY&&n++,a===S.INTERIOR&&(i=!0)}var a=S.NONE;i&&(a=S.INTERIOR),n>0&&(a=Pn.determineBoundary(e,n)),this.label.setLocation(t,a)},computeLabelSide:function(t,e){for(var n=this.iterator();n.hasNext();){var i=n.next();if(i.getLabel().isArea()){var r=i.getLabel().getLocation(t,e);if(r===S.INTERIOR)return this.label.setLocation(t,e,S.INTERIOR),null;r===S.EXTERIOR&&this.label.setLocation(t,e,S.EXTERIOR)}}},getLabel:function(){return this.label},computeLabelSides:function(t){this.computeLabelSide(t,Ae.LEFT),this.computeLabelSide(t,Ae.RIGHT)},updateIM:function(t){Tn.updateIM(this.label,t)},computeLabel:function(t){for(var e=!1,n=this.iterator();n.hasNext();)n.next().getLabel().isArea()&&(e=!0);this.label=e?new ke(S.NONE,S.NONE,S.NONE):new ke(S.NONE);for(var i=0;i<2;i++)this.computeLabelOn(i,t),e&&this.computeLabelSides(i)},interfaces_:function(){return[]},getClass:function(){return Ln}}),Pr(Nn,Ue),Tr(Nn.prototype,{updateIM:function(t){for(var e=this.iterator();e.hasNext();)e.next().updateIM(t)},insert:function(t){var e=this.edgeMap.get(t);null===e?(e=new Ln(t),this.insertEdgeEnd(t,e)):e.insert(t)},interfaces_:function(){return[]},getClass:function(){return Nn}}),Pr(kn,Xe),Tr(kn.prototype,{updateIMFromEdges:function(t){this.edges.updateIM(t)},computeIM:function(t){t.setAtLeastIfValid(this.label.getLocation(0),this.label.getLocation(1),0)},interfaces_:function(){return[]},getClass:function(){return kn}}),Pr(Rn,He),Tr(Rn.prototype,{createNode:function(t){return new kn(t,new Nn)},interfaces_:function(){return[]},getClass:function(){return Rn}}),Tr(Dn.prototype,{insertEdgeEnds:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.nodes.add(n)}},getNodeIterator:function(){return this.nodes.iterator()},copyNodesAndLabels:function(t,e){for(var n=t.getNodeIterator();n.hasNext();){var i=n.next();this.nodes.addNode(i.getCoordinate()).setLabel(e,i.getLabel().getLocation(e))}},build:function(t){this.computeIntersectionNodes(t,0),this.copyNodesAndLabels(t,0);var e=new An,n=e.computeEdgeEnds(t.getEdgeIterator());this.insertEdgeEnds(n)},computeIntersectionNodes:function(t,e){for(var n=t.getEdgeIterator();n.hasNext();)for(var i=n.next(),r=i.getLabel().getLocation(e),o=i.getEdgeIntersectionList().iterator();o.hasNext();){var a=o.next(),s=this.nodes.addNode(a.coord);r===S.BOUNDARY?s.setLabelBoundary(e):s.getLabel().isNull(e)&&s.setLabel(e,S.INTERIOR)}},interfaces_:function(){return[]},getClass:function(){return Dn}}),Tr(Fn.prototype,{isNodeEdgeAreaLabelsConsistent:function(){for(var t=this.nodeGraph.getNodeIterator();t.hasNext();){var e=t.next();if(!e.getEdges().isAreaLabelsConsistent(this.geomGraph))return this.invalidPoint=e.getCoordinate().copy(),!1}return!0},getInvalidPoint:function(){return this.invalidPoint},hasDuplicateRings:function(){for(var t=this.nodeGraph.getNodeIterator();t.hasNext();)for(var e=t.next(),n=e.getEdges().iterator();n.hasNext();){var i=n.next();if(i.getEdgeEnds().size()>1)return this.invalidPoint=i.getEdge().getCoordinate(0),!0}return!1},isNodeConsistentArea:function(){var t=this.geomGraph.computeSelfNodes(this.li,!0,!0);return t.hasProperIntersection()?(this.invalidPoint=t.getProperIntersectionPoint(),!1):(this.nodeGraph.build(this.geomGraph),this.isNodeEdgeAreaLabelsConsistent());
},interfaces_:function(){return[]},getClass:function(){return Fn}}),Tr(Bn.prototype,{getBounds:function(){},interfaces_:function(){return[]},getClass:function(){return Bn}}),Tr(jn.prototype,{getItem:function(){return this.item},getBounds:function(){return this.bounds},interfaces_:function(){return[Bn,s]},getClass:function(){return jn}}),Tr(Un.prototype,{poll:function(){if(this.isEmpty())return null;var t=this.items.get(1);return this.items.set(1,this.items.get(this._size)),this._size-=1,this.reorder(1),t},size:function(){return this._size},reorder:function(t){for(var e=null,n=this.items.get(t);2*t<=this._size&&(e=2*t,e!==this._size&&this.items.get(e+1).compareTo(this.items.get(e))<0&&e++,this.items.get(e).compareTo(n)<0);t=e)this.items.set(t,this.items.get(e));this.items.set(t,n)},clear:function(){this._size=0,this.items.clear()},isEmpty:function(){return 0===this._size},add:function(t){this.items.add(null),this._size+=1;var e=this._size;for(this.items.set(0,t);t.compareTo(this.items.get(Math.trunc(e/2)))<0;e/=2)this.items.set(e,this.items.get(Math.trunc(e/2)));this.items.set(e,t)},interfaces_:function(){return[]},getClass:function(){return Un}}),Tr(zn.prototype,{getLevel:function(){return this.level},size:function(){return this.childBoundables.size()},getChildBoundables:function(){return this.childBoundables},addChildBoundable:function(t){c.isTrue(null===this.bounds),this.childBoundables.add(t)},isEmpty:function(){return this.childBoundables.isEmpty()},getBounds:function(){return null===this.bounds&&(this.bounds=this.computeBounds()),this.bounds},interfaces_:function(){return[Bn,s]},getClass:function(){return zn}}),zn.serialVersionUID=0x5a1e55ec41369800,Tr(Gn.prototype,{expandToQueue:function(t,e){var i=Gn.isComposite(this.boundable1),r=Gn.isComposite(this.boundable2);if(i&&r)return Gn.area(this.boundable1)>Gn.area(this.boundable2)?(this.expand(this.boundable1,this.boundable2,t,e),null):(this.expand(this.boundable2,this.boundable1,t,e),null);if(i)return this.expand(this.boundable1,this.boundable2,t,e),null;if(r)return this.expand(this.boundable2,this.boundable1,t,e),null;throw new n("neither boundable is composite")},isLeaves:function(){return!(Gn.isComposite(this.boundable1)||Gn.isComposite(this.boundable2))},compareTo:function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0},expand:function(t,e,n,i){for(var r=t.getChildBoundables(),o=r.iterator();o.hasNext();){var a=o.next(),s=new Gn(a,e,this.itemDistance);s.getDistance()<i&&n.add(s)}},getBoundable:function(t){return 0===t?this.boundable1:this.boundable2},getDistance:function(){return this._distance},distance:function(){return this.isLeaves()?this.itemDistance.distance(this.boundable1,this.boundable2):this.boundable1.getBounds().distance(this.boundable2.getBounds())},interfaces_:function(){return[r]},getClass:function(){return Gn}}),Gn.area=function(t){return t.getBounds().getArea()},Gn.isComposite=function(t){return t instanceof zn},Tr(Vn.prototype,{getNodeCapacity:function(){return this.nodeCapacity},lastNode:function(t){return t.get(t.size()-1)},size:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.root));if(1===arguments.length){for(var t=arguments[0],e=0,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();i instanceof zn?e+=this.size(i):i instanceof jn&&(e+=1)}return e}},removeItem:function(t,e){for(var n=null,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof jn&&r.getItem()===e&&(n=r)}return null!==n&&(t.getChildBoundables().remove(n),!0)},itemsTree:function(){if(0===arguments.length){this.build();var t=this.itemsTree(this.root);return null===t?new _:t}if(1===arguments.length){for(var e=arguments[0],n=new _,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof zn){var o=this.itemsTree(r);null!==o&&n.add(o)}else r instanceof jn?n.add(r.getItem()):c.shouldNeverReachHere()}return n.size()<=0?null:n}},insert:function(t,e){c.isTrue(!this.built,"Cannot insert items into an STR packed R-tree after it has been built."),this.itemBoundables.add(new jn(t,e))},boundablesAtLevel:function(){if(1===arguments.length){var t=arguments[0],e=new _;return this.boundablesAtLevel(t,this.root,e),e}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(c.isTrue(n>-2),i.getLevel()===n)return r.add(i),null;for(var o=i.getChildBoundables().iterator();o.hasNext();){var a=o.next();a instanceof zn?this.boundablesAtLevel(n,a,r):(c.isTrue(a instanceof jn),n===-1&&r.add(a))}return null}},query:function(){if(1===arguments.length){var t=arguments[0];this.build();var e=new _;return this.isEmpty()?e:(this.getIntersectsOp().intersects(this.root.getBounds(),t)&&this.query(t,this.root,e),e)}if(2===arguments.length){var n=arguments[0],i=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.root.getBounds(),n)&&this.query(n,this.root,i)}else if(3===arguments.length)if(Lr(arguments[2],ve)&&arguments[0]instanceof Object&&arguments[1]instanceof zn)for(var r=arguments[0],o=arguments[1],a=arguments[2],s=o.getChildBoundables(),u=0;u<s.size();u++){var l=s.get(u);this.getIntersectsOp().intersects(l.getBounds(),r)&&(l instanceof zn?this.query(r,l,a):l instanceof jn?a.visitItem(l.getItem()):c.shouldNeverReachHere())}else if(Lr(arguments[2],v)&&arguments[0]instanceof Object&&arguments[1]instanceof zn)for(var h=arguments[0],f=arguments[1],d=arguments[2],s=f.getChildBoundables(),u=0;u<s.size();u++){var l=s.get(u);this.getIntersectsOp().intersects(l.getBounds(),h)&&(l instanceof zn?this.query(h,l,d):l instanceof jn?d.add(l.getItem()):c.shouldNeverReachHere())}},build:function(){return this.built?null:(this.root=this.itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this.itemBoundables,-1),this.itemBoundables=null,this.built=!0,void 0)},getRoot:function(){return this.build(),this.root},remove:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.root.getBounds(),t)&&this.remove(t,this.root,e)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],o=this.removeItem(i,r);if(o)return!0;for(var a=null,s=i.getChildBoundables().iterator();s.hasNext();){var u=s.next();if(this.getIntersectsOp().intersects(u.getBounds(),n)&&u instanceof zn&&(o=this.remove(n,u,r))){a=u;break}}return null!==a&&a.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(a),o}},createHigherLevels:function(t,e){c.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},depth:function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.root));if(1===arguments.length){for(var t=arguments[0],e=0,n=t.getChildBoundables().iterator();n.hasNext();){var i=n.next();if(i instanceof zn){var r=this.depth(i);r>e&&(e=r)}}return e+1}},createParentBoundables:function(t,e){c.isTrue(!t.isEmpty());var n=new _;n.add(this.createNode(e));var i=new _(t);Jr.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var o=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(e)),this.lastNode(n).addChildBoundable(o)}return n},isEmpty:function(){return this.built?this.root.isEmpty():this.itemBoundables.isEmpty()},interfaces_:function(){return[s]},getClass:function(){return Vn}}),Vn.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},Vn.IntersectsOp=Xn,Vn.serialVersionUID=-0x35ef64c82d4c5400,Vn.DEFAULT_NODE_CAPACITY=10,Tr(Hn.prototype,{distance:function(t,e){},interfaces_:function(){return[]},getClass:function(){return Hn}}),Pr(qn,Vn),Tr(qn.prototype,{createParentBoundablesFromVerticalSlices:function(t,e){c.isTrue(t.length>0);for(var n=new _,i=0;i<t.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[i],e));return n},createNode:function(t){return new Yn(t)},size:function(){return 0===arguments.length?Vn.prototype.size.call(this):Vn.prototype.size.apply(this,arguments)},insert:function(){if(2!==arguments.length)return Vn.prototype.insert.apply(this,arguments);var t=arguments[0],e=arguments[1];return t.isNull()?null:void Vn.prototype.insert.call(this,t,e)},getIntersectsOp:function(){return qn.intersectsOp},verticalSlices:function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),i=new Array(e).fill(null),r=t.iterator(),o=0;o<e;o++){i[o]=new _;for(var a=0;r.hasNext()&&a<n;){var s=r.next();i[o].add(s),a++}}return i},query:function(){if(1===arguments.length){var t=arguments[0];return Vn.prototype.query.call(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];Vn.prototype.query.call(this,e,n)}else if(3===arguments.length)if(Lr(arguments[2],ve)&&arguments[0]instanceof Object&&arguments[1]instanceof zn){var i=arguments[0],r=arguments[1],o=arguments[2];Vn.prototype.query.call(this,i,r,o)}else if(Lr(arguments[2],v)&&arguments[0]instanceof Object&&arguments[1]instanceof zn){var a=arguments[0],s=arguments[1],u=arguments[2];Vn.prototype.query.call(this,a,s,u)}},getComparator:function(){return qn.yComparator},createParentBoundablesFromVerticalSlice:function(t,e){return Vn.prototype.createParentBoundables.call(this,t,e)},remove:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return Vn.prototype.remove.call(this,t,e)}return Vn.prototype.remove.apply(this,arguments)},depth:function(){return 0===arguments.length?Vn.prototype.depth.call(this):Vn.prototype.depth.apply(this,arguments)},createParentBoundables:function(t,e){c.isTrue(!t.isEmpty());var n=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),i=new _(t);Jr.sort(i,qn.xComparator);var r=this.verticalSlices(i,Math.trunc(Math.ceil(Math.sqrt(n))));return this.createParentBoundablesFromVerticalSlices(r,e)},nearestNeighbour:function(){if(1===arguments.length){if(Lr(arguments[0],Hn)){var t=arguments[0],e=new Gn(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(e)}if(arguments[0]instanceof Gn){var n=arguments[0];return this.nearestNeighbour(n,i.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof qn&&Lr(arguments[1],Hn)){var r=arguments[0],o=arguments[1],e=new Gn(this.getRoot(),r.getRoot(),o);return this.nearestNeighbour(e)}if(arguments[0]instanceof Gn&&"number"==typeof arguments[1]){var a=arguments[0],s=arguments[1],u=s,l=null,c=new Un;for(c.add(a);!c.isEmpty()&&u>0;){var h=c.poll(),f=h.getDistance();if(f>=u)break;h.isLeaves()?(u=f,l=h):h.expandToQueue(c,u)}return[l.getBoundable(0).getItem(),l.getBoundable(1).getItem()]}}else if(3===arguments.length){var d=arguments[0],p=arguments[1],g=arguments[2],v=new jn(d,p),e=new Gn(this.getRoot(),v,g);return this.nearestNeighbour(e)[0]}},interfaces_:function(){return[ge,s]},getClass:function(){return qn}}),qn.centreX=function(t){return qn.avg(t.getMinX(),t.getMaxX())},qn.avg=function(t,e){return(t+e)/2},qn.centreY=function(t){return qn.avg(t.getMinY(),t.getMaxY())},Pr(Yn,zn),Tr(Yn.prototype,{computeBounds:function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new x(n.getBounds()):t.expandToInclude(n.getBounds())}return t},interfaces_:function(){return[]},getClass:function(){return Yn}}),qn.STRtreeNode=Yn,qn.serialVersionUID=0x39920f7d5f261e0,qn.xComparator={interfaces_:function(){return[a]},compare:function(t,e){return Vn.compareDoubles(qn.centreX(t.getBounds()),qn.centreX(e.getBounds()))}},qn.yComparator={interfaces_:function(){return[a]},compare:function(t,e){return Vn.compareDoubles(qn.centreY(t.getBounds()),qn.centreY(e.getBounds()))}},qn.intersectsOp={interfaces_:function(){return[IntersectsOp]},intersects:function(t,e){return t.intersects(e)}},qn.DEFAULT_NODE_CAPACITY=10,Tr(Wn.prototype,{buildIndex:function(){this.index=new qn;for(var t=0;t<this.rings.size();t++){var e=this.rings.get(t),n=e.getEnvelopeInternal();this.index.insert(n,e)}},getNestedPoint:function(){return this.nestedPt},isNonNested:function(){this.buildIndex();for(var t=0;t<this.rings.size();t++)for(var e=this.rings.get(t),n=e.getCoordinates(),i=this.index.query(e.getEnvelopeInternal()),r=0;r<i.size();r++){var o=i.get(r),a=o.getCoordinates();if(e!==o&&e.getEnvelopeInternal().intersects(o.getEnvelopeInternal())){var s=Jn.findPtNotNode(n,o,this.graph);if(null!==s){var u=ae.isPointInRing(s,a);if(u)return this.nestedPt=s,!1}}}return!0},add:function(t){this.rings.add(t),this.totalEnv.expandToInclude(t.getEnvelopeInternal())},interfaces_:function(){return[]},getClass:function(){return Wn}}),Tr(Zn.prototype,{getErrorType:function(){return this.errorType},getMessage:function(){return Zn.errMsg[this.errorType]},getCoordinate:function(){return this.pt},toString:function(){var t="";return null!==this.pt&&(t=" at or near point "+this.pt),this.getMessage()+t},interfaces_:function(){return[]},getClass:function(){return Zn}}),Zn.ERROR=0,Zn.REPEATED_POINT=1,Zn.HOLE_OUTSIDE_SHELL=2,Zn.NESTED_HOLES=3,Zn.DISCONNECTED_INTERIOR=4,Zn.SELF_INTERSECTION=5,Zn.RING_SELF_INTERSECTION=6,Zn.NESTED_SHELLS=7,Zn.DUPLICATE_RINGS=8,Zn.TOO_FEW_POINTS=9,Zn.INVALID_COORDINATE=10,Zn.RING_NOT_CLOSED=11,Zn.errMsg=["Topology Validation Error","Repeated Point","Hole lies outside shell","Holes are nested","Interior is disconnected","Self-intersection","Ring Self-intersection","Nested shells","Duplicate Rings","Too few distinct points in geometry component","Invalid Coordinate","Ring is not closed"],Tr(Jn.prototype,{checkInvalidCoordinates:function(){if(arguments[0]instanceof Array){for(var t=arguments[0],e=0;e<t.length;e++)if(!Jn.isValid(t[e]))return this.validErr=new Zn(Zn.INVALID_COORDINATE,t[e]),null}else if(arguments[0]instanceof Mt){var n=arguments[0];if(this.checkInvalidCoordinates(n.getExteriorRing().getCoordinates()),null!==this.validErr)return null;for(var e=0;e<n.getNumInteriorRing();e++)if(this.checkInvalidCoordinates(n.getInteriorRingN(e).getCoordinates()),null!==this.validErr)return null}},checkHolesNotNested:function(t,e){for(var n=new Wn(e),i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);n.add(r)}n.isNonNested()||(this.validErr=new Zn(Zn.NESTED_HOLES,n.getNestedPoint()))},checkConsistentArea:function(t){var e=new Fn(t);return e.isNodeConsistentArea()?void(e.hasDuplicateRings()&&(this.validErr=new Zn(Zn.DUPLICATE_RINGS,e.getInvalidPoint()))):(this.validErr=new Zn(Zn.SELF_INTERSECTION,e.getInvalidPoint()),null)},isValid:function(){return this.checkValid(this.parentGeometry),null===this.validErr},checkShellInsideHole:function(t,e,n){var i=t.getCoordinates(),r=e.getCoordinates(),o=Jn.findPtNotNode(i,e,n);if(null!==o&&!ae.isPointInRing(o,r))return o;var a=Jn.findPtNotNode(r,t,n);return null!==a?ae.isPointInRing(a,i)?a:null:(c.shouldNeverReachHere("points in shell and hole appear to be equal"),null)},checkNoSelfIntersectingRings:function(t){for(var e=t.getEdgeIterator();e.hasNext();){var n=e.next();if(this.checkNoSelfIntersectingRing(n.getEdgeIntersectionList()),null!==this.validErr)return null}},checkConnectedInteriors:function(t){var e=new Ke(t);e.isInteriorsConnected()||(this.validErr=new Zn(Zn.DISCONNECTED_INTERIOR,e.getCoordinate()))},checkNoSelfIntersectingRing:function(t){for(var e=new rt,n=!0,i=t.iterator();i.hasNext();){var r=i.next();if(n)n=!1;else{if(e.contains(r.coord))return this.validErr=new Zn(Zn.RING_SELF_INTERSECTION,r.coord),null;e.add(r.coord)}}},checkHolesInShell:function(t,e){for(var n=t.getExteriorRing(),i=new ln(n),r=0;r<t.getNumInteriorRing();r++){var o=t.getInteriorRingN(r),a=Jn.findPtNotNode(o.getCoordinates(),n,e);if(null===a)return null;if(!i.isInside(a))return this.validErr=new Zn(Zn.HOLE_OUTSIDE_SHELL,a),null}},checkTooFewPoints:function(t){if(t.hasTooFewPoints())return this.validErr=new Zn(Zn.TOO_FEW_POINTS,t.getInvalidPoint()),null},getValidationError:function(){return this.checkValid(this.parentGeometry),this.validErr},checkValid:function(){if(arguments[0]instanceof Et){var t=arguments[0];this.checkInvalidCoordinates(t.getCoordinates())}else if(arguments[0]instanceof Ct){var e=arguments[0];this.checkInvalidCoordinates(e.getCoordinates())}else if(arguments[0]instanceof It){var n=arguments[0];if(this.checkInvalidCoordinates(n.getCoordinates()),null!==this.validErr)return null;if(this.checkClosedRing(n),null!==this.validErr)return null;var i=new Pn(0,n);if(this.checkTooFewPoints(i),null!==this.validErr)return null;var r=new ie;i.computeSelfNodes(r,!0,!0),this.checkNoSelfIntersectingRings(i)}else if(arguments[0]instanceof xt){var o=arguments[0];if(this.checkInvalidCoordinates(o.getCoordinates()),null!==this.validErr)return null;var i=new Pn(0,o);this.checkTooFewPoints(i)}else if(arguments[0]instanceof Mt){var a=arguments[0];if(this.checkInvalidCoordinates(a),null!==this.validErr)return null;if(this.checkClosedRings(a),null!==this.validErr)return null;var i=new Pn(0,a);if(this.checkTooFewPoints(i),null!==this.validErr)return null;if(this.checkConsistentArea(i),null!==this.validErr)return null;if(!this.isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(i),null!==this.validErr))return null;if(this.checkHolesInShell(a,i),null!==this.validErr)return null;if(this.checkHolesNotNested(a,i),null!==this.validErr)return null;this.checkConnectedInteriors(i)}else if(arguments[0]instanceof Ot){for(var s=arguments[0],u=0;u<s.getNumGeometries();u++){var l=s.getGeometryN(u);if(this.checkInvalidCoordinates(l),null!==this.validErr)return null;if(this.checkClosedRings(l),null!==this.validErr)return null}var i=new Pn(0,s);if(this.checkTooFewPoints(i),null!==this.validErr)return null;if(this.checkConsistentArea(i),null!==this.validErr)return null;if(!this.isSelfTouchingRingFormingHoleValid&&(this.checkNoSelfIntersectingRings(i),null!==this.validErr))return null;for(var u=0;u<s.getNumGeometries();u++){var l=s.getGeometryN(u);if(this.checkHolesInShell(l,i),null!==this.validErr)return null}for(var u=0;u<s.getNumGeometries();u++){var l=s.getGeometryN(u);if(this.checkHolesNotNested(l,i),null!==this.validErr)return null}if(this.checkShellsNotNested(s,i),null!==this.validErr)return null;this.checkConnectedInteriors(i)}else if(arguments[0]instanceof lt)for(var c=arguments[0],u=0;u<c.getNumGeometries();u++){var h=c.getGeometryN(u);if(this.checkValid(h),null!==this.validErr)return null}else if(arguments[0]instanceof D){var f=arguments[0];if(this.validErr=null,f.isEmpty())return null;if(f instanceof Et)this.checkValid(f);else if(f instanceof Ct)this.checkValid(f);else if(f instanceof It)this.checkValid(f);else if(f instanceof xt)this.checkValid(f);else if(f instanceof Mt)this.checkValid(f);else if(f instanceof Ot)this.checkValid(f);else{if(!(f instanceof lt))throw new UnsupportedOperationException(f.getClass().getName());this.checkValid(f)}}},setSelfTouchingRingFormingHoleValid:function(t){this.isSelfTouchingRingFormingHoleValid=t},checkShellNotNested:function(t,e,n){var i=t.getCoordinates(),r=e.getExteriorRing(),o=r.getCoordinates(),a=Jn.findPtNotNode(i,r,n);if(null===a)return null;if(!ae.isPointInRing(a,o))return null;if(e.getNumInteriorRing()<=0)return this.validErr=new Zn(Zn.NESTED_SHELLS,a),null;for(var s=null,u=0;u<e.getNumInteriorRing();u++){var l=e.getInteriorRingN(u);if(null===(s=this.checkShellInsideHole(t,l,n)))return null}this.validErr=new Zn(Zn.NESTED_SHELLS,s)},checkClosedRings:function(t){if(this.checkClosedRing(t.getExteriorRing()),null!==this.validErr)return null;for(var e=0;e<t.getNumInteriorRing();e++)if(this.checkClosedRing(t.getInteriorRingN(e)),null!==this.validErr)return null},checkClosedRing:function(t){if(!t.isClosed()){var e=null;t.getNumPoints()>=1&&(e=t.getCoordinateN(0)),this.validErr=new Zn(Zn.RING_NOT_CLOSED,e)}},checkShellsNotNested:function(t,e){for(var n=0;n<t.getNumGeometries();n++)for(var i=t.getGeometryN(n),r=i.getExteriorRing(),o=0;o<t.getNumGeometries();o++)if(n!==o){var a=t.getGeometryN(o);if(this.checkShellNotNested(r,a,e),null!==this.validErr)return null}},interfaces_:function(){return[]},getClass:function(){return Jn}}),Jn.findPtNotNode=function(t,e,n){for(var i=n.findEdge(e),r=i.getEdgeIntersectionList(),o=0;o<t.length;o++){var a=t[o];if(!r.isIntersection(a))return a}return null},Jn.isValid=function(){if(arguments[0]instanceof D)return new Jn(arguments[0]).isValid();if(arguments[0]instanceof h){var t=arguments[0];return!(i.isNaN(t.x)||i.isInfinite(t.x)||i.isNaN(t.y)||i.isInfinite(t.y))}},Tr(Kn.prototype,{transformPoint:function(t,e){return this.factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},transformPolygon:function(t,e){var n=!0,i=this.transformLinearRing(t.getExteriorRing(),t);null!==i&&i instanceof It&&!i.isEmpty()||(n=!1);for(var r=new _,o=0;o<t.getNumInteriorRing();o++){var a=this.transformLinearRing(t.getInteriorRingN(o),t);null===a||a.isEmpty()||(a instanceof It||(n=!1),r.add(a))}if(n)return this.factory.createPolygon(i,r.toArray([]));var s=new _;return null!==i&&s.add(i),s.addAll(r),this.factory.buildGeometry(s)},createCoordinateSequence:function(t){return this.factory.getCoordinateSequenceFactory().create(t)},getInputGeometry:function(){return this.inputGeom},transformMultiLineString:function(t,e){for(var n=new _,i=0;i<t.getNumGeometries();i++){var r=this.transformLineString(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.factory.buildGeometry(n)},transformCoordinates:function(t,e){return this.copy(t)},transformLineString:function(t,e){return this.factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},transformMultiPoint:function(t,e){for(var n=new _,i=0;i<t.getNumGeometries();i++){var r=this.transformPoint(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.factory.buildGeometry(n)},transformMultiPolygon:function(t,e){for(var n=new _,i=0;i<t.getNumGeometries();i++){var r=this.transformPolygon(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.factory.buildGeometry(n)},copy:function(t){return t.copy()},transformGeometryCollection:function(t,e){for(var n=new _,i=0;i<t.getNumGeometries();i++){var r=this.transform(t.getGeometryN(i));null!==r&&(this.pruneEmptyGeometry&&r.isEmpty()||n.add(r))}return this.preserveGeometryCollectionType?this.factory.createGeometryCollection($t.toGeometryArray(n)):this.factory.buildGeometry(n)},transform:function(t){if(this.inputGeom=t,this.factory=t.getFactory(),t instanceof Et)return this.transformPoint(t,null);if(t instanceof Ct)return this.transformMultiPoint(t,null);if(t instanceof It)return this.transformLinearRing(t,null);if(t instanceof xt)return this.transformLineString(t,null);if(t instanceof ct)return this.transformMultiLineString(t,null);if(t instanceof Mt)return this.transformPolygon(t,null);if(t instanceof Ot)return this.transformMultiPolygon(t,null);if(t instanceof lt)return this.transformGeometryCollection(t,null);throw new n("Unknown Geometry subtype: "+t.getClass().getName())},transformLinearRing:function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this.factory.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this.preserveType?this.factory.createLineString(n):this.factory.createLinearRing(n)},interfaces_:function(){return[]},getClass:function(){return Kn}}),Tr(Qn.prototype,{snapVertices:function(t,e){for(var n=this._isClosed?t.size()-1:t.size(),i=0;i<n;i++){var r=t.get(i),o=this.findSnapForVertex(r,e);null!==o&&(t.set(i,new h(o)),0===i&&this._isClosed&&t.set(t.size()-1,new h(o)))}},findSnapForVertex:function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this.snapTolerance)return e[n]}return null},snapTo:function(t){var e=new b(this.srcPts);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},snapSegments:function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var i=0;i<n;i++){var r=e[i],o=this.findSegmentIndexToSnap(r,t);o>=0&&t.add(o+1,new h(r),!1)}},findSegmentIndexToSnap:function(t,e){for(var n=i.MAX_VALUE,r=-1,o=0;o<e.size()-1;o++){if(this.seg.p0=e.get(o),this.seg.p1=e.get(o+1),this.seg.p0.equals2D(t)||this.seg.p1.equals2D(t)){if(this.allowSnappingToSourceVertices)continue;return-1}var a=this.seg.distance(t);a<this.snapTolerance&&a<n&&(n=a,r=o)}return r},setAllowSnappingToSourceVertices:function(t){this.allowSnappingToSourceVertices=t},interfaces_:function(){return[]},getClass:function(){return Qn}}),Qn.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])},Tr($n.prototype,{snapTo:function(t,e){return new ti(e,this.extractTargetCoordinates(t)).transform(this.srcGeom)},snapToSelf:function(t,e){var n=this.extractTargetCoordinates(this.srcGeom),i=new ti(t,n,!0),r=i.transform(this.srcGeom),o=r;return e&&Lr(o,St)&&(o=r.buffer(0)),o},computeSnapTolerance:function(t){return this.computeMinimumSegmentLength(t)/10},extractTargetCoordinates:function(t){for(var e=new rt,n=t.getCoordinates(),i=0;i<n.length;i++)e.add(n[i]);return e.toArray(new Array(0).fill(null))},computeMinimumSegmentLength:function(t){for(var e=i.MAX_VALUE,n=0;n<t.length-1;n++){var r=t[n].distance(t[n+1]);r<e&&(e=r)}return e},interfaces_:function(){return[]},getClass:function(){return $n}}),$n.snap=function(t,e,n){var i=new Array(2).fill(null),r=new $n(t);i[0]=r.snapTo(e,n);var o=new $n(e);return i[1]=o.snapTo(i[0],n),i},$n.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=$n.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===Kt.FIXED){var i=1/n.getScale()*2/1.415;i>e&&(e=i)}return e}if(2===arguments.length){var r=arguments[0],o=arguments[1];return Math.min($n.computeOverlaySnapTolerance(r),$n.computeOverlaySnapTolerance(o))}},$n.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*$n.SNAP_PRECISION_FACTOR},$n.snapToSelf=function(t,e,n){return new $n(t).snapToSelf(e,n)},$n.SNAP_PRECISION_FACTOR=1e-9,Pr(ti,Kn),Tr(ti.prototype,{snapLine:function(t,e){var n=new Qn(t,this.snapTolerance);return n.setAllowSnappingToSourceVertices(this.isSelfSnap),n.snapTo(e)},transformCoordinates:function(t,e){var n=t.toCoordinateArray(),i=this.snapLine(n,this.snapPts);return this.factory.getCoordinateSequenceFactory().create(i)},interfaces_:function(){return[]},getClass:function(){return ti}}),Tr(ei.prototype,{getCommon:function(){return i.longBitsToDouble(this.commonBits)},add:function(t){var e=i.doubleToLongBits(t);return this.isFirst?(this.commonBits=e,this.commonSignExp=ei.signExpBits(this.commonBits),this.isFirst=!1,null):ei.signExpBits(e)!==this.commonSignExp?(this.commonBits=0,null):(this.commonMantissaBitsCount=ei.numCommonMostSigMantissaBits(this.commonBits,e),void(this.commonBits=ei.zeroLowerBits(this.commonBits,64-(12+this.commonMantissaBitsCount))))},toString:function(){if(1===arguments.length){var t=arguments[0],e=i.longBitsToDouble(t),n=Long.toBinaryString(t),r="0000000000000000000000000000000000000000000000000000000000000000"+n,o=r.substring(r.length-64);return o.substring(0,1)+"  "+o.substring(1,12)+"(exp) "+o.substring(12)+" [ "+e+" ]"}},interfaces_:function(){return[]},getClass:function(){return ei}}),ei.getBit=function(t,e){return 0!=(t&1<<e)?1:0},ei.signExpBits=function(t){return t>>52},ei.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},ei.numCommonMostSigMantissaBits=function(t,e){for(var n=0,i=52;i>=0;i--){if(ei.getBit(t,i)!==ei.getBit(e,i))return n;n++}return 52},Tr(ni.prototype,{addCommonBits:function(t){var e=new ri(this.commonCoord);t.apply(e),t.geometryChanged()},removeCommonBits:function(t){if(0===this.commonCoord.x&&0===this.commonCoord.y)return t;var e=new h(this.commonCoord);e.x=-e.x,e.y=-e.y;var n=new ri(e);return t.apply(n),t.geometryChanged(),t},getCommonCoordinate:function(){return this.commonCoord},add:function(t){t.apply(this.ccFilter),this.commonCoord=this.ccFilter.getCommonCoordinate()},interfaces_:function(){return[]},getClass:function(){return ni}}),Tr(ii.prototype,{filter:function(t){this.commonBitsX.add(t.x),this.commonBitsY.add(t.y)},getCommonCoordinate:function(){return new h(this.commonBitsX.getCommon(),this.commonBitsY.getCommon())},interfaces_:function(){return[F]},getClass:function(){return ii}}),Tr(ri.prototype,{filter:function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,i=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,i)},isDone:function(){return!1},isGeometryChanged:function(){return!0},interfaces_:function(){return[ut]},getClass:function(){return ri}}),ni.CommonCoordinateFilter=ii,ni.Translater=ri,Tr(oi.prototype,{interfaces_:function(){return[]},getClass:function(){return oi}}),oi.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new n("Cannot compute the octant for point ( "+t+", "+e+" )");var i=Math.abs(t),r=Math.abs(e);return t>=0?e>=0?i>=r?0:1:i>=r?7:6:e>=0?i>=r?3:2:i>=r?4:5}if(arguments[0]instanceof h&&arguments[1]instanceof h){var o=arguments[0],a=arguments[1],s=a.x-o.x,u=a.y-o.y;if(0===s&&0===u)throw new n("Cannot compute the octant for two identical points "+o);return oi.octant(s,u)}},Tr(ai.prototype,{getCoordinates:function(){},size:function(){},getCoordinate:function(t){},isClosed:function(){},setData:function(t){},getData:function(){},interfaces_:function(){return[]},getClass:function(){return ai}}),Tr(si.prototype,{getCoordinates:function(){return this.pts},size:function(){return this.pts.length},getCoordinate:function(t){return this.pts[t]},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getSegmentOctant:function(t){return t===this.pts.length-1?-1:oi.octant(this.getCoordinate(t),this.getCoordinate(t+1))},setData:function(t){this.data=t},getData:function(){return this.data},toString:function(){return ee.toLineString(new kt(this.pts))},interfaces_:function(){return[ai]},getClass:function(){return si}}),Tr(ui.prototype,{interfaces_:function(){return[]},getClass:function(){return ui}}),ui.relativeSign=function(t,e){return t<e?-1:t>e?1:0},ui.compare=function(t,e,n){if(e.equals2D(n))return 0;var i=ui.relativeSign(e.x,n.x),r=ui.relativeSign(e.y,n.y);switch(t){case 0:return ui.compareValue(i,r);case 1:return ui.compareValue(r,i);case 2:return ui.compareValue(r,-i);case 3:return ui.compareValue(-i,r);case 4:return ui.compareValue(-i,-r);case 5:return ui.compareValue(-r,-i);case 6:return ui.compareValue(-r,i);case 7:return ui.compareValue(i,-r)}return c.shouldNeverReachHere("invalid octant value"),0},ui.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0},Tr(li.prototype,{getCoordinate:function(){return this.coord},print:function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},compareTo:function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:ui.compare(this.segmentOctant,this.coord,e.coord)},isEndPoint:function(t){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===t},isInterior:function(){return this._isInterior},interfaces_:function(){return[r]},getClass:function(){return li}});Tr(ci.prototype,{getSplitCoordinates:function(){var t=new b;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next();this.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()},addCollapsedNodes:function(){var t=new _;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this.edge.getCoordinate(n),n)}},print:function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},findCollapsesFromExistingVertices:function(t){for(var e=0;e<this.edge.size()-2;e++){var n=this.edge.getCoordinate(e),i=(this.edge.getCoordinate(e+1),this.edge.getCoordinate(e+2));n.equals2D(i)&&t.add(new I(e+1))}},addEdgeCoordinates:function(t,e,n){var i=e.segmentIndex-t.segmentIndex+2,r=this.edge.getCoordinate(e.segmentIndex),o=e.isInterior()||!e.coord.equals2D(r);o||i--,n.add(new h(t.coord),!1);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)n.add(this.edge.getCoordinate(a));
o&&n.add(new h(e.coord))},iterator:function(){return this.nodeMap.values().iterator()},addSplitEdges:function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},findCollapseIndex:function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,1===i&&(n[0]=t.segmentIndex+1,!0)},findCollapsesFromInsertedNodes:function(t){for(var e=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,e)&&t.add(new I(e[0])),i=r}},getEdge:function(){return this.edge},addEndpoints:function(){var t=this.edge.size()-1;this.add(this.edge.getCoordinate(0),0),this.add(this.edge.getCoordinate(t),t)},createSplitEdge:function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.edge.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);r||n--;var o=new Array(n).fill(null),a=0;o[a++]=new h(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)o[a++]=this.edge.getCoordinate(s);return r&&(o[a]=new h(e.coord)),new di(o,this.edge.getData())},add:function(t,e){var n=new li(this.edge,t,e,this.edge.getSegmentOctant(e)),i=this.nodeMap.get(n);return null!==i?(c.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this.nodeMap.put(n,n),n)},checkSplitEdgesCorrectness:function(t){var e=this.edge.getCoordinates(),n=t.get(0),i=n.getCoordinate(0);if(!i.equals2D(e[0]))throw new u("bad split edge start point at "+i);var r=t.get(t.size()-1),o=r.getCoordinates(),a=o[o.length-1];if(!a.equals2D(e[e.length-1]))throw new u("bad split edge end point at "+a)},interfaces_:function(){return[]},getClass:function(){return ci}}),Tr(hi.prototype,{next:function(){return null===this.currNode?(this.currNode=this.nextNode,this.currSegIndex=this.currNode.segmentIndex,this.readNextNode(),this.currNode):null===this.nextNode?null:this.nextNode.segmentIndex===this.currNode.segmentIndex?(this.currNode=this.nextNode,this.currSegIndex=this.currNode.segmentIndex,this.readNextNode(),this.currNode):(this.nextNode.segmentIndex,this.currNode.segmentIndex,null)},remove:function(){throw new UnsupportedOperationException(this.getClass().getName())},hasNext:function(){return null!==this.nextNode},readNextNode:function(){this.nodeIt.hasNext()?this.nextNode=this.nodeIt.next():this.nextNode=null},interfaces_:function(){return[d]},getClass:function(){return hi}}),Tr(fi.prototype,{addIntersection:function(t,e){},interfaces_:function(){return[ai]},getClass:function(){return fi}}),Tr(di.prototype,{getCoordinates:function(){return this.pts},size:function(){return this.pts.length},getCoordinate:function(t){return this.pts[t]},isClosed:function(){return this.pts[0].equals(this.pts[this.pts.length-1])},getSegmentOctant:function(t){return t===this.pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},setData:function(t){this.data=t},safeOctant:function(t,e){return t.equals2D(e)?0:oi.octant(t,e)},getData:function(){return this.data},addIntersection:function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=(arguments[2],arguments[3]),o=new h(n.getIntersection(r));this.addIntersection(o,i)}},toString:function(){return ee.toLineString(new kt(this.pts))},getNodeList:function(){return this.nodeList},addIntersectionNode:function(t,e){var n=e,i=n+1;if(i<this.pts.length){var r=this.pts[i];t.equals2D(r)&&(n=i)}return this.nodeList.add(t,n)},addIntersections:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},interfaces_:function(){return[fi]},getClass:function(){return di}}),di.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new _;return di.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var o=r.next();o.getNodeList().addSplitEdges(i)}},Tr(pi.prototype,{overlap:function(){if(2===arguments.length)arguments[0],arguments[1];else if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];t.getLineSegment(e,this.overlapSeg1),n.getLineSegment(i,this.overlapSeg2),this.overlap(this.overlapSeg1,this.overlapSeg2)}},interfaces_:function(){return[]},getClass:function(){return pi}}),Tr(gi.prototype,{computeNodes:function(t){},getNodedSubstrings:function(){},interfaces_:function(){return[]},getClass:function(){return gi}}),Tr(vi.prototype,{setSegmentIntersector:function(t){this.segInt=t},interfaces_:function(){return[gi]},getClass:function(){return vi}}),Pr(mi,vi),Tr(mi.prototype,{getMonotoneChains:function(){return this.monoChains},getNodedSubstrings:function(){return di.getNodedSubstrings(this.nodedSegStrings)},getIndex:function(){return this.index},add:function(t){for(var e=sn.getChains(t.getCoordinates(),t),n=e.iterator();n.hasNext();){var i=n.next();i.setId(this.idCounter++),this.index.insert(i.getEnvelope(),i),this.monoChains.add(i)}},computeNodes:function(t){this.nodedSegStrings=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},intersectChains:function(){for(var t=new yi(this.segInt),e=this.monoChains.iterator();e.hasNext();)for(var n=e.next(),i=this.index.query(n.getEnvelope()),r=i.iterator();r.hasNext();){var o=r.next();if(o.getId()>n.getId()&&(n.computeOverlaps(o,t),this.nOverlaps++),this.segInt.isDone())return null}},interfaces_:function(){return[]},getClass:function(){return mi}}),Pr(yi,pi),Tr(yi.prototype,{overlap:function(){if(4!==arguments.length)return pi.prototype.overlap.apply(this,arguments);var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3],r=t.getContext(),o=n.getContext();this.si.processIntersections(r,e,o,i)},interfaces_:function(){return[]},getClass:function(){return yi}}),mi.SegmentOverlapAction=yi,Tr(_i.prototype,{processIntersections:function(t,e,n,i){},isDone:function(){},interfaces_:function(){return[]},getClass:function(){return _i}}),Tr(bi.prototype,{getInteriorIntersection:function(){return this.interiorIntersection},setCheckEndSegmentsOnly:function(t){this.isCheckEndSegmentsOnly=t},getIntersectionSegments:function(){return this.intSegments},count:function(){return this.intersectionCount},getIntersections:function(){return this.intersections},setFindAllIntersections:function(t){this.findAllIntersections=t},setKeepIntersections:function(t){this.keepIntersections=t},processIntersections:function(t,e,n,i){if(!this.findAllIntersections&&this.hasIntersection())return null;if(t===n&&e===i)return null;if(this.isCheckEndSegmentsOnly&&!this.isEndSegment(t,e)&&!this.isEndSegment(n,i))return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],s=n.getCoordinates()[i+1];this.li.computeIntersection(r,o,a,s),this.li.hasIntersection()&&this.li.isInteriorIntersection()&&(this.intSegments=new Array(4).fill(null),this.intSegments[0]=r,this.intSegments[1]=o,this.intSegments[2]=a,this.intSegments[3]=s,this.interiorIntersection=this.li.getIntersection(0),this.keepIntersections&&this.intersections.add(this.interiorIntersection),this.intersectionCount++)},isEndSegment:function(t,e){return 0===e||e>=t.size()-2},hasIntersection:function(){return null!==this.interiorIntersection},isDone:function(){return!this.findAllIntersections&&null!==this.interiorIntersection},interfaces_:function(){return[_i]},getClass:function(){return bi}}),bi.createAllIntersectionsFinder=function(t){var e=new bi(t);return e.setFindAllIntersections(!0),e},bi.createAnyIntersectionFinder=function(t){return new bi(t)},bi.createIntersectionCounter=function(t){var e=new bi(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e},Tr(xi.prototype,{execute:function(){return null!==this.segInt?null:void this.checkInteriorIntersections()},getIntersections:function(){return this.segInt.getIntersections()},isValid:function(){return this.execute(),this._isValid},setFindAllIntersections:function(t){this.findAllIntersections=t},checkInteriorIntersections:function(){this._isValid=!0,this.segInt=new bi(this.li),this.segInt.setFindAllIntersections(this.findAllIntersections);var t=new mi;if(t.setSegmentIntersector(this.segInt),t.computeNodes(this.segStrings),this.segInt.hasIntersection())return this._isValid=!1,null},checkValid:function(){if(this.execute(),!this._isValid)throw new Le(this.getErrorMessage(),this.segInt.getInteriorIntersection())},getErrorMessage:function(){if(this._isValid)return"no intersections found";var t=this.segInt.getIntersectionSegments();return"found non-noded intersection between "+ee.toLineString(t[0],t[1])+" and "+ee.toLineString(t[2],t[3])},interfaces_:function(){return[]},getClass:function(){return xi}}),xi.computeIntersections=function(t){var e=new xi(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()},Tr(wi.prototype,{checkValid:function(){this.nv.checkValid()},interfaces_:function(){return[]},getClass:function(){return wi}}),wi.toSegmentStrings=function(t){for(var e=new _,n=t.iterator();n.hasNext();){var i=n.next();e.add(new si(i.getCoordinates(),i))}return e},wi.checkValid=function(t){new wi(t).checkValid()},Tr(Ei.prototype,{sortShellsAndHoles:function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):e.add(r)}},computePolygons:function(t){for(var e=new _,n=t.iterator();n.hasNext();){var i=n.next(),r=i.toPolygon(this.geometryFactory);e.add(r)}return e},placeFreeHoles:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,t);if(null===r)throw new Le("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},buildMinimalEdgeRings:function(t,e,n){for(var i=new _,r=t.iterator();r.hasNext();){var o=r.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var a=o.buildMinimalRings(),s=this.findShell(a);null!==s?(this.placePolygonHoles(s,a),e.add(s)):n.addAll(a)}else i.add(o)}return i},containsPoint:function(t){for(var e=this.shellList.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},buildMaximalEdgeRings:function(t){for(var e=new _,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new Fe(i,this.geometryFactory);e.add(r),r.setInResult()}}return e},placePolygonHoles:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(t)}},getPolygons:function(){return this.computePolygons(this.shellList)},findEdgeRingContaining:function(t,e){for(var n=t.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),o=null,a=null,s=e.iterator();s.hasNext();){var u=s.next(),l=u.getLinearRing(),c=l.getEnvelopeInternal();null!==o&&(a=o.getLinearRing().getEnvelopeInternal());var h=!1;c.contains(i)&&ae.isPointInRing(r,l.getCoordinates())&&(h=!0),h&&(null===o||a.contains(c))&&(o=u)}return o},findShell:function(t){for(var e=0,n=null,i=t.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,e++)}return c.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},add:function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0],n=arguments[1];Je.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(e),r=new _,o=this.buildMinimalEdgeRings(i,this.shellList,r);this.sortShellsAndHoles(o,this.shellList,r),this.placeFreeHoles(this.shellList,r)}},interfaces_:function(){return[]},getClass:function(){return Ei}}),Tr(Si.prototype,{collectLines:function(t){for(var e=this.op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next();this.collectLineEdge(n,t,this.lineEdgesList),this.collectBoundaryTouchEdge(n,t,this.lineEdgesList)}},labelIsolatedLine:function(t,e){var n=this.ptLocator.locate(t.getCoordinate(),this.op.getArgGeometry(e));t.getLabel().setLocation(e,n)},build:function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this.resultLineList},collectLineEdge:function(t,e,n){var i=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Ti.isResultOfOp(i,e)||r.isCovered()||(n.add(r),t.setVisitedEdge(!0)))},findCoveredLineEdges:function(){for(var t=this.op.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this.op.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this.op.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},labelIsolatedLines:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},buildLines:function(t){for(var e=this.lineEdgesList.iterator();e.hasNext();){var n=e.next(),i=(n.getLabel(),this.geometryFactory.createLineString(n.getCoordinates()));this.resultLineList.add(i),n.setInResult(!0)}},collectBoundaryTouchEdge:function(t,e,n){var i=t.getLabel();return t.isLineEdge()?null:t.isVisited()?null:t.isInteriorAreaEdge()?null:t.getEdge().isInResult()?null:(c.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Ti.isResultOfOp(i,e)&&e===Ti.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},interfaces_:function(){return[]},getClass:function(){return Si}}),Tr(Mi.prototype,{filterCoveredNodeToPoint:function(t){var e=t.getCoordinate();if(!this.op.isCoveredByLA(e)){var n=this.geometryFactory.createPoint(e);this.resultPointList.add(n)}},extractNonCoveredResultNodes:function(t){for(var e=this.op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&t!==Ti.INTERSECTION)){var i=n.getLabel();Ti.isResultOfOp(i,t)&&this.filterCoveredNodeToPoint(n)}}},build:function(t){return this.extractNonCoveredResultNodes(t),this.resultPointList},interfaces_:function(){return[]},getClass:function(){return Mi}}),Tr(Ci.prototype,{getArgGeometry:function(t){return this.arg[t].getGeometry()},setComputationPrecision:function(t){this.resultPrecisionModel=t,this.li.setPrecisionModel(this.resultPrecisionModel)},interfaces_:function(){return[]},getClass:function(){return Ci}}),Tr(Ii.prototype,{compareTo:function(t){var e=t;return Ii.compareOriented(this.pts,this._orientation,e.pts,e._orientation)},interfaces_:function(){return[r]},getClass:function(){return Ii}}),Ii.orientation=function(t){return 1===V.increasingDirection(t)},Ii.compareOriented=function(t,e,n,i){for(var r=e?1:-1,o=i?1:-1,a=e?t.length:-1,s=i?n.length:-1,u=e?0:t.length-1,l=i?0:n.length-1;;){var c=t[u].compareTo(n[l]);if(0!==c)return c;u+=r,l+=o;var h=u===a,f=l===s;if(h&&!f)return-1;if(!h&&f)return 1;if(h&&f)return 0}},Tr(Oi.prototype,{print:function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this.edges.size();e++){var n=this.edges.get(e);e>0&&t.print(","),t.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&t.print(","),t.print(i[r].x+" "+i[r].y);t.println(")")}t.print(")  ")},addAll:function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},findEdgeIndex:function(t){for(var e=0;e<this.edges.size();e++)if(this.edges.get(e).equals(t))return e;return-1},iterator:function(){return this.edges.iterator()},getEdges:function(){return this.edges},get:function(t){return this.edges.get(t)},findEqualEdge:function(t){var e=new Ii(t.getCoordinates());return this.ocaMap.get(e)},add:function(t){this.edges.add(t);var e=new Ii(t.getCoordinates());this.ocaMap.put(e,t)},interfaces_:function(){return[]},getClass:function(){return Oi}}),Pr(Ti,Ci),Tr(Ti.prototype,{insertUniqueEdge:function(t){var e=this.edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new ke(t.getLabel()),i.flip());var r=e.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this.edgeList.add(t)},getGraph:function(){return this.graph},cancelDuplicateResultEdges:function(){for(var t=this.graph.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},isCoveredByLA:function(t){return!!this.isCovered(t,this.resultLineList)||!!this.isCovered(t,this.resultPolyList)},computeGeometry:function(t,e,n,i){var r=new _;return r.addAll(t),r.addAll(e),r.addAll(n),r.isEmpty()?Ti.createEmptyResult(i,this.arg[0].getGeometry(),this.arg[1].getGeometry(),this.geomFact):this.geomFact.buildGeometry(r)},mergeSymLabels:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},isCovered:function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(this.ptLocator.locate(t,i)!==S.EXTERIOR)return!0}return!1},replaceCollapsedEdges:function(){for(var t=new _,e=this.edgeList.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this.edgeList.addAll(t)},updateNodeLabelling:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},getResultGeometry:function(t){return this.computeOverlay(t),this.resultGeom},insertUniqueEdges:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},computeOverlay:function(t){this.copyPoints(0),this.copyPoints(1),this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1),this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!0);var e=new _;this.arg[0].computeSplitEdges(e),this.arg[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),wi.checkValid(this.edgeList.getEdges()),this.graph.addEdges(this.edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Ei(this.geomFact);n.add(this.graph),this.resultPolyList=n.getPolygons();var i=new Si(this,this.geomFact,this.ptLocator);this.resultLineList=i.build(t);var r=new Mi(this,this.geomFact,this.ptLocator);this.resultPointList=r.build(t),this.resultGeom=this.computeGeometry(this.resultPointList,this.resultLineList,this.resultPolyList,t)},labelIncompleteNode:function(t,e){var n=this.ptLocator.locate(t.getCoordinate(),this.arg[e].getGeometry());t.getLabel().setLocation(e,n)},copyPoints:function(t){for(var e=this.arg[t].getNodeIterator();e.hasNext();){var n=e.next();this.graph.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},findResultAreaEdges:function(t){for(var e=this.graph.getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getLabel();i.isArea()&&!n.isInteriorAreaEdge()&&Ti.isResultOfOp(i.getLocation(0,Ae.RIGHT),i.getLocation(1,Ae.RIGHT),t)&&n.setInResult(!0)}},computeLabelsFromDepths:function(){for(var t=this.edgeList.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),i=e.getDepth();if(!i.isNull()){i.normalize();for(var r=0;r<2;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(c.isTrue(!i.isNull(r,Ae.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,Ae.LEFT,i.getLocation(r,Ae.LEFT)),c.isTrue(!i.isNull(r,Ae.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,Ae.RIGHT,i.getLocation(r,Ae.RIGHT))))}}},computeLabelling:function(){for(var t=this.graph.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this.arg);this.mergeSymLabels(),this.updateNodeLabelling()},labelIncompleteNodes:function(){for(var t=0,e=this.graph.getNodes().iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(t++,i.isNull(0)?this.labelIncompleteNode(n,0):this.labelIncompleteNode(n,1)),n.getEdges().updateLabelling(i)}},isCoveredByA:function(t){return!!this.isCovered(t,this.resultPolyList)},interfaces_:function(){return[]},getClass:function(){return Ti}}),Ti.overlayOp=function(t,e,n){return new Ti(t,e).getResultGeometry(n)},Ti.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Ti.createEmptyResult(Ti.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Pe.map(t,{interfaces_:function(){return[MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ai.overlayOp(t,e,Ti.INTERSECTION)},Ti.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Ti.createEmptyResult(Ti.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ai.overlayOp(t,e,Ti.SYMDIFFERENCE)},Ti.resultDimension=function(t,e,n){var i=e.getDimension(),r=n.getDimension(),o=-1;switch(t){case Ti.INTERSECTION:o=Math.min(i,r);break;case Ti.UNION:o=Math.max(i,r);break;case Ti.DIFFERENCE:o=i;break;case Ti.SYMDIFFERENCE:o=Math.max(i,r)}return o},Ti.createEmptyResult=function(t,e,n,i){var r=null;switch(Ti.resultDimension(t,e,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},Ti.difference=function(t,e){return t.isEmpty()?Ti.createEmptyResult(Ti.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ai.overlayOp(t,e,Ti.DIFFERENCE))},Ti.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),i=t.getLocation(1);return Ti.isResultOfOp(n,i,e)}if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];switch(r===S.BOUNDARY&&(r=S.INTERIOR),o===S.BOUNDARY&&(o=S.INTERIOR),a){case Ti.INTERSECTION:return r===S.INTERIOR&&o===S.INTERIOR;case Ti.UNION:return r===S.INTERIOR||o===S.INTERIOR;case Ti.DIFFERENCE:return r===S.INTERIOR&&o!==S.INTERIOR;case Ti.SYMDIFFERENCE:return r===S.INTERIOR&&o!==S.INTERIOR||r!==S.INTERIOR&&o===S.INTERIOR}return!1}},Ti.INTERSECTION=1,Ti.UNION=2,Ti.DIFFERENCE=3,Ti.SYMDIFFERENCE=4,Tr(Pi.prototype,{selfSnap:function(t){return new $n(t).snapTo(t,this.snapTolerance)},removeCommonBits:function(t){this.cbr=new ni,this.cbr.add(t[0]),this.cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this.cbr.removeCommonBits(t[0].copy()),e[1]=this.cbr.removeCommonBits(t[1].copy()),e},prepareResult:function(t){return this.cbr.addCommonBits(t),t},getResultGeometry:function(t){var e=this.snap(this.geom),n=Ti.overlayOp(e[0],e[1],t);return this.prepareResult(n)},checkValid:function(t){t.isValid()||L.out.println("Snapped geometry is invalid")},computeSnapTolerance:function(){this.snapTolerance=$n.computeOverlaySnapTolerance(this.geom[0],this.geom[1])},snap:function(t){var e=this.removeCommonBits(t);return $n.snap(e[0],e[1],this.snapTolerance)},interfaces_:function(){return[]},getClass:function(){return Pi}}),Pi.overlayOp=function(t,e,n){return new Pi(t,e).getResultGeometry(n)},Pi.union=function(t,e){return Pi.overlayOp(t,e,Ti.UNION)},Pi.intersection=function(t,e){return Pi.overlayOp(t,e,Ti.INTERSECTION)},Pi.symDifference=function(t,e){return Pi.overlayOp(t,e,Ti.SYMDIFFERENCE)},Pi.difference=function(t,e){return Pi.overlayOp(t,e,Ti.DIFFERENCE)},Tr(Ai.prototype,{getResultGeometry:function(t){var e=null,n=!1,i=null;try{e=Ti.overlayOp(this.geom[0],this.geom[1],t),n=!0}catch(t){if(!(t instanceof u))throw t;i=t}finally{}if(!n)try{e=Pi.overlayOp(this.geom[0],this.geom[1],t)}catch(t){throw t instanceof u?i:t}finally{}return e},interfaces_:function(){return[]},getClass:function(){return Ai}}),Ai.overlayOp=function(t,e,n){return new Ai(t,e).getResultGeometry(n)},Ai.union=function(t,e){return Ai.overlayOp(t,e,Ti.UNION)},Ai.intersection=function(t,e){return Ai.overlayOp(t,e,Ti.INTERSECTION)},Ai.symDifference=function(t,e){return Ai.overlayOp(t,e,Ti.SYMDIFFERENCE)},Ai.difference=function(t,e){return Ai.overlayOp(t,e,Ti.DIFFERENCE)},Tr(Li.prototype,{addPolygon:function(t){if(t.isEmpty())return null;var e=null,n=0,i=this.horizontalBisector(t);if(0===i.getLength())n=0,e=i.getCoordinate();else{var r=Ai.overlayOp(i,t,Ti.INTERSECTION),o=this.widestGeometry(r);n=o.getEnvelopeInternal().getWidth(),e=Li.centre(o.getEnvelopeInternal())}(null===this.interiorPoint||n>this.maxWidth)&&(this.interiorPoint=e,this.maxWidth=n)},getInteriorPoint:function(){return this.interiorPoint},widestGeometry:function(){if(arguments[0]instanceof lt){var t=arguments[0];if(t.isEmpty())return t;for(var e=t.getGeometryN(0),n=1;n<t.getNumGeometries();n++)t.getGeometryN(n).getEnvelopeInternal().getWidth()>e.getEnvelopeInternal().getWidth()&&(e=t.getGeometryN(n));return e}if(arguments[0]instanceof D){var i=arguments[0];return i instanceof lt?this.widestGeometry(i):i}},horizontalBisector:function(t){var e=t.getEnvelopeInternal(),n=Ni.getBisectorY(t);return this.factory.createLineString([new h(e.getMinX(),n),new h(e.getMaxX(),n)])},add:function(t){if(t instanceof Mt)this.addPolygon(t);else if(t instanceof lt)for(var e=t,n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))},interfaces_:function(){return[]},getClass:function(){return Li}}),Li.centre=function(t){return new h(Li.avg(t.getMinX(),t.getMaxX()),Li.avg(t.getMinY(),t.getMaxY()))},Li.avg=function(t,e){return(t+e)/2},Tr(Ni.prototype,{updateInterval:function(t){t<=this.centreY?t>this.loY&&(this.loY=t):t>this.centreY&&t<this.hiY&&(this.hiY=t)},getBisectorY:function(){this.process(this.poly.getExteriorRing());for(var t=0;t<this.poly.getNumInteriorRing();t++)this.process(this.poly.getInteriorRingN(t));return Li.avg(this.hiY,this.loY)},process:function(t){for(var e=t.getCoordinateSequence(),n=0;n<e.size();n++){var i=e.getY(n);this.updateInterval(i)}},interfaces_:function(){return[]},getClass:function(){return Ni}}),Ni.getBisectorY=function(t){return new Ni(t).getBisectorY()},Li.SafeBisectorFinder=Ni,Tr(ki.prototype,{extractElements:function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);this.skipEmpty&&i.isEmpty()||e.add(i)}},combine:function(){for(var t=new _,e=this.inputGeoms.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this.geomFactory?this.geomFactory.createGeometryCollection(null):null:this.geomFactory.buildGeometry(t)},interfaces_:function(){return[]},getClass:function(){return ki}}),ki.combine=function(){if(1===arguments.length){var t=arguments[0],e=new ki(t);return e.combine()}if(2===arguments.length){var n=arguments[0],i=arguments[1],e=new ki(ki.createList(n,i));return e.combine()}if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2],e=new ki(ki.createList(r,o,a));return e.combine()}},ki.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},ki.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new _;return n.add(t),n.add(e),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],n=new _;return n.add(i),n.add(r),n.add(o),n}},Tr(Ri.prototype,{union:function(){for(var t=new Ee,e=new rt,n=0;n<this.pointGeom.getNumGeometries();n++){var i=this.pointGeom.getGeometryN(n),r=i.getCoordinate();t.locate(r,this.otherGeom)===S.EXTERIOR&&e.add(r)}if(0===e.size())return this.otherGeom;var o=null,a=V.toCoordinateArray(e);return o=1===a.length?this.geomFact.createPoint(a[0]):this.geomFact.createMultiPointFromCoords(a),ki.combine(o,this.otherGeom)},interfaces_:function(){return[]},getClass:function(){return Ri}}),Ri.union=function(t,e){return new Ri(t,e).union()},Tr(Di.prototype,{filter:function(t){this.sortIndex!==-1&&t.getSortIndex()!==this.sortIndex||this.comps.add(t)},interfaces_:function(){return[st]},getClass:function(){return Di}}),Di.extract=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return Di.extract(t,e,new _)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];return n.getSortIndex()===i?r.add(n):n instanceof lt&&n.apply(new Di(i,r)),r}},Tr(Fi.prototype,{reduceToGeometries:function(t){for(var e=new _,n=t.iterator();n.hasNext();){var i=n.next(),r=null;Lr(i,v)?r=this.unionTree(i):i instanceof D&&(r=i),e.add(r)}return e},extractByEnvelope:function(t,e,n){for(var i=new _,r=0;r<e.getNumGeometries();r++){var o=e.getGeometryN(r);o.getEnvelopeInternal().intersects(t)?i.add(o):n.add(o)}return this.geomFactory.buildGeometry(i)},unionOptimized:function(t,e){var n=t.getEnvelopeInternal(),i=e.getEnvelopeInternal();if(!n.intersects(i))return ki.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(t,e,r)},union:function(){if(null===this.inputPolys)throw new IllegalStateException("union() method cannot be called twice");if(this.inputPolys.isEmpty())return null;this.geomFactory=this.inputPolys.iterator().next().getFactory();for(var t=new qn(Fi.STRTREE_NODE_CAPACITY),e=this.inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this.inputPolys=null;var i=t.itemsTree();return this.unionTree(i)},binaryUnion:function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Fi.getGeometry(e,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe(Fi.getGeometry(e,n),Fi.getGeometry(e,n+1));var o=Math.trunc((i+n)/2),r=this.binaryUnion(e,n,o),a=this.binaryUnion(e,o,i);return this.unionSafe(r,a)}},repeatedUnion:function(t){for(var e=null,n=t.iterator();n.hasNext();){var i=n.next();e=null===e?i.copy():e.union(i)}return e},unionSafe:function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},unionActual:function(t,e){return Fi.restrictToPolygons(t.union(e))},unionTree:function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},unionUsingEnvelopeIntersection:function(t,e,n){var i=new _,r=this.extractByEnvelope(n,t,i),o=this.extractByEnvelope(n,e,i),a=this.unionActual(r,o);return i.add(a),ki.combine(i)},bufferUnion:function(){if(1===arguments.length){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),i=n.buffer(0);return i}if(2===arguments.length){var r=arguments[0],o=arguments[1],e=r.getFactory(),n=e.createGeometryCollection([r,o]),i=n.buffer(0);return i}},interfaces_:function(){return[]},getClass:function(){return Fi}}),Fi.restrictToPolygons=function(t){if(Lr(t,St))return t;var e=Se.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon($t.toPolygonArray(e))},Fi.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Fi.union=function(t){return new Fi(t).union()},Fi.STRTREE_NODE_CAPACITY=4,Tr(Bi.prototype,{unionNoOpt:function(t){var e=this.geomFact.createPoint();return Ai.overlayOp(t,e,Ti.UNION)},unionWithNull:function(t,e){return null===t&&null===e?null:null===e?t:null===t?e:t.union(e)},extract:function(){if(Lr(arguments[0],p))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.extract(n)}else if(arguments[0]instanceof D){var i=arguments[0];null===this.geomFact&&(this.geomFact=i.getFactory()),Di.extract(i,D.SORTINDEX_POLYGON,this.polygons),Di.extract(i,D.SORTINDEX_LINESTRING,this.lines),Di.extract(i,D.SORTINDEX_POINT,this.points)}},union:function(){if(null===this.geomFact)return null;var t=null;if(this.points.size()>0){var e=this.geomFact.buildGeometry(this.points);t=this.unionNoOpt(e)}var n=null;if(this.lines.size()>0){var i=this.geomFact.buildGeometry(this.lines);n=this.unionNoOpt(i)}var r=null;this.polygons.size()>0&&(r=Fi.union(this.polygons));var o=this.unionWithNull(n,r),a=null;return a=null===t?o:null===o?t:Ri.union(t,o),null===a?this.geomFact.createGeometryCollection():a},interfaces_:function(){return[]},getClass:function(){return Bi}}),Bi.union=function(){if(1===arguments.length){if(Lr(arguments[0],p)){var t=arguments[0],e=new Bi(t);return e.union()}if(arguments[0]instanceof D){var n=arguments[0],e=new Bi(n);return e.union()}}else if(2===arguments.length){var i=arguments[0],r=arguments[1],e=new Bi(i,r);return e.union()}},Tr(ji.prototype,{interfaces_:function(){return[]},getClass:function(){
return ji}}),ji.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Ti.createEmptyResult(Ti.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ai.overlayOp(t,e,Ti.UNION)},Tr(Ui.prototype,{addEndpoints:function(){if(arguments[0]instanceof D){var t=arguments[0];if(t instanceof xt)this.addEndpoints(t.getCoordinates());else if(t instanceof lt)for(var e=t,n=0;n<e.getNumGeometries();n++)this.addEndpoints(e.getGeometryN(n))}else if(arguments[0]instanceof Array){var i=arguments[0];this.add(i[0]),this.add(i[i.length-1])}},getInteriorPoint:function(){return this.interiorPoint},addInterior:function(){if(arguments[0]instanceof D){var t=arguments[0];if(t instanceof xt)this.addInterior(t.getCoordinates());else if(t instanceof lt)for(var e=t,n=0;n<e.getNumGeometries();n++)this.addInterior(e.getGeometryN(n))}else if(arguments[0]instanceof Array)for(var i=arguments[0],n=1;n<i.length-1;n++)this.add(i[n])},add:function(t){var e=t.distance(this.centroid);e<this.minDistance&&(this.interiorPoint=new h(t),this.minDistance=e)},interfaces_:function(){return[]},getClass:function(){return Ui}}),Tr(zi.prototype,{isSimpleMultiPoint:function(t){if(t.isEmpty())return!0;for(var e=new rt,n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n),r=i.getCoordinate();if(e.contains(r))return this.nonSimpleLocation=r,!1;e.add(r)}return!0},isSimplePolygonal:function(t){for(var e=Oe.getLines(t),n=e.iterator();n.hasNext();){var i=n.next();if(!this.isSimpleLinearGeometry(i))return!1}return!0},hasClosedEndpointIntersection:function(t){for(var e=new et,n=t.getEdgeIterator();n.hasNext();){var i=n.next(),r=(i.getMaximumSegmentIndex(),i.isClosed()),o=i.getCoordinate(0);this.addEndpoint(e,o,r);var a=i.getCoordinate(i.getNumPoints()-1);this.addEndpoint(e,a,r)}for(var n=e.values().iterator();n.hasNext();){var s=n.next();if(s.isClosed&&2!==s.degree)return this.nonSimpleLocation=s.getCoordinate(),!0}return!1},getNonSimpleLocation:function(){return this.nonSimpleLocation},isSimpleLinearGeometry:function(t){if(t.isEmpty())return!0;var e=new Pn(0,t),n=new ie,i=e.computeSelfNodes(n,!0);return!(i.hasIntersection()&&(i.hasProperIntersection()?(this.nonSimpleLocation=i.getProperIntersectionPoint(),1):this.hasNonEndpointIntersection(e)||this.isClosedEndpointsInInterior&&this.hasClosedEndpointIntersection(e)))},hasNonEndpointIntersection:function(t){for(var e=t.getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getMaximumSegmentIndex(),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var o=r.next();if(!o.isEndPoint(i))return this.nonSimpleLocation=o.getCoordinate(),!0}return!1},addEndpoint:function(t,e,n){var i=t.get(e);null===i&&(i=new Gi(e),t.put(e,i)),i.addEndpoint(n)},computeSimple:function(t){return this.nonSimpleLocation=null,!!t.isEmpty()||(t instanceof xt?this.isSimpleLinearGeometry(t):t instanceof ct?this.isSimpleLinearGeometry(t):t instanceof Ct?this.isSimpleMultiPoint(t):Lr(t,St)?this.isSimplePolygonal(t):!(t instanceof lt)||this.isSimpleGeometryCollection(t))},isSimple:function(){return this.nonSimpleLocation=null,this.computeSimple(this.inputGeom)},isSimpleGeometryCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);if(!this.computeSimple(n))return!1}return!0},interfaces_:function(){return[]},getClass:function(){return zi}}),Tr(Gi.prototype,{addEndpoint:function(t){this.degree++,this.isClosed|=t},getCoordinate:function(){return this.pt},interfaces_:function(){return[]},getClass:function(){return Gi}}),zi.EndpointInfo=Gi,Tr(Vi.prototype,{getEndCapStyle:function(){return this.endCapStyle},isSingleSided:function(){return this._isSingleSided},setQuadrantSegments:function(t){this.quadrantSegments=t,0===this.quadrantSegments&&(this.joinStyle=Vi.JOIN_BEVEL),this.quadrantSegments<0&&(this.joinStyle=Vi.JOIN_MITRE,this.mitreLimit=Math.abs(this.quadrantSegments)),t<=0&&(this.quadrantSegments=1),this.joinStyle!==Vi.JOIN_ROUND&&(this.quadrantSegments=Vi.DEFAULT_QUADRANT_SEGMENTS)},getJoinStyle:function(){return this.joinStyle},setJoinStyle:function(t){this.joinStyle=t},setSimplifyFactor:function(t){this.simplifyFactor=t<0?0:t},getSimplifyFactor:function(){return this.simplifyFactor},getQuadrantSegments:function(){return this.quadrantSegments},setEndCapStyle:function(t){this.endCapStyle=t},getMitreLimit:function(){return this.mitreLimit},setMitreLimit:function(t){this.mitreLimit=t},setSingleSided:function(t){this._isSingleSided=t},interfaces_:function(){return[]},getClass:function(){return Vi}}),Vi.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Vi.CAP_ROUND=1,Vi.CAP_FLAT=2,Vi.CAP_SQUARE=3,Vi.JOIN_ROUND=1,Vi.JOIN_MITRE=2,Vi.JOIN_BEVEL=3,Vi.DEFAULT_QUADRANT_SEGMENTS=8,Vi.DEFAULT_MITRE_LIMIT=5,Vi.DEFAULT_SIMPLIFY_FACTOR=.01,Xi.prototype=new Error,Xi.prototype.name="EmptyStackException",Hi.prototype=new v,Hi.prototype.add=function(t){return this.array_.push(t),!0},Hi.prototype.get=function(t){if(t<0||t>=this.size())throw new IndexOutOfBoundsException;return this.array_[t]},Hi.prototype.push=function(t){return this.array_.push(t),t},Hi.prototype.pop=function(t){if(0===this.array_.length)throw new Xi;return this.array_.pop()},Hi.prototype.peek=function(){if(0===this.array_.length)throw new Xi;return this.array_[this.array_.length-1]},Hi.prototype.empty=function(){return 0===this.array_.length},Hi.prototype.isEmpty=function(){return this.empty()},Hi.prototype.search=function(t){return this.array_.indexOf(t)},Hi.prototype.size=function(){return this.array_.length},Hi.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},Tr(qi.prototype,{getCoordinate:function(){return this.minCoord},getRightmostSide:function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this.minCoord=null,this.checkForRightmostCoordinate(t)),n},findRightmostEdgeAtVertex:function(){var t=this.minDe.getEdge().getCoordinates();c.isTrue(this.minIndex>0&&this.minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this.minIndex-1],n=t[this.minIndex+1],i=ae.computeOrientation(this.minCoord,n,e),r=!1;e.y<this.minCoord.y&&n.y<this.minCoord.y&&i===ae.COUNTERCLOCKWISE?r=!0:e.y>this.minCoord.y&&n.y>this.minCoord.y&&i===ae.CLOCKWISE&&(r=!0),r&&(this.minIndex=this.minIndex-1)},getRightmostSideOfSegment:function(t,e){var n=t.getEdge(),i=n.getCoordinates();if(e<0||e+1>=i.length)return-1;if(i[e].y===i[e+1].y)return-1;var r=Ae.LEFT;return i[e].y<i[e+1].y&&(r=Ae.RIGHT),r},getEdge:function(){return this.orientedDe},checkForRightmostCoordinate:function(t){for(var e=t.getEdge().getCoordinates(),n=0;n<e.length-1;n++)(null===this.minCoord||e[n].x>this.minCoord.x)&&(this.minDe=t,this.minIndex=n,this.minCoord=e[n])},findRightmostEdgeAtNode:function(){var t=this.minDe.getNode(),e=t.getEdges();this.minDe=e.getRightmostEdge(),this.minDe.isForward()||(this.minDe=this.minDe.getSym(),this.minIndex=this.minDe.getEdge().getCoordinates().length-1)},findEdge:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}c.isTrue(0!==this.minIndex||this.minCoord.equals(this.minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this.minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.orientedDe=this.minDe,this.getRightmostSide(this.minDe,this.minIndex)===Ae.LEFT&&(this.orientedDe=this.minDe.getSym())},interfaces_:function(){return[]},getClass:function(){return qi}}),Yi.prototype.addLast=function(t){this.array_.push(t)},Yi.prototype.removeFirst=function(){return this.array_.shift()},Yi.prototype.isEmpty=function(){return 0===this.array_.length},Tr(Wi.prototype,{clearVisitedEdges:function(){for(var t=this.dirEdgeList.iterator();t.hasNext();)t.next().setVisited(!1)},getRightmostCoordinate:function(){return this.rightMostCoord},computeNodeDepth:function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){e=i;break}}if(null===e)throw new Le("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();i.setVisited(!0),this.copySymDepths(i)}},computeDepth:function(t){this.clearVisitedEdges();var e=this.finder.getEdge();e.getNode(),e.getLabel(),e.setEdgeDepths(Ae.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},create:function(t){this.addReachable(t),this.finder.findEdge(this.dirEdgeList),this.rightMostCoord=this.finder.getCoordinate()},findResultEdges:function(){for(var t=this.dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Ae.RIGHT)>=1&&e.getDepth(Ae.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},computeDepths:function(t){var e=new Z,n=new Yi,i=t.getNode();for(n.addLast(i),e.add(i),t.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();e.add(r),this.computeNodeDepth(r);for(var o=r.getEdges().iterator();o.hasNext();){var a=o.next(),s=a.getSym();if(!s.isVisited()){var u=s.getNode();e.contains(u)||(n.addLast(u),e.add(u))}}}},compareTo:function(t){var e=t;return this.rightMostCoord.x<e.rightMostCoord.x?-1:this.rightMostCoord.x>e.rightMostCoord.x?1:0},getEnvelope:function(){if(null===this.env){for(var t=new x,e=this.dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),i=n.getEdge().getCoordinates(),r=0;r<i.length-1;r++)t.expandToInclude(i[r]);this.env=t}return this.env},addReachable:function(t){var e=new Hi;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},copySymDepths:function(t){var e=t.getSym();e.setDepth(Ae.LEFT,t.getDepth(Ae.RIGHT)),e.setDepth(Ae.RIGHT,t.getDepth(Ae.LEFT))},add:function(t,e){t.setVisited(!0),this.nodes.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();this.dirEdgeList.add(i);var r=i.getSym(),o=r.getNode();o.isVisited()||e.push(o)}},getNodes:function(){return this.nodes},getDirectedEdges:function(){return this.dirEdgeList},interfaces_:function(){return[r]},getClass:function(){return Wi}}),Tr(Zi.prototype,{isDeletable:function(t,e,n,i){var r=this.inputLine[t],o=this.inputLine[e],a=this.inputLine[n];return!!this.isConcave(r,o,a)&&!!this.isShallow(r,o,a,i)&&this.isShallowSampled(r,o,t,n,i)},deleteShallowConcavities:function(){for(var t=1,e=(this.inputLine.length,this.findNextNonDeletedIndex(t)),n=this.findNextNonDeletedIndex(e),i=!1;n<this.inputLine.length;){var r=!1;this.isDeletable(t,e,n,this.distanceTol)&&(this.isDeleted[e]=Zi.DELETE,r=!0,i=!0),t=r?n:e,e=this.findNextNonDeletedIndex(t),n=this.findNextNonDeletedIndex(e)}return i},isShallowConcavity:function(t,e,n,i){return ae.computeOrientation(t,e,n)===this.angleOrientation&&ae.distancePointLine(e,t,n)<i},isShallowSampled:function(t,e,n,i,r){var o=Math.trunc((i-n)/Zi.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var a=n;a<i;a+=o)if(!this.isShallow(t,e,this.inputLine[a],r))return!1;return!0},isConcave:function(t,e,n){return ae.computeOrientation(t,e,n)===this.angleOrientation},simplify:function(t){this.distanceTol=Math.abs(t),t<0&&(this.angleOrientation=ae.CLOCKWISE),this.isDeleted=new Array(this.inputLine.length).fill(null);var e=!1;do e=this.deleteShallowConcavities();while(e);return this.collapseLine()},findNextNonDeletedIndex:function(t){for(var e=t+1;e<this.inputLine.length&&this.isDeleted[e]===Zi.DELETE;)e++;return e},isShallow:function(t,e,n,i){return ae.distancePointLine(e,t,n)<i},collapseLine:function(){for(var t=new b,e=0;e<this.inputLine.length;e++)this.isDeleted[e]!==Zi.DELETE&&t.add(this.inputLine[e]);return t.toCoordinateArray()},interfaces_:function(){return[]},getClass:function(){return Zi}}),Zi.simplify=function(t,e){return new Zi(t).simplify(e)},Zi.INIT=0,Zi.DELETE=1,Zi.KEEP=1,Zi.NUM_PTS_TO_CHECK=10,Tr(Ji.prototype,{getCoordinates:function(){return this.ptList.toArray(Ji.COORDINATE_ARRAY_TYPE)},setPrecisionModel:function(t){this.precisionModel=t},addPt:function(t){var e=new h(t);return this.precisionModel.makePrecise(e),this.isRedundant(e)?null:void this.ptList.add(e)},reverse:function(){},addPts:function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var n=t.length-1;n>=0;n--)this.addPt(t[n])},isRedundant:function(t){if(this.ptList.size()<1)return!1;var e=this.ptList.get(this.ptList.size()-1);return t.distance(e)<this.minimimVertexDistance},toString:function(){return(new $t).createLineString(this.getCoordinates()).toString()},closeRing:function(){if(this.ptList.size()<1)return null;var t=new h(this.ptList.get(0)),e=this.ptList.get(this.ptList.size()-1);return this.ptList.size()>=2&&this.ptList.get(this.ptList.size()-2),t.equals(e)?null:void this.ptList.add(t)},setMinimumVertexDistance:function(t){this.minimimVertexDistance=t},interfaces_:function(){return[]},getClass:function(){return Ji}}),Ji.COORDINATE_ARRAY_TYPE=new Array(0).fill(null),Tr(Ki.prototype,{interfaces_:function(){return[]},getClass:function(){return Ki}}),Ki.toDegrees=function(t){return 180*t/Math.PI},Ki.normalize=function(t){for(;t>Math.PI;)t-=Ki.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ki.PI_TIMES_2;return t},Ki.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1],i=n.x-e.x,r=n.y-e.y;return Math.atan2(r,i)}},Ki.isAcute=function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)>0},Ki.isObtuse=function(t,e,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)<0},Ki.interiorAngle=function(t,e,n){var i=Ki.angle(e,t),r=Ki.angle(e,n);return Math.abs(r-i)},Ki.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ki.PI_TIMES_2;t>=Ki.PI_TIMES_2&&(t=0)}else{for(;t>=Ki.PI_TIMES_2;)t-=Ki.PI_TIMES_2;t<0&&(t=0)}return t},Ki.angleBetween=function(t,e,n){var i=Ki.angle(e,t),r=Ki.angle(e,n);return Ki.diff(i,r)},Ki.diff=function(t,e){var n=null;return n=t<e?e-t:t-e,n>Math.PI&&(n=2*Math.PI-n),n},Ki.toRadians=function(t){return t*Math.PI/180},Ki.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Ki.COUNTERCLOCKWISE:n<0?Ki.CLOCKWISE:Ki.NONE},Ki.angleBetweenOriented=function(t,e,n){var i=Ki.angle(e,t),r=Ki.angle(e,n),o=r-i;return o<=-Math.PI?o+Ki.PI_TIMES_2:o>Math.PI?o-Ki.PI_TIMES_2:o},Ki.PI_TIMES_2=2*Math.PI,Ki.PI_OVER_2=Math.PI/2,Ki.PI_OVER_4=Math.PI/4,Ki.COUNTERCLOCKWISE=ae.COUNTERCLOCKWISE,Ki.CLOCKWISE=ae.CLOCKWISE,Ki.NONE=ae.COLLINEAR,Tr(Qi.prototype,{addNextSegment:function(t,e){if(this.s0=this.s1,this.s1=this.s2,this.s2=t,this.seg0.setCoordinates(this.s0,this.s1),this.computeOffsetSegment(this.seg0,this.side,this.distance,this.offset0),this.seg1.setCoordinates(this.s1,this.s2),this.computeOffsetSegment(this.seg1,this.side,this.distance,this.offset1),this.s1.equals(this.s2))return null;var n=ae.computeOrientation(this.s0,this.s1,this.s2),i=n===ae.CLOCKWISE&&this.side===Ae.LEFT||n===ae.COUNTERCLOCKWISE&&this.side===Ae.RIGHT;0===n?this.addCollinear(e):i?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},addLineEndCap:function(t,e){var n=new se(t,e),i=new se;this.computeOffsetSegment(n,Ae.LEFT,this.distance,i);var r=new se;this.computeOffsetSegment(n,Ae.RIGHT,this.distance,r);var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o);switch(this.bufParams.getEndCapStyle()){case Vi.CAP_ROUND:this.segList.addPt(i.p1),this.addFilletArc(e,s+Math.PI/2,s-Math.PI/2,ae.CLOCKWISE,this.distance),this.segList.addPt(r.p1);break;case Vi.CAP_FLAT:this.segList.addPt(i.p1),this.segList.addPt(r.p1);break;case Vi.CAP_SQUARE:var u=new h;u.x=Math.abs(this.distance)*Math.cos(s),u.y=Math.abs(this.distance)*Math.sin(s);var l=new h(i.p1.x+u.x,i.p1.y+u.y),c=new h(r.p1.x+u.x,r.p1.y+u.y);this.segList.addPt(l),this.segList.addPt(c)}},getCoordinates:function(){return this.segList.getCoordinates()},addMitreJoin:function(t,e,n,i){var r=!0,o=null;try{o=N.intersection(e.p0,e.p1,n.p0,n.p1),(i<=0?1:o.distance(t)/Math.abs(i))>this.bufParams.getMitreLimit()&&(r=!1)}catch(t){if(!(t instanceof E))throw t;o=new h(0,0),r=!1}finally{}r?this.segList.addPt(o):this.addLimitedMitreJoin(e,n,i,this.bufParams.getMitreLimit())},addFilletCorner:function(t,e,n,i,r){var o=e.x-t.x,a=e.y-t.y,s=Math.atan2(a,o),u=n.x-t.x,l=n.y-t.y,c=Math.atan2(l,u);i===ae.CLOCKWISE?s<=c&&(s+=2*Math.PI):s>=c&&(s-=2*Math.PI),this.segList.addPt(e),this.addFilletArc(t,s,c,i,r),this.segList.addPt(n)},addOutsideTurn:function(t,e){return this.offset0.p1.distance(this.offset1.p0)<this.distance*Qi.OFFSET_SEGMENT_SEPARATION_FACTOR?(this.segList.addPt(this.offset0.p1),null):void(this.bufParams.getJoinStyle()===Vi.JOIN_MITRE?this.addMitreJoin(this.s1,this.offset0,this.offset1,this.distance):this.bufParams.getJoinStyle()===Vi.JOIN_BEVEL?this.addBevelJoin(this.offset0,this.offset1):(e&&this.segList.addPt(this.offset0.p1),this.addFilletCorner(this.s1,this.offset0.p1,this.offset1.p0,t,this.distance),this.segList.addPt(this.offset1.p0)))},createSquare:function(t){this.segList.addPt(new h(t.x+this.distance,t.y+this.distance)),this.segList.addPt(new h(t.x+this.distance,t.y-this.distance)),this.segList.addPt(new h(t.x-this.distance,t.y-this.distance)),this.segList.addPt(new h(t.x-this.distance,t.y+this.distance)),this.segList.closeRing()},addSegments:function(t,e){this.segList.addPts(t,e)},addFirstSegment:function(){this.segList.addPt(this.offset1.p0)},addLastSegment:function(){this.segList.addPt(this.offset1.p1)},initSideSegments:function(t,e,n){this.s1=t,this.s2=e,this.side=n,this.seg1.setCoordinates(t,e),this.computeOffsetSegment(this.seg1,n,this.distance,this.offset1)},addLimitedMitreJoin:function(t,e,n,i){var r=this.seg0.p1,o=Ki.angle(r,this.seg0.p0),a=(Ki.angle(r,this.seg1.p1),Ki.angleBetweenOriented(this.seg0.p0,r,this.seg1.p1)),s=a/2,u=Ki.normalize(o+s),l=Ki.normalize(u+Math.PI),c=i*n,f=c*Math.abs(Math.sin(s)),d=n-f,p=r.x+c*Math.cos(l),g=r.y+c*Math.sin(l),v=new h(p,g),m=new se(r,v),y=m.pointAlongOffset(1,d),_=m.pointAlongOffset(1,-d);this.side===Ae.LEFT?(this.segList.addPt(y),this.segList.addPt(_)):(this.segList.addPt(_),this.segList.addPt(y))},computeOffsetSegment:function(t,e,n,i){var r=e===Ae.LEFT?1:-1,o=t.p1.x-t.p0.x,a=t.p1.y-t.p0.y,s=Math.sqrt(o*o+a*a),u=r*n*o/s,l=r*n*a/s;i.p0.x=t.p0.x-l,i.p0.y=t.p0.y+u,i.p1.x=t.p1.x-l,i.p1.y=t.p1.y+u},addFilletArc:function(t,e,n,i,r){var o=i===ae.CLOCKWISE?-1:1,a=Math.abs(e-n),s=Math.trunc(a/this.filletAngleQuantum+.5);if(s<1)return null;var u=null,l=null;u=0,l=a/s;for(var c=u,f=new h;c<a;){var d=e+o*c;f.x=t.x+r*Math.cos(d),f.y=t.y+r*Math.sin(d),this.segList.addPt(f),c+=l}},addInsideTurn:function(t,e){if(this.li.computeIntersection(this.offset0.p0,this.offset0.p1,this.offset1.p0,this.offset1.p1),this.li.hasIntersection())this.segList.addPt(this.li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this.offset0.p1.distance(this.offset1.p0)<this.distance*Qi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.segList.addPt(this.offset0.p1);else{if(this.segList.addPt(this.offset0.p1),this.closingSegLengthFactor>0){var n=new h((this.closingSegLengthFactor*this.offset0.p1.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset0.p1.y+this.s1.y)/(this.closingSegLengthFactor+1));this.segList.addPt(n);var i=new h((this.closingSegLengthFactor*this.offset1.p0.x+this.s1.x)/(this.closingSegLengthFactor+1),(this.closingSegLengthFactor*this.offset1.p0.y+this.s1.y)/(this.closingSegLengthFactor+1));this.segList.addPt(i)}else this.segList.addPt(this.s1);this.segList.addPt(this.offset1.p0)}},createCircle:function(t){var e=new h(t.x+this.distance,t.y);this.segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this.distance),this.segList.closeRing()},addBevelJoin:function(t,e){this.segList.addPt(t.p1),this.segList.addPt(e.p0)},init:function(t){this.distance=t,this.maxCurveSegmentError=t*(1-Math.cos(this.filletAngleQuantum/2)),this.segList=new Ji,this.segList.setPrecisionModel(this.precisionModel),this.segList.setMinimumVertexDistance(t*Qi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},addCollinear:function(t){this.li.computeIntersection(this.s0,this.s1,this.s1,this.s2),this.li.getIntersectionNum()>=2&&(this.bufParams.getJoinStyle()===Vi.JOIN_BEVEL||this.bufParams.getJoinStyle()===Vi.JOIN_MITRE?(t&&this.segList.addPt(this.offset0.p1),this.segList.addPt(this.offset1.p0)):this.addFilletCorner(this.s1,this.offset0.p1,this.offset1.p0,ae.CLOCKWISE,this.distance))},closeRing:function(){this.segList.closeRing()},hasNarrowConcaveAngle:function(){return this._hasNarrowConcaveAngle},interfaces_:function(){return[]},getClass:function(){return Qi}}),Qi.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Qi.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Qi.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Qi.MAX_CLOSING_SEG_LEN_FACTOR=80,Tr($i.prototype,{getOffsetCurve:function(t,e){if(this.distance=e,0===e)return null;var n=e<0,i=Math.abs(e),r=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,n,r);var o=r.getCoordinates();return n&&V.reverse(o),o},computeSingleSidedBufferCurve:function(t,e,n){var i=this.simplifyTolerance(this.distance);if(e){n.addSegments(t,!0);var r=Zi.simplify(t,-i),o=r.length-1;n.initSideSegments(r[o],r[o-1],Ae.LEFT),n.addFirstSegment();for(var a=o-2;a>=0;a--)n.addNextSegment(r[a],!0)}else{n.addSegments(t,!1);var s=Zi.simplify(t,i),u=s.length-1;n.initSideSegments(s[0],s[1],Ae.LEFT),n.addFirstSegment();for(var a=2;a<=u;a++)n.addNextSegment(s[a],!0)}n.addLastSegment(),n.closeRing()},computeRingBufferCurve:function(t,e,n){var i=this.simplifyTolerance(this.distance);e===Ae.RIGHT&&(i=-i);var r=Zi.simplify(t,i),o=r.length-1;n.initSideSegments(r[o-1],r[0],e);for(var a=1;a<=o;a++){var s=1!==a;n.addNextSegment(r[a],s)}n.closeRing()},computeLineBufferCurve:function(t,e){var n=this.simplifyTolerance(this.distance),i=Zi.simplify(t,n),r=i.length-1;e.initSideSegments(i[0],i[1],Ae.LEFT);for(var o=2;o<=r;o++)e.addNextSegment(i[o],!0);e.addLastSegment(),e.addLineEndCap(i[r-1],i[r]);var a=Zi.simplify(t,-n),s=a.length-1;e.initSideSegments(a[s],a[s-1],Ae.LEFT);for(var o=s-2;o>=0;o--)e.addNextSegment(a[o],!0);e.addLastSegment(),e.addLineEndCap(a[1],a[0]),e.closeRing()},computePointCurve:function(t,e){switch(this.bufParams.getEndCapStyle()){case Vi.CAP_ROUND:e.createCircle(t);break;case Vi.CAP_SQUARE:e.createSquare(t)}},getLineCurve:function(t,e){if(this.distance=e,e<0&&!this.bufParams.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),i=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],i);else if(this.bufParams.isSingleSided()){var r=e<0;this.computeSingleSidedBufferCurve(t,r,i)}else this.computeLineBufferCurve(t,i);return i.getCoordinates()},getBufferParameters:function(){return this.bufParams},simplifyTolerance:function(t){return t*this.bufParams.getSimplifyFactor()},getRingCurve:function(t,e,n){if(this.distance=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return $i.copyCoordinates(t);var i=this.getSegGen(n);return this.computeRingBufferCurve(t,e,i),i.getCoordinates()},computeOffsetCurve:function(t,e,n){var i=this.simplifyTolerance(this.distance);if(e){var r=Zi.simplify(t,-i),o=r.length-1;n.initSideSegments(r[o],r[o-1],Ae.LEFT),n.addFirstSegment();for(var a=o-2;a>=0;a--)n.addNextSegment(r[a],!0)}else{var s=Zi.simplify(t,i),u=s.length-1;n.initSideSegments(s[0],s[1],Ae.LEFT),n.addFirstSegment();for(var a=2;a<=u;a++)n.addNextSegment(s[a],!0)}n.addLastSegment()},getSegGen:function(t){return new Qi(this.precisionModel,this.bufParams,t)},interfaces_:function(){return[]},getClass:function(){return $i}}),$i.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new h(t[n]);return e},Tr(tr.prototype,{findStabbedSegments:function(){if(1===arguments.length){for(var t=arguments[0],e=new _,n=this.subgraphs.iterator();n.hasNext();){var i=n.next(),r=i.getEnvelope();t.y<r.getMinY()||t.y>r.getMaxY()||this.findStabbedSegments(t,i.getDirectedEdges(),e)}return e}if(3===arguments.length)if(Lr(arguments[2],v)&&arguments[0]instanceof h&&arguments[1]instanceof Ze)for(var o=arguments[0],a=arguments[1],s=arguments[2],u=a.getEdge().getCoordinates(),n=0;n<u.length-1;n++){this.seg.p0=u[n],this.seg.p1=u[n+1],this.seg.p0.y>this.seg.p1.y&&this.seg.reverse();var l=Math.max(this.seg.p0.x,this.seg.p1.x);if(!(l<o.x||this.seg.isHorizontal()||o.y<this.seg.p0.y||o.y>this.seg.p1.y||ae.computeOrientation(this.seg.p0,this.seg.p1,o)===ae.RIGHT)){var c=a.getDepth(Ae.LEFT);this.seg.p0.equals(u[n])||(c=a.getDepth(Ae.RIGHT));var f=new er(this.seg,c);s.add(f)}}else if(Lr(arguments[2],v)&&arguments[0]instanceof h&&Lr(arguments[1],v))for(var d=arguments[0],p=arguments[1],g=arguments[2],n=p.iterator();n.hasNext();){var m=n.next();m.isForward()&&this.findStabbedSegments(d,m,g)}},getDepth:function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:Jr.min(e).leftDepth},interfaces_:function(){return[]},getClass:function(){return tr}}),Tr(er.prototype,{compareTo:function(t){var e=t;if(this.upwardSeg.minX()>=e.upwardSeg.maxX())return 1;if(this.upwardSeg.maxX()<=e.upwardSeg.minX())return-1;var n=this.upwardSeg.orientationIndex(e.upwardSeg);return 0!==n?n:(n=-1*e.upwardSeg.orientationIndex(this.upwardSeg),0!==n?n:this.upwardSeg.compareTo(e.upwardSeg))},compareX:function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},toString:function(){return this.upwardSeg.toString()},interfaces_:function(){return[r]},getClass:function(){return er}}),tr.DepthSegment=er,Tr(nr.prototype,{area:function(){return nr.area(this.p0,this.p1,this.p2)},signedArea:function(){return nr.signedArea(this.p0,this.p1,this.p2)},interpolateZ:function(t){if(null===t)throw new n("Supplied point is null.");return nr.interpolateZ(t,this.p0,this.p1,this.p2)},longestSideLength:function(){return nr.longestSideLength(this.p0,this.p1,this.p2)},isAcute:function(){return nr.isAcute(this.p0,this.p1,this.p2)},circumcentre:function(){return nr.circumcentre(this.p0,this.p1,this.p2)},area3D:function(){return nr.area3D(this.p0,this.p1,this.p2)},centroid:function(){return nr.centroid(this.p0,this.p1,this.p2)},inCentre:function(){return nr.inCentre(this.p0,this.p1,this.p2)},interfaces_:function(){return[]},getClass:function(){return nr}}),nr.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},nr.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},nr.det=function(t,e,n,i){return t*i-e*n},nr.interpolateZ=function(t,e,n,i){var r=e.x,o=e.y,a=n.x-r,s=i.x-r,u=n.y-o,l=i.y-o,c=a*l-s*u,h=t.x-r,f=t.y-o,d=(l*h-s*f)/c,p=(-u*h+a*f)/c;return e.z+d*(n.z-e.z)+p*(i.z-e.z)},nr.longestSideLength=function(t,e,n){var i=t.distance(e),r=e.distance(n),o=n.distance(t),a=i;return r>a&&(a=r),o>a&&(a=o),a},nr.isAcute=function(t,e,n){return!!Ki.isAcute(t,e,n)&&!!Ki.isAcute(e,n,t)&&!!Ki.isAcute(n,t,e)},nr.circumcentre=function(t,e,n){var i=n.x,r=n.y,o=t.x-i,a=t.y-r,s=e.x-i,u=e.y-r,l=2*nr.det(o,a,s,u);return new h(i-nr.det(a,o*o+a*a,u,s*s+u*u)/l,r+nr.det(o,o*o+a*a,s,s*s+u*u)/l)},nr.perpendicularBisector=function(t,e){var n=e.x-t.x,i=e.y-t.y;return new N(new N(t.x+n/2,t.y+i/2,1),new N(t.x-i+n/2,t.y+n+i/2,1))},nr.angleBisector=function(t,e,n){var i=e.distance(t),r=e.distance(n),o=i/(i+r),a=n.x-t.x,s=n.y-t.y;return new h(t.x+o*a,t.y+o*s)},nr.area3D=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,o=e.z-t.z,a=n.x-t.x,s=n.y-t.y,u=n.z-t.z,l=r*u-o*s,c=o*a-i*u,h=i*s-r*a,f=l*l+c*c+h*h;return Math.sqrt(f)/2},nr.centroid=function(t,e,n){return new h((t.x+e.x+n.x)/3,(t.y+e.y+n.y)/3)},nr.inCentre=function(t,e,n){var i=e.distance(n),r=t.distance(n),o=t.distance(e),a=i+r+o;return new h((i*t.x+r*e.x+o*n.x)/a,(i*t.y+r*e.y+o*n.y)/a)},Tr(ir.prototype,{addPoint:function(t){if(this.distance<=0)return null;var e=t.getCoordinates(),n=this.curveBuilder.getLineCurve(e,this.distance);this.addCurve(n,S.EXTERIOR,S.INTERIOR)},addPolygon:function(t){var e=this.distance,n=Ae.LEFT;this.distance<0&&(e=-this.distance,n=Ae.RIGHT);var i=t.getExteriorRing(),r=V.removeRepeatedPoints(i.getCoordinates());if(this.distance<0&&this.isErodedCompletely(i,this.distance))return null;if(this.distance<=0&&r.length<3)return null;this.addPolygonRing(r,e,n,S.EXTERIOR,S.INTERIOR);for(var o=0;o<t.getNumInteriorRing();o++){var a=t.getInteriorRingN(o),s=V.removeRepeatedPoints(a.getCoordinates());this.distance>0&&this.isErodedCompletely(a,-this.distance)||this.addPolygonRing(s,e,Ae.opposite(n),S.INTERIOR,S.EXTERIOR)}},isTriangleErodedCompletely:function(t,e){var n=new nr(t[0],t[1],t[2]),i=n.inCentre();return ae.distancePointLine(i,n.p0,n.p1)<Math.abs(e)},addLineString:function(t){if(this.distance<=0&&!this.curveBuilder.getBufferParameters().isSingleSided())return null;var e=V.removeRepeatedPoints(t.getCoordinates()),n=this.curveBuilder.getLineCurve(e,this.distance);this.addCurve(n,S.EXTERIOR,S.INTERIOR)},addCurve:function(t,e,n){if(null===t||t.length<2)return null;var i=new di(t,new ke(0,S.BOUNDARY,e,n));this.curveList.add(i)},getCurves:function(){return this.add(this.inputGeom),this.curveList},addPolygonRing:function(t,e,n,i,r){if(0===e&&t.length<It.MINIMUM_VALID_SIZE)return null;var o=i,a=r;t.length>=It.MINIMUM_VALID_SIZE&&ae.isCCW(t)&&(o=r,a=i,n=Ae.opposite(n));var s=this.curveBuilder.getRingCurve(t,n,e);this.addCurve(s,o,a)},add:function(t){if(t.isEmpty())return null;if(t instanceof Mt)this.addPolygon(t);else if(t instanceof xt)this.addLineString(t);else if(t instanceof Et)this.addPoint(t);else if(t instanceof Ct)this.addCollection(t);else if(t instanceof ct)this.addCollection(t);else if(t instanceof Ot)this.addCollection(t);else{if(!(t instanceof lt))throw new UnsupportedOperationException(t.getClass().getName());this.addCollection(t)}},isErodedCompletely:function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var i=t.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return e<0&&2*Math.abs(e)>r},addCollection:function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},interfaces_:function(){return[]},getClass:function(){return ir}}),Tr(rr.prototype,{isTrivialIntersection:function(t,e,n,i){if(t===n&&1===this.li.getIntersectionNum()){if(rr.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},getProperIntersectionPoint:function(){return this.properIntersectionPoint},hasProperInteriorIntersection:function(){return this.hasProperInterior},getLineIntersector:function(){return this.li},hasProperIntersection:function(){return this.hasProper},processIntersections:function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],s=n.getCoordinates()[i+1];this.li.computeIntersection(r,o,a,s),this.li.hasIntersection()&&(this.numIntersections++,this.li.isInteriorIntersection()&&(this.numInteriorIntersections++,this.hasInterior=!0),this.isTrivialIntersection(t,e,n,i)||(this._hasIntersection=!0,t.addIntersections(this.li,e,0),n.addIntersections(this.li,i,1),this.li.isProper()&&(this.numProperIntersections++,this.hasProper=!0,this.hasProperInterior=!0)))},hasIntersection:function(){return this._hasIntersection},isDone:function(){return!1},hasInteriorIntersection:function(){return this.hasInterior},interfaces_:function(){return[_i]},getClass:function(){return rr}}),rr.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)},Tr(or.prototype,{setWorkingPrecisionModel:function(t){this.workingPrecisionModel=t},insertUniqueEdge:function(t){var e=this.edgeList.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new ke(t.getLabel()),i.flip()),n.merge(i);var r=or.depthDelta(i),o=e.getDepthDelta(),a=o+r;e.setDepthDelta(a)}else this.edgeList.add(t),t.setDepthDelta(or.depthDelta(t.getLabel()))},buildSubgraphs:function(t,e){for(var n=new _,i=t.iterator();i.hasNext();){var r=i.next(),o=r.getRightmostCoordinate(),a=new tr(n),s=a.getDepth(o);r.computeDepth(s),r.findResultEdges(),n.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},createSubgraphs:function(t){for(var e=new _,n=t.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new Wi;r.create(i),e.add(r)}}return Jr.sort(e,Jr.reverseOrder()),
e},createEmptyResultGeometry:function(){return this.geomFact.createPolygon()},getNoder:function(t){if(null!==this.workingNoder)return this.workingNoder;var e=new mi,n=new ie;return n.setPrecisionModel(t),e.setSegmentIntersector(new rr(n)),e},buffer:function(t,e){var n=this.workingPrecisionModel;null===n&&(n=t.getPrecisionModel()),this.geomFact=t.getFactory();var i=new $i(n,this.bufParams),r=new ir(t,e,i),o=r.getCurves();if(o.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(o,n),this.graph=new Je(new qe),this.graph.addEdges(this.edgeList.getEdges());var a=this.createSubgraphs(this.graph),s=new Ei(this.geomFact);this.buildSubgraphs(a,s);var u=s.getPolygons();return u.size()<=0?this.createEmptyResultGeometry():this.geomFact.buildGeometry(u)},computeNodedEdges:function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var i=n.getNodedSubstrings(),r=i.iterator();r.hasNext();){var o=r.next(),a=o.getCoordinates();if(2!==a.length||!a[0].equals2D(a[1])){var s=o.getData(),u=new Tn(o.getCoordinates(),new ke(s));this.insertUniqueEdge(u)}}},setNoder:function(t){this.workingNoder=t},interfaces_:function(){return[]},getClass:function(){return or}}),or.depthDelta=function(t){var e=t.getLocation(0,Ae.LEFT),n=t.getLocation(0,Ae.RIGHT);return e===S.INTERIOR&&n===S.EXTERIOR?1:e===S.EXTERIOR&&n===S.INTERIOR?-1:0},or.convertSegStrings=function(t){for(var e=new $t,n=new _;t.hasNext();){var i=t.next(),r=e.createLineString(i.getCoordinates());n.add(r)}return e.buildGeometry(n)},Tr(ar.prototype,{rescale:function(){if(Lr(arguments[0],p))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){var i=arguments[0];2===i.length&&(new h(i[0]),new h(i[1]));for(var e=0;e<i.length;e++)i[e].x=i[e].x/this.scaleFactor+this.offsetX,i[e].y=i[e].y/this.scaleFactor+this.offsetY;2===i.length&&i[0].equals2D(i[1])&&L.out.println(i)}},scale:function(){if(Lr(arguments[0],p)){for(var t=arguments[0],e=new _,n=t.iterator();n.hasNext();){var i=n.next();e.add(new di(this.scale(i.getCoordinates()),i.getData()))}return e}if(arguments[0]instanceof Array){for(var r=arguments[0],o=new Array(r.length).fill(null),n=0;n<r.length;n++)o[n]=new h(Math.round((r[n].x-this.offsetX)*this.scaleFactor),Math.round((r[n].y-this.offsetY)*this.scaleFactor),r[n].z);return V.removeRepeatedPoints(o)}},isIntegerPrecision:function(){return 1===this.scaleFactor},getNodedSubstrings:function(){var t=this.noder.getNodedSubstrings();return this.isScaled&&this.rescale(t),t},computeNodes:function(t){var e=t;this.isScaled&&(e=this.scale(t)),this.noder.computeNodes(e)},interfaces_:function(){return[gi]},getClass:function(){return ar}}),Tr(sr.prototype,{checkEndPtVertexIntersections:function(){if(0===arguments.length)for(var t=this.segStrings.iterator();t.hasNext();){var e=t.next(),n=e.getCoordinates();this.checkEndPtVertexIntersections(n[0],this.segStrings),this.checkEndPtVertexIntersections(n[n.length-1],this.segStrings)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1],t=r.iterator();t.hasNext();)for(var e=t.next(),n=e.getCoordinates(),o=1;o<n.length-1;o++)if(n[o].equals(i))throw new u("found endpt/interior pt intersection at index "+o+" :pt "+i)},checkInteriorIntersections:function(){if(0===arguments.length)for(var t=this.segStrings.iterator();t.hasNext();)for(var e=t.next(),n=this.segStrings.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(e,i)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],a=r.getCoordinates(),s=o.getCoordinates(),l=0;l<a.length-1;l++)for(var c=0;c<s.length-1;c++)this.checkInteriorIntersections(r,l,o,c);else if(4===arguments.length){var h=arguments[0],f=arguments[1],d=arguments[2],p=arguments[3];if(h===d&&f===p)return null;var g=h.getCoordinates()[f],v=h.getCoordinates()[f+1],m=d.getCoordinates()[p],y=d.getCoordinates()[p+1];if(this.li.computeIntersection(g,v,m,y),this.li.hasIntersection()&&(this.li.isProper()||this.hasInteriorIntersection(this.li,g,v)||this.hasInteriorIntersection(this.li,m,y)))throw new u("found non-noded intersection at "+g+"-"+v+" and "+m+"-"+y)}},checkValid:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},checkCollapses:function(){if(0===arguments.length)for(var t=this.segStrings.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var n=arguments[0],i=n.getCoordinates(),t=0;t<i.length-2;t++)this.checkCollapse(i[t],i[t+1],i[t+2])},hasInteriorIntersection:function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++){var r=t.getIntersection(i);if(!r.equals(e)&&!r.equals(n))return!0}return!1},checkCollapse:function(t,e,n){if(t.equals(n))throw new u("found non-noded collapse at "+sr.fact.createLineString([t,e,n]))},interfaces_:function(){return[]},getClass:function(){return sr}}),sr.fact=new $t,Tr(ur.prototype,{intersectsScaled:function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y),a=this.maxx<n||this.minx>i||this.maxy<r||this.miny>o;if(a)return!1;var s=this.intersectsToleranceSquare(t,e);return c.isTrue(!(a&&s),"Found bad envelope test"),s},initCorners:function(t){this.minx=t.x-.5,this.maxx=t.x+.5,this.miny=t.y-.5,this.maxy=t.y+.5,this.corner[0]=new h(this.maxx,this.maxy),this.corner[1]=new h(this.minx,this.maxy),this.corner[2]=new h(this.minx,this.miny),this.corner[3]=new h(this.maxx,this.miny)},intersects:function(t,e){return 1===this.scaleFactor?this.intersectsScaled(t,e):(this.copyScaled(t,this.p0Scaled),this.copyScaled(e,this.p1Scaled),this.intersectsScaled(this.p0Scaled,this.p1Scaled))},scale:function(t){return Math.round(t*this.scaleFactor)},getCoordinate:function(){return this.originalPt},copyScaled:function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},getSafeEnvelope:function(){if(null===this.safeEnv){var t=ur.SAFE_ENV_EXPANSION_FACTOR/this.scaleFactor;this.safeEnv=new x(this.originalPt.x-t,this.originalPt.x+t,this.originalPt.y-t,this.originalPt.y+t)}return this.safeEnv},intersectsPixelClosure:function(t,e){return this.li.computeIntersection(t,e,this.corner[0],this.corner[1]),!!(this.li.hasIntersection()||(this.li.computeIntersection(t,e,this.corner[1],this.corner[2]),this.li.hasIntersection()||(this.li.computeIntersection(t,e,this.corner[2],this.corner[3]),this.li.hasIntersection()||(this.li.computeIntersection(t,e,this.corner[3],this.corner[0]),this.li.hasIntersection()))))},intersectsToleranceSquare:function(t,e){var n=!1,i=!1;return this.li.computeIntersection(t,e,this.corner[0],this.corner[1]),!!(this.li.isProper()||(this.li.computeIntersection(t,e,this.corner[1],this.corner[2]),this.li.isProper()||(this.li.hasIntersection()&&(n=!0),this.li.computeIntersection(t,e,this.corner[2],this.corner[3]),this.li.isProper()||(this.li.hasIntersection()&&(i=!0),this.li.computeIntersection(t,e,this.corner[3],this.corner[0]),this.li.isProper()||n&&i||t.equals(this.pt)||e.equals(this.pt)))))},addSnappedNode:function(t,e){var n=t.getCoordinate(e),i=t.getCoordinate(e+1);return!!this.intersects(n,i)&&(t.addIntersection(this.getCoordinate(),e),!0)},interfaces_:function(){return[]},getClass:function(){return ur}}),ur.SAFE_ENV_EXPANSION_FACTOR=.75,Tr(lr.prototype,{snap:function(){if(1===arguments.length){var t=arguments[0];return this.snap(t,null,-1)}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2],r=e.getSafeEnvelope(),o=new cr(e,n,i);return this.index.query(r,{interfaces_:function(){return[ve]},visitItem:function(t){t.select(r,o)}}),o.isNodeAdded()}},interfaces_:function(){return[]},getClass:function(){return lr}}),Pr(cr,Qe),Tr(cr.prototype,{isNodeAdded:function(){return this._isNodeAdded},select:function(){if(2!==arguments.length)return Qe.prototype.select.apply(this,arguments);var t=arguments[0],e=arguments[1],n=t.getContext();return null!==this.parentEdge&&n===this.parentEdge&&e===this.hotPixelVertexIndex?null:void(this._isNodeAdded=this.hotPixel.addSnappedNode(n,e))},interfaces_:function(){return[]},getClass:function(){return cr}}),lr.HotPixelSnapAction=cr,Tr(hr.prototype,{processIntersections:function(t,e,n,i){if(t===n&&e===i)return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],a=n.getCoordinates()[i],s=n.getCoordinates()[i+1];if(this.li.computeIntersection(r,o,a,s),this.li.hasIntersection()&&this.li.isInteriorIntersection()){for(var u=0;u<this.li.getIntersectionNum();u++)this.interiorIntersections.add(this.li.getIntersection(u));t.addIntersections(this.li,e,0),n.addIntersections(this.li,i,1)}},isDone:function(){return!1},getInteriorIntersections:function(){return this.interiorIntersections},interfaces_:function(){return[_i]},getClass:function(){return hr}}),Tr(fr.prototype,{checkCorrectness:function(t){var e=di.getNodedSubstrings(t),n=new sr(e);try{n.checkValid()}catch(t){if(!(t instanceof w))throw t;t.printStackTrace()}finally{}},getNodedSubstrings:function(){return di.getNodedSubstrings(this.nodedSegStrings)},snapRound:function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},findInteriorIntersections:function(t,e){var n=new hr(e);return this.noder.setSegmentIntersector(n),this.noder.computeNodes(t),n.getInteriorIntersections()},computeVertexSnaps:function(){if(Lr(arguments[0],p))for(var t=arguments[0],e=t.iterator();e.hasNext();){var n=e.next();this.computeVertexSnaps(n)}else if(arguments[0]instanceof di)for(var i=arguments[0],r=i.getCoordinates(),o=0;o<r.length;o++){var a=new ur(r[o],this.scaleFactor,this.li),s=this.pointSnapper.snap(a,i,o);s&&i.addIntersection(r[o],o)}},computeNodes:function(t){this.nodedSegStrings=t,this.noder=new mi,this.pointSnapper=new lr(this.noder.getIndex()),this.snapRound(t,this.li)},computeIntersectionSnaps:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=new ur(n,this.scaleFactor,this.li);this.pointSnapper.snap(i)}},interfaces_:function(){return[gi]},getClass:function(){return fr}}),Tr(dr.prototype,{bufferFixedPrecision:function(t){var e=new ar(new fr(new Kt(1)),t.getScale()),n=new or(this.bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this.resultGeometry=n.buffer(this.argGeom,this.distance)},bufferReducedPrecision:function(){if(0===arguments.length){for(var t=dr.MAX_PRECISION_DIGITS;t>=0;t--){try{this.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Le))throw t;this.saveException=t}finally{}if(null!==this.resultGeometry)return null}throw this.saveException}if(1===arguments.length){var e=arguments[0],n=dr.precisionScaleFactor(this.argGeom,this.distance,e),i=new Kt(n);this.bufferFixedPrecision(i)}},computeGeometry:function(){if(this.bufferOriginalPrecision(),null!==this.resultGeometry)return null;var t=this.argGeom.getFactory().getPrecisionModel();t.getType()===Kt.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},setQuadrantSegments:function(t){this.bufParams.setQuadrantSegments(t)},bufferOriginalPrecision:function(){try{var t=new or(this.bufParams);this.resultGeometry=t.buffer(this.argGeom,this.distance)}catch(t){if(!(t instanceof u))throw t;this.saveException=t}finally{}},getResultGeometry:function(t){return this.distance=t,this.computeGeometry(),this.resultGeometry},setEndCapStyle:function(t){this.bufParams.setEndCapStyle(t)},interfaces_:function(){return[]},getClass:function(){return dr}}),dr.bufferOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new dr(t),i=n.getResultGeometry(e);return i}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof D&&"number"==typeof arguments[1]){var r=arguments[0],o=arguments[1],a=arguments[2],s=new dr(r);s.setQuadrantSegments(a);var i=s.getResultGeometry(o);return i}if(arguments[2]instanceof Vi&&arguments[0]instanceof D&&"number"==typeof arguments[1]){var u=arguments[0],l=arguments[1],c=arguments[2],s=new dr(u,c),i=s.getResultGeometry(l);return i}}else if(4===arguments.length){var h=arguments[0],f=arguments[1],d=arguments[2],p=arguments[3],s=new dr(h);s.setQuadrantSegments(d),s.setEndCapStyle(p);var i=s.getResultGeometry(f);return i}},dr.precisionScaleFactor=function(t,e,n){var i=t.getEnvelopeInternal(),r=M.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY())),o=e>0?e:0,a=r+2*o,s=Math.trunc(Math.log(a)/Math.log(10)+1),u=n-s;return Math.pow(10,u)},dr.CAP_ROUND=Vi.CAP_ROUND,dr.CAP_BUTT=Vi.CAP_FLAT,dr.CAP_FLAT=Vi.CAP_FLAT,dr.CAP_SQUARE=Vi.CAP_SQUARE,dr.MAX_PRECISION_DIGITS=12,Tr(pr.prototype,{filter:function(t){this.treeSet.contains(t)||(this.list.add(t),this.treeSet.add(t))},getCoordinates:function(){var t=new Array(this.list.size()).fill(null);return this.list.toArray(t)},interfaces_:function(){return[F]},getClass:function(){return pr}}),pr.filterCoordinates=function(t){for(var e=new pr,n=0;n<t.length;n++)e.filter(t[n]);return e.getCoordinates()},Tr(gr.prototype,{preSort:function(t){for(var e=null,n=1;n<t.length;n++)(t[n].y<t[0].y||t[n].y===t[0].y&&t[n].x<t[0].x)&&(e=t[0],t[0]=t[n],t[n]=e);return ot.sort(t,1,t.length,new vr(t[0])),t},computeOctRing:function(t){var e=this.computeOctPts(t),n=new b;return n.add(e,!1),n.size()<3?null:(n.closeRing(),n.toCoordinateArray())},lineOrPolygon:function(t){if(t=this.cleanRing(t),3===t.length)return this.geomFactory.createLineString([t[0],t[1]]);var e=this.geomFactory.createLinearRing(t);return this.geomFactory.createPolygon(e,null)},cleanRing:function(t){c.equals(t[0],t[t.length-1]);for(var e=new _,n=null,i=0;i<=t.length-2;i++){var r=t[i],o=t[i+1];r.equals(o)||null!==n&&this.isBetween(n,r,o)||(e.add(r),n=r)}e.add(t[t.length-1]);var a=new Array(e.size()).fill(null);return e.toArray(a)},isBetween:function(t,e,n){if(0!==ae.computeOrientation(t,e,n))return!1;if(t.x!==n.x){if(t.x<=e.x&&e.x<=n.x)return!0;if(n.x<=e.x&&e.x<=t.x)return!0}if(t.y!==n.y){if(t.y<=e.y&&e.y<=n.y)return!0;if(n.y<=e.y&&e.y<=t.y)return!0}return!1},reduce:function(t){var e=this.computeOctRing(t);if(null===e)return t;for(var n=new rt,i=0;i<e.length;i++)n.add(e[i]);for(var i=0;i<t.length;i++)ae.isPointInRing(t[i],e)||n.add(t[i]);var r=V.toCoordinateArray(n);return r.length<3?this.padArray3(r):r},getConvexHull:function(){if(0===this.inputPts.length)return this.geomFactory.createGeometryCollection(null);if(1===this.inputPts.length)return this.geomFactory.createPoint(this.inputPts[0]);if(2===this.inputPts.length)return this.geomFactory.createLineString(this.inputPts);var t=this.inputPts;this.inputPts.length>50&&(t=this.reduce(this.inputPts));var e=this.preSort(t),n=this.grahamScan(e),i=this.toCoordinateArray(n);return this.lineOrPolygon(i)},padArray3:function(t){for(var e=new Array(3).fill(null),n=0;n<e.length;n++)n<t.length?e[n]=t[n]:e[n]=t[0];return e},computeOctPts:function(t){for(var e=new Array(8).fill(null),n=0;n<e.length;n++)e[n]=t[0];for(var i=1;i<t.length;i++)t[i].x<e[0].x&&(e[0]=t[i]),t[i].x-t[i].y<e[1].x-e[1].y&&(e[1]=t[i]),t[i].y>e[2].y&&(e[2]=t[i]),t[i].x+t[i].y>e[3].x+e[3].y&&(e[3]=t[i]),t[i].x>e[4].x&&(e[4]=t[i]),t[i].x-t[i].y>e[5].x-e[5].y&&(e[5]=t[i]),t[i].y<e[6].y&&(e[6]=t[i]),t[i].x+t[i].y<e[7].x+e[7].y&&(e[7]=t[i]);return e},toCoordinateArray:function(t){for(var e=new Array(t.size()).fill(null),n=0;n<t.size();n++){var i=t.get(n);e[n]=i}return e},grahamScan:function(t){var e=null,n=new Hi;e=n.push(t[0]),e=n.push(t[1]),e=n.push(t[2]);for(var i=3;i<t.length;i++){for(e=n.pop();!n.empty()&&ae.computeOrientation(n.peek(),e,t[i])>0;)e=n.pop();e=n.push(e),e=n.push(t[i])}return e=n.push(t[0]),n},interfaces_:function(){return[]},getClass:function(){return gr}}),gr.extractCoordinates=function(t){var e=new pr;return t.apply(e),e.getCoordinates()},Tr(vr.prototype,{compare:function(t,e){var n=t,i=e;return vr.polarCompare(this.origin,n,i)},interfaces_:function(){return[a]},getClass:function(){return vr}}),vr.polarCompare=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,o=n.x-t.x,a=n.y-t.y,s=ae.computeOrientation(t,e,n);if(s===ae.COUNTERCLOCKWISE)return 1;if(s===ae.CLOCKWISE)return-1;var u=i*i+r*r,l=o*o+a*a;return u<l?-1:u>l?1:0},gr.RadialComparator=vr,Tr(mr.prototype,{addPoint:function(t){this.ptCount+=1,this.ptCentSum.x+=t.x,this.ptCentSum.y+=t.y},setBasePoint:function(t){null===this.areaBasePt&&(this.areaBasePt=t)},addLineSegments:function(t){for(var e=0,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);if(0!==i){e+=i;var r=(t[n].x+t[n+1].x)/2;this.lineCentSum.x+=i*r;var o=(t[n].y+t[n+1].y)/2;this.lineCentSum.y+=i*o}}this.totalLength+=e,0===e&&t.length>0&&this.addPoint(t[0])},addHole:function(t){for(var e=ae.isCCW(t),n=0;n<t.length-1;n++)this.addTriangle(this.areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)},getCentroid:function(){var t=new h;if(Math.abs(this.areasum2)>0)t.x=this.cg3.x/3/this.areasum2,t.y=this.cg3.y/3/this.areasum2;else if(this.totalLength>0)t.x=this.lineCentSum.x/this.totalLength,t.y=this.lineCentSum.y/this.totalLength;else{if(!(this.ptCount>0))return null;t.x=this.ptCentSum.x/this.ptCount,t.y=this.ptCentSum.y/this.ptCount}return t},addShell:function(t){t.length>0&&this.setBasePoint(t[0]);for(var e=!ae.isCCW(t),n=0;n<t.length-1;n++)this.addTriangle(this.areaBasePt,t[n],t[n+1],e);this.addLineSegments(t)},addTriangle:function(t,e,n,i){var r=i?1:-1;mr.centroid3(t,e,n,this.triangleCent3);var o=mr.area2(t,e,n);this.cg3.x+=r*o*this.triangleCent3.x,this.cg3.y+=r*o*this.triangleCent3.y,this.areasum2+=r*o},add:function(){if(arguments[0]instanceof Mt){var t=arguments[0];this.addShell(t.getExteriorRing().getCoordinates());for(var e=0;e<t.getNumInteriorRing();e++)this.addHole(t.getInteriorRingN(e).getCoordinates())}else if(arguments[0]instanceof D){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof Et)this.addPoint(n.getCoordinate());else if(n instanceof xt)this.addLineSegments(n.getCoordinates());else if(n instanceof Mt){var i=n;this.add(i)}else if(n instanceof lt)for(var r=n,e=0;e<r.getNumGeometries();e++)this.add(r.getGeometryN(e))}},interfaces_:function(){return[]},getClass:function(){return mr}}),mr.area2=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)},mr.centroid3=function(t,e,n,i){return i.x=t.x+e.x+n.x,i.y=t.y+e.y+n.y,null},mr.getCentroid=function(t){return new mr(t).getCentroid()},Tr(yr.prototype,{isIntersects:function(){return!this.isDisjoint()},isCovers:function(){return(yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])||yr.isTrue(this.matrix[S.INTERIOR][S.BOUNDARY])||yr.isTrue(this.matrix[S.BOUNDARY][S.INTERIOR])||yr.isTrue(this.matrix[S.BOUNDARY][S.BOUNDARY]))&&this.matrix[S.EXTERIOR][S.INTERIOR]===at.FALSE&&this.matrix[S.EXTERIOR][S.BOUNDARY]===at.FALSE},isCoveredBy:function(){return(yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])||yr.isTrue(this.matrix[S.INTERIOR][S.BOUNDARY])||yr.isTrue(this.matrix[S.BOUNDARY][S.INTERIOR])||yr.isTrue(this.matrix[S.BOUNDARY][S.BOUNDARY]))&&this.matrix[S.INTERIOR][S.EXTERIOR]===at.FALSE&&this.matrix[S.BOUNDARY][S.EXTERIOR]===at.FALSE},set:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.matrix[n][i]=at.toDimensionValue(t.charAt(e))}else if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];this.matrix[r][o]=a}},isContains:function(){return yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])&&this.matrix[S.EXTERIOR][S.INTERIOR]===at.FALSE&&this.matrix[S.EXTERIOR][S.BOUNDARY]===at.FALSE},setAtLeast:function(){if(1===arguments.length)for(var t=arguments[0],e=0;e<t.length;e++){var n=Math.trunc(e/3),i=e%3;this.setAtLeast(n,i,at.toDimensionValue(t.charAt(e)))}else if(3===arguments.length){var r=arguments[0],o=arguments[1],a=arguments[2];this.matrix[r][o]<a&&(this.matrix[r][o]=a)}},setAtLeastIfValid:function(t,e,n){t>=0&&e>=0&&this.setAtLeast(t,e,n)},isWithin:function(){return yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])&&this.matrix[S.INTERIOR][S.EXTERIOR]===at.FALSE&&this.matrix[S.BOUNDARY][S.EXTERIOR]===at.FALSE},isTouches:function(t,e){return t>e?this.isTouches(e,t):(t===at.A&&e===at.A||t===at.L&&e===at.L||t===at.L&&e===at.A||t===at.P&&e===at.A||t===at.P&&e===at.L)&&this.matrix[S.INTERIOR][S.INTERIOR]===at.FALSE&&(yr.isTrue(this.matrix[S.INTERIOR][S.BOUNDARY])||yr.isTrue(this.matrix[S.BOUNDARY][S.INTERIOR])||yr.isTrue(this.matrix[S.BOUNDARY][S.BOUNDARY]))},isOverlaps:function(t,e){return t===at.P&&e===at.P||t===at.A&&e===at.A?yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])&&yr.isTrue(this.matrix[S.INTERIOR][S.EXTERIOR])&&yr.isTrue(this.matrix[S.EXTERIOR][S.INTERIOR]):t===at.L&&e===at.L&&1===this.matrix[S.INTERIOR][S.INTERIOR]&&yr.isTrue(this.matrix[S.INTERIOR][S.EXTERIOR])&&yr.isTrue(this.matrix[S.EXTERIOR][S.INTERIOR])},isEquals:function(t,e){return t===e&&yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])&&this.matrix[S.INTERIOR][S.EXTERIOR]===at.FALSE&&this.matrix[S.BOUNDARY][S.EXTERIOR]===at.FALSE&&this.matrix[S.EXTERIOR][S.INTERIOR]===at.FALSE&&this.matrix[S.EXTERIOR][S.BOUNDARY]===at.FALSE},toString:function(){for(var t=new C("123456789"),e=0;e<3;e++)for(var n=0;n<3;n++)t.setCharAt(3*e+n,at.toDimensionSymbol(this.matrix[e][n]));return t.toString()},setAll:function(t){for(var e=0;e<3;e++)for(var n=0;n<3;n++)this.matrix[e][n]=t},get:function(t,e){return this.matrix[t][e]},transpose:function(){var t=this.matrix[1][0];return this.matrix[1][0]=this.matrix[0][1],this.matrix[0][1]=t,t=this.matrix[2][0],this.matrix[2][0]=this.matrix[0][2],this.matrix[0][2]=t,t=this.matrix[2][1],this.matrix[2][1]=this.matrix[1][2],this.matrix[1][2]=t,this},matches:function(t){if(9!==t.length)throw new n("Should be length 9: "+t);for(var e=0;e<3;e++)for(var i=0;i<3;i++)if(!yr.matches(this.matrix[e][i],t.charAt(3*e+i)))return!1;return!0},add:function(t){for(var e=0;e<3;e++)for(var n=0;n<3;n++)this.setAtLeast(e,n,t.get(e,n))},isDisjoint:function(){return this.matrix[S.INTERIOR][S.INTERIOR]===at.FALSE&&this.matrix[S.INTERIOR][S.BOUNDARY]===at.FALSE&&this.matrix[S.BOUNDARY][S.INTERIOR]===at.FALSE&&this.matrix[S.BOUNDARY][S.BOUNDARY]===at.FALSE},isCrosses:function(t,e){return t===at.P&&e===at.L||t===at.P&&e===at.A||t===at.L&&e===at.A?yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])&&yr.isTrue(this.matrix[S.INTERIOR][S.EXTERIOR]):t===at.L&&e===at.P||t===at.A&&e===at.P||t===at.A&&e===at.L?yr.isTrue(this.matrix[S.INTERIOR][S.INTERIOR])&&yr.isTrue(this.matrix[S.EXTERIOR][S.INTERIOR]):t===at.L&&e===at.L&&0===this.matrix[S.INTERIOR][S.INTERIOR]},interfaces_:function(){return[o]},getClass:function(){return yr}}),yr.matches=function(){if(Number.isInteger(arguments[0])&&"string"==typeof arguments[1]){var t=arguments[0],e=arguments[1];return e===at.SYM_DONTCARE||e===at.SYM_TRUE&&(t>=0||t===at.TRUE)||e===at.SYM_FALSE&&t===at.FALSE||e===at.SYM_P&&t===at.P||e===at.SYM_L&&t===at.L||e===at.SYM_A&&t===at.A}if("string"==typeof arguments[0]&&"string"==typeof arguments[1]){var n=arguments[0],i=arguments[1];return new yr(n).matches(i)}};yr.isTrue=function(t){return t>=0||t===at.TRUE},Tr(_r.prototype,{insertEdgeEnds:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.nodes.add(n)}},computeProperIntersectionIM:function(t,e){var n=this.arg[0].getGeometry().getDimension(),i=this.arg[1].getGeometry().getDimension(),r=t.hasProperIntersection(),o=t.hasProperInteriorIntersection();2===n&&2===i?r&&e.setAtLeast("212101212"):2===n&&1===i?(r&&e.setAtLeast("FFF0FFFF2"),o&&e.setAtLeast("1FFFFF1FF")):1===n&&2===i?(r&&e.setAtLeast("F0FFFFFF2"),o&&e.setAtLeast("1F1FFFFFF")):1===n&&1===i&&o&&e.setAtLeast("0FFFFFFFF")},labelIsolatedEdges:function(t,e){for(var n=this.arg[t].getEdgeIterator();n.hasNext();){var i=n.next();i.isIsolated()&&(this.labelIsolatedEdge(i,e,this.arg[e].getGeometry()),this.isolatedEdges.add(i))}},labelIsolatedEdge:function(t,e,n){if(n.getDimension()>0){var i=this.ptLocator.locate(t.getCoordinate(),n);t.getLabel().setAllLocations(e,i)}else t.getLabel().setAllLocations(e,S.EXTERIOR)},computeIM:function(){var t=new yr;if(t.set(S.EXTERIOR,S.EXTERIOR,2),!this.arg[0].getGeometry().getEnvelopeInternal().intersects(this.arg[1].getGeometry().getEnvelopeInternal()))return this.computeDisjointIM(t),t;this.arg[0].computeSelfNodes(this.li,!1),this.arg[1].computeSelfNodes(this.li,!1);var e=this.arg[0].computeEdgeIntersections(this.arg[1],this.li,!1);this.computeIntersectionNodes(0),this.computeIntersectionNodes(1),this.copyNodesAndLabels(0),this.copyNodesAndLabels(1),this.labelIsolatedNodes(),this.computeProperIntersectionIM(e,t);var n=new An,i=n.computeEdgeEnds(this.arg[0].getEdgeIterator());this.insertEdgeEnds(i);var r=n.computeEdgeEnds(this.arg[1].getEdgeIterator());return this.insertEdgeEnds(r),this.labelNodeEdges(),this.labelIsolatedEdges(0,1),this.labelIsolatedEdges(1,0),this.updateIM(t),t},labelNodeEdges:function(){for(var t=this.nodes.iterator();t.hasNext();)t.next().getEdges().computeLabelling(this.arg)},copyNodesAndLabels:function(t){for(var e=this.arg[t].getNodeIterator();e.hasNext();){var n=e.next();this.nodes.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},labelIntersectionNodes:function(t){for(var e=this.arg[t].getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var o=r.next(),a=this.nodes.find(o.coord);a.getLabel().isNull(t)&&(i===S.BOUNDARY?a.setLabelBoundary(t):a.setLabel(t,S.INTERIOR))}},labelIsolatedNode:function(t,e){var n=this.ptLocator.locate(t.getCoordinate(),this.arg[e].getGeometry());t.getLabel().setAllLocations(e,n)},computeIntersectionNodes:function(t){for(var e=this.arg[t].getEdgeIterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.getEdgeIntersectionList().iterator();r.hasNext();){var o=r.next(),a=this.nodes.addNode(o.coord);i===S.BOUNDARY?a.setLabelBoundary(t):a.getLabel().isNull(t)&&a.setLabel(t,S.INTERIOR)}},labelIsolatedNodes:function(){for(var t=this.nodes.iterator();t.hasNext();){var e=t.next(),n=e.getLabel();c.isTrue(n.getGeometryCount()>0,"node with empty label found"),e.isIsolated()&&(n.isNull(0)?this.labelIsolatedNode(e,0):this.labelIsolatedNode(e,1))}},updateIM:function(t){for(var e=this.isolatedEdges.iterator();e.hasNext();)e.next().updateIM(t);for(var n=this.nodes.iterator();n.hasNext();){var i=n.next();i.updateIM(t),i.updateIMFromEdges(t)}},computeDisjointIM:function(t){var e=this.arg[0].getGeometry();e.isEmpty()||(t.set(S.INTERIOR,S.EXTERIOR,e.getDimension()),t.set(S.BOUNDARY,S.EXTERIOR,e.getBoundaryDimension()));var n=this.arg[1].getGeometry();n.isEmpty()||(t.set(S.EXTERIOR,S.INTERIOR,n.getDimension()),t.set(S.EXTERIOR,S.BOUNDARY,n.getBoundaryDimension()))},interfaces_:function(){return[]},getClass:function(){return _r}}),Tr(br.prototype,{isContainedInBoundary:function(t){if(t instanceof Mt)return!1;if(t instanceof Et)return this.isPointContainedInBoundary(t);if(t instanceof xt)return this.isLineStringContainedInBoundary(t);for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);if(!this.isContainedInBoundary(n))return!1}return!0},isLineSegmentContainedInBoundary:function(t,e){if(t.equals(e))return this.isPointContainedInBoundary(t);if(t.x===e.x){if(t.x===this.rectEnv.getMinX()||t.x===this.rectEnv.getMaxX())return!0}else if(t.y===e.y&&(t.y===this.rectEnv.getMinY()||t.y===this.rectEnv.getMaxY()))return!0;return!1},isLineStringContainedInBoundary:function(t){for(var e=t.getCoordinateSequence(),n=new h,i=new h,r=0;r<e.size()-1;r++)if(e.getCoordinate(r,n),e.getCoordinate(r+1,i),!this.isLineSegmentContainedInBoundary(n,i))return!1;return!0},isPointContainedInBoundary:function(){if(arguments[0]instanceof Et){var t=arguments[0];return this.isPointContainedInBoundary(t.getCoordinate())}if(arguments[0]instanceof h){var e=arguments[0];return e.x===this.rectEnv.getMinX()||e.x===this.rectEnv.getMaxX()||e.y===this.rectEnv.getMinY()||e.y===this.rectEnv.getMaxY()}},contains:function(t){return!!this.rectEnv.contains(t.getEnvelopeInternal())&&!this.isContainedInBoundary(t)},interfaces_:function(){return[]},getClass:function(){return br}}),br.contains=function(t,e){return new br(t).contains(e)},Tr(xr.prototype,{intersects:function(t,e){var n=new x(t,e);if(!this.rectEnv.intersects(n))return!1;if(this.rectEnv.intersects(t))return!0;if(this.rectEnv.intersects(e))return!0;if(t.compareTo(e)>0){var i=t;t=e,e=i}var r=!1;return e.y>t.y&&(r=!0),r?this.li.computeIntersection(t,e,this.diagDown0,this.diagDown1):this.li.computeIntersection(t,e,this.diagUp0,this.diagUp1),!!this.li.hasIntersection()},interfaces_:function(){return[]},getClass:function(){return xr}}),Tr(wr.prototype,{applyTo:function(t){for(var e=0;e<t.getNumGeometries()&&!this._isDone;e++){var n=t.getGeometryN(e);if(n instanceof lt)this.applyTo(n);else if(this.visit(n),this.isDone())return this._isDone=!0,null}},interfaces_:function(){return[]},getClass:function(){return wr}}),Tr(Er.prototype,{intersects:function(t){if(!this.rectEnv.intersects(t.getEnvelopeInternal()))return!1;var e=new Sr(this.rectEnv);if(e.applyTo(t),e.intersects())return!0;var n=new Mr(this.rectangle);if(n.applyTo(t),n.containsPoint())return!0;var i=new Cr(this.rectangle);return i.applyTo(t),!!i.intersects()},interfaces_:function(){return[]},getClass:function(){return Er}}),Er.intersects=function(t,e){return new Er(t).intersects(e)},Pr(Sr,wr),Tr(Sr.prototype,{isDone:function(){return this._intersects===!0},visit:function(t){var e=t.getEnvelopeInternal();return this.rectEnv.intersects(e)?this.rectEnv.contains(e)?(this._intersects=!0,null):e.getMinX()>=this.rectEnv.getMinX()&&e.getMaxX()<=this.rectEnv.getMaxX()?(this._intersects=!0,null):e.getMinY()>=this.rectEnv.getMinY()&&e.getMaxY()<=this.rectEnv.getMaxY()?(this._intersects=!0,null):void 0:null},intersects:function(){return this._intersects},interfaces_:function(){return[]},getClass:function(){return Sr}}),Pr(Mr,wr),Tr(Mr.prototype,{isDone:function(){return this._containsPoint===!0},visit:function(t){if(!(t instanceof Mt))return null;var e=t.getEnvelopeInternal();if(!this.rectEnv.intersects(e))return null;for(var n=new h,i=0;i<4;i++)if(this.rectSeq.getCoordinate(i,n),e.contains(n)&&je.containsPointInPolygon(n,t))return this._containsPoint=!0,null},containsPoint:function(){return this._containsPoint},interfaces_:function(){return[]},getClass:function(){return Mr}}),Pr(Cr,wr),Tr(Cr.prototype,{intersects:function(){return this.hasIntersection},isDone:function(){return this.hasIntersection===!0},visit:function(t){var e=t.getEnvelopeInternal();if(!this.rectEnv.intersects(e))return null;var n=Oe.getLines(t);this.checkIntersectionWithLineStrings(n)},checkIntersectionWithLineStrings:function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();if(this.checkIntersectionWithSegments(n),this.hasIntersection)return null}},checkIntersectionWithSegments:function(t){for(var e=t.getCoordinateSequence(),n=1;n<e.size();n++)if(e.getCoordinate(n-1,this.p0),e.getCoordinate(n,this.p1),this.rectIntersector.intersects(this.p0,this.p1))return this.hasIntersection=!0,null},interfaces_:function(){return[]},getClass:function(){return Cr}}),Pr(Ir,Ci),Tr(Ir.prototype,{getIntersectionMatrix:function(){return this._relate.computeIM()},interfaces_:function(){return[]},getClass:function(){return Ir}}),Ir.covers=function(t,e){return!!t.getEnvelopeInternal().covers(e.getEnvelopeInternal())&&(!!t.isRectangle()||Ir.relate(t,e).isCovers())},Ir.intersects=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&(t.isRectangle()?Er.intersects(t,e):e.isRectangle()?Er.intersects(e,t):Ir.relate(t,e).isIntersects())},Ir.touches=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&Ir.relate(t,e).isTouches(t.getDimension(),e.getDimension())},Ir.within=function(t,e){return e.contains(t)},Ir.coveredBy=function(t,e){return Ir.covers(e,t)},Ir.relate=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new Ir(t,e),i=n.getIntersectionMatrix();return i}if(3===arguments.length){if("string"==typeof arguments[2]&&arguments[0]instanceof D&&arguments[1]instanceof D){var r=arguments[0],o=arguments[1],a=arguments[2];return Ir.relateWithCheck(r,o).matches(a)}if(Lr(arguments[2],B)&&arguments[0]instanceof D&&arguments[1]instanceof D){var s=arguments[0],u=arguments[1],l=arguments[2],n=new Ir(s,u,l),i=n.getIntersectionMatrix();
return i}}},Ir.overlaps=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&Ir.relate(t,e).isOverlaps(t.getDimension(),e.getDimension())},Ir.disjoint=function(t,e){return!t.intersects(e)},Ir.relateWithCheck=function(t,e){return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),Ir.relate(t,e)},Ir.crosses=function(t,e){return!!t.getEnvelopeInternal().intersects(e.getEnvelopeInternal())&&Ir.relate(t,e).isCrosses(t.getDimension(),e.getDimension())},Ir.contains=function(t,e){return!!t.getEnvelopeInternal().contains(e.getEnvelopeInternal())&&(t.isRectangle()?br.contains(t,e):Ir.relate(t,e).isContains())},Tr(Or.prototype,{getInteriorPoint:function(){return this.interiorPoint},add:function(){if(arguments[0]instanceof D){var t=arguments[0];if(t instanceof Et)this.add(t.getCoordinate());else if(t instanceof lt)for(var e=t,n=0;n<e.getNumGeometries();n++)this.add(e.getGeometryN(n))}else if(arguments[0]instanceof h){var i=arguments[0],r=i.distance(this.centroid);r<this.minDistance&&(this.interiorPoint=new h(i),this.minDistance=r)}},interfaces_:function(){return[]},getClass:function(){return Or}}),Tr(D.prototype,{equalsTopo:function(t){return!!this.getEnvelopeInternal().equals(t.getEnvelopeInternal())&&Ir.relate(this,t).isEquals(this.getDimension(),t.getDimension())},union:function(){if(0===arguments.length)return Bi.union(this);if(1===arguments.length){var t=arguments[0];return ji.union(this,t)}},isValid:function(){return Jn.isValid(this)},intersection:function(t){if(this.isEmpty()||t.isEmpty())return Ti.createEmptyResult(Ti.INTERSECTION,this,t,this.factory);if(this.isGeometryCollection()){var e=t;return Pe.map(this,{interfaces_:function(){return[MapOp]},map:function(t){return t.intersection(e)}})}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),Ai.overlayOp(this,t,Ti.INTERSECTION)},covers:function(t){return Ir.covers(this,t)},coveredBy:function(t){return Ir.coveredBy(this,t)},touches:function(t){return Ir.touches(this,t)},intersects:function(t){return Ir.intersects(this,t)},within:function(t){return Ir.within(this,t)},overlaps:function(t){return Ir.overlaps(this,t)},disjoint:function(t){return Ir.disjoint(this,t)},crosses:function(t){return Ir.crosses(this,t)},buffer:function(){if(1===arguments.length){var t=arguments[0];return dr.bufferOp(this,t)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return dr.bufferOp(this,e,n)}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];return dr.bufferOp(this,i,r,o)}},convexHull:function(){return new gr(this).getConvexHull()},relate:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return Ir.relate.apply(Ir,[this].concat(e))},getCentroid:function(){if(this.isEmpty())return this.factory.createPoint();var t=mr.getCentroid(this);return this.createPointFromInternalCoord(t,this)},getInteriorPoint:function(){if(this.isEmpty())return this.factory.createPoint();var t=null,e=this.getDimension();if(0===e){var n=new Or(this);t=n.getInteriorPoint()}else if(1===e){var n=new Ui(this);t=n.getInteriorPoint()}else{var n=new Li(this);t=n.getInteriorPoint()}return this.createPointFromInternalCoord(t,this)},symDifference:function(t){if(this.isEmpty()||t.isEmpty()){if(this.isEmpty()&&t.isEmpty())return Ti.createEmptyResult(Ti.SYMDIFFERENCE,this,t,this.factory);if(this.isEmpty())return t.copy();if(t.isEmpty())return this.copy()}return this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),Ai.overlayOp(this,t,Ti.SYMDIFFERENCE)},createPointFromInternalCoord:function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},toText:function(){return(new ee).write(this)},toString:function(){this.toText()},contains:function(t){return Ir.contains(this,t)},difference:function(t){return this.isEmpty()?Ti.createEmptyResult(Ti.DIFFERENCE,this,t,this.factory):t.isEmpty()?this.copy():(this.checkNotGeometryCollection(this),this.checkNotGeometryCollection(t),Ai.overlayOp(this,t,Ti.DIFFERENCE))},isSimple:function(){return new zi(this).isSimple()},isWithinDistance:function(t,e){return!(this.getEnvelopeInternal().distance(t.getEnvelopeInternal())>e)&&Te.isWithinDistance(this,t,e)},distance:function(t){return Te.distance(this,t)},isEquivalentClass:function(t){return this.getClass()===t.getClass()}}),t.version="1.4.0 (1ba5f4e)",t.geom=Vr,t.index=Hr,t.io=Zr,t.operation=Qr,Object.defineProperty(t,"__esModule",{value:!0})})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(38),s=i(a),u=n(120),l=i(u),c=n(15),h=function(){function t(){r(this,t),this._emitter=new s.default,this.id=l.default.generate()}return o(t,[{key:"on",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length<2)return this;for(var i=e.pop(),r=e,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;this._emitter.on(u,i)}return this}},{key:"once",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length<2)return this;for(var i=e.pop(),r=e,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;this._emitter.once(u,i)}return this}},{key:"off",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length<2)return this;for(var i=e.pop(),r=e,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;this._emitter.off(u,i)}return this}},{key:"emit",value:function(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(e=this._emitter).emit.apply(e,[t].concat(i)),this}},{key:"platform",value:function(){var t=window.navigator.userAgent,e=/Android/i.test(t),n=/BlackBerry/i.test(t),i=/IEMobile/i.test(t),r=/iPhone|iPad|iPod/i.test(t),o=e||n||i||r;return r?c.Platform.iOS:e?c.Platform.Android:n?c.Platform.BlackBerry:i?c.Platform.WindowPhone:o?c.Platform.other:c.Platform.PC}},{key:"fire",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.emit.apply(this,[t].concat(n))}},{key:"listeners",value:function(t){return this._emitter.listeners(t)}},{key:"hasListeners",value:function(t){return this._emitter.hasListeners(t)}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}();e.default=h},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=void 0,o=function(){function t(){n(this,t)}return i(t,[{key:"update",value:function(t){this._provider.update(t)}},{key:"ofNumber",value:function(){var t;return(t=this._provider).ofNumber.apply(t,arguments)}},{key:"ofObject",value:function(){var t;return(t=this._provider).ofObject.apply(t,arguments)}},{key:"provider",get:function(){return this._provider},set:function(t){this._provider=t}}],[{key:"getInstance",value:function(){return r||(r=new t),r}}]),t}();e.default=o},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0}),e.DOMUtils=void 0;var r=n(47),o=i(r);e.DOMUtils=o},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(4),a=new o.geom.GeometryFactory,s=new o.io.GeoJSONReader(a),u=new o.io.GeoJSONWriter,l=function(){function t(){i(this,t)}return r(t,null,[{key:"getFactory",value:function(){return a}},{key:"getGeoReader",value:function(){return s}},{key:"getGeoWriter",value:function(){return u}},{key:"getLongEdge",value:function(t){var e=null;if(!t)return e;var n=t.getGeometryType();if("Polygon"===n)for(var i=t.getExteriorRing(),r=i.getCoordinates(),a=0,s=1;s<r.length;s++){var u=new o.geom.LineSegment(r[s-1],r[s]),l=u.getLength();a<l&&(e=u,a=l)}return e}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Response=e.Request=e.Headers=void 0;var r=n(77),o=i(r),a=n(20),s=i(a),u=n(40),l=i(u),c=n(41),h=i(c),f=n(78),d=i(f);o.default.helper={timeout:d.default},e.default=o.default,e.Headers=s.default,e.Request=l.default,e.Response=h.default},function(t,e,n){"use strict";function i(){r(this,o)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o={type:function(){return"default"},margin:0};e.default=i},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),c=i(l),h=n(19),f=i(h),d=n(3),p=n(7),g=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,e),!t)throw new Error("Control: Invalid name");var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._options=s({position:"bottomleft"},n),i._name=t,i._element=i._options.element,i._container=null,i._map=null,i._needAppend=!0,i._element&&(i._needAppend=!1),i._options.container&&i.setContainer(n.container),i}return a(e,t),u(e,[{key:"setContainer",value:function(t){return this._container=(0,d.isString)(t)?document.getElementById(t):t,this}},{key:"getContainer",value:function(){return this._container}},{key:"getMap",value:function(){return this._map}},{key:"addTo",value:function(t){return t instanceof f.default?t.addDomControl(this):console.warn("addTo: Invalid map"),this}},{key:"removeFrom",value:function(t){return t===this._map&&t.removeDomControl(this),this}},{key:"hide",value:function(){return this._element.style.display="none",this}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";return this._element.style.display=t,this}},{key:"disable",value:function(){return this}},{key:"enable",value:function(){return this}},{key:"_onAdd",value:function(t){var e=this._options.position;if(this.emit("add",this),this._map=t,t.controlDom&&!this._container){var n=t.controlCorners[e],i=void 0,r=void 0;if(n)i="ngr-control",r=n;else{if("custom"!==e)throw new Error("Invalid control position");i="ngr-custom-control",r=t.controlDom}p.DOMUtils.addClass(this._element,i),this.setContainer(r)}return this._needAppend&&(e.indexOf("bottom")!==-1?this._container.insertBefore(this._element,this._container.firstChild):this._container.appendChild(this._element)),this}},{key:"_onRemove",value:function(t){return this.emit("remove",this),this._map=null,this._needAppend&&(this._container.removeChild(this._element),this._container=null),this}},{key:"_refocusOnMap",value:function(){return this._map&&this._map.targetDom.focus(),this}},{key:"element",get:function(){return this._element}}]),e}(c.default);e.default=g},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.devServerHost="http://localhost",e.blueVersion="2.0",e.supportParticle=!1,e.enableQuadTree=!1,e.isDev=!1,e.isProd=!0,e.isLite=!1,e.touchEmulator=!1},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,null,[{key:"parseColor",value:function(t){var e=16777215;return"number"==typeof t?e=Math.floor(t):"string"==typeof t?e=parseInt(t,16):console.warn("Unknown Color",t),e}},{key:"converToSharp",value:function(t){var e=t;return"string"==typeof t&&(e=e.replace("0x","#")),e}},{key:"parseStringColor",value:function(t){var e=16777215;if("string"!=typeof t)return console.warn("Invalid String"),e;var n=/^\#([A-Fa-f0-9]+)$/.exec(t);if(n){var i=n[1],r=i.length;if(3===r){var o=i.charAt(0)+i.charAt(0)+i.charAt(1)+i.charAt(1)+i.charAt(2)+i.charAt(2);e=parseInt(o,16)}else 6===r?e=parseInt(t,16):console.warn("Unknown Color",t)}else console.warn("Unknown Color",t);return e}}]),t}();e.default=r},function(t,e,n){(function(e,i){/*!
	 * @overview es6-promise - a tiny implementation of Promises/A+.
	 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
	 * @license   Licensed under MIT license
	 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
	 * @version   4.1.1
	 */
!function(e,n){t.exports=n()}(this,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function r(t){return"function"==typeof t}function o(t){Z=t}function a(t){J=t}function s(){return function(){return e.nextTick(f)}}function u(){return"undefined"!=typeof W?function(){W(f)}:h()}function l(){var t=0,e=new $(f),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function c(){var t=new MessageChannel;return t.port1.onmessage=f,function(){return t.port2.postMessage(0)}}function h(){var t=setTimeout;return function(){return t(f,1)}}function f(){for(var t=0;t<Y;t+=2){var e=nt[t],n=nt[t+1];e(n),nt[t]=void 0,nt[t+1]=void 0}Y=0}function d(){try{var t=n(216);return W=t.runOnLoop||t.runOnContext,u()}catch(t){return h()}}function p(t,e){var n=arguments,i=this,r=new this.constructor(v);void 0===r[rt]&&R(r);var o=i._state;return o?!function(){var t=n[o-1];J(function(){return L(o,r,t,i._result)})}():O(i,r,t,e),r}function g(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(v);return S(n,t),n}function v(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function _(t){try{return t.then}catch(t){return ut.error=t,ut}}function b(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}function x(t,e,n){J(function(t){var i=!1,r=b(n,e,function(n){i||(i=!0,e!==n?S(t,n):C(t,n))},function(e){i||(i=!0,I(t,e))},"Settle: "+(t._label||" unknown promise"));!i&&r&&(i=!0,I(t,r))},t)}function w(t,e){e._state===at?C(t,e._result):e._state===st?I(t,e._result):O(e,void 0,function(e){return S(t,e)},function(e){return I(t,e)})}function E(t,e,n){e.constructor===t.constructor&&n===p&&e.constructor.resolve===g?w(t,e):n===ut?(I(t,ut.error),ut.error=null):void 0===n?C(t,e):r(n)?x(t,e,n):C(t,e)}function S(e,n){e===n?I(e,m()):t(n)?E(e,n,_(n)):C(e,n)}function M(t){t._onerror&&t._onerror(t._result),T(t)}function C(t,e){t._state===ot&&(t._result=e,t._state=at,0!==t._subscribers.length&&J(T,t))}function I(t,e){t._state===ot&&(t._state=st,t._result=e,J(M,t))}function O(t,e,n,i){var r=t._subscribers,o=r.length;t._onerror=null,r[o]=e,r[o+at]=n,r[o+st]=i,0===o&&t._state&&J(T,t)}function T(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,o=t._result,a=0;a<e.length;a+=3)i=e[a],r=e[a+n],i?L(n,i,r,o):r(o);t._subscribers.length=0}}function P(){this.error=null}function A(t,e){try{return t(e)}catch(t){return lt.error=t,lt}}function L(t,e,n,i){var o=r(n),a=void 0,s=void 0,u=void 0,l=void 0;if(o){if(a=A(n,i),a===lt?(l=!0,s=a.error,a.error=null):u=!0,e===a)return void I(e,y())}else a=i,u=!0;e._state!==ot||(o&&u?S(e,a):l?I(e,s):t===at?C(e,a):t===st&&I(e,a))}function N(t,e){try{e(function(e){S(t,e)},function(e){I(t,e)})}catch(e){I(t,e)}}function k(){return ct++}function R(t){t[rt]=ct++,t._state=void 0,t._result=void 0,t._subscribers=[]}function D(t,e){this._instanceConstructor=t,this.promise=new t(v),this.promise[rt]||R(this.promise),q(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?C(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&C(this.promise,this._result))):I(this.promise,F())}function F(){return new Error("Array Methods must be provided an Array")}function B(t){return new D(this,t).promise}function j(t){var e=this;return new e(q(t)?function(n,i){for(var r=t.length,o=0;o<r;o++)e.resolve(t[o]).then(n,i)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function U(t){var e=this,n=new e(v);return I(n,t),n}function z(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function G(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function V(t){this[rt]=k(),this._result=this._state=void 0,this._subscribers=[],v!==t&&("function"!=typeof t&&z(),this instanceof V?N(this,t):G())}function X(){var t=void 0;if("undefined"!=typeof i)t=i;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=V}var H=void 0;H=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var q=H,Y=0,W=void 0,Z=void 0,J=function(t,e){nt[Y]=t,nt[Y+1]=e,Y+=2,2===Y&&(Z?Z(f):it())},K="undefined"!=typeof window?window:void 0,Q=K||{},$=Q.MutationObserver||Q.WebKitMutationObserver,tt="undefined"==typeof self&&"undefined"!=typeof e&&"[object process]"==={}.toString.call(e),et="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,nt=new Array(1e3),it=void 0;it=tt?s():$?l():et?c():void 0===K?d():h();var rt=Math.random().toString(36).substring(16),ot=void 0,at=1,st=2,ut=new P,lt=new P,ct=0;return D.prototype._enumerate=function(t){for(var e=0;this._state===ot&&e<t.length;e++)this._eachEntry(t[e],e)},D.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===g){var r=_(t);if(r===p&&t._state!==ot)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===V){var o=new n(v);E(o,t,r),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(i(t),e)},D.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===ot&&(this._remaining--,t===st?I(i,n):this._result[e]=n),0===this._remaining&&C(i,this._result)},D.prototype._willSettleAt=function(t,e){var n=this;O(t,void 0,function(t){return n._settledAt(at,e,t)},function(t){return n._settledAt(st,e,t)})},V.all=B,V.race=j,V.resolve=g,V.reject=U,V._setScheduler=o,V._setAsap=a,V._asap=J,V.prototype={constructor:V,then:p,catch:function(t){return this.then(null,t)}},V.polyfill=X,V.Promise=V,V})}).call(e,n(72),function(){return this}())},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={Screen:1,World:2,WGS84:3},i={iOS:1,Android:2,BlackBerry:3,WindowPhone:4,PC:5,other:0};e.Platform=i,e.CoordType=n},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(3),a=function(){function t(e){i(this,t),this.name=e,this.features=[],this._featureMap={}}return r(t,[{key:"_setFeatureParent",value:function(t){return this.forEach(function(e){e.parent=t}),this}},{key:"forEach",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return(0,o.isArray)(this.features)&&this.features.forEach(t,e),this}},{key:"addFeature",value:function(t){var e=t.id;if((0,o.isBlank)(t.id))return console.warn("Invalid feature"),this;if(this._featureMap[e])return console.warn("Feature is existed"),this;var n=this.features.push(t);return t.parent=this.parent,this._featureMap[t.id]=n-1,this}},{key:"updateFeature",value:function(t){var e=t.id,n=this._featureMap[e];return n>-1&&(this.features[n]=t,t.parent=this.parent),this}},{key:"_removeFeature",value:function(t,e){if(e>-1){this.features[e].parent=null,this.features.splice(e,1),delete this._featureMap[t];for(var n in this._featureMap)this._featureMap[n]>e&&(this._featureMan[n]-=1)}return this}},{key:"removeFeature",value:function(t){return this.removeFeatureById(t.id),this}},{key:"removeFeatureById",value:function(t){var e=this._featureMap[t];return this._removeFeature(t,e),this}},{key:"has",value:function(t){return!!t&&(t.id in this._featureMap||this._features.indexOf(t)!==-1)}},{key:"getFeatureById",value:function(t){var e=this._featureMap[t];return e>-1?this.features[e]:null}},{key:"getFeatureCount",value:function(){return this._features.length}},{key:"copy",value:function(){var e=new t(this.name),n=this.features;return e.features=n.map(function(t){return t.copy()}),e}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"features",get:function(){return this._features},set:function(t){if(this._setFeatureParent(null),this._features=[],(0,o.isArray)(t)){this._featureMap={};for(var e in t){var n=t[e];(0,o.isBlank)(n.id)?console.warn("Invalid feature"):this._featureMap[n.id]?console.warn("Feature is existed"):(t.parent=this.parent,this._featureMap[t.id]=this._features.push(n)-1)}}}},{key:"parent",set:function(t){this._setFeatureParent(t),this._parent=t},get:function(){return this._parent}}]),t}();e.default=a},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._scenes={},n.id=t,n._sceneManager=null,n.visible=!0,n}return a(e,t),s(e,[{key:"onAdd",value:function(t){this._sceneManager=t;for(var e in this._scenes)this._sceneManager.addScene(this._scenes[e])}},{key:"onRemove",value:function(t){for(var e in this._scenes)this._sceneManager.removeScene(this._scenes[e]);this._sceneManager=null}},{key:"add",value:function(t){return t.id&&!this.has(t)&&(this._scenes[t.id]=t,this._sceneManager&&this._sceneManager.addScene(t)),this}},{key:"remove",value:function(t){return this.has(t)&&(delete this._scenes[t.id],this._sceneManager&&this._sceneManager.removeScene(t)),this}},{key:"getAABB",value:function(){}},{key:"makeCollision",value:function(t){}},{key:"get",value:function(t){var e=null;return this.has(t)&&(e=this._scenes[t]),e}},{key:"has",value:function(t){return!!t&&(t in this._scenes||t.id in this._scenes)}},{key:"render",value:function(){if(this.visible)for(var t in this._scenes)this._scenes[t].render()}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible=t}},{key:"originStyle",set:function(t){this._originStyle=t},get:function(){return this._originStyle}}]),e}(l.default);e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.CAType=e.CollisionAnimation=void 0;var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(6),l=i(u),c=n(3),h=null,f=function(){function t(){a(this,t)}return s(t,[{key:"hasAnimation",value:function(t){return!1}},{key:"makeCollision",value:function(t,e){}},{key:"reset",value:function(t){}}]),t}(),d=function(t){function e(){return a(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(f),p=function(t){function e(){return a(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),s(e,[{key:"hasAnimation",value:function(t){var e=!1;if(t.children.length>0)for(var n=t.children,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;e=this.hasAnimation(a);break}return this._hasOpacity(t)||e}},{key:"makeParams",value:function(t,e,n){if(t.children.length>0)for(var i=t.children,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;this.makeParams(s,e,n)}this._hasOpacity(t)&&(t.material.opacity=e.num)}},{key:"complete",value:function(t,e){this._visibleScene(t,!e)}},{key:"makeCollision",value:function(t,e){var n=this,i=this._getOpacity(t),r=void 0;return e?(t.visible||(i=0),r=0):r=(0,c.isNumber)(t.destOpacity)?t.destOpacity:t.children[0]&&(0,c.isNumber)(t.children[0].destOpacity)?t.children[0].destOpacity:1,t.visible||i!==r||(this.makeParams(t,{num:0},e),i=0),i===r?null:l.default.getInstance().ofNumber(i,r,300).on("update",function(i,r){n.makeParams(t,r,e)}).on("start",function(){n._visibleScene(t,!0)}).on("complete",function(){n.makeParams(t,{num:r},e),n.complete(t,e)}).on("stop",function(){n.complete(t,e)}).start()}},{key:"reset",value:function(t){t.animation(h.Default)}},{key:"_getOpacity",value:function(t){if(t.children.length>0)for(var e=t.children,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;if(this._hasOpacity(o))return o.material.opacity}return t.material?t.material.opacity:0}},{key:"_visibleScene",value:function(t,e){if(t.children.length>0)for(var n=t.children,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;this._visibleScene(a,e)}t.visible=e}},{key:"_hasOpacity",value:function(t){return t&&t.material&&(0,c.isNumber)(t.material.opacity)}}]),e}(f);e.CAType=h={Default:new d,Opacity:new p},e.CollisionAnimation=f,e.CAType=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=n(1),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=n(68),f=i(h),d=n(5),p=i(d),g=n(25),v=i(g),m=n(30),y=i(m),_=n(170),b=i(_),x=n(175),w=i(x),E=n(6),S=i(E),M=n(33),C=i(M),I=n(11),O=i(I),T=n(18),P=n(45),A=i(P),L=n(69),N=n(12),k=n(3),R=n(15),D={Uninitialized:0,Initialized:1,Start:2,Loop:3,Stop:4,Destroy:5},F=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,e);var i=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._name=t,i._layers={},i._layersIndex=[],i._planarGraphs=[],i._domControl={},i._floorHeight=30,i._options=l({styleGenerator:new C.default},n),i.styleGenerator=i._options.styleGenerator,i._collisionSceneManager=new w.default,i._sceneManager=new b.default(i),i.renderLoop=new L.AnimationFrameRenderLoop,i._frame=0,i._frameF={},i._options.geomMap&&(i._goemMap=i._options.geomMap),i._beginFrame=i._beginFrame.bind(i),i.on("beginDraw",i._beginFrame),i}return s(e,t),c(e,[{key:"_beginFrame",value:function(t,e){var n=this._frameF[e];if(n&&n.length){try{for(var i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;s()}}catch(t){throw delete this._frameF[e],t}delete this._frameF[e]}}},{key:"changeMapViewLifeCycle",value:function(t){this._lifeCycle!==t&&(this.emit("lifeCycleChange",this,this._lifeCycle,t),this._lifeCycle=t)}},{key:"addDomControl",value:function(t){return!(t instanceof O.default)||t._map||t._name in this._domControl?(console.warn("adding control failed"),!1):(t._onAdd(this),this._domControl[t._name]=t,!0)}},{key:"removeDomControl",value:function(t){var e=null;return(e=t instanceof O.default&&t._name in this._domControl&&t._map===this?t:this.getDomControl(t))?(e._onRemove(this),delete this._domControl[e._name],!0):(console.warn("removing control failed"),!1)}},{key:"getDomControl",value:function(t){return this._domControl[t]}},{key:"addOverlay",value:function(t,e){var n=e;if(!e&&(n=this.getLayer(this.currentPlanarGraphIds[0]),!n))for(var i in this._layers){n=this._layers[i];break}this.emit("addOverlay",this,n,t)}},{key:"reAttachOverlay",value:function(t,e){this.emit("reAttachOverlay",this,e,t)}},{key:"removeOverlay",value:function(t){t.layer&&this.emit("removeOverlay",this,t.layer,t)}},{key:"addLayer",value:function(t){if(t.parent)return console.warn("addLayer: Existed parent"),null;if(this.hasLayer(t.name))return console.warn("addLayer: Existed layer"),null;var e=this._sceneGenerator.generator(t,this),n=this._layersIndex.indexOf(t.name);return e&&this._sceneManager.add(e),t.parent=this,this._layers[t.name]=t,n!==-1&&this._layersIndex.splice(n,1),this._layersIndex.push(t.name),this.emit("addLayer",this,t),e}},{key:"getLayer",value:function(t){return this._layers[t]}},{key:"hasLayer",value:function(t){return!!this._layers[t]}},{key:"getLayers",value:function(t){var e=[];for(var n in this._layers){var i=this._layers[n];i instanceof y.default?i.foreach(function(n,i){n===t&&e.push(i)}):i.name===t&&e.push(i)}return e}},{key:"removeLayer",value:function(t){var e=this._sceneGenerator.find(t),n=this._layersIndex.indexOf(t.name);return e&&this._sceneManager.remove(e),t.parent=null,delete this._layers[t.name],n!==-1&&this._layersIndex.splice(n,1),this.emit("removeLayer",this,t),this}},{key:"reSize",value:function(t,e){this.engine.reSize(this,t,e),this.activeCamera.reSize(t,e),this.emit("reSize",this,t,e)}},{key:"drawPlanarGraphExt",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];if(n.gradually){var r={};l(r,t.Area),t.Area.features=[];var o=new NGR.data.PlanarGraph(t);this.drawPlanarGraph(o,n);var a=o.planarGraphId,s=this.getLayer(a).getLayer("Area"),u=this.getLayer(a).getLayer("AreaText"),c=[],h=[];r.features.map(function(t){var e=s.renderer.getStyle(t),n=new NGR.data.Feature(NGR.geom.JTSUtils.getGeoReader().read(t.geometry),t.properties);return c.push(n),h.push(NGR.data.DataUtil.fuckYouBitch(n,e.height,!0)),null});var f=n.perCount||100,d=n.perTime||200,p=0;if(!(0,k.isNumber)(f)||f<=0)throw new Error("drawPlanarGraphExt: Invalid perCount");var g=Math.ceil((c.length-1)/f),v=setInterval(function(){if(g<=p)return clearInterval(v),i&&i(),void(e.onLoaded&&e.onLoaded());var t=p*f,n=g===p+1?c.length:(p+1)*f;p++,s.addFeatures(c.slice(t,n),!1),u.addFeatures(h.slice(t,n),!1),e.collisionSceneManager.updateCollision()},d)}else{var m=new NGR.data.PlanarGraph(t);this.drawPlanarGraph(m,n)}}},{key:"drawMultiPlanarGraphExt",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.added,i=void 0!==n&&n,r=e.visible,o=void 0===r||r,a=e.autoAreaTextHeight,s=void 0!==a&&a,u=e.gradually,l=void 0===u||u;i||this.clear();var c=this._curPlanarGraphs?this._curPlanarGraphs.concat():[];this._curPlanarGraphs=[];for(var h=t,f=Array.isArray(h),d=0,h=f?h:h[Symbol.iterator]();;){var p;if(f){if(d>=h.length)break;p=h[d++]}else{if(d=h.next(),d.done)break;p=d.value}var g=p;this.drawPlanarGraphExt(g,{gradually:l,added:!0,visible:o,autoAreaTextHeight:s})}this._changePlanarGraph(this._curPlanarGraphs.concat(),c)}},{key:"drawPlanarGraph",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.added,r=void 0!==i&&i,o=n.visible,a=void 0===o||o,s=n.fireEvent,l=void 0===s||s,c=n.autoAreaTextHeight,h=void 0!==c&&c,d=new y.default(t.planarGraphId),p=t.features;if(r||this.clear(),this._planarGraphs.push(t.planarGraphId),!this._coordinateSystem||!r){var g=this._options,m=g.initSkewAngle,_=g.initRotationAngle;for(var b in p)if("Frame"===b){var x=p[b].features[0].geometry.getEnvelopeInternal(),w=[x.minx,x.miny,x.maxx,x.maxy],E=f.default.getExtentCenter(w),S=u(E,2),M=S[0],C=S[1];this._camera.initRect(w),this._coordinateSystem=new f.default,this._coordinateSystem.setOffset([-M,-C])}this.activeControl&&((0,k.isNumber)(m)&&this.activeControl.skewTo(m),(0,k.isNumber)(_)&&this.activeControl.rotateTo(0,0,_))}for(var I in p){var O=p[I],T=new v.default(I,this._styleGenerator);if(T.coordinateSystem=this._coordinateSystem,T.features=O,d.addLayer(T),(N.enableQuadTree&&"Frame"===I||"Area"===I)&&(T.clickable=!0),"Area"===I){var P=new v.default("AreaText",this._styleGenerator);T.renderer||(P.coordinateSystem=this._coordinateSystem),h?P.features=A.default.kickYourAss(O,T,this._options.interiorPoint):P.features=A.default.featureCollectionPolygon2Point(O,this._options.interiorPoint),d.addLayer(P)}}this.addLayer(d);var L=d.getLayer("AreaText");L.coordinateSystem=this._coordinateSystem,L&&this._sceneManager.setVisible(L,null,null,!1),this._sceneManager.setVisible(d,null,null,!1),this.next(1,function(){e._sceneManager.setPosition(d,null,null,0,0,e._planarGraphs.indexOf(t.planarGraphId)*e._floorHeight),a&&(e._sceneManager.setVisible(d,null,null,!0),e.collisionSceneManager.updateCollision()),L&&e._sceneManager.setVisible(L,null,null,!0)}),l&&this._changePlanarGraph(this._curPlanarGraphs?this._curPlanarGraphs.concat([t.planarGraphId]):[t.planarGraphId],this._curPlanarGraphs?this._curPlanarGraphs.concat():[].concat(this.planarGraph&&this.planarGraph.planarGraphId||[])),r?(this._curPlanarGraphs=this._curPlanarGraphs||[],a&&this._curPlanarGraphs.push(t.planarGraphId)):this._planarGraph=t}},{key:"drawMultiPlanarGraph",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.added,i=void 0!==n&&n,r=e.visible,o=void 0===r||r,a=e.autoAreaTextHeight,s=void 0!==a&&a;i||this.clear();var u=this._curPlanarGraphs?this._curPlanarGraphs.concat():[];this._curPlanarGraphs=[];for(var l=t,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var d=f;this.drawPlanarGraph(d,{added:!0,visible:o,autoAreaTextHeight:s})}this._changePlanarGraph(this._curPlanarGraphs.concat(),u)}},{key:"changePlanarGraphIndex",value:function(t){if((0,k.isArray)(t)){for(var e=this._planarGraphs.concat(),n=[],i=t,o=Array.isArray(i),a=0,i=o?i:i[Symbol.iterator]();;){var s;if(o){if(a>=i.length)break;s=i[a++]}else{if(a=i.next(),a.done)break;s=a.value}var u=s,l=this._layers[u];if(l){var c=e.indexOf(u);e.splice(c,1),this.sceneManager.setPosition(l,null,null,0,0,n.length*this._floorHeight),n[n.length]=u}}return n.push.apply(n,r(e)),this._planarGraphs=n,!0}return!1}},{key:"showPlanarGraphs",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments[2];if(!(0,k.isArray)(t))throw new Error("showPlanarGraph: Invalid parameters");for(var r=this._planarGraphs,o=this.sceneManager,a=this.collisionSceneManager,s=[],u=0,l=function(){if(h){if(f>=c.length)return"break";d=c[f++]}else{if(f=c.next(),f.done)return"break";d=f.value}var n=d,r=e._layers[n],l=void 0;t.indexOf(n)!==-1?(o.setPosition(r,null,null,0,0,u++*e._floorHeight,i),o.setVisible(r,null,null,!0),s.push(n),l=!0):(o.setVisible(r,null,null,!1),l=!1),r.foreach(function(t,e){a.setFeatureLayerEnable(e,l)})},c=r,h=Array.isArray(c),f=0,c=h?c:c[Symbol.iterator]();;){var d,p=l();if("break"===p)break}return this._changePlanarGraph(s,this._curPlanarGraphs),this._curPlanarGraphs=s,n&&this.next(1,function(){e.collisionSceneManager.animation(T.CAType.Opacity).updateCollision(!0)}),u}},{key:"_changePlanarGraph",value:function(t,e){this.emit("changePlanarGraph",this,t.concat(),e.concat())}},{key:"removePlanarGraph",value:function(t){var e=t.planarGraphId,n=this._planarGraphs.indexOf(e),i=this.getLayer(e);n!==-1&&i&&i instanceof y.default&&(this.removeLayer(i),this._planarGraphs.splice(n,1))}},{key:"searchFeatureById",value:function(t){console.warn("searchFeatureById is deprecated, please use searchFeature");var e=this._layers;for(var n in e){var i=e[n];if(i instanceof y.default)for(var r in i._layers){var o=i._layers[r].searchById(t);if(o)return o}else{var a=i.searchById(t);if(a)return a}}return null}},{key:"searchFeature",value:function(t,e){for(var n in this._layers){var i=this._layers[n],r=null;if(i instanceof y.default?r=i.searchFeature(t,e):i.id===t&&(r=i.searchById(e)),r)return r}return null}},{key:"start",value:function(){var t=this;this._lifeCycle!==D.Start&&this._lifeCycle!==D.Loop&&(this.changeMapViewLifeCycle(D.Start),this._renderLoop.loop(function(e){t._loop(e)}))}},{key:"stop",value:function(){this.changeMapViewLifeCycle(D.Stop),this._renderLoop.stop()}},{key:"destroy",value:function(){var t=this;this.clear();var e=function(){t.stop(),t.changeMapViewLifeCycle(D.Destroy),t._collisionSceneManager.clear(),t._sceneManager.destroy(),t._control.dispose(),t._camera.destroy(),t._gestureManager.destroy(),t._camera=null,t._control=null,t._planarGraph=null,t._control=null,t.sceneGenerator=null,t._coordinateSystem=null,t._engine=null,t._gestureManager=null,t._layers=null,t._layersIndex=null,t._options=null,t._styleGenerator=null,t._collisionSceneManager=null,t._sceneManager=null,t.off("beginDraw",t._beginFrame)};e()}},{key:"next",value:function(t,e){var n=t+this._frame;n<this._frame||(this._frameF[n]||(this._frameF[n]=[]),this._frameF[n].push(e))}},{key:"clear",value:function(){for(var t in this._layers)this.removeLayer(this._layers[t]);return this._sceneManager.clearOctree(),this._collisionSceneManager.clear(),this._coordinateSystem=null,this._planarGraphs=[],this._curPlanarGraphs=null,this}},{key:"searchObjectsByPoint",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:R.CoordType.Screen,o=[],a=[t,e];switch(i){case R.CoordType.Screen:if(this.activeCamera&&this._coordinateSystem){var s=this.activeCamera.toCameraCoordinate(t,e,0);a=this._coordinateSystem.offset(s.x,s.y)}break;case R.CoordType.World:this._coordinateSystem&&(a=this._coordinateSystem.offset(t,e));break;case R.CoordType.WGS84:}for(var u=function(){if(c){if(h>=l.length)return"break";f=l[h++]}else{if(h=l.next(),h.done)return"break";f=h.value}var t=f,e=n._layers[t],i=void 0;e instanceof y.default?e.foreach(function(t,e){i=n._searchByPoint.apply(n,[e].concat(r(a))),o.push.apply(o,r(i))}):(i=n._searchByPoint.apply(n,[e].concat(r(a))),o.push.apply(o,r(i)))},l=this._layersIndex,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f,d=u();if("break"===d)break}return o}},{key:"_searchByPoint",value:function(t,e,n){return t.clickable?t.searchByPoint(e,n):[]}},{key:"searchFeaturesByClientPoint",value:function(t,e){for(var n=this._getObjectsByClinet(t,e),i=[],r=n,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s,l=u.object,c=l._layerId,h=l._sceneId,f=this.searchFeature(c,h);f&&i.push(f)}return i}},{key:"searchObjectsByClient",value:function(t,e){for(var n=this._getObjectsByClinet(t,e),i=[],r=n,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s,l=u.object,c=l._layerId,h=l._sceneId,f=this.searchFeature(c,h);f&&i.push({feature:f,point:u.point})}return i}},{key:"_getObjectsByClinet",value:function(t,e){var n=[];return this._camera?"three"!==this.engine.type()?(console.warn("Invalid Engine"),n):n=this._sceneManager._searchObjectsInOctree(t/this.width*2-1,2*-(e/this.height)+1):(console.warn("Invalid Camera"),n)}},{key:"_loop",value:function(t){this._lifeCycle!==D.Stop&&this._lifeCycle!==D.Destroy&&(this.changeMapViewLifeCycle(D.Loop),S.default.getInstance().update(t),t&&(this.emit("beginDraw",this,this._frame,t),this._sceneManager&&(this.emit("drawing",this,this._frame,t),this._sceneManager.render()),this.emit("endDraw",this,this._frame++,t)))}},{key:"particleEngine",set:function(t){this._particleEngine=t},get:function(){return this._particleEngine}},{key:"sceneGenerator",set:function(t){this._sceneGenerator=t}},{key:"gestureManager",get:function(){return this._gestureManager},set:function(t){this._gestureManager=t}},{key:"activeCamera",set:function(t){this._camera=t,this._camera.onActiveCamera(this),this._collisionSceneManager.activeCamera=t},get:function(){return this._camera}},{key:"activeControl",set:function(t){this._control=t,this._control&&this._control.onActiveControl&&this._control.onActiveControl(this)},get:function(){return this._control}},{key:"name",get:function(){return this._name}},{key:"engine",set:function(t){this._engine=t},get:function(){return this._engine}},{key:"renderLoop",set:function(t){this._renderLoop=t},get:function(){return this._renderLoop}},{key:"sceneManager",get:function(){return this._sceneManager}},{key:"collisionSceneManager",get:function(){return this._collisionSceneManager},set:function(t){this._collisionSceneManager=t}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}},{key:"height",set:function(t){this._height=t},get:function(){return this._height}},{key:"width",set:function(t){this._width=t},get:function(){return this._width}},{key:"maxDistance",set:function(t){this._maxDistance=t},get:function(){return this._maxDistance}},{key:"minDistance",set:function(t){this._minDistance=t},get:function(){return this._minDistance}},{key:"currentPlanarGraphIds",set:function(t){console.warn("currentPlanarGraphIds is readonly")},get:function(){return this._curPlanarGraphs?this._curPlanarGraphs:this._planarGraphs}},{key:"planarGraphs",set:function(t){console.warn("planargraphs is readonly")},get:function(){return this._planarGraphs}},{key:"container",set:function(t){this._container=t},get:function(){return this._container}},{key:"targetDom",set:function(t){this._targetDom=t},get:function(){return this._targetDom}},{key:"controlDom",set:function(t){this._controlDom=t},get:function(){return this._controlDom}},{key:"overlayDom",set:function(t){this._overlayDom=t},get:function(){return this._overlayDom}},{key:"styleGenerator",set:function(t){this._styleGenerator=t;
},get:function(){return this._styleGenerator}},{key:"floorHeight",set:function(t){this._floorHeight=t},get:function(){return this._floorHeight}}]),e}(p.default);e.default=F},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){var e=t;if("string"!=typeof t&&(e=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return e}function r(t){var e=t;return"string"!=typeof t&&(e=String(t)),e}function o(t){var e={next:function(){var e=t.shift();return{value:e,done:"undefined"==typeof e}}};return s&&(e[Symbol.iterator]=function(){return e}),e}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s="Symbol"in self&&"iterator"in Symbol,u=function(){function t(e){var i=this;n(this,t),this.map={},e instanceof t?e.forEach(function(t){var e=t.name,n=t.value;return i.append(e,n)}):e&&Object.getOwnPropertyNames(e).forEach(function(t){i.append(t,e[t])})}return a(t,[{key:"append",value:function(t,e){var n=i(t),r=this.map[n];r||(r=[],this.map[n]=r),r.push(e)}},{key:"set",value:function(t,e){this.map[i(t)]=[r(e)]}},{key:"delete",value:function(t){delete this.map[i(t)]}},{key:"get",value:function(t){var e=this.map[i(t)];return e?e[0]:null}},{key:"getAll",value:function(t){return this.map[i(t)]||[]}},{key:"has",value:function(t){return this.map.hasOwnProperty(i(t))}},{key:"forEach",value:function(t,e){var n=this;Object.getOwnPropertyNames(this.map).forEach(function(i){n.map[i].forEach(function(r){t.call(e,i,r,n)})})}},{key:"keys",value:function(){var t=[];return this.forEach(function(e){return t.push(e)}),o(t)}},{key:"values",value:function(){var t=[];return this.forEach(function(e,n){return t.push(n)}),o(t)}},{key:"entries",value:function(){var t=[];return this.forEach(function(e,n){return t.push([e,n])}),o(t)}}]),t}();s&&(u.prototype[Symbol.iterator]=u.prototype.entries),e.default=u},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i,r){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var a=Object.getPrototypeOf(e);null!==a&&t(a,n,i,r)}else if("value"in o&&o.writable)o.value=i;else{var s=o.set;void 0!==s&&s.call(r,i)}return i},c=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},h=n(110),f=r(h),d=n(2),p=i(d),g=n(90),v=function(t){function e(t,n,i,r){o(this,e);var s=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,-2));return s._camera=new p.PerspectiveCamera(t,n,i,r),s.id=s._camera.id,s._quaternion=s._camera.quaternion.clone(),s._rotation=s._camera.rotation.clone(),s._target0=new p.Vector3,s._originDistance=100,s}return s(e,t),u(e,[{key:"addLight",value:function(t){var e=null;if("Point"===t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e=new(Function.prototype.bind.apply(p.PointLight,[null].concat(i))),this._camera.add(e)}return e}},{key:"reSize",value:function(t,e){this._camera.aspect=t/e,this._camera.updateProjectionMatrix()}},{key:"destroy",value:function(){this._camera=null,this._quaternion=null,this._rotation=null}},{key:"initRect",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.667,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,i=new p.Vector3(0,0,0);if(this._mapView&&4===t.length){this._camera.quaternion.set(this._quaternion.x,this._quaternion.y,this._quaternion.z,this._quaternion.w),this._camera.rotation.set(this._rotation.x,this._rotation.y,this._rotation.z),this._camera.position.setZ(this._originDistance);var r=t[0],o=t[1],a=t[2],s=t[3],u=(r+a)/2,l=(s+o)/2,c=new p.Vector3(r-u,o-l,1),h=new p.Vector3(a-u,s-l,1),f=Math.sqrt(Math.pow(h.x-c.x,2)+Math.pow(h.y-c.y,2)+Math.pow(h.z-c.z,2))/2;this._mapBound=new g.EllipticCylinder(i,f,f),this._camera.updateMatrix(),this._camera.updateMatrixWorld();var d=this.toScreenCoordinate(c.x,c.y,c.z),v=this.toScreenCoordinate(h.x,h.y,h.z),m=(v.x-d.x)/this._mapView.width,y=(d.y-v.y)/this._mapView.height,_=Math.max(m,y);this._originDistance=this._camera.position.z*_/e,this._camera.position.setZ(this._originDistance),this._camera.updateMatrix(),this._camera.updateMatrixWorld()}else if(this._mapView&&6===t.length){this._camera.quaternion.set(this._quaternion.x,this._quaternion.y,this._quaternion.z,this._quaternion.w),this._camera.rotation.set(this._rotation.x,this._rotation.y,this._rotation.z),this._camera.position.setZ(100);var b=(t[0]+t[3])/2,x=(t[1]+t[4])/2,w=(t[2]+t[5])/2,E=new p.Vector3(t[0]-b,t[1]-x,t[2]-w),S=new p.Vector3(t[3]-b,t[4]-x,t[5]-w),M=Math.sqrt(Math.pow(S.x-E.x,2)+Math.pow(S.y-E.y,2)+Math.pow(S.z-E.z,2))/2;this._mapBound=new g.EllipticCylinder(i,M,M),this._camera.updateMatrix(),this._camera.updateMatrixWorld();var C=new p.Vector3(this._camera.up.y,-this._camera.up.x,0).normalize(),I=new p.Matrix4;I.makeRotationAxis(C,n*Math.PI/180),this._camera.position.applyMatrix4(I),this._camera.up.applyMatrix4(I);var O=this.toScreenCoordinate(E.x,E.y,E.z),T=this.toScreenCoordinate(E.x,S.y,E.z),P=this.toScreenCoordinate(S.x,E.y,E.z),A=this.toScreenCoordinate(S.x,S.y,E.z),L=this.toScreenCoordinate(E.x,E.y,S.z),N=this.toScreenCoordinate(E.x,S.y,S.z),k=this.toScreenCoordinate(S.x,E.y,S.z),R=this.toScreenCoordinate(S.x,S.y,S.z),D=Math.min(O.x,T.x,P.x,A.x,L.x,N.x,k.x,R.x),F=Math.max(O.x,T.x,P.x,A.x,L.x,N.x,k.x,R.x),B=Math.min(O.y,T.y,P.y,A.y,L.y,N.y,k.y,R.y),j=Math.max(O.y,T.y,P.y,A.y,L.y,N.y,k.y,R.y),U=(F-D)/this._mapView.width,z=(j-B)/this._mapView.height,G=Math.max(U,z);this._camera.position.setX(this._camera.position.x*G/e),this._camera.position.setY(this._camera.position.y*G/e),this._camera.position.setZ(this._camera.position.z*G/e),this._camera.updateMatrix(),this._camera.updateMatrixWorld()}}},{key:"toScreenCoordinate",value:function(t,e,n){var i=void 0;if(this._mapView){var r=new p.Vector3(t,e,n);i=r.project(this._camera),i.x=(i.x+1)/2*this._mapView.width,i.y=-(i.y-1)/2*this._mapView.height}return i.setZ(0)}},{key:"toCameraCoordinate",value:function(t,e,n){var i=void 0;if(this._mapView){this._camera.updateProjectionMatrix();var r=new p.Vector3(t/this._mapView.width*2-1,2*-(e/this._mapView.height)+1,n),o=(new p.Vector3).setFromMatrixPosition(this._camera.matrix);i=r.unproject(this._camera);var a=i.sub(o).normalize(),s=-o.z/a.z;i=o.clone().add(a.multiplyScalar(s))}var u=(this._target.z-this._camera.position.z)/(i.z-this._camera.position.z),l=this._camera.position.clone().multiplyScalar(1-u).add(i.multiplyScalar(u));return l}},{key:"getMetersPerPixel",value:function(){if(!this._mapView)return 0;var t=this._camera,e=new p.Vector3(this._mapView.width/2,this._mapView.height/2,0),n=this.toCameraCoordinate(e.x,e.y,e.z),i=new p.Vector3,r=new p.Vector3(1,0,0),o=t.getWorldQuaternion(),a=null,s=0;return r.applyQuaternion(o),i.copy(n).add(r),a=this.toScreenCoordinate(i.x,i.y,i.z),s=e.distanceTo(a),1/s}},{key:"removeLight",value:function(t){this._camera.remove(t)}},{key:"lookAt",value:function(t,e){this._target0.set(e.x,e.y,e.z),this._camera.lookAt(this._target0)}},{key:"originDistance",get:function(){return this._originDistance}},{key:"camera",get:function(){return this._camera}},{key:"bound",get:function(){return this._mapBound}},{key:"position",get:function(){var t=c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",this);return t.x=this._camera.position.x,t.y=this._camera.position.y,t.z=this._camera.position.z,t},set:function(t){this._camera.position.set(t.x,t.y,t.z),t instanceof p.Vector3?(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",this).x=t.x,c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",this).y=t.y,c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",this).z=t.z):l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",t,this)}},{key:"target",get:function(){return this._target},set:function(t){t instanceof p.Vector3?(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"target",this).x=t.x,c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"target",this).y=t.y,c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"target",this).z=t.z):l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"target",t,this)}},{key:"up",get:function(){var t=c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"up",this);return t.x=this._camera.up.x,t.y=this._camera.up.y,t.z=this._camera.up.z,t},set:function(t){this._camera.up.set(t.x,t.y,t.z),t instanceof p.Vector3?(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"up",this).x=t.x,c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"up",this).y=t.y,c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"up",this).z=t.z):l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"up",t,this)}}]),e}(f.default);e.default=v},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(11),h=i(c),f=n(7),d=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.name?"toggle-"+t.name:"toggle",s({disabled:!1,selected:!1,innerHTML:"",position:"topright"},t)));n._element&&console.warn("ToggleControl: Element will be overrided");var i=n._options.className?" "+n._options.className:"";return n._element=f.DOMUtils.createElement("div","ngr-toggle ngr-control ngr-bar"+i),n._button=f.DOMUtils.createElement("a","",n._element),n._button.innerHTML=n._options.innerHTML,n._button.href="#",n._disabled=n._options.disabled,n._selected=n._options.selected,n._selected&&f.DOMUtils.addClass(n._button,"selected"),n._disabled&&f.DOMUtils.addClass(n._button,"disabled"),n._onClick=n._onClick.bind(n),n}return a(e,t),u(e,[{key:"_onAdd",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this._button.addEventListener("click",this._onClick,!1),this}},{key:"_onRemove",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this._button.removeEventListener("click",this._onClick),this}},{key:"_onClick",value:function(t){t.preventDefault(),t.stopPropagation(),this.trigger()}},{key:"trigger",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._disabled||(this._selected?(f.DOMUtils.removeClass(this._button,"selected"),this._selected=!1):(f.DOMUtils.addClass(this._button,"selected"),this._selected=!0),t&&this.fire("toggle",{selected:this._selected,targetControl:this}))}},{key:"getSelected",value:function(){return this._selected}},{key:"disable",value:function(){return this.disabled=!0,this}},{key:"enable",value:function(){return this.disabled=!1,this}},{key:"disabled",set:function(t){this._disabled=!!t,this._disabled?f.DOMUtils.addClass(this._button,"disabled"):f.DOMUtils.removeClass(this._button,"disabled")},get:function(){return this._disabled}}]),e}(h.default);e.default=d},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n){i(this,t),this.geometry=e,this.properties=n,this.id=this.properties&&this.properties.id,this.hasOffset=!0,this.priority=5}return o(t,[{key:"copy",value:function(){var e=this.geometry.copy(),n=r({},this.properties),i=new t(e,n);return i.hasOffset=this.hasOffset,i}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}},{key:"geometry",get:function(){return this._geometry},set:function(t){this._geometry=t}},{key:"properties",get:function(){return this._properties},set:function(t){this._properties=t}},{key:"hasOffset",set:function(t){this._hasOffset=t},get:function(){return this._hasOffset}},{key:"parent",set:function(t){this._parent=t},get:function(){return this._parent}}]),t}();e.default=a},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(8),u=i(s),l=n(4),c=n(3),h=function(){function t(){o(this,t)}return a(t,null,[{key:"createPoint",value:function(t){return t?u.default.getFactory().createPoint(new(Function.prototype.bind.apply(l.geom.Coordinate,[null].concat(r(t))))):null}},{key:"createPolygon",value:function(t){if((0,c.isArray)(t)){for(var e=[],n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var a;if(i){if(o>=n.length)break;a=n[o++]}else{if(o=n.next(),o.done)break;a=o.value}var s=a;if((0,c.isArray)(s)){var h=new(Function.prototype.bind.apply(l.geom.Coordinate,[null].concat(r(s))));e.push(h)}}if(e.length>=3)return u.default.getFactory().createPolygon(e)}return null}},{key:"createLineString",value:function(t){if((0,c.isArray)(t)){for(var e=[],n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var a;if(i){if(o>=n.length)break;a=n[o++]}else{if(o=n.next(),o.done)break;a=o.value}var s=a;if((0,c.isArray)(s)){var h=new(Function.prototype.bind.apply(l.geom.Coordinate,[null].concat(r(s))));e.push(h)}}if(e.length>=2)return u.default.getFactory().createLineString(e)}return null}},{key:"createMultiPoint",value:function(t){if((0,c.isArray)(t)){for(var e=[],n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var a;if(i){if(o>=n.length)break;a=n[o++]}else{if(o=n.next(),o.done)break;a=o.value}var s=a;if((0,c.isArray)(s)){var h=new(Function.prototype.bind.apply(l.geom.Coordinate,[null].concat(r(s))));e.push(h)}}if(e.length>=1)return u.default.getFactory().createMultiPoint(e)}return null}},{key:"createMultiPolygon",value:function(e){if((0,c.isArray)(e)){for(var n=[],i=e,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a,l=t.createPolygon(s);l&&n.push(l)}if(n.length>=1)return u.default.getFactory().createMultiPolygon(n)}return null}},{key:"createMultiLineString",value:function(e){if((0,c.isArray)(e)){for(var n=[],i=e,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a,l=t.createPolygon(s);l&&n.push(l)}if(n.length>=1)return u.default.getFactory().createMultiLineString(n)}return null}}]),t}();e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(26),l=i(u),c=n(16),h=i(c),f=n(33),d=i(f),p=n(4),g=n(8),v=i(g),m=n(125),y=i(m),_=n(12),b=n(3),x=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.features=new h.default(t),i._subHeight=1e-5,i._zIndex=i._subHeight,n instanceof d.default?i.renderer=n.generator(i):i.renderer=n,_.enableQuadTree&&(i._quadTree=new p.index.quadtree.Quadtree),i.clickable=!1,i._parent=null,i}return a(e,t),s(e,[{key:"visit",value:function(t){var e=this;this.renderer&&this.features.forEach(function(n){return t(n,e.renderer.getStyle(n))},this)}},{key:"addFeatures",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=(0,b.isArray)(t),i=n?t:t.features;if(!(0,b.isArray)(i))return console.warn("Invalid Features"),this;for(var r=i,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;this.addFeature(u,e)}return e||this.emit("addFeatures",this,i),this}},{key:"addFeature",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._addFeature(t,!0,e)}},{key:"removeFeature",value:function(t){return t&&this._features.has(t)&&(t.onRemove&&t.onRemove(this),this._features.removeFeature(t),_.enableQuadTree&&this._quadTree.remove(t.geometry.getEnvelopeInternal(),t),t.parent=null,this.emit("removeFeature",this,t)),this}},{key:"clearFeatures",value:function(){if(this.features){var t=this.features.getFeatureCount();this.features.parent=null;for(var e=t;e>=0;e--){var n=this.features.features[e];this.removeFeature(n)}}return this}},{key:"search",value:function(t,e){for(var n=[],i=this._features.features,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a,u=s.properties;t in u&&e===u[t]&&n.push(s)}return n}},{key:"searchByPoint",value:function(t,e){if(!_.enableQuadTree)return console.warn("FeatureLayer: quadTree is disabled"),null;var n=[],i=[t,e];if(!this.clickable)return n;if(this._coordinateSystem){var r=this._coordinateSystem.getOffset(),o=r[0],a=r[1];i[0]+=o,i[1]+=a}i[2]=i[0]+.01,i[3]=i[1]+.01,i[0]-=.01,i[1]-=.01;var s=this._quadTree.query(new(Function.prototype.bind.apply(p.geom.Envelope,[null].concat(i)))),u=s.size();if(u>0)for(var l=v.default.getFactory().createPoint(new p.geom.Coordinate(i[0]+.01,i[1]+.01)),c=s.array_,h=Array.isArray(c),f=0,c=h?c:c[Symbol.iterator]();;){var d;if(h){if(f>=c.length)break;d=c[f++]}else{if(f=c.next(),f.done)break;d=f.value}var g=d;g.geometry.contains(l)&&n.push(g)}return n}},{key:"searchById",value:function(t){return this._features.getFeatureById(t)}},{key:"_addFeature",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&!this._features.has(t)&&this.renderer){if(t.onAdd&&!t.onAdd(this))return this;this._coordinateSystem&&this._coordinateSystem.getOffset()&&t.hasOffset&&this._offset(t),e&&this._features.addFeature(t),_.enableQuadTree&&this._quadTree.insert(t.geometry.getEnvelopeInternal(),t),t.parent=this,n&&this.emit("addFeature",this,t,this.renderer.getStyle(t))}return this}},{key:"_offset",value:function(t){if(this._coordinateSystem&&this._coordinateSystem.getOffset()&&t.hasOffset){var e=this._coordinateSystem.getOffset(),n=e[0],i=e[1],r=new y.default(function(t){for(var e=t.coordinates,r=Array.isArray(e),o=0,e=r?e:e[Symbol.iterator]();;){var a;if(r){if(o>=e.length)break;a=e[o++]}else{if(o=e.next(),o.done)break;a=o.value}var s=a;s.x+=n,s.y+=i}return t});t.geometry=r.transform(t.geometry),t.geometry.zIndex=this._zIndex,this._zIndex+=this._subHeight,t.hasOffset=!1}return this}},{key:"clickable",get:function(){return this._clickable},set:function(t){this._clickable=t}},{key:"renderer",get:function(){return this._renderer},set:function(t){this._renderer=t}},{key:"features",get:function(){return this._features},set:function(t){var e=t.features;if(!(0,b.isArray)(e))return void console.warn("Invalid Features");this.clearFeatures();for(var n=e,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;this._addFeature(a,!1)}this._features=t}},{key:"coordinateSystem",get:function(){return this._coordinateSystem},set:function(t){this._coordinateSystem=t}},{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}}]),e}(l.default);e.default=x},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.name=t,n.height=0,n}return a(e,t),s(e,[{key:"height",get:function(){return this._height},set:function(t){this._height=t}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}}]),e}(l.default);e.default=c},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),s=i(a),u=(new s.Vector3(1,0,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),function(){function t(){r(this,t)}return o(t,null,[{key:"getRelCoord",value:function(e,n,i,r){var o=t.projectOnVectorScalar(e,n),a=t.projectOnVectorScalar(e,i),u=t.projectOnVectorScalar(e,r);return new s.Vector3(o,a,u)}},{key:"getRelCoordOnPlane",value:function(e,n,i){var r=t.projectOnVectorScalar(e,n),o=t.projectOnVectorScalar(e,i);return new s.Vector3(r,o,0)}},{key:"directionalAdd",value:function(t,e,n){var i=t.clone(),r=e.clone();return r.normalize(),i.x+=n*r.x,i.y+=n*r.y,i.z+=n*r.z,i}},{key:"projectOnVectorScalar",value:function(t,e){return t.dot(e)/e.length()}},{key:"subVector",value:function(t,e){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z||0}}},{key:"getAngle",value:function(e,n){var i=t.getVectorDot(e,n)/window.Math.sqrt(t.getLengthSq(e)*t.getLengthSq(n));return window.Math.acos(t.clamp(i,-1,1))}},{key:"angleTo",value:function(t){var e=window.Math.atan2(t.y,t.x);return e<0&&(e+=2*window.Math.PI),e}},{key:"getVectorDot",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"getLengthSq",value:function(t){return t.x*t.x+t.y*t.y+t.z*t.z}},{key:"clamp",value:function(t,e,n){return window.Math.max(e,window.Math.min(n,t))}}]),t}());e.default=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(51),l=i(u),c=n(29),h=i(c),f=function(t){function e(t,n,i){r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._connection=t,i?(a.from=new h.default(t.to,n),a.to=new h.default(t.from,n)):(a.from=new h.default(t.from,n),a.to=new h.default(t.to,n)),a}return a(e,t),s(e,[{key:"connection",get:function(){return this._connection}},{key:"weight",get:function(){return this._connection.rank}},{key:"altitude",get:function(){return this.to.vertex.altitude}}]),e}(l.default);e.default=f},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i){n(this,t),this._vertex=e,this._vertexLoader=i,this.needCalcExtraPath=!1,this.g=0,this.h=0}return i(t,[{key:"findPath",value:function(t){return this._paths.get(t.vertex.id)}},{key:"_loadPaths",value:function(){var t=this;this._paths||(this._paths=new Map,this._vertexLoader.loadPaths(this.vertex,this.needCalcExtraPath).forEach(function(e){t._paths.set(e.to.vertex.id,e)}))}},{key:"toString",value:function(){return this.vertex.toString()}},{key:"equals",value:function(t){return this===t||!!t&&this.vertex.equals(t.vertex)}},{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}},{key:"vertex",get:function(){return this._vertex}},{key:"paths",get:function(){return this._loadPaths(),this._paths.values()}},{key:"g",get:function(){return this._g},set:function(t){this._g=t}},{key:"h",get:function(){return this._h},set:function(t){this._h=t}},{key:"needCalcExtraPath",get:function(){return this._needCalcExtraPath},set:function(t){this._needCalcExtraPath=t}}],[{key:"compareTo",value:function(t,e){return t.g+t.h-e.g-e.h>0?-1:1}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(26),l=i(u),c=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._layers={},n}return a(e,t),s(e,[{key:"addLayer",value:function(t){if(!this.has(t)){if(t.parent)return void console.warn("addLayer: Existed parent");t.parent=this,this._layers[t.name]=t,this.emit("addToGroup",this,t)}}},{key:"removeLayer",value:function(t){this.has(t)&&(t.parent=null,delete this._layers[t.name],this.emit("removeToGroup",this,t))}},{key:"getLayer",value:function(t){return this._layers[t]}},{key:"foreach",value:function(t){for(var e in this._layers)t(e,this._layers[e])}},{key:"has",value:function(t){return!!t&&t.name in this._layers}},{key:"searchFeature",value:function(t,n){for(var i in this._layers){var r=this._layers[i],o=null;if(r instanceof e?o=r.searchFeature(t,n):r.id===t&&(o=r.searchById(n)),o)return o}return null}}]),e}(l.default);e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(51),l=i(u),c=n(29),h=i(c),f=function(t){function e(t,n,i){r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));
return a._path=t,a._reverse=i,i?(a.from=new h.default(t.to,n),a.to=new h.default(t.from,n)):(a.from=new h.default(t.from,n),a.to=new h.default(t.to,n)),a}return a(e,t),s(e,[{key:"path",get:function(){return this._path}},{key:"reverse",get:function(){return this._reverse}},{key:"weight",get:function(){return this._path.shape.getLength()*(this._path.rank+1)}},{key:"altitude",get:function(){return this._path.altitude}}]),e}(l.default);e.default=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(49),u=i(s),l=n(140),c=i(l),h=n(52),f=i(h),d=n(143),p=i(d),g=n(146),v=i(g),m=n(54),y=i(m),_=n(28),b=i(_),x=n(8),w=i(x),E=n(4),S=n(3),M="undefined"==typeof Promise?n(14).Promise:Promise,C=1,I=function(){function t(e,n){r(this,t),this._dataSource=e,this._options=o({},n||{});var i=this._options,a=i.vertex,s=i.path,u=i.connection,l=i.g,h=i.h;if(a&&s&&u){var d=new y.default(a,s,u);this._astar=new c.default(l||new f.default,h||new p.default,new v.default(d)),this._offLine=!0}}return a(t,[{key:"navigate",value:function(t){var e=this;return this._offLine?new M(function(n,i){try{var r=w.default.getFactory().createPoint(new E.geom.Coordinate(t.from_x,t.from_y)),o=w.default.getFactory().createPoint(new E.geom.Coordinate(t.to_x,t.to_y)),a=e._astar.astar(r,t.from_planar_graph,o,t.to_planar_graph,t.planarGraphIdList||null),s={},u=[];s.type="FeatureCollection",s.features=[];for(var l in a){var c=a[l],h={};if(c instanceof b.default)u.push(c);else{if(h.type="Feature",h.properties={planar_graph:c.from.vertex.planarGraphId,hasTransitPoint:!1,poi:null},u.length>0){var f=s.features.pop();f&&(f.properties.poi=u[0].connection.fromLocationId,s.features.push(f)),h.properties.poi=u.pop().connection.toLocationId,u=[]}var d=c.path.shape;if(c.reverse){var p=d.getCoordinates().map(function(t){var e=t.x,n=t.y,i=t.z;return new E.geom.Coordinate(e,n,i)});p.reverse(),d=new E.geom.LineString(w.default.getFactory().getCoordinateSequenceFactory().create(p),w.default.getFactory())}h.geometry=w.default.getGeoWriter().write(d),s.features.push(h)}}e._rawNavigates=s,e._parseNavi(s),n(e._navigates)}catch(t){i(t)}}):this._dataSource.requestNavigation(t).then(function(t){return(0,S.isBoolean)(t)?null:(e._rawNavigates=t,e._parseNavi(t),e._navigates)})}},{key:"transit",value:function(t){var e=this;return this._dataSource.requestTransitNavigation(t).then(function(t){return e._parseNavi(t),e._navigates})}},{key:"getNavigateByPlanarGraph",value:function(t){return this._navigates&&this._navigates[t]?this._navigates[t].copy():null}},{key:"getClosestPoints",value:function(t,e,n){var i=w.default.getFactory(),r=i.createPoint(new E.geom.Coordinate(e,n)),o=this._navigates[t].features,a=o.map(function(t){return t.geometry}),s=i.createMultiLineString(a),u=new E.operation.distance.DistanceOp(s,r),l=u.nearestPoints();return l.pop(),l.map(function(t){return t.copy()})}},{key:"_getDistance",value:function(t,e){var n=0;return n=Math.hypot?Math.hypot(e.x-t.x,e.y-t.y):Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},{key:"_getArrayPointsDistance",value:function(t,e){if(!t||!e)return null;var n=new E.geom.Coordinate(t[0],t[1]),i=new E.geom.Coordinate(e[0],e[1]);return this._getDistance(n,i)}},{key:"getWholeDistance",value:function(){var t=this._distances,e=0;if(t)for(var n in t)for(var i=t[n],r=i,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;e+=u}return e}},{key:"getDistancesByPlanarGraph",value:function(t){return this._distances?this._distances[t]:null}},{key:"getPlanarGraphOrder",value:function(){return this._naviOrder}},{key:"getTransitByPlanarGraph",value:function(t){return this._transit?this._transit[t].copy():null}},{key:"getConnectionInfo",value:function(){return this._connectionInfo}},{key:"getConnectionInfoByPlanarGraph",value:function(t){return this._connectionInfo?this._connectionInfo[t]:null}},{key:"getRawFC",value:function(){return this._rawNavigates}},{key:"_parseNavi",value:function(t){var e={},n={},i=t.features,r=-1,a=void 0,s=0;this._navigates={},this._transit={},this._naviOrder=[],this._connectionInfo={},this._distances={};for(var l=i,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var d=f,p=d.properties,g=d.geometry.coordinates,v=p.hasTransitPoint,m=p.poi,y=p.planar_graph,_=this._naviOrder[this._naviOrder.length-1];if(_!==y&&(this._naviOrder.push(y),this._connectionInfo[y]=[],this._distances[y]=[],this._distances[_]&&this._distances[_].push(s),s=0),y){var b=this._createFs(y,e);a=this._createF(b,a,y,r,"LineString",m);for(var x=g,w=Array.isArray(x),E=0,x=w?x:x[Symbol.iterator]();;){var S;if(w){if(E>=x.length)break;S=x[E++]}else{if(E=x.next(),E.done)break;S=E.value}var M=S,C=a.geometry.coordinates[a.geometry.coordinates.length-1],I=this._getArrayPointsDistance(C,M);C&&I<.01||(a.geometry.coordinates.push(M.concat()),s+=I)}}if(v){var O=this._createFs(y,n),T=this._createF(O,null,y,-1,"Point"),P=g[g.length-1];delete T.properties.poi,T.geometry.coordinates.push(P.concat())}m&&this._connectionInfo[y].push(o({},p)),r=y}this._distances[r].push(s);for(var A in e)this._navigates[A]=u.default.parse(A,e[A]);for(var L in n)this._transit[L]=u.default.parse(L,n[L])}},{key:"_createFs",value:function(t,e){var n=e[t];return n||(n={type:"FeatureCollection",features:[]},e[t]=n),n}},{key:"_createF",value:function(t,e,n,i,r,o){var a=e;return n!==i?(a={type:"Feature",properties:{id:C++,poi:[o]},geometry:{type:r,coordinates:[]}},t.features.push(a)):a.properties.poi[1]=o,a}}]),t}();e.default=I},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"generator",value:function(t){console.log("Please set StyleGenerator to "+t.name+" Layer")}}]),t}();e.default=r},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t),this.clientX=this.clientY=this.pageX=this.pageY=0}return i(t,[{key:"clientX",get:function(){return this._clientX},set:function(t){this._clientX=t}},{key:"clientY",get:function(){return this._clientY},set:function(t){this._clientY=t}},{key:"pageX",get:function(){return this._pageX},set:function(t){this._pageX=t}},{key:"pageY",get:function(){return this._pageY},set:function(t){this._pageY=t}},{key:"screenX",get:function(){return this._screenX},set:function(t){this._screenX=t}},{key:"screenY",get:function(){return this._screenY},set:function(t){this._screenY=t}},{key:"detail",get:function(){return this._detail},set:function(t){this._detail=t}}]),t}();e.default=r},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t),this.touches=[],this.type="none",this.rotate=this.scale=0}return i(t,[{key:"touches",get:function(){return this._touchs},set:function(t){this._touchs=t}},{key:"type",get:function(){return this._type},set:function(t){this._type=t}},{key:"rotate",get:function(){return this._rotate},set:function(t){this._rotate=t}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale=t}},{key:"target",get:function(){return this._target},set:function(t){this._target=t}}]),t}();e.default=r},function(t,e){t.exports={name:"nagrand-webgl",version:"3.0.0",description:"",main:"index.js",scripts:{"webpack-dev":"webpack-dev-server --port 8080 --config ./scripts/webpack.config.babel.js --progress --display-error-details","webpack-build":" webpack --progress --config ./scripts/webpack.config.babel.js",start:"NODE_ENV=development BUILD_ENV=standard npm run webpack-dev","build-dev":"NODE_ENV=development BUILD_ENV=standard npm run webpack-build",build:"NODE_ENV=production BUILD_ENV=standard npm run webpack-build","build-lite":"NODE_ENV=production BUILD_ENV=lite npm run webpack-build","start:win":"set NODE_ENV=development&& set BUILD_ENV=standard&& npm run webpack-dev","build:win":"set NODE_ENV=development&& set BUILD_ENV=standard&& npm run webpack-build","build-lite:win":"set NODE_ENV=development&& set BUILD_ENV=lite&& npm run webpack-build",prebuild:"npm run clean","prebuild:win":"npm run clean",clean:"rimraf ./build",test:"mocha ./test/**/*.spec.js","build-examples":"metalsmith",jsdoc:"rimraf ./docs && jsdoc src lib/three-ext/planeLine lib/three-ext/tube -R src/README.md -r -c ./conf.json -d docs"},config:{commitizen:{path:"cz-conventional-changelog"}},author:"Palmap.Inc <sdk@palmaplus.com>",license:"UNLICENSED",devDependencies:{"babel-cli":"^6.10.1","babel-eslint":"^6.1.2","babel-loader":"^6.2.4","babel-preset-es2015":"^6.24.0","babel-preset-stage-3":"^6.11.0","babel-plugin-transform-es2015-for-of":"^6.23.0","babel-plugin-es6-promise":"^1.1.1","babel-plugin-transform-object-rest-spread":"^6.23.0","babel-polyfill":"^6.23.0","babel-plugin-transform-class-properties":"^6.23.0",chai:"^3.5.0","css-loader":"^0.23.1","cz-conventional-changelog":"^1.1.6",debug:"^2.6.0",docdash:"^0.4.0","es6-promise":"^4.0.5",eslint:"^3.3.1","eslint-loader":"^1.4.1","eslint-plugin-flow-vars":"^0.4.0","extract-text-webpack-plugin":"^1.0.1","file-loader":"^0.9.0",handlebars:"^4.0.2","html-loader":"^0.4.3","html-webpack-plugin":"^2.22.0","image-webpack-loader":"^2.0.0",jsdoc:"^3.4.3","json-loader":"^0.5.4",metalsmith:"^2.3.0","metalsmith-layouts":"1.8.0",mocha:"^2.5.3","postcss-loader":"^0.9.1","postcss-pxtorem":"^4.0.1",rimraf:"^2.5.3","style-loader":"^0.13.1","url-loader":"^0.5.7",webpack:"^1.13.1","webpack-dev-server":"^1.14.1","worker-loader":"^0.7.1"},dependencies:{"object-assign":"^4.1.0",rbush:"^2.0.1",hammerjs:"^2.0.8","string-hash":"^1.1.0",priorityqueuejs:"^1.0.0","tween.js":"~16.6.0","polyline-normals":"^2.0.0","three-line-2d":"^1.1.6","as-number":"^1.0.0","@hughsk/fulltilt":"^0.7.1"}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t),this._callbacks={}}return i(t,[{key:"on",value:function(t,e){var n=this._callbacks;return n[t]=n[t]||[],n[t].push(e),this}},{key:"once",value:function(t,e){var n=this,i=function i(){for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];n.off(t,i),e.apply(n,o)};return i.fn=e,this.on(t,i),this}},{key:"off",value:function(t,e){var n=this._callbacks;if("undefined"==typeof t)return n={},this;var i=n[t];if(!i)return this;if("undefined"==typeof e)return delete n[t],this;for(var r=0,o=i.length;r<o;r++){var a=i[r];if(a===e||a.fn===e){i.splice(r,1);break}}return this}},{key:"emit",value:function(t){var e=this._callbacks[t],n=e&&e.length;if(n){for(var i=arguments.length,r=Array(i>1?i-1:0),o=1;o<i;o++)r[o-1]=arguments[o];for(var a=0;a<n;a++)e[a].apply(this,r)}return this}},{key:"listeners",value:function(t){return this._callbacks[t]||[]}},{key:"hasListeners",value:function(t){return!!this.listeners(t).length}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t){return new c(function(e,n){t.onloaded=function(){return e(t.result)},t.onerror=function(){return n(t.error)}})}function o(t){var e=new FileReader;return e.readAsArrayBuffer(t),r(e)}function a(t){var e=new FileReader;return e.readAsText(t),r(e)}function s(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}}),e}function u(t){return t.bodyUsed?c.reject(new TypeError("Body locked yet")):void(t.bodyUsed=!0)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c="undefined"==typeof Promise?n(14).Promise:Promise,h={string:"text/plain;charset=UTF-8",json:"application/json",urlencoded:"application/x-www-form-urlencoded;charset=UTF-8"},f="FileReader"in self&&"Blob"in self,d="FormData"in self,p="ArrayBuffer"in self,g="URLSearchParams"in self,v=function(){function t(){i(this,t),this.bodyUsed=!1}return l(t,[{key:"_initBody",value:function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(f&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(p&&ArrayBuffer.prototype.isPrototypeOf(t));else if(d&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(g&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else{if(t)throw new Error("Unsupported body type");this._bodyText=""}if(!this.headers.get("Content-Type"))if("string"==typeof t)try{JSON.parse(t),this.headers.set("Content-Type",h.json)}catch(t){this.headers.set("Content-Type",h.string)}else this._bodyBlob&&this._bodyBlob.type?this.headers.set("Content-Type",this._bodyBlob.type):g&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("Content-Type",h.urlencoded)}},{key:"blob",value:function(){var t=u(this);if(t)return t;if(f){if(this._bodyBlob)return c.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read formData body as blob");return c.resolve(new Blob([this._bodyText]))}}},{key:"arrayBuffer",value:function(){return this.blob().then(o)}},{key:"formData",value:function(){if(d)return this.text().then(s)}},{key:"json",value:function(){return this.text().then(JSON.parse)}},{key:"text",value:function(){var t=u(this);if(t)return t;if(f){if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read formData body as text")}return c.resolve(this._bodyText)}}]),t}();e.default=v},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=t.toUpperCase();if(g.indexOf(e)!==-1)return e;throw new Error("invalid method name")}Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},h=n(39),f=i(h),d=n(20),p=i(d),g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],v={mode:"cors",method:"GET",credientials:"omit"},m=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),a=u({},v,n),l=n.body;if(e.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Body already locked");l||(l=t.body,t.bodyUsed=!0),a.headers||(i.headers=new p.default(t.headers)),i.url=t.url,i.mode=t.mode,i.method=t.method,i.credientials=t.credientials}else i.url=t;if(i.method=s(a.method||i.method),!a.headers&&i.headers||(i.headers=new p.default(a.headers)),i.mode=a.mode||i.mode,i.credientials=a.credientials||i.credientials,i.referrer=null,("GET"===i.method||"HEAD"===i.method)&&l)throw new TypeError("Body not allowed for GET or HEAD requests");return c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_initBody",i).call(i,l),i}return a(e,t),l(e,[{key:"clone",value:function(){return new e(this)}}]),e}(f.default);e.default=m},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},l=n(39),c=i(l),h=n(20),f=i(h),d=[301,302,303,307,308],p={status:200,statusText:"OK",body:null,type:"default"},g=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n.status<200||n.status>=599)throw new RangeError("Invalid response status code");var a=n.status,s=n.statusText,l=n.headers,c=n.url;return i.status=a,i.ok=a>=200&&i.status<300,i.statusText=s,i.headers=l instanceof f.default?l:new f.default(l),i.url=c,u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_initBody",i).call(i,t),i}return a(e,t),s(e,[{key:"clone",value:function(){var t=this.status,n=this.statusText,i=this.headers,r=this.url;return new e(this,{status:t,statusText:n,headers:new f.default(i),url:r})}}],[{key:"error",value:function(){var t=new e(null,{status:0,statusText:""});return t.type="error",t}},{key:"redirect",value:function(t,n){if(d.indexOf(n)===-1)throw new RangeError("Invalid redirect status code");return new e(null,{status:n,headers:{location:t}})}}]),e}(c.default);e.default=g},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),o=i(r);e.default={center:new o.Vector2(0,0),left:new o.Vector2(1,0),topLeft:new o.Vector2(1,-1),topRight:new o.Vector2(-1,-1),right:new o.Vector2(-1,0),bottomLeft:new o.Vector2(1,1),bottomRight:new o.Vector2(-1,1)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(11),h=i(c),f=n(7),d=n(3),p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=t.name?"floor-"+t.name:"floor",i=t.className?" "+t.className:"",a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,s({position:"bottomright"},t)));return a._element&&console.warn("FloorControl: Element will be overrided"),a.floorMap={},a.defaultFloor=null,a._element=f.DOMUtils.createElement("div","ngr-floor-switcher ngr-bar"+i),a._onItemClick=a._onItemClick.bind(a),a}return a(e,t),u(e,[{key:"_onAdd",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this._setFloorList(),this._setCurrentFloor(),this}},{key:"setFloorList",value:function(t){return this.floorList=t,this._setFloorList(),this}},{key:"_onItemClick",value:function(t){return t.preventDefault(),t.stopPropagation(),f.DOMUtils.hasClass(t.target,"ngr-disabled")?this:(this.fire("change",{from:this.currentFloor,to:t.target.floor,targetControl:this}),this)}},{key:"_setFloorList",value:function(){if(this._map&&this.floorList){for(this.floorMap={};this._element.firstChild;)this._element.firstChild.removeEventListener("click",this._onItemClick),this._element.removeChild(this._element.firstChild);for(var t=this.floorList,e=Array.isArray(t),n=0,t=e?t:t[Symbol.iterator]();;){var i;if(e){if(n>=t.length)break;i=t[n++]}else{if(n=t.next(),n.done)break;i=n.value}var r=i,o=f.DOMUtils.createElement("a","",this._element);o.innerHTML=r.address,o.href="#",o.floor=r.id,o.altitude=r.altitude,o.addEventListener("click",this._onItemClick),this.floorMap[r.id]=o}}return this}},{key:"getCurrentFloor",value:function(){return this.currentFloor}},{key:"_disable",value:function(t){var e=this.floorMap[t];e&&f.DOMUtils.addClass(e,"ngr-disabled")}},{key:"_enable",value:function(t){var e=this.floorMap[t];e&&f.DOMUtils.removeClass(e,"ngr-disabled")}},{key:"disable",value:function(t){if((0,d.isBlank)(t))for(var e in this.floorMap)this._disable(e);else this._disable(t);return this}},{key:"enable",value:function(t){if((0,d.isBlank)(t))for(var e in this.floorMap)this._enable(e);else this._enable(t);return this}},{key:"handleClass",value:function(t,e,n){if((0,d.isBlank)(e))return this;var i=[];if((0,d.isBlank)(t))for(var r in this.floorMap)i.push(r);else(0,d.isArray)(t)&&(i=t);for(var o=i,a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(s>=o.length)break;u=o[s++]}else{if(s=o.next(),s.done)break;u=s.value}var l=u,c=this.floorMap[l];c&&n(c,e)}return this}},{key:"addClass",value:function(t,e){return this.handleClass(t,e,f.DOMUtils.addClass)}},{key:"removeClass",value:function(t,e){return this.handleClass(t,e,f.DOMUtils.removeClass)}},{key:"setCurrentFloor",value:function(t,e){return this.currentFloor=t,this._setCurrentFloor(),(0,d.isFunction)(e)&&e(t),this}},{key:"_setCurrentFloor",value:function(){if(!this._map||!this._element)return this;var t=this.floorMap[this.currentFloor];if(t){for(var e in this.floorMap){var n=this.floorMap[e];f.DOMUtils.removeClass(n,"selected")}f.DOMUtils.addClass(t,"selected")}return this}}]),e}(h.default);e.default=p},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.DimensionControl=e.ToggleControl=e.MultiFloorControl=e.FacilityControl=e.ZoomControl=e.SliderControl=e.ScaleControl=e.FloorControl=e.Control=e.CompassControl=void 0;var r=n(113),o=i(r),a=n(11),s=i(a),u=n(43),l=i(u),c=n(117),h=i(c),f=n(118),d=i(f),p=n(119),g=i(p),v=n(115),m=i(v),y=n(116),_=i(y),b=n(22),x=i(b),w=n(114),E=i(w);e.CompassControl=o.default,e.Control=s.default,e.FloorControl=l.default,e.ScaleControl=h.default,e.SliderControl=d.default,e.ZoomControl=g.default,e.FacilityControl=m.default,e.MultiFloorControl=_.default,e.ToggleControl=x.default,e.DimensionControl=E.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(23),s=i(a),u=n(16),l=i(u),c=n(26),h=i(c),f=n(27),d=i(f),p=n(4),g=function(){function t(){r(this,t)}return o(t,null,[{key:"featurePolygon2Point",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(t instanceof s.default))return console.warn("Invalid Feature"),null;var n=t.geometry.getGeometryType();if("Polygon"!==n&&"MultiPolygon"!==n)return console.warn("Invalid Geometry"),null;var i={},r=t.geometry;if(e)r=r.getInteriorPoint();else{var o=r.getEnvelopeInternal();r=r.factory.createPoint(new p.geom.Coordinate(o.minx+(o.maxx-o.minx)/2,o.miny+(o.maxy-o.miny)/2,0))}for(var a in t.properties)i[a]=t.properties[a];return new s.default(r,i)}},{key:"featureCollectionPolygon2Point",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!(e instanceof l.default))return console.warn("Invalid FeatureCollection"),null;for(var i=new l.default(e.name),r=[],o=void 0,a=void 0,s=e.features,u=Array.isArray(s),c=0,s=u?s:s[Symbol.iterator]();;){if(u){if(c>=s.length)break;o=s[c++]}else{if(c=s.next(),c.done)break;o=c.value}a=t.featurePolygon2Point(o,n),a&&r.push(a)}return i.features=r,i}},{key:"fuckYouBitch",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!(t instanceof s.default))return console.warn("f__k off"),null;var i=t.geometry.getGeometryType(),r={},o=t.geometry;if("Polygon"!==i&&"MultiPolygon"!==i)return console.warn("f__k off"),null;if(n){o=o.getInteriorPoint();var a=o.getCoordinate();a.z=e||0}else{var u=o.getEnvelopeInternal();o=o.factory.createPoint(new p.geom.Coordinate(u.minx+(u.maxx-u.minx)/2,u.miny+(u.maxy-u.miny)/2,e||0))}for(var l in t.properties)r[l]=t.properties[l];return new s.default(o,r)}},{key:"kickYourAss",value:function(e,n){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!(e instanceof l.default&&n instanceof h.default))return console.warn("f__k off"),null;var r=new l.default(n.features.name),o=[];return n.visit(function(n,r){var a=e.getFeatureById(n.id),s=t.fuckYouBitch(a,r.height,i);s&&o.push(s)}),r.features=o,r}},{key:"getHightLightOffset",value:function(t,e){var n=[];if(!(t instanceof Array&&e instanceof Array&&t.length>0&&e.length>0))return n;for(var i=e,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;if("string"!=typeof s)return n}for(var u=t,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var h;if(l){if(c>=u.length)break;h=u[c++]}else{if(c=u.next(),c.done)break;h=c.value}var f=h;if("string"!=typeof f)return n;var d=[];n.push(d);for(var p=e,g=Array.isArray(p),v=0,p=g?p:p[Symbol.iterator]();;){var m;if(g){if(v>=p.length)break;m=p[v++]}else{if(v=p.next(),v.done)break;m=v.value}for(var y=m,_=0,b=0;_>=0;)_=f.indexOf(y,b),b=_+y.length,_>=0&&d.push(_,b)}}return n}},{key:"getMapAngle",value:function(t){var e=0;if(t&&t.angle_line){var n=t.angle_line,i=new p.geom.Coordinate(0,1,0),r=new p.geom.Coordinate(n.coordinates[1][0]-n.coordinates[0][0],n.coordinates[1][1]-n.coordinates[0][1],0);e=d.default.getAngle(i,r),e*=180/window.Math.PI}return e}}]),t}();e.default=g},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.PlanarGraph=e.FeatureCollection=e.Feature=e.DataUtil=e.DataSource=void 0;var r=n(121),o=i(r),a=n(45),s=i(a),u=n(23),l=i(u),c=n(16),h=i(c),f=n(122),d=i(f);e.DataSource=o.default,e.DataUtil=s.default,e.Feature=l.default,e.FeatureCollection=h.default,e.PlanarGraph=d.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={},i=function(t){n[t.type]=!0},r=function(t){var e=n[t.type];return n[t.type]=!1,e},o=function(t){return"undefined"==typeof t.className.baseVal?t.className:t.className.baseVal},a=function(t,e){"undefined"==typeof t.className.baseVal?t.className=e:t.className.baseVal=e},s=function(t,e,n){var i=document.createElement(t);return i.className=e,n&&n.appendChild(i),i},u=function(t,e){if("undefined"!=typeof t.classList)return t.classList.contains(e);var n=o(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},l=function(t,e){if("undefined"!=typeof t.classList)for(var n=e.trim().split(/\s+/),i=n,r=Array.isArray(i),s=0,i=r?i:i[Symbol.iterator]();;){var l;if(r){if(s>=i.length)break;l=i[s++]}else{if(s=i.next(),s.done)break;l=s.value}var c=l;t.classList.add(c)}else if(!u(t,e)){var h=o(t);a(t,""+(h?h:" ")+e)}},c=function(t,e){if("undefined"!=typeof t.classList)t.classList.remove(e);else{var n=o(t);n=(" "+n+" ").replace(" "+e+" "," ").trim(),a(t,n)}},h=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble(),r(t)},f=function(t){for(var e=h,n=document.ontouchstart?["touchstart","mousedown"]:["mousedown"],r=n,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;t.addEventListener(u,e)}t.addEventListener("click",i),t.addEventListener("dblclick",e)},d=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},p=function(t){d(t),h(t)};e.createElement=s,e.hasClass=u,e.addClass=l,e.removeClass=c,e.stopPropagation=h,e.disableClickPropagation=f,e.preventDefault=d,e.stop=p},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{
constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(123),h=r(c),f=n(2),d=i(f),p=n(88),g=(r(p),n(94)),v=r(g),m=n(60),y=r(m),_=n(174),b=r(_),x=n(166),w=n(167),E=n(111),S=r(E),M=n(6),C=r(M),I=n(108),O=r(I),T=n(184),P=r(T),A=n(185),L=r(A),N=n(186),k=r(N),R=n(7),D=n(69),F=n(12),B=n(3),j=function(t){function e(){o(this,e);var t=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._renderers={},t._domRendererrs={},C.default.getInstance().provider=new O.default,t}return s(e,t),u(e,[{key:"_createCorner",value:function(t,e,n,i){var r="ngr-",o=""+t+e,a=""+r+t+" "+r+e;i[o]=R.DOMUtils.createElement("div",a,n)}},{key:"_creatControlContainer",value:function(){var t=R.DOMUtils.createElement("div","ngr-control-container"),e={};return this._createCorner("top","left",t,e),this._createCorner("top","right",t,e),this._createCorner("bottom","left",t,e),this._createCorner("bottom","right",t,e),{container:t,corners:e}}},{key:"initMapView",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"initMapView",this).call(this,t,n);if(i&&t){var r=null;if((0,B.isString)(t.name)?(r=document.getElementById(t.name),r||(r=document.querySelector(t.name))):t.name instanceof HTMLElement&&(r=t.name),!r)throw new Error("Invalid mapView container");var o=n.devicePixelRatio,a=void 0===o?window.devicePixelRatio:o,s=n.width,u=void 0===s?r.clientWidth:s,c=n.height,h=void 0===c?r.clientHeight:c,f=n.clearColor,p=void 0===f?14408667:f,g=n.autoClear,m=void 0===g||g,_=n.fps,E=n.clearImage,M=new b.default,C=new d.WebGLRenderer({antialias:!0,preserveDrawingBuffer:m,alpha:!0,SpritePlugin:v.default}),I=new d.CSS2DRenderer,O=this._creatControlContainer(),T=O.container,A=O.corners,N=new P.default,j=t.activeCamera;if(t.changeMapViewLifeCycle(0),t.width=u,t.height=h,t.engine=this,t.sceneGenerator=M,C.autoClear=!m,C.setPixelRatio(a),C.setSize(u,h),I.setSize(u,h),this._renderers[t.name]=C,this._domRendererrs[t.name]=I,_&&_>0&&_<60?t.renderLoop=new D.LockFPSRenderLoop({fps:n.fps}):t.renderLoop=new D.AnimationFrameRenderLoop,t.container=r,t.targetDom=C.domElement,t.controlDom=T,t.controlCorners=A,t._overlayDom=I.domElement,R.DOMUtils.addClass(C.domElement,"ngr-target"),R.DOMUtils.addClass(t._overlayDom,"ngr-overlay-container"),r.appendChild(T),r.appendChild(C.domElement),r.appendChild(t._overlayDom),E?(C.setClearColor(0,0),R.DOMUtils.addClass(t.targetDom,"clear-image"),t.targetDom.style.backgroundImage="url("+E+")"):C.setClearColor(p),N.init(t),N.addGesture(new L.default),N.addGesture(new k.default),t.gestureManager=N,j){var U=new S.default(j,t);if(M._threeNode.add(j),t.activeControl=U,j.camera.aspect=u/h,j.camera.updateProjectionMatrix(),F.supportParticle){var z=new y.default,G=new w.ParticleNode(w.ParticleNodeId);t.particleEngine=z,M._threeNode.add(G)}var V=new x.OverlayNode(x.OverlayNodeId);V.add(j),t.sceneManager.add(V)}t.changeMapViewLifeCycle(1)}return i}},{key:"reSize",value:function(t,e,n){var i=this.getRenderer(t),r=this.getDomRenderer(t);i.setSize(e,n),r.setSize(e,n),t.width=e,t.height=n}},{key:"remove",value:function(t){var n=l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"remove",this).call(this,t);if(n){var i=this._renderers[t.name];t.destroy(),i.dispose(),this._empty(t.container),delete this._renderers[t.name],delete this._domRendererrs[t.name]}return n}},{key:"getRenderer",value:function(t){return this._renderers[t.name]}},{key:"getRenderInfo",value:function(t){var e=this._renderers[t.name].info,n=e.render,i=n.faces,r=n.points,o=n.vertices,a=n.calls,s=e.memory.geometries;return{faces:i,points:r,vertices:o,calls:a,geometries:s}}},{key:"getDomRenderer",value:function(t){return this._domRendererrs[t.name]}},{key:"type",value:function(){return"three"}},{key:"_empty",value:function(t){for(;t.lastChild;)t.removeChild(t.lastChild)}}]),e}(h.default);e.default=j},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(8),l=i(u),c=n(4),h=n(16),f=i(h),d=n(23),p=i(d),g=n(3),v=function(){function t(){o(this,t)}return s(t,null,[{key:"parse",value:function(e,n){return(0,g.isString)(n)?t.parseByStr(e,n):"object"===("undefined"==typeof n?"undefined":a(n))?t.parseByObj(e,n):null}},{key:"parseByStr",value:function(e,n){return t.parseByObj(e,JSON.parse(n))}},{key:"parseByObj",value:function(t,e){for(var n=new f.default(t),i=e.features,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;n.addFeature(new p.default(l.default.getGeoReader().read(s.geometry),s.properties))}return n}},{key:"parseLineString",value:function(t,e,n){var i=e.map(function(t){return new(Function.prototype.bind.apply(c.geom.Coordinate,[null].concat(r(t))))}),o=l.default.getFactory().createLineString(i),a=new f.default(t);return a.addFeature(new p.default(o,n)),a}},{key:"parsePoints",value:function(t,e,n){for(var i=new f.default(t),o=e,a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(s>=o.length)break;u=o[s++]}else{if(s=o.next(),s.done)break;u=s.value}var h=u,d=new(Function.prototype.bind.apply(c.geom.Coordinate,[null].concat(r(h)))),g=l.default.getFactory().createLinePoint(d);n&&n.id&&n.id++,i.addFeature(new p.default(g,n))}return i}}]),t}();e.default=v},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.SBLocationProvider=e.LocationStatus=e.LocationType=e.WiFiLocationManager=e.BleWorkerManager=e.BluetoothLocationManager=void 0;var r=n(133),o=i(r),a=n(132),s=i(a),u=n(136),l=n(135),c=i(l);e.BluetoothLocationManager=o.default,e.BleWorkerManager=s.default,e.WiFiLocationManager=u.WiFiLocationManager,e.LocationType=u.LocationType,e.LocationStatus=u.LocationStatus,e.SBLocationProvider=c.default},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"weight",get:function(){}},{key:"altitude",get:function(){}},{key:"from",get:function(){return this._from},set:function(t){this._from=t}},{key:"to",get:function(){return this._to},set:function(t){this._to=t}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(144),l=i(u),c=n(31),h=i(c),f=n(28),d=i(f),p=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"g",value:function(t,e,n){if(e instanceof h.default)return e.weight;if(e instanceof d.default){if(0===n)return 1e4;if(n>2){var i=e.connection.categoryId?e.connection.categoryId.toString():null;if(/2409[2-9]000/.test(i)||13164e3===e.connection.categoryId)return 1e4}else{var r=e.connection.categoryId?e.connection.categoryId.toString():null;if(/2409[7-9]000/.test(r)||13164e3===e.connection.categoryId)return 1e4;if(24091e3===e.connection.categoryId||24092e3===e.connection.categoryId){var o=t.parent.findPath(t);return o instanceof d.default&&(24091e3===o.connection.categoryId||24092e3===e.connection.categoryId)?30:190}}return 60}return 0}}]),e}(l.default);e.default=p},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i,r,o,a,s,u){n(this,t),this.mapId=e,this.rank=i,this.direction=r,this.shape=o,this.planarGraphId=a,this.pathId=s,this.altitude=u}return i(t,[{key:"toString",value:function(){return 31*this.id+this.planarGraphId}},{key:"equals",value:function(t){return this===t||!!t&&(this.id===t.id&&this.planarGraphId===t.planarGraphId)}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}},{key:"mapId",get:function(){return this._mapId},set:function(t){this._mapId=t}},{key:"rank",get:function(){return this._rank},set:function(t){this._rank=t}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t}},{key:"shape",get:function(){return this._shape},set:function(t){this._shape=t}},{key:"from",get:function(){return this._from},set:function(t){this._from=t}},{key:"to",get:function(){return this._to},set:function(t){this._to=t}},{key:"planarGraphId",get:function(){return this._planarGraphId},set:function(t){this._planarGraphId=t}},{key:"pathId",get:function(){return this._pathId},set:function(t){this._pathId=t}},{key:"altitude",get:function(){return this._altitude},set:function(t){this._altitude=t}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(55),s=i(a),u=n(53),l=i(u),c=n(141),h=i(c),f=n(8),d=i(f),p=n(4),g=function(){function t(e,n,i){if(r(this,t),!e||!n||!i)throw new Error("PathService: Invalid input");var o="string"==typeof e?JSON.parse(e):e,a="string"==typeof n?JSON.parse(n):n,u="string"==typeof i?JSON.parse(i):i,c=new p.io.GeoJSONReader(d.default.getFactory());this._vertexes={},this._paths={},this._pathsMapping={},this._connections={},this._connectionsMapping={},this._quadtreeMapping={};for(var f=o,g=Array.isArray(f),v=0,f=g?f:f[Symbol.iterator]();;){var m;if(g){if(v>=f.length)break;m=f[v++]}else{if(v=f.next(),v.done)break;m=v.value}var y=m,_=new s.default(y.mapId,c.read(y.shape),y.planarGraphId,y.altitude);_.id=y.id,_.virtual=y.virtual,this._vertexes[y.id]=_}for(var b in a){var x=a[b];this._paths[b]={},this._pathsMapping[b]={},this._quadtreeMapping[b]=new p.index.quadtree.Quadtree;for(var w in x){var E=x[w];this._pathsMapping[b][w]=[];for(var S=E,M=Array.isArray(S),C=0,S=M?S:S[Symbol.iterator]();;){var I;if(M){if(C>=S.length)break;I=S[C++]}else{if(C=S.next(),C.done)break;I=C.value}var O=I;if(!this._paths[b][O.id]){var T=new l.default(O.mapId,O.rank,O.direction,c.read(O.shape),O.planarGraphId,O.pathId,O.altitude);T.id=O.id,T.from=this._vertexes[O.from],T.to=this._vertexes[O.to],this._paths[b][O.id]=T,this._quadtreeMapping[b].insert(T.shape.getEnvelopeInternal(),T)}this._pathsMapping[b][w].push(this._paths[b][O.id])}}}for(var P in u){var A=u[P];this._connections[P]={},this._connectionsMapping[P]={};for(var L in A){var N=A[L];this._connectionsMapping[P][L]=[];for(var k=N,R=Array.isArray(k),D=0,k=R?k:k[Symbol.iterator]();;){var F;if(R){if(D>=k.length)break;F=k[D++]}else{if(D=k.next(),D.done)break;F=D.value}var B=F;if(!this._connections[P][B.id]){var j=new h.default(B.mapId,B.direction,B.rank,B.fromLocationId,B.toLocationId);j.id=B.id,j.from=this._vertexes[B.from],j.to=this._vertexes[B.to],j.categoryId=B.categoryId,this._connections[P][B.id]=j}this._connectionsMapping[P][L].push(this._connections[P][B.id])}}}}return o(t,[{key:"queryQuadTree",value:function(t){return this._quadtreeMapping[t]}},{key:"queryPathsByVertex",value:function(t){var e=this._pathsMapping[t.planarGraphId];return e&&e[t.id]?e[t.id]:[]}},{key:"queryConnectionsByVertex",value:function(t){var e=this._connectionsMapping[t.planarGraphId];return e&&e[t.id]?e[t.id]:[]}},{key:"queryAllPathFromIndex",value:function(t){var e=this._quadtreeMapping[t];return e?e.queryAll():[]}}]),t}();e.default=g},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i,r,o){n(this,t),this.mapId=e,this.shape=i,this.planarGraphId=r,this.altitude=o}return i(t,[{key:"toString",value:function(){return 31*this.id+this.planarGraphId}},{key:"equals",value:function(t){return this===t||!!t&&(this.id===t.id&&this.planarGraphId===t.planarGraphId)}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}},{key:"mapId",get:function(){return this._mapId},set:function(t){this._mapId=t}},{key:"shape",get:function(){return this._shape},set:function(t){this._shape=t}},{key:"planarGraphId",get:function(){return this._planarGraphId},set:function(t){this._planarGraphId=t}},{key:"virtual",get:function(){return this._virtual},set:function(t){this._virtual=t}},{key:"altitude",get:function(){return this._altitude},set:function(t){this._altitude=t}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(156),u=r(s),l=n(148),c=r(l),h=n(149),f=r(h),d=n(2),p=i(d),g=n(4),v=n(6),m=r(v),y=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{needAudio:!1,autoplay:!1,endThreshold:8},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{autoMove:!1},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{autoPullToEnd:!1,pullThreshold:5};o(this,t),this._mapView=e,this._navigateManager=n,this._messageOptions=i,this._cameraOptions=r,this._locationOptions=a,this._trigger=new u.default(new c.default,i.needAudio),this._dynamicNavigationRule=new f.default,this._dynamicNavigationRule.trigger=this._trigger,this._isArrived=!1,this._onSegmentChange=this._onSegmentChange.bind(this),this._dynamicNavigationRule.on("onSegmentChange",this._onSegmentChange),this._onLocationChange=this._onLocationChange.bind(this),this._dynamicNavigationRule.on("onLocationChange",this._onLocationChange),this._onArriveSegEnd=this._onArriveSegEnd.bind(this),this._dynamicNavigationRule.on("onArriveSegEnd",this._onArriveSegEnd),this._crtPlanarGraphId=null,this._onSegChangeCallback=null,this._onLocChangeCallback=null}return a(t,[{key:"clearFeatureCollection",value:function(){this._trigger._audioProvider.audioElmt.pause(),this._trigger._segments=[],this._dynamicNavigationRule.reset(),this._crtPlanarGraphId=null,this._isArrived=!1}},{key:"addSegment",value:function(t){return this._trigger.addSegment(t),this}},{key:"removeSegment",value:function(t){return this._trigger.removeSegment(t),this}},{key:"start",value:function(t,e){this._dynamicNavigationRule.start(t,e)}},{key:"isYawing",value:function(t,e,n){var i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._crtPlanarGraphId,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]);return i?this.crtOffsetLocation.distance(new g.geom.Coordinate(t,e))>n:this.crtLocation.distance(new g.geom.Coordinate(t,e))>n}},{key:"findNearestSegment",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this._mapView.coordinateSystem.getOffset(),a=null;this._crtPlanarGraphId=n,i?(a=new g.geom.Coordinate(t,e),r&&(a.x-=o[0],a.y-=o[1])):a=this._navigateManager.getClosestPoints(n,t,e)[0];var s=this._locationOptions,u=s.autoPullToEnd,l=s.pullThreshold;return this._dynamicNavigationRule.findNearestSegment(a.x,a.y,n,u,l)}},{key:"returnNearestSegment",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this._mapView.coordinateSystem.getOffset(),a=new g.geom.Coordinate(t,e);return i?(a=new g.geom.Coordinate(t,e),r&&(a.x-=o[0],a.y-=o[1])):a=this._navigateManager.getClosestPoints(n,t,e)[0],this._dynamicNavigationRule.returnNearestSegment(a.x,a.y,n)}},{key:"destroy",value:function(){this._dynamicNavigationRule.reset(),this._dynamicNavigationRule.off("onSegmentChange",this._onSegmentChange),this._dynamicNavigationRule.off("onLocationChange",this._onLocationChange),this._dynamicNavigationRule.off("onArriveSegEnd",this._onArriveSegEnd),this._mapView=null,this._navigateManager=null,this._trigger._audioProvider.audioElmt.pause(),this._trigger._audioProvider.audioElmt.parentNode.removeChild(this._trigger._audioProvider.audioElmt),this._trigger=null,this._dynamicNavigationRule=null,this._messageOptions=null,this._crtPlanarGraphId=null,this._isArrived=!1,this._onSegChangeCallback=null,this._onLocChangeCallback=null}},{key:"moveToSegment",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.crtOffsetLocation,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.crtSegment,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=this,r=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),o=this._mapView.activeControl.target,a=o.x,s=o.y;m.default.getInstance().ofNumber(1,0,300).on("update",function(e,n){var o=n.num;i._mapView.activeControl.zoomByFocalLength(50),i._mapView.activeControl.moveToPoint(a*o+(1-o)*t.x,s*o+(1-o)*t.y,null,!0,r,!1)}).on("start",function(){}).on("complete",function(){if(n){var o=e.spot.lineString.getCoordinate(),a=e.spot.nextLineSpot?e.spot.nextLineSpot.lineString.getCoordinate():e.spot.lineString.points.coordinates[1],s=new p.Vector3(a.x-o.x,a.y-o.y,0),u=i._mapView.activeControl.getRotate(),l=-(i._mapView.activeControl._getAngle(s)-270);u-l<-180?u+=360:u-l>180&&(l+=360),m.default.getInstance().ofNumber(u,l,500).on("update",function(e,n){i._mapView.activeControl.moveToPoint(t.x,t.y,null,!0,!0,!1),i._mapView.activeControl.zoomByFocalLength(50),i._mapView.activeControl.rotateTo(t.x,t.y,n.num,!0,r)}).on("start",function(){}).on("complete",function(){}).start()}}).start()}},{key:"distanceToEnd",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.crtOffsetLocation.x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.crtOffsetLocation.y,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._crtPlanarGraphId,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===this._trigger._segments.length)return-1;var o=this.returnNearestSegment(t,e,n,i,r);if(!o.segment)return-1;var a=this._trigger._segments[o.index],s=new g.geom.Coordinate(t,e);if(r){var u=this._mapView.coordinateSystem.getOffset();s.x-=u[0],s.y-=u[1]}return a.state.distanceToEnd-a.spot.lineString.getCoordinate().distance(s)}},{key:"getConnectionInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.crtOffsetLocation.x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.crtOffsetLocation.y,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._crtPlanarGraphId,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===this._trigger._segments.length)return null;var o=this.returnNearestSegment(t,e,n,i,r);if(!o.segment)return null;var a=this._trigger._segments[o.index],s=new g.geom.Coordinate(t,e);if(r){var u=this._mapView.coordinateSystem.getOffset();s.x-=u[0],s.y-=u[1]}var l=a.state.distanceToConnection-a.spot.lineString.getCoordinate().distance(s);if(!l)return null;for(var c=void 0,h=void 0,f=o.index;a;){if(a.state&&a.state.targetFloor){c=a.state.targetFloor,h=a.state.isUp;break}f++,a=this._trigger._segments[f]}return{connectionDist:l,targetFloor:c,isUp:h,index:f}}},{key:"distanceToSegmentEnd",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.crtOffsetLocation.x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.crtOffsetLocation.y,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._crtPlanarGraphId,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return 0===this._trigger._segments.length?null:this._trigger._segments[this._dynamicNavigationRule.currentIndex+1]?this.distanceToEnd(t,e,n,i,r)-this._trigger._segments[this._dynamicNavigationRule.currentIndex+1].state.distanceToEnd:this.distanceToEnd(t,e,n,i,r)}},{key:"distanceToSegmentStart",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.crtOffsetLocation.x,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.crtOffsetLocation.y,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._crtPlanarGraphId,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return 0===this._trigger._segments.length?null:this._trigger._segments[this._dynamicNavigationRule.currentIndex].state.distanceToEnd-this.distanceToEnd(t,e,n,i,r)}},{key:"getMessageInNavi",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0===this._trigger._segments.length)return null;var e=this._trigger._segments[this._dynamicNavigationRule.currentIndex],n=this.crtLocation;if(!n)return null;if(!this._crtPlanarGraphId)return t||this.playMessage(""+e.getMessageInNavi(0,t)),e.getMessageInNavi(0,!0);var i=this.getConnectionInfo();if(i&&i.connectionDist<10)return this.segments[i.index].getMessageInNavi(1e5,t);if(this.distanceToEnd()<this._messageOptions.endThreshold)return this._messageOptions.endMessage?this.playMessage(this._messageOptions.endMessage):this.segments[this.segments.length-1].getMessageInNavi(1e5,t);var r=e.state.distanceToEnd-this.distanceToEnd(n.x,n.y,this._crtPlanarGraphId,!0,!1);return e.getMessageInNavi(r,t)}},{key:"getMessageInList",value:function(){var t=[];return this.segments&&this.segments.forEach(function(e){t.push(e.getMessageInList())}),t}},{key:"playMessage",value:function(t){return this._trigger._audioProvider&&this._trigger._audioProvider.playMessage(t),t}},{key:"pauseMessage",value:function(){this._trigger._audioProvider&&this._trigger._audioProvider.audioElmt.pause()}},{key:"_onLocationChange",value:function(t){this._cameraOptions.autoMove&&this.moveToSegment(),this._onLocChangeCallback&&this._onLocChangeCallback(t),this.distanceToEnd()<=this._messageOptions.endThreshold&&this.distanceToEnd()>=0&&this._messageOptions.needAudio&&this._messageOptions.autoplay&&(this.getMessageInNavi(this._isArrived),this._isArrived=!0)}},{key:"_onSegmentChange",value:function(t){this._messageOptions.needAudio&&this._messageOptions.autoplay&&this.getMessageInNavi(this._isArrived),this._onSegChangeCallback&&this._onSegChangeCallback(t)}},{key:"_onArriveSegEnd",value:function(){this._messageOptions.needAudio&&this._messageOptions.autoplay}},{key:"featureCollection",set:function(t){this._trigger.trigger(t),this._dynamicNavigationRule.reset(),this._dynamicNavigationRule._center=this.crtSegment.spot.lineString.getCoordinate()||null,this._crtPlanarGraphId=null,this._isArrived=!1,this._dynamicNavigationRule._changeSegment(this.crtSegment,this.crtLocation)}},{key:"trigger",get:function(){return this._trigger}},{key:"dynamicNavigationRule",get:function(){return this._dynamicNavigationRule}},{key:"segments",get:function(){return this._trigger._segments}},{key:"crtLocation",get:function(){return this._dynamicNavigationRule.center}},{key:"crtOffsetLocation",get:function(){var t=this._dynamicNavigationRule.center.copy(),e=this._mapView.coordinateSystem.getOffset();return t.x+=e[0],t.y+=e[1],t}},{key:"crtIndex",get:function(){return this._dynamicNavigationRule.currentIndex}},{key:"crtSegment",get:function(){return this._trigger._segments[this._dynamicNavigationRule.currentIndex]||null}},{key:"crtPlanarGraphId",get:function(){return this._crtPlanarGraphId}},{key:"onSegmentChange",set:function(t){this._onSegChangeCallback=t}},{key:"onLocationChange",set:function(t){this._onLocChangeCallback=t}}]),t}();e.default=y},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"mate",value:function(t){return null}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),c=i(l),h=n(4),f=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i.targetDom=t,i._options=s({},n),i._options.defaultDisplay||(i._options.defaultDisplay=i.targetDom&&i.targetDom.style.display?i.targetDom.style.display:"inline"),i._position=new h.geom.Coordinate(0,0,0),i}return a(e,t),u(e,[{key:"attach",value:function(t){this._layer=t}},{key:"detach",value:function(t){delete this._layer}},{key:"layer",get:function(){return this._layer}},{key:"coordinateSystem",get:function(){return this._coordinateSystem},set:function(t){this._coordinateSystem=t}},{key:"targetDom",get:function(){return this._dom},set:function(t){this._dom=t,this.emit("valueChange",this,"targetDom",t)}},{key:"position",get:function(){return this._position},set:function(t){var e=t.x,n=t.y;if(this.coordinateSystem){var i=this._coordinateSystem.getOffset();e+=i[0],n+=i[1]}this._position.x=e,this._position.y=n,this._position.z=t.z,this.emit("valueChange",this,"position",this._position)}}]),e}(c.default);e.default=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.IconOverlay=e.Overlay=void 0;var r=n(58),o=i(r),a=n(158),s=i(a);e.Overlay=o.default,e.IconOverlay=s.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._particleGroups={},t}return a(e,t),s(e,[{key:"addParticleGroup",value:function(t){!t&&this.has(t)||(this._particleGroups[t.id]=t,this.emit("addParticleGroup",t))}},{key:"removeParticleGroup",value:function(t){this.has(t)&&(delete this._particleGroups[t.id],this.emit("removeParticleGroup",t))}},{key:"has",value:function(t){return!!t&&t.id in this._particleGroups}},{key:"destroy",value:function(){for(var t in this._particleGroups)this.removeParticleGroup(this._particleGroups[t])}}]),e}(l.default);e.default=c},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"getStyle",value:function(t){return null}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,c)}Object.defineProperty(e,"__esModule",{
value:!0});var o=n(1),a=n(10),s=i(a),u=n(13),l=i(u),c={font:"20px Arial",field:null,outlineWidth:null,shadowBlur:null,anchor:[.5,.5],anchorAuto:!1,anchorStyle:null,optTextRect:!1,type:function(){return"Annotation"}};Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){this._color=l.default.converToSharp(t)}}),Object.defineProperty(r.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor=l.default.converToSharp(t)}}),Object.defineProperty(r.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this._shadowColor=l.default.converToSharp(t)}}),e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,u)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(10),s=i(a),u={anchor:[.5,.5],field:null,serverUrl:null,height:null,width:null,texture:null,plane:null,type:function(){return"Icon"}};e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=n(1),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(33),h=i(c),f=n(62),d=i(f),p=n(63),g=i(p),v=n(67),m=i(v),y=n(66),_=i(y),b=n(179),x=i(b),w=n(180),E=i(w),S=n(65),M=i(S),C=n(162),I=i(C),O=n(163),T=i(O),P=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._styleJson=t,n}return a(e,t),l(e,[{key:"generator",value:function(t){if(!(this._styleJson.default&&t&&this._styleJson.default[t.name]))return console.warn("Invalid Json or Layer"),null;var e=this._styleJson.default[t.name],n=null;if(t.height=e.height||0,e.renderer&&"simple"===e.renderer.type)n=new I.default,n.style=this._generator(e.renderer.style);else if(e.renderer&&"unique"===e.renderer.type){n=new T.default,n.defaultStyle=this._generator(e.renderer.default);for(var i=e.renderer.keys,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;n.addKey(s)}for(var u in e.renderer.styles)n.addStyle(u,this._generator(e.renderer.styles[u],n.defaultStyle))}else console.warn("Invalid Renderer Type");return n}},{key:"_initialsToCapitals",value:function(t){return t.replace(/(\w)/,function(t){return t.toUpperCase()})}},{key:"_parse",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n&&u(e,n);for(var r in t)if("type"!==r){var o=t[r];if(i&&this._hasStyle(o)){var a=n&&n[r]||{};if(o=this._generator(o,a),e[r]){var s=e[r],l=this._generator({type:o.type()});o=u(l,s,o)}}e[r]=o}}},{key:"_generator",value:function(t,e){var n=t.type,i=void 0;switch(n){case"Polygon":i=new m.default,this._parse(t,i,e);for(var r in t.face)i[r]=t.face[r];for(var o in t.outline){var a="outline"+this._initialsToCapitals(o);i[a]=t.outline[o]}break;case"Annotation":i=new d.default,this._parse(t,i,e,!0);break;case"Icon":i=new g.default,this._parse(t,i,e);break;case"LineString":i=new _.default,this._parse(t,i,e);break;case"Light":i=new M.default,this._parse(t,i,e);break;case"Model":i=new x.default,this._parse(t,i,e);break;case"Sphere":i=new E.default,this._parse(t,i,e);break;default:console.warn("Invalid Style Type")}return i}},{key:"_hasStyle",value:function(t){return"object"===("undefined"==typeof t?"undefined":s(t))&&!!t&&"type"in t}}]),e}(h.default);e.default=P},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,c)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(10),s=i(a),u=n(13),l=i(u),c={intensity:1,lightType:"HemisphereLight",type:function(){return"Light"}};Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){this._color=l.default.parseColor(t)}}),Object.defineProperty(r.prototype,"options",{get:function(){return this._options},set:function(t){this._options=o({},t),t.groudColor&&(this._options.groudColor=l.default.parseColor(t.groudColor))}}),e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,c)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(10),s=i(a),u=n(13),l=i(u),c={type:function(){return"LineString"}};Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){this._color=l.default.parseColor(t)}}),Object.defineProperty(r.prototype,"dash",{get:function(){return this._dash},set:function(t){t instanceof Array&&t.length>1&&(this._dash=[t[0],t[1]])}}),e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,c)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(10),s=i(a),u=n(13),l=i(u),c={texture:null,height:0,z:0,polygonMerge:!1,outlineMerge:!0,outlineBlending:!0,clickable:!0,type:function(){return"Polygon"}};Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){this._color=l.default.parseColor(t)}}),Object.defineProperty(r.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor=l.default.parseColor(t)}}),e.default=r},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(3),a=function(){function t(){i(this,t)}return r(t,[{key:"offset",value:function(t,e){return[t-this._offset[0],e-this._offset[1]]}},{key:"setOffset",value:function(t){return(0,o.isArray)(t)&&2===t.length?(this._offset=t,this):(console.warn("Invalid Offset"),this)}},{key:"getOffset",value:function(){return this._offset}}],[{key:"getExtentCenter",value:function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return[(e+i)/2,(n+r)/2]}}]),t}();e.default=a},function(t,e){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function(){function t(){r(this,t),this._running=!1}return a(t,[{key:"loop",value:function(t){this._running||(this._running=!0,this._onLoop(t))}},{key:"hasRunning",value:function(){return this._running}},{key:"stop",value:function(){this._running=!1}},{key:"_onLoop",value:function(t){}}]),t}(),u=function(t){function e(){return r(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,t),a(e,[{key:"_onLoop",value:function(t){var e=this,n=function n(i){e._running&&(window.requestAnimationFrame(n),t(i))};window.requestAnimationFrame(n)}}]),e}(s),l=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.fps,o=void 0===i?60:i;r(this,e);var a=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._fps=o,a._interval=null,a}return i(e,t),a(e,[{key:"_onLoop",value:function(t){var e=this,n=function(){e._running&&window.requestAnimationFrame(t)};this._interval=setInterval(n,1e3/this._fps)}},{key:"stop",value:function(){this._interval&&clearInterval(this._interval),o(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"stop",this).call(this)}}]),e}(s);e.RenderLoop=s,e.AnimationFrameRenderLoop=u,e.LockFPSRenderLoop=l},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"onAdd",value:function(t){this._gestureManager=t}},{key:"onRemove",value:function(){this._gestureManager=null}},{key:"providerEvent",value:function(){return null}},{key:"type",value:function(){return"none"}}]),t}();e.default=r},function(t,e){function n(t){this._comparator=t||n.DEFAULT_COMPARATOR,this._elements=[]}t.exports=n,n.DEFAULT_COMPARATOR=function(t,e){return"number"==typeof t&&"number"==typeof e?t-e:(t=t.toString(),e=e.toString(),t==e?0:t>e?1:-1)},n.prototype.isEmpty=function(){return 0===this.size()},n.prototype.peek=function(){if(this.isEmpty())throw new Error("PriorityQueue is empty");return this._elements[0]},n.prototype.deq=function(){var t=this.peek(),e=this._elements.pop(),n=this.size();if(0===n)return t;this._elements[0]=e;for(var i=0;i<n;){var r=i,o=2*i+1,a=2*i+2;if(o<n&&this._compare(o,r)>=0&&(r=o),a<n&&this._compare(a,r)>=0&&(r=a),r===i)break;this._swap(r,i),i=r}return t},n.prototype.enq=function(t){for(var e=this._elements.push(t),n=e-1;n>0;){var i=Math.floor((n-1)/2);if(this._compare(n,i)<=0)break;this._swap(i,n),n=i}return e},n.prototype.size=function(){return this._elements.length},n.prototype.forEach=function(t){return this._elements.forEach(t)},n.prototype._compare=function(t,e){return this._comparator(this._elements[t],this._elements[e])},n.prototype._swap=function(t,e){var n=this._elements[t];this._elements[t]=this._elements[e],this._elements[e]=n}},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function a(){g&&d&&(g=!1,d.length?p=d.concat(p):v=-1,p.length&&s())}function s(){if(!g){var t=r(a);g=!0;for(var e=p.length;e;){for(d=p,p=[];++v<e;)d&&d[v].run();v=-1,e=p.length}d=null,g=!1,o(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var c,h,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var d,p=[],g=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||g||r(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,n){var i,r;(function(n){var o=o||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var n=t.indexOf(e);n!==-1&&t.splice(n,1)},update:function(e,n){if(0===t.length)return!1;var i=0;for(e=void 0!==e?e:o.now();i<t.length;)t[i].update(e)||n?i++:t.splice(i,1);return!0}}}();"undefined"==typeof window&&"undefined"!=typeof n?o.now=function(){var t=n.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(t){var e,n=t,i={},r={},a={},s=1e3,u=0,l=!1,c=!1,h=!1,f=0,d=null,p=o.Easing.Linear.None,g=o.Interpolation.Linear,v=[],m=null,y=!1,_=null,b=null,x=null;this.to=function(t,e){return r=t,void 0!==e&&(s=e),this},this.start=function(t){o.add(this),c=!0,y=!1,d=void 0!==t?t:o.now(),d+=f;for(var e in r){if(r[e]instanceof Array){if(0===r[e].length)continue;r[e]=[n[e]].concat(r[e])}void 0!==n[e]&&(i[e]=n[e],i[e]instanceof Array==!1&&(i[e]*=1),a[e]=i[e]||0)}return this},this.stop=function(){return c?(o.remove(this),c=!1,null!==x&&x.call(n,n),this.stopChainedTweens(),this):this},this.end=function(){return this.update(d+s),this},this.stopChainedTweens=function(){for(var t=0,e=v.length;t<e;t++)v[t].stop()},this.delay=function(t){return f=t,this},this.repeat=function(t){return u=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return l=t,this},this.easing=function(t){return p=t,this},this.interpolation=function(t){return g=t,this},this.chain=function(){return v=arguments,this},this.onStart=function(t){return m=t,this},this.onUpdate=function(t){return _=t,this},this.onComplete=function(t){return b=t,this},this.onStop=function(t){return x=t,this},this.update=function(t){var o,c,x;if(t<d)return!0;y===!1&&(null!==m&&m.call(n,n),y=!0),c=(t-d)/s,c=c>1?1:c,x=p(c);for(o in r)if(void 0!==i[o]){var w=i[o]||0,E=r[o];E instanceof Array?n[o]=g(E,x):("string"==typeof E&&(E="+"===E.charAt(0)||"-"===E.charAt(0)?w+parseFloat(E):parseFloat(E)),"number"==typeof E&&(n[o]=w+(E-w)*x))}if(null!==_&&_.call(n,x),1===c){if(u>0){isFinite(u)&&u--;for(o in a){if("string"==typeof r[o]&&(a[o]=a[o]+parseFloat(r[o])),l){var S=a[o];a[o]=r[o],r[o]=S}i[o]=a[o]}return l&&(h=!h),d=void 0!==e?t+e:t+f,!0}null!==b&&b.call(n,n);for(var M=0,C=v.length;M<C;M++)v[M].start(d+s);return!1}return!0}},o.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-o.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*o.Easing.Bounce.In(2*t):.5*o.Easing.Bounce.Out(2*t-1)+.5}}},o.Interpolation={Linear:function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),a=o.Interpolation.Utils.Linear;return e<0?a(t[0],t[1],i):e>1?a(t[n],t[n-1],n-i):a(t[r],t[r+1>n?n:r+1],i-r)},Bezier:function(t,e){for(var n=0,i=t.length-1,r=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=i;s++)n+=r(1-e,i-s)*r(e,s)*t[s]*a(i,s);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,r=Math.floor(i),a=o.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(r=Math.floor(i=n*(1+e))),a(t[(r-1+n)%n],t[r],t[(r+1)%n],t[(r+2)%n],i-r)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(a(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):a(t[r?r-1:0],t[r],t[n<r+1?n:r+1],t[n<r+2?n:r+2],i-r)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=o.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var i=e;i>1;i--)n*=i;return t[e]=n,n}}(),CatmullRom:function(t,e,n,i,r){var o=.5*(n-t),a=.5*(i-e),s=r*r,u=r*s;return(2*e-2*n+o+a)*u+(-3*e+3*n-2*o-a)*s+o*r+e}}},function(n){i=[],r=function(){return o}.apply(e,i),!(void 0!==r&&(t.exports=r))}(this)}).call(e,n(72))},function(t,e){!function(t){function e(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1}function n(t){var e=new Promise(function(e,n){var i=function(r){setTimeout(function(){t&&t.data?e():r>=20?n():i(++r)},50)};i(0)});return e}function i(){p=d?(t.screen.orientation.angle||0)*l:(t.orientation||0)*l}function r(t){h.orientation.data=t;for(var e in h.orientation.callbacks)h.orientation.callbacks[e].call(this)}function o(t){h.motion.data=t;for(var e in h.motion.callbacks)h.motion.callbacks[e].call(this)}if(void 0===t.FULLTILT||null===t.FULLTILT){var a=Math.PI,s=a/2,u=2*a,l=a/180,c=180/a,h={orientation:{active:!1,callbacks:[],data:void 0},motion:{active:!1,callbacks:[],data:void 0}},f=!1,d=!(!t.screen||!t.screen.orientation||void 0===t.screen.orientation.angle||null===t.screen.orientation.angle),p=(d?t.screen.orientation.angle:t.orientation||0)*l,g=s,v=a,m=u/3,y=-s,_={};_.version="0.5.3",_.getDeviceOrientation=function(t){var e=new Promise(function(e,i){var r=new _.DeviceOrientation(t);r.start();var o=new n(h.orientation);o.then(function(){e(r)}).catch(function(){r.stop(),i("DeviceOrientation is not supported")})});return e},_.getDeviceMotion=function(t){var e=new Promise(function(e,i){var r=new _.DeviceMotion(t);r.start();var o=new n(h.motion);o.then(function(){e(r)}).catch(function(){r.stop(),i("DeviceMotion is not supported")})});return e},_.Quaternion=function(t,n,i,r){var o;this.set=function(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=i||1},this.copy=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w},this.setFromEuler=function(){var t,e,n,i,r,o,a,s,u,c,h,f;return function(d){return d=d||{},n=(d.alpha||0)*l,t=(d.beta||0)*l,e=(d.gamma||0)*l,o=n/2,i=t/2,r=e/2,a=Math.cos(i),s=Math.cos(r),u=Math.cos(o),c=Math.sin(i),h=Math.sin(r),f=Math.sin(o),this.set(c*s*u-a*h*f,a*h*u+c*s*f,a*s*f+c*h*u,a*s*u-c*h*f),this.normalize(),this}}(),this.setFromRotationMatrix=function(){var t;return function(n){return t=n.elements,this.set(.5*Math.sqrt(1+t[0]-t[4]-t[8])*e(t[7]-t[5]),.5*Math.sqrt(1-t[0]+t[4]-t[8])*e(t[2]-t[6]),.5*Math.sqrt(1-t[0]-t[4]+t[8])*e(t[3]-t[1]),.5*Math.sqrt(1+t[0]+t[4]+t[8])),this}}(),this.multiply=function(t){return o=_.Quaternion.prototype.multiplyQuaternions(this,t),this.copy(o),this},this.rotateX=function(t){return o=_.Quaternion.prototype.rotateByAxisAngle(this,[1,0,0],t),this.copy(o),this},this.rotateY=function(t){return o=_.Quaternion.prototype.rotateByAxisAngle(this,[0,1,0],t),this.copy(o),this},this.rotateZ=function(t){return o=_.Quaternion.prototype.rotateByAxisAngle(this,[0,0,1],t),this.copy(o),this},this.normalize=function(){return _.Quaternion.prototype.normalize(this)},this.set(t,n,i,r)},_.Quaternion.prototype={constructor:_.Quaternion,multiplyQuaternions:function(){var t=new _.Quaternion;return function(e,n){var i=e.x,r=e.y,o=e.z,a=e.w,s=n.x,u=n.y,l=n.z,c=n.w;return t.set(i*c+a*s+r*l-o*u,r*c+a*u+o*s-i*l,o*c+a*l+i*u-r*s,a*c-i*s-r*u-o*l),t}}(),normalize:function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return 0===e?(t.x=0,t.y=0,t.z=0,t.w=1):(e=1/e,t.x*=e,t.y*=e,t.z*=e,t.w*=e),t},rotateByAxisAngle:function(){var t,e,n=new _.Quaternion,i=new _.Quaternion;return function(r,o,a){return t=(a||0)/2,e=Math.sin(t),i.set((o[0]||0)*e,(o[1]||0)*e,(o[2]||0)*e,Math.cos(t)),n=_.Quaternion.prototype.multiplyQuaternions(r,i),_.Quaternion.prototype.normalize(n)}}()},_.RotationMatrix=function(t,e,n,i,r,o,a,s,u){var c;this.elements=new Float32Array(9),this.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},this.set=function(t,e,n,i,r,o,a,s,u){this.elements[0]=t||1,this.elements[1]=e||0,this.elements[2]=n||0,this.elements[3]=i||0,this.elements[4]=r||1,this.elements[5]=o||0,this.elements[6]=a||0,this.elements[7]=s||0,this.elements[8]=u||1},this.copy=function(t){this.elements[0]=t.elements[0],this.elements[1]=t.elements[1],this.elements[2]=t.elements[2],this.elements[3]=t.elements[3],this.elements[4]=t.elements[4],this.elements[5]=t.elements[5],this.elements[6]=t.elements[6],this.elements[7]=t.elements[7],this.elements[8]=t.elements[8]},this.setFromEuler=function(){var t,e,n,i,r,o,a,s,u;return function(c){return c=c||{},n=(c.alpha||0)*l,t=(c.beta||0)*l,e=(c.gamma||0)*l,i=Math.cos(t),r=Math.cos(e),o=Math.cos(n),a=Math.sin(t),s=Math.sin(e),u=Math.sin(n),this.set(o*r-u*a*s,-i*u,r*u*a+o*s,r*u+o*a*s,o*i,u*s-o*r*a,-i*s,a,i*r),this.normalize(),this}}(),this.setFromQuaternion=function(){var t,e,n,i;return function(r){return t=r.w*r.w,e=r.x*r.x,n=r.y*r.y,i=r.z*r.z,this.set(t+e-n-i,2*(r.x*r.y-r.w*r.z),2*(r.x*r.z+r.w*r.y),2*(r.x*r.y+r.w*r.z),t-e+n-i,2*(r.y*r.z-r.w*r.x),2*(r.x*r.z-r.w*r.y),2*(r.y*r.z+r.w*r.x),t-e-n+i),this}}(),this.multiply=function(t){return c=_.RotationMatrix.prototype.multiplyMatrices(this,t),this.copy(c),this},this.rotateX=function(t){return c=_.RotationMatrix.prototype.rotateByAxisAngle(this,[1,0,0],t),this.copy(c),this},this.rotateY=function(t){return c=_.RotationMatrix.prototype.rotateByAxisAngle(this,[0,1,0],t),this.copy(c),this},this.rotateZ=function(t){return c=_.RotationMatrix.prototype.rotateByAxisAngle(this,[0,0,1],t),this.copy(c),this},this.normalize=function(){return _.RotationMatrix.prototype.normalize(this)},this.set(t,e,n,i,r,o,a,s,u)},_.RotationMatrix.prototype={constructor:_.RotationMatrix,multiplyMatrices:function(){var t,e,n=new _.RotationMatrix;return function(i,r){return t=i.elements,e=r.elements,n.set(t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]),n}}(),normalize:function(t){var e=t.elements,n=e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[1]*e[3]*e[8]+e[1]*e[5]*e[6]+e[2]*e[3]*e[7]-e[2]*e[4]*e[6];return e[0]/=n,e[1]/=n,e[2]/=n,e[3]/=n,e[4]/=n,e[5]/=n,e[6]/=n,e[7]/=n,e[8]/=n,t.elements=e,t},rotateByAxisAngle:function(){var t,e,n=new _.RotationMatrix,i=new _.RotationMatrix,r=!1;return function(o,a,s){return i.identity(),r=!1,t=Math.sin(s),e=Math.cos(s),1===a[0]&&0===a[1]&&0===a[2]?(r=!0,i.elements[4]=e,i.elements[5]=-t,i.elements[7]=t,i.elements[8]=e):1===a[1]&&0===a[0]&&0===a[2]?(r=!0,i.elements[0]=e,i.elements[2]=t,i.elements[6]=-t,i.elements[8]=e):1===a[2]&&0===a[0]&&0===a[1]&&(r=!0,i.elements[0]=e,i.elements[1]=-t,i.elements[3]=t,i.elements[4]=e),r?(n=_.RotationMatrix.prototype.multiplyMatrices(o,i),n=_.RotationMatrix.prototype.normalize(n)):n=o,n}}()},_.Euler=function(t,e,n){this.set=function(t,e,n){this.alpha=t||0,this.beta=e||0,this.gamma=n||0},this.copy=function(t){this.alpha=t.alpha,this.beta=t.beta,this.gamma=t.gamma},this.setFromRotationMatrix=function(){var t,e,n,i;return function(r){t=r.elements,t[8]>0?(e=Math.atan2(-t[1],t[4]),n=Math.asin(t[7]),i=Math.atan2(-t[6],t[8])):t[8]<0?(e=Math.atan2(t[1],-t[4]),n=-Math.asin(t[7]),n+=n>=0?-a:a,i=Math.atan2(t[6],-t[8])):t[6]>0?(e=Math.atan2(-t[1],t[4]),n=Math.asin(t[7]),i=-s):t[6]<0?(e=Math.atan2(t[1],-t[4]),n=-Math.asin(t[7]),n+=n>=0?-a:a,i=-s):(e=Math.atan2(t[3],t[0]),n=t[7]>0?s:-s,i=0),e<0&&(e+=u),e*=c,n*=c,i*=c,this.set(e,n,i)}}(),this.setFromQuaternion=function(){var t,e,n;return function(i){var r=i.w*i.w,o=i.x*i.x,l=i.y*i.y,h=i.z*i.z,f=r+o+l+h,d=i.w*i.x+i.y*i.z,p=1e-6;if(d>(.5-p)*f)t=2*Math.atan2(i.y,i.w),e=s,n=0;else if(d<(-.5+p)*f)t=-2*Math.atan2(i.y,i.w),e=-s,n=0;else{var g=r-o+l-h,v=2*(i.w*i.z-i.x*i.y),m=r-o-l+h,y=2*(i.w*i.y-i.x*i.z);m>0?(t=Math.atan2(v,g),e=Math.asin(2*d/f),n=Math.atan2(y,m)):(t=Math.atan2(-v,-g),e=-Math.asin(2*d/f),e+=e<0?a:-a,n=Math.atan2(-y,-m))}t<0&&(t+=u),t*=c,e*=c,n*=c,this.set(t,e,n)}}(),this.rotateX=function(t){return _.Euler.prototype.rotateByAxisAngle(this,[1,0,0],t),this},this.rotateY=function(t){return _.Euler.prototype.rotateByAxisAngle(this,[0,1,0],t),this},this.rotateZ=function(t){return _.Euler.prototype.rotateByAxisAngle(this,[0,0,1],t),this},this.set(t,e,n)},_.Euler.prototype={constructor:_.Euler,rotateByAxisAngle:function(){var t=new _.RotationMatrix;return function(e,n,i){return t.setFromEuler(e),t=_.RotationMatrix.prototype.rotateByAxisAngle(t,n,i),e.setFromRotationMatrix(t),e}}()},_.DeviceOrientation=function(e){this.options=e||{};var n=0,i=200,r=0,o=10;if(this.alphaOffsetScreen=0,this.alphaOffsetDevice=void 0,"game"===this.options.type){var a=function(e){return null!==e.alpha&&(this.alphaOffsetDevice=new _.Euler(e.alpha,0,0),this.alphaOffsetDevice.rotateZ(-p),++r>=o)?void t.removeEventListener("deviceorientation",a,!1):void(++n>=i&&t.removeEventListener("deviceorientation",a,!1))}.bind(this);t.addEventListener("deviceorientation",a,!1)}else if("world"===this.options.type){var s=function(e){return e.absolute!==!0&&void 0!==e.webkitCompassAccuracy&&null!==e.webkitCompassAccuracy&&+e.webkitCompassAccuracy>=0&&+e.webkitCompassAccuracy<50&&(this.alphaOffsetDevice=new _.Euler(e.webkitCompassHeading,0,0),this.alphaOffsetDevice.rotateZ(p),this.alphaOffsetScreen=p,++r>=o)?void t.removeEventListener("deviceorientation",s,!1):void(++n>=i&&t.removeEventListener("deviceorientation",s,!1))}.bind(this);t.addEventListener("deviceorientation",s,!1)}},_.DeviceOrientation.prototype={constructor:_.DeviceOrientation,start:function(e){e&&"[object Function]"==Object.prototype.toString.call(e)&&h.orientation.callbacks.push(e),f||(d?t.screen.orientation.addEventListener("change",i,!1):t.addEventListener("orientationchange",i,!1)),h.orientation.active||(t.addEventListener("deviceorientation",r,!1),h.orientation.active=!0)},stop:function(){h.orientation.active&&(t.removeEventListener("deviceorientation",r,!1),h.orientation.active=!1)},listen:function(t){this.start(t)},getFixedFrameQuaternion:function(){var t=new _.Euler,e=new _.RotationMatrix,n=new _.Quaternion;return function(){var i=h.orientation.data||{alpha:0,beta:0,gamma:0},r=i.alpha;return this.alphaOffsetDevice&&(e.setFromEuler(this.alphaOffsetDevice),e.rotateZ(-this.alphaOffsetScreen),t.setFromRotationMatrix(e),t.alpha<0&&(t.alpha+=360),t.alpha%=360,r-=t.alpha),t.set(r,i.beta,i.gamma),n.setFromEuler(t),n}}(),getScreenAdjustedQuaternion:function(){var t;return function(){return t=this.getFixedFrameQuaternion(),t.rotateZ(-p),t}}(),getFixedFrameMatrix:function(){var t=new _.Euler,e=new _.RotationMatrix;return function(){var n=h.orientation.data||{alpha:0,beta:0,gamma:0},i=n.alpha;return this.alphaOffsetDevice&&(e.setFromEuler(this.alphaOffsetDevice),e.rotateZ(-this.alphaOffsetScreen),t.setFromRotationMatrix(e),t.alpha<0&&(t.alpha+=360),t.alpha%=360,i-=t.alpha),t.set(i,n.beta,n.gamma),e.setFromEuler(t),e}}(),getScreenAdjustedMatrix:function(){var t;return function(){return t=this.getFixedFrameMatrix(),t.rotateZ(-p),t}}(),getFixedFrameEuler:function(){var t,e=new _.Euler;return function(){return t=this.getFixedFrameMatrix(),e.setFromRotationMatrix(t),e}}(),getScreenAdjustedEuler:function(){var t,e=new _.Euler;return function(){return t=this.getScreenAdjustedMatrix(),e.setFromRotationMatrix(t),e}}(),isAbsolute:function(){return!(!h.orientation.data||h.orientation.data.absolute!==!0)},getLastRawEventData:function(){return h.orientation.data||{}},ALPHA:"alpha",BETA:"beta",GAMMA:"gamma"},_.DeviceMotion=function(t){this.options=t||{}},_.DeviceMotion.prototype={constructor:_.DeviceMotion,start:function(e){e&&"[object Function]"==Object.prototype.toString.call(e)&&h.motion.callbacks.push(e),f||(d?t.screen.orientation.addEventListener("change",i,!1):t.addEventListener("orientationchange",i,!1)),h.motion.active||(t.addEventListener("devicemotion",o,!1),h.motion.active=!0)},stop:function(){h.motion.active&&(t.removeEventListener("devicemotion",o,!1),h.motion.active=!1)},listen:function(t){this.start(t)},getScreenAdjustedAcceleration:function(){var t=h.motion.data&&h.motion.data.acceleration?h.motion.data.acceleration:{x:0,y:0,z:0},e={};switch(p){case g:e.x=-t.y,e.y=t.x;break;case v:e.x=-t.x,e.y=-t.y;break;case m:case y:e.x=t.y,e.y=-t.x;break;default:e.x=t.x,e.y=t.y}return e.z=t.z,e},getScreenAdjustedAccelerationIncludingGravity:function(){var t=h.motion.data&&h.motion.data.accelerationIncludingGravity?h.motion.data.accelerationIncludingGravity:{x:0,y:0,z:0},e={};switch(p){case g:e.x=-t.y,e.y=t.x;break;case v:e.x=-t.x,e.y=-t.y;break;case m:case y:e.x=t.y,e.y=-t.x;break;default:e.x=t.x,e.y=t.y}return e.z=t.z,e},getScreenAdjustedRotationRate:function(){var t=h.motion.data&&h.motion.data.rotationRate?h.motion.data.rotationRate:{alpha:0,beta:0,gamma:0},e={};switch(p){case g:e.beta=-t.gamma,e.gamma=t.beta;break;case v:e.beta=-t.beta,e.gamma=-t.gamma;break;case m:case y:e.beta=t.gamma,e.gamma=-t.beta;break;default:e.beta=t.beta,e.gamma=t.gamma}return e.alpha=t.alpha,e},getLastRawEventData:function(){return h.motion.data||{}}},t.FULLTILT=_}}(window)},function(t,e){t.exports=function(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}},function(t,e,n){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=n(2),u=i(s),l={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};r=l,o="function"==typeof r?r.call(e,n,e,t):r,!(void 0!==o&&(t.exports=o)),l.TypedArrayHelper=function(t,e,n,i){"use strict";
this.componentSize=n||1,this.size=e||1,this.TypedArrayConstructor=t||Float32Array,this.array=new t(e*this.componentSize),this.indexOffset=i||0},l.TypedArrayHelper.constructor=l.TypedArrayHelper,l.TypedArrayHelper.prototype.setSize=function(t,e){"use strict";var n=this.array.length;return e||(t*=this.componentSize),t<n?this.shrink(t):t>n?this.grow(t):void console.info("TypedArray is already of size:",t+".","Will not resize.")},l.TypedArrayHelper.prototype.shrink=function(t){"use strict";return this.array=this.array.subarray(0,t),this.size=t,this},l.TypedArrayHelper.prototype.grow=function(t){"use strict";var e=this.array,n=new this.TypedArrayConstructor(t);return n.set(e),this.array=n,this.size=t,this},l.TypedArrayHelper.prototype.splice=function(t,e){"use strict";t*=this.componentSize,e*=this.componentSize;for(var n=[],i=this.array,r=i.length,o=0;o<r;++o)(o<t||o>=e)&&n.push(i[o]);return this.setFromArray(0,n),this},l.TypedArrayHelper.prototype.setFromArray=function(t,e){"use strict";var n=e.length,i=t+n;return i>this.array.length?this.grow(i):i<this.array.length&&this.shrink(i),this.array.set(e,this.indexOffset+t),this},l.TypedArrayHelper.prototype.setVec2=function(t,e){"use strict";return this.setVec2Components(t,e.x,e.y)},l.TypedArrayHelper.prototype.setVec2Components=function(t,e,n){"use strict";var i=this.array,r=this.indexOffset+t*this.componentSize;return i[r]=e,i[r+1]=n,this},l.TypedArrayHelper.prototype.setVec3=function(t,e){"use strict";return this.setVec3Components(t,e.x,e.y,e.z)},l.TypedArrayHelper.prototype.setVec3Components=function(t,e,n,i){"use strict";var r=this.array,o=this.indexOffset+t*this.componentSize;return r[o]=e,r[o+1]=n,r[o+2]=i,this},l.TypedArrayHelper.prototype.setVec4=function(t,e){"use strict";return this.setVec4Components(t,e.x,e.y,e.z,e.w)},l.TypedArrayHelper.prototype.setVec4Components=function(t,e,n,i,r){"use strict";var o=this.array,a=this.indexOffset+t*this.componentSize;return o[a]=e,o[a+1]=n,o[a+2]=i,o[a+3]=r,this},l.TypedArrayHelper.prototype.setMat3=function(t,e){"use strict";return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},l.TypedArrayHelper.prototype.setMat4=function(t,e){"use strict";return this.setFromArray(this.indexOffset+t*this.componentSize,e.elements)},l.TypedArrayHelper.prototype.setColor=function(t,e){"use strict";return this.setVec3Components(t,e.r,e.g,e.b)},l.TypedArrayHelper.prototype.setNumber=function(t,e){"use strict";return this.array[this.indexOffset+t*this.componentSize]=e,this},l.TypedArrayHelper.prototype.getValueAtIndex=function(t){"use strict";return this.array[this.indexOffset+t]},l.TypedArrayHelper.prototype.getComponentValueAtIndex=function(t){"use strict";return this.array.subarray(this.indexOffset+t*this.componentSize)},l.ShaderAttribute=function(t,e,n){"use strict";var i=l.ShaderAttribute.typeSizeMap;this.type="string"==typeof t&&i.hasOwnProperty(t)?t:"f",this.componentSize=i[this.type],this.arrayType=n||Float32Array,this.typedArray=null,this.bufferAttribute=null,this.dynamicBuffer=!!e,this.updateMin=0,this.updateMax=0},l.ShaderAttribute.constructor=l.ShaderAttribute,l.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16},l.ShaderAttribute.prototype.setUpdateRange=function(t,e){"use strict";this.updateMin=Math.min(t*this.componentSize,this.updateMin*this.componentSize),this.updateMax=Math.max(e*this.componentSize,this.updateMax*this.componentSize)},l.ShaderAttribute.prototype.flagUpdate=function(){"use strict";var t=this.bufferAttribute,e=t.updateRange;e.offset=this.updateMin,e.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length),t.needsUpdate=!0},l.ShaderAttribute.prototype.resetUpdateRange=function(){"use strict";this.updateMin=0,this.updateMax=0},l.ShaderAttribute.prototype.resetDynamic=function(){"use strict";this.bufferAttribute.dynamic=this.dynamicBuffer},l.ShaderAttribute.prototype.splice=function(t,e){"use strict";this.typedArray.splice(t,e),this.forceUpdateAll()},l.ShaderAttribute.prototype.forceUpdateAll=function(){"use strict";this.bufferAttribute.array=this.typedArray.array,this.bufferAttribute.updateRange.offset=0,this.bufferAttribute.updateRange.count=-1,this.bufferAttribute.dynamic=!1,this.bufferAttribute.needsUpdate=!0},l.ShaderAttribute.prototype._ensureTypedArray=function(t){"use strict";null!==this.typedArray&&this.typedArray.size===t*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==t?this.typedArray.setSize(t):null===this.typedArray&&(this.typedArray=new l.TypedArrayHelper(this.arrayType,t,this.componentSize)))},l.ShaderAttribute.prototype._createBufferAttribute=function(t){"use strict";return this._ensureTypedArray(t),null!==this.bufferAttribute?(this.bufferAttribute.array=this.typedArray.array,parseFloat(u.REVISION)>=81&&(this.bufferAttribute.count=this.bufferAttribute.array.length/this.bufferAttribute.itemSize),void(this.bufferAttribute.needsUpdate=!0)):(this.bufferAttribute=new u.BufferAttribute(this.typedArray.array,this.componentSize),void(this.bufferAttribute.dynamic=this.dynamicBuffer))},l.ShaderAttribute.prototype.getLength=function(){"use strict";return null===this.typedArray?0:this.typedArray.array.length},l.shaderChunks={defines:["#define PACKED_COLOR_SIZE 256.0","#define PACKED_COLOR_DIVISOR 255.0"].join("\n"),uniforms:["uniform float deltaTime;","uniform float runTime;","uniform sampler2D texture;","uniform vec4 textureAnimation;","uniform float scale;"].join("\n"),attributes:["attribute vec4 acceleration;","attribute vec3 velocity;","attribute vec4 rotation;","attribute vec3 rotationCenter;","attribute vec4 params;","attribute vec4 size;","attribute vec4 angle;","attribute vec4 color;","attribute vec4 opacity;"].join("\n"),varyings:["varying vec4 vColor;","#ifdef SHOULD_ROTATE_TEXTURE","    varying float vAngle;","#endif","#ifdef SHOULD_CALCULATE_SPRITE","    varying vec4 vSpriteSheet;","#endif"].join("\n"),branchAvoidanceFunctions:["float when_gt(float x, float y) {","    return max(sign(x - y), 0.0);","}","float when_lt(float x, float y) {","    return min( max(1.0 - sign(x - y), 0.0), 1.0 );","}","float when_eq( float x, float y ) {","    return 1.0 - abs( sign( x - y ) );","}","float when_ge(float x, float y) {","  return 1.0 - when_lt(x, y);","}","float when_le(float x, float y) {","  return 1.0 - when_gt(x, y);","}","float and(float a, float b) {","    return a * b;","}","float or(float a, float b) {","    return min(a + b, 1.0);","}"].join("\n"),unpackColor:["vec3 unpackColor( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   return c;","}"].join("\n"),unpackRotationAxis:["vec3 unpackRotationAxis( in float hex ) {","   vec3 c = vec3( 0.0 );","   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );","   float b = mod( hex, PACKED_COLOR_SIZE );","   c.r = r / PACKED_COLOR_DIVISOR;","   c.g = g / PACKED_COLOR_DIVISOR;","   c.b = b / PACKED_COLOR_DIVISOR;","   c *= vec3( 2.0 );","   c -= vec3( 1.0 );","   return c;","}"].join("\n"),floatOverLifetime:["float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {","    highp float value = 0.0;","    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );","    float fIndex = 0.0;","    float shouldApplyValue = 0.0;","    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );","","    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {","       fIndex = float( i );","       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );","       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );","    }","","    return value;","}"].join("\n"),colorOverLifetime:["vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {","    vec3 value = vec3( 0.0 );","    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );","    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );","    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );","    return value;","}"].join("\n"),paramFetchingFunctions:["float getAlive() {","   return params.x;","}","float getAge() {","   return params.y;","}","float getMaxAge() {","   return params.z;","}","float getWiggle() {","   return params.w;","}"].join("\n"),forceFetchingFunctions:["vec4 getPosition( in float age ) {","   return modelViewMatrix * vec4( position, 1.0 );","}","vec3 getVelocity( in float age ) {","   return velocity * age;","}","vec3 getAcceleration( in float age ) {","   return acceleration.xyz * age;","}"].join("\n"),rotationFunctions:["#ifdef SHOULD_ROTATE_PARTICLES","   mat4 getRotationMatrix( in vec3 axis, in float angle) {","       axis = normalize(axis);","       float s = sin(angle);","       float c = cos(angle);","       float oc = 1.0 - c;","","       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,","                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,","                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,","                   0.0,                                0.0,                                0.0,                                1.0);","   }","","   vec3 getRotation( in vec3 pos, in float positionInTime ) {","      if( rotation.y == 0.0 ) {","           return pos;","      }","","      vec3 axis = unpackRotationAxis( rotation.x );","      vec3 center = rotationCenter;","      vec3 translated;","      mat4 rotationMatrix;","      float angle = 0.0;","      angle += when_eq( rotation.z, 0.0 ) * rotation.y;","      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );","      translated = rotationCenter - pos;","      rotationMatrix = getRotationMatrix( axis, angle );","      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );","   }","#endif"].join("\n"),rotateTexture:["    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );","","    #ifdef SHOULD_ROTATE_TEXTURE","       float x = gl_PointCoord.x - 0.5;","       float y = 1.0 - gl_PointCoord.y - 0.5;","       float c = cos( -vAngle );","       float s = sin( -vAngle );","       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","    #endif","","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = vSpriteSheet.x;","        float framesY = vSpriteSheet.y;","        float columnNorm = vSpriteSheet.z;","        float rowNorm = vSpriteSheet.w;","        vUv.x = gl_PointCoord.x * framesX + columnNorm;","        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);","    #endif","","    vec4 rotatedTexture = texture2D( texture, vUv );"].join("\n")},l.shaders={vertex:[l.shaderChunks.defines,l.shaderChunks.uniforms,l.shaderChunks.attributes,l.shaderChunks.varyings,u.ShaderChunk.common,u.ShaderChunk.logdepthbuf_pars_vertex,u.ShaderChunk.fog_pars_vertex,l.shaderChunks.branchAvoidanceFunctions,l.shaderChunks.unpackColor,l.shaderChunks.unpackRotationAxis,l.shaderChunks.floatOverLifetime,l.shaderChunks.colorOverLifetime,l.shaderChunks.paramFetchingFunctions,l.shaderChunks.forceFetchingFunctions,l.shaderChunks.rotationFunctions,"void main() {","    highp float age = getAge();","    highp float alive = getAlive();","    highp float maxAge = getMaxAge();","    highp float positionInTime = (age / maxAge);","    highp float isAlive = when_gt( alive, 0.0 );","    #ifdef SHOULD_WIGGLE_PARTICLES","        float wiggleAmount = positionInTime * getWiggle();","        float wiggleSin = isAlive * sin( wiggleAmount );","        float wiggleCos = isAlive * cos( wiggleAmount );","    #endif","    vec3 vel = getVelocity( age );","    vec3 accel = getAcceleration( age );","    vec3 force = vec3( 0.0 );","    vec3 pos = vec3( position );","    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;","    force += vel;","    force *= drag;","    force += accel * age;","    pos += force;","    #ifdef SHOULD_WIGGLE_PARTICLES","        pos.x += wiggleSin;","        pos.y += wiggleCos;","        pos.z += wiggleSin;","    #endif","    #ifdef SHOULD_ROTATE_PARTICLES","        pos = getRotation( pos, positionInTime );","    #endif","    vec4 mvPosition = modelViewMatrix * vec4( pos, 1.0 );","    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;","    #ifdef HAS_PERSPECTIVE","        float perspective = scale / length( mvPosition.xyz );","    #else","        float perspective = 1.0;","    #endif","    float pointSizePerspective = pointSize * perspective;","    #ifdef COLORIZE","       vec3 c = isAlive * getColorOverLifetime(","           positionInTime,","           unpackColor( color.x ),","           unpackColor( color.y ),","           unpackColor( color.z ),","           unpackColor( color.w )","       );","    #else","       vec3 c = vec3(1.0);","    #endif","    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );","    vColor = vec4( c, o );","    #ifdef SHOULD_ROTATE_TEXTURE","        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );","    #endif","    #ifdef SHOULD_CALCULATE_SPRITE","        float framesX = textureAnimation.x;","        float framesY = textureAnimation.y;","        float loopCount = textureAnimation.w;","        float totalFrames = textureAnimation.z;","        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );","        float column = floor(mod( frameNumber, framesX ));","        float row = floor( (frameNumber - column) / framesX );","        float columnNorm = column / framesX;","        float rowNorm = row / framesY;","        vSpriteSheet.x = 1.0 / framesX;","        vSpriteSheet.y = 1.0 / framesY;","        vSpriteSheet.z = columnNorm;","        vSpriteSheet.w = rowNorm;","    #endif","    gl_PointSize = pointSizePerspective;","    gl_Position = projectionMatrix * mvPosition;",u.ShaderChunk.logdepthbuf_vertex,u.ShaderChunk.fog_vertex,"}"].join("\n"),fragment:[l.shaderChunks.uniforms,u.ShaderChunk.common,u.ShaderChunk.fog_pars_fragment,u.ShaderChunk.logdepthbuf_pars_fragment,l.shaderChunks.varyings,l.shaderChunks.branchAvoidanceFunctions,"void main() {","    vec3 outgoingLight = vColor.xyz;","    ","    #ifdef ALPHATEST","       if ( vColor.w < float(ALPHATEST) ) discard;","    #endif",l.shaderChunks.rotateTexture,u.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;","    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );",u.ShaderChunk.fog_fragment,"}"].join("\n")},l.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(t,e,n){"use strict";return("undefined"==typeof t?"undefined":a(t))===e?t:n},ensureArrayTypedArg:function(t,e,n){"use strict";if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(a(t[i])!==e)return n;return t}return this.ensureTypedArg(t,e,n)},ensureInstanceOf:function(t,e,n){"use strict";return void 0!==e&&t instanceof e?t:n},ensureArrayInstanceOf:function(t,e,n){"use strict";if(Array.isArray(t)){for(var i=t.length-1;i>=0;--i)if(void 0!==e&&t[i]instanceof e==!1)return n;return t}return this.ensureInstanceOf(t,e,n)},ensureValueOverLifetimeCompliance:function(t,e,n){"use strict";e=e||3,n=n||3,Array.isArray(t._value)===!1&&(t._value=[t._value]),Array.isArray(t._spread)===!1&&(t._spread=[t._spread]);var i=this.clamp(t._value.length,e,n),r=this.clamp(t._spread.length,e,n),o=Math.max(i,r);t._value.length!==o&&(t._value=this.interpolateArray(t._value,o)),t._spread.length!==o&&(t._spread=this.interpolateArray(t._spread,o))},interpolateArray:function(t,e){"use strict";for(var n=t.length,i=["function"==typeof t[0].clone?t[0].clone():t[0]],r=(n-1)/(e-1),o=1;o<e-1;++o){var a=o*r,s=Math.floor(a),u=Math.ceil(a),l=a-s;i[o]=this.lerpTypeAgnostic(t[s],t[u],l)}return i.push("function"==typeof t[n-1].clone?t[n-1].clone():t[n-1]),i},clamp:function(t,e,n){"use strict";return Math.max(e,Math.min(t,n))},zeroToEpsilon:function(t,e){"use strict";var n=1e-5,i=t;return i=e?Math.random()*n*10:n,t<0&&t>-n&&(i=-i),i},lerpTypeAgnostic:function(t,e,n){"use strict";var i,r=this.types;return("undefined"==typeof t?"undefined":a(t))===r.NUMBER&&("undefined"==typeof e?"undefined":a(e))===r.NUMBER?t+(e-t)*n:t instanceof u.Vector2&&e instanceof u.Vector2?(i=t.clone(),i.x=this.lerp(t.x,e.x,n),i.y=this.lerp(t.y,e.y,n),i):t instanceof u.Vector3&&e instanceof u.Vector3?(i=t.clone(),i.x=this.lerp(t.x,e.x,n),i.y=this.lerp(t.y,e.y,n),i.z=this.lerp(t.z,e.z,n),i):t instanceof u.Vector4&&e instanceof u.Vector4?(i=t.clone(),i.x=this.lerp(t.x,e.x,n),i.y=this.lerp(t.y,e.y,n),i.z=this.lerp(t.z,e.z,n),i.w=this.lerp(t.w,e.w,n),i):t instanceof u.Color&&e instanceof u.Color?(i=t.clone(),i.r=this.lerp(t.r,e.r,n),i.g=this.lerp(t.g,e.g,n),i.b=this.lerp(t.b,e.b,n),i):void console.warn("Invalid argument types, or argument types do not match:",t,e)},lerp:function(t,e,n){"use strict";return t+(e-t)*n},roundToNearestMultiple:function(t,e){"use strict";var n=0;return 0===e?t:(n=Math.abs(t)%e,0===n?t:t<0?-(Math.abs(t)-n):t+e-n)},arrayValuesAreEqual:function(t){"use strict";for(var e=0;e<t.length-1;++e)if(t[e]!==t[e+1])return!1;return!0},randomFloat:function(t,e){"use strict";return t+e*(Math.random()-.5)},randomVector3:function(t,e,n,i,r){"use strict";var o=n.x+(Math.random()*i.x-.5*i.x),a=n.y+(Math.random()*i.y-.5*i.y),s=n.z+(Math.random()*i.z-.5*i.z);r&&(o=.5*-r.x+this.roundToNearestMultiple(o,r.x),a=.5*-r.y+this.roundToNearestMultiple(a,r.y),s=.5*-r.z+this.roundToNearestMultiple(s,r.z)),t.typedArray.setVec3Components(e,o,a,s)},randomColor:function(t,e,n,i){"use strict";var r=n.r+Math.random()*i.x,o=n.g+Math.random()*i.y,a=n.b+Math.random()*i.z;r=this.clamp(r,0,1),o=this.clamp(o,0,1),a=this.clamp(a,0,1),t.typedArray.setVec3Components(e,r,o,a)},randomColorAsHex:function(){"use strict";var t=new u.Color;return function(e,n,i,r){for(var o=i.length,a=[],s=0;s<o;++s){var u=r[s];t.copy(i[s]),t.r+=Math.random()*u.x-.5*u.x,t.g+=Math.random()*u.y-.5*u.y,t.b+=Math.random()*u.z-.5*u.z,t.r=this.clamp(t.r,0,1),t.g=this.clamp(t.g,0,1),t.b=this.clamp(t.b,0,1),a.push(t.getHex())}e.typedArray.setVec4Components(n,a[0],a[1],a[2],a[3])}}(),randomVector3OnSphere:function(t,e,n,i,r,o,a,s){"use strict";var u=2*Math.random()-1,l=6.2832*Math.random(),c=Math.sqrt(1-u*u),h=this.randomFloat(i,r),f=0,d=0,p=0;a&&(h=Math.round(h/a)*a),f=c*Math.cos(l)*h,d=c*Math.sin(l)*h,p=u*h,f*=o.x,d*=o.y,p*=o.z,f+=n.x,d+=n.y,p+=n.z,t.typedArray.setVec3Components(e,f,d,p)},seededRandom:function(t){var e=1e4*Math.sin(t);return e-(0|e)},randomVector3OnDisc:function(t,e,n,i,r,o,a){"use strict";var s=6.2832*Math.random(),u=Math.abs(this.randomFloat(i,r)),l=0,c=0,h=0;a&&(u=Math.round(u/a)*a),l=Math.cos(s)*u,c=Math.sin(s)*u,l*=o.x,c*=o.y,l+=n.x,c+=n.y,h+=n.z,t.typedArray.setVec3Components(e,l,c,h)},randomDirectionVector3OnSphere:function(){"use strict";var t=new u.Vector3;return function(e,n,i,r,o,a,s,u){t.copy(a),t.x-=i,t.y-=r,t.z-=o,t.normalize().multiplyScalar(-this.randomFloat(s,u)),e.typedArray.setVec3Components(n,t.x,t.y,t.z)}}(),randomDirectionVector3OnDisc:function(){"use strict";var t=new u.Vector3;return function(e,n,i,r,o,a,s,u){t.copy(a),t.x-=i,t.y-=r,t.z-=o,t.normalize().multiplyScalar(-this.randomFloat(s,u)),e.typedArray.setVec3Components(n,t.x,t.y,0)}}(),getPackedRotationAxis:function(){"use strict";var t=new u.Vector3,e=new u.Vector3,n=new u.Color,i=new u.Vector3(1,1,1);return function(r,o){return t.copy(r).normalize(),e.copy(o).normalize(),t.x+=.5*-o.x+Math.random()*o.x,t.y+=.5*-o.y+Math.random()*o.y,t.z+=.5*-o.z+Math.random()*o.z,t.normalize().add(i).multiplyScalar(.5),n.setRGB(t.x,t.y,t.z),n.getHex()}}()},l.Group=function(t){"use strict";var e=l.utils,n=e.types;t=e.ensureTypedArg(t,n.OBJECT,{}),t.texture=e.ensureTypedArg(t.texture,n.OBJECT,{}),this.uuid=u.Math.generateUUID(),this.fixedTimeStep=e.ensureTypedArg(t.fixedTimeStep,n.NUMBER,.016),this.texture=e.ensureInstanceOf(t.texture.value,u.Texture,null),this.textureFrames=e.ensureInstanceOf(t.texture.frames,u.Vector2,new u.Vector2(1,1)),this.textureFrameCount=e.ensureTypedArg(t.texture.frameCount,n.NUMBER,this.textureFrames.x*this.textureFrames.y),this.textureLoop=e.ensureTypedArg(t.texture.loop,n.NUMBER,1),this.textureFrames.max(new u.Vector2(1,1)),this.hasPerspective=e.ensureTypedArg(t.hasPerspective,n.BOOLEAN,!0),this.colorize=e.ensureTypedArg(t.colorize,n.BOOLEAN,!0),this.maxParticleCount=e.ensureTypedArg(t.maxParticleCount,n.NUMBER,null),this.blending=e.ensureTypedArg(t.blending,n.NUMBER,u.AdditiveBlending),this.transparent=e.ensureTypedArg(t.transparent,n.BOOLEAN,!0),this.alphaTest=parseFloat(e.ensureTypedArg(t.alphaTest,n.NUMBER,0)),this.depthWrite=e.ensureTypedArg(t.depthWrite,n.BOOLEAN,!1),this.depthTest=e.ensureTypedArg(t.depthTest,n.BOOLEAN,!0),this.fog=e.ensureTypedArg(t.fog,n.BOOLEAN,!0),this.scale=e.ensureTypedArg(t.scale,n.NUMBER,300),this.emitters=[],this.emitterIDs=[],this._pool=[],this._poolCreationSettings=null,this._createNewWhenPoolEmpty=0,this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!1,this.particleCount=0,this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new u.Vector4(this.textureFrames.x,this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}},this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:l.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,SHOULD_CALCULATE_SPRITE:this.textureFrames.x>1||this.textureFrames.y>1},this.attributes={position:new l.ShaderAttribute("v3",!0),acceleration:new l.ShaderAttribute("v4",!0),velocity:new l.ShaderAttribute("v3",!0),rotation:new l.ShaderAttribute("v4",!0),rotationCenter:new l.ShaderAttribute("v3",!0),params:new l.ShaderAttribute("v4",!0),size:new l.ShaderAttribute("v4",!0),angle:new l.ShaderAttribute("v4",!0),color:new l.ShaderAttribute("v4",!0),opacity:new l.ShaderAttribute("v4",!0)},this.attributeKeys=Object.keys(this.attributes),this.attributeCount=this.attributeKeys.length,this.material=new u.ShaderMaterial({uniforms:this.uniforms,vertexShader:l.shaders.vertex,fragmentShader:l.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog}),this.geometry=new u.BufferGeometry,this.mesh=new u.Points(this.geometry,this.material),null===this.maxParticleCount&&console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")},l.Group.constructor=l.Group,l.Group.prototype._updateDefines=function(){"use strict";var t,e=this.emitters,n=e.length-1,i=this.defines;for(n;n>=0;--n)t=e[n],i.SHOULD_CALCULATE_SPRITE||(i.SHOULD_ROTATE_TEXTURE=i.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,t.angle.value),Math.max.apply(null,t.angle.spread))),i.SHOULD_ROTATE_PARTICLES=i.SHOULD_ROTATE_PARTICLES||!!Math.max(t.rotation.angle,t.rotation.angleSpread),i.SHOULD_WIGGLE_PARTICLES=i.SHOULD_WIGGLE_PARTICLES||!!Math.max(t.wiggle.value,t.wiggle.spread);this.material.needsUpdate=!0},l.Group.prototype._applyAttributesToGeometry=function(){"use strict";var t,e,n=this.attributes,i=this.geometry,r=i.attributes;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],e=r[o],e?e.array=t.typedArray.array:i.addAttribute(o,t.bufferAttribute),t.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)},l.Group.prototype.addEmitter=function(t){"use strict";if(t instanceof l.Emitter==!1)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",t);if(this.emitterIDs.indexOf(t.uuid)>-1)return void console.error("Emitter already exists in this group. Will not add again.");if(null!==t.group)return void console.error("Emitter already belongs to another group. Will not add to requested group.");var e=this.attributes,n=this.particleCount,i=n+t.particleCount;this.particleCount=i,null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount),t._calculatePPSValue(t.maxAge._value+t.maxAge._spread),t._setBufferUpdateRanges(this.attributeKeys),t._setAttributeOffset(n),t.group=this,t.attributes=this.attributes;for(var r in e)e.hasOwnProperty(r)&&e[r]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);for(var o=n;o<i;++o)t._assignPositionValue(o),t._assignForceValue(o,"velocity"),t._assignForceValue(o,"acceleration"),t._assignAbsLifetimeValue(o,"opacity"),t._assignAbsLifetimeValue(o,"size"),t._assignAngleValue(o),t._assignRotationValue(o),t._assignParamsValue(o),t._assignColorValue(o);return this._applyAttributesToGeometry(),this.emitters.push(t),this.emitterIDs.push(t.uuid),this._updateDefines(t),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this},l.Group.prototype.removeEmitter=function(t){"use strict";var e=this.emitterIDs.indexOf(t.uuid);if(t instanceof l.Emitter==!1)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",t);if(e===-1)return void console.error("Emitter does not exist in this group. Will not remove.");for(var n=t.attributeOffset,i=n+t.particleCount,r=this.attributes.params.typedArray,o=n;o<i;++o)r.array[4*o]=0,r.array[4*o+1]=0;this.emitters.splice(e,1),this.emitterIDs.splice(e,1);for(var a in this.attributes)this.attributes.hasOwnProperty(a)&&this.attributes[a].splice(n,i);this.particleCount-=t.particleCount,t._onRemove(),this._attributesNeedRefresh=!0},l.Group.prototype.getFromPool=function(){"use strict";var t=this._pool,e=this._createNewWhenPoolEmpty;if(t.length)return t.pop();if(e){var n=new l.Emitter(this._poolCreationSettings);return this.addEmitter(n),n}return null},l.Group.prototype.releaseIntoPool=function(t){"use strict";return t instanceof l.Emitter==!1?void console.error("Argument is not instanceof SPE.Emitter:",t):(t.reset(),this._pool.unshift(t),this)},l.Group.prototype.getPool=function(){"use strict";return this._pool},l.Group.prototype.addPool=function(t,e,n){"use strict";var i;this._poolCreationSettings=e,this._createNewWhenPoolEmpty=!!n;for(var r=0;r<t;++r)i=Array.isArray(e)?new l.Emitter(e[r]):new l.Emitter(e),this.addEmitter(i),this.releaseIntoPool(i);return this},l.Group.prototype._triggerSingleEmitter=function(t){"use strict";var e=this.getFromPool(),n=this;return null===e?void console.log("SPE.Group pool ran out."):(t instanceof u.Vector3&&(e.position.value.copy(t),e.position.value=e.position.value),e.enable(),setTimeout(function(){e.disable(),n.releaseIntoPool(e)},1e3*Math.max(e.duration,e.maxAge.value+e.maxAge.spread)),this)},l.Group.prototype.triggerPoolEmitter=function(t,e){"use strict";if("number"==typeof t&&t>1)for(var n=0;n<t;++n)this._triggerSingleEmitter(e);else this._triggerSingleEmitter(e);return this},l.Group.prototype._updateUniforms=function(t){"use strict";this.uniforms.runTime.value+=t,this.uniforms.deltaTime.value=t},l.Group.prototype._resetBufferRanges=function(){"use strict";var t=this.attributeKeys,e=this.attributeCount-1,n=this.attributes;for(e;e>=0;--e)n[t[e]].resetUpdateRange()},l.Group.prototype._updateBuffers=function(t){"use strict";var e,n,i,r=this.attributeKeys,o=this.attributeCount-1,a=this.attributes,s=t.bufferUpdateRanges;for(o;o>=0;--o)e=r[o],n=s[e],i=a[e],i.setUpdateRange(n.min,n.max),i.flagUpdate()},l.Group.prototype.tick=function(t){"use strict";var e,n=this.emitters,i=n.length,r=t||this.fixedTimeStep,o=this.attributeKeys,a=this.attributes;if(this._updateUniforms(r),this._resetBufferRanges(),0!==i||this._attributesNeedRefresh!==!1||this._attributesNeedDynamicReset!==!1){for(var s,e=0;e<i;++e)s=n[e],s.tick(r),this._updateBuffers(s);if(this._attributesNeedDynamicReset===!0){for(e=this.attributeCount-1;e>=0;--e)a[o[e]].resetDynamic();this._attributesNeedDynamicReset=!1}if(this._attributesNeedRefresh===!0){for(e=this.attributeCount-1;e>=0;--e)a[o[e]].forceUpdateAll();this._attributesNeedRefresh=!1,this._attributesNeedDynamicReset=!0}}},l.Group.prototype.dispose=function(){"use strict";return this.geometry.dispose(),this.material.dispose(),this},l.Emitter=function(t){"use strict";var e=l.utils,n=e.types,i=l.valueOverLifetimeLength;t=e.ensureTypedArg(t,n.OBJECT,{}),t.position=e.ensureTypedArg(t.position,n.OBJECT,{}),t.velocity=e.ensureTypedArg(t.velocity,n.OBJECT,{}),t.acceleration=e.ensureTypedArg(t.acceleration,n.OBJECT,{}),t.radius=e.ensureTypedArg(t.radius,n.OBJECT,{}),t.drag=e.ensureTypedArg(t.drag,n.OBJECT,{}),t.rotation=e.ensureTypedArg(t.rotation,n.OBJECT,{}),t.color=e.ensureTypedArg(t.color,n.OBJECT,{}),t.opacity=e.ensureTypedArg(t.opacity,n.OBJECT,{}),t.size=e.ensureTypedArg(t.size,n.OBJECT,{}),t.angle=e.ensureTypedArg(t.angle,n.OBJECT,{}),t.wiggle=e.ensureTypedArg(t.wiggle,n.OBJECT,{}),t.maxAge=e.ensureTypedArg(t.maxAge,n.OBJECT,{}),t.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime."),this.uuid=u.Math.generateUUID(),this.type=e.ensureTypedArg(t.type,n.NUMBER,l.distributions.BOX),this.position={_value:e.ensureInstanceOf(t.position.value,u.Vector3,new u.Vector3),_spread:e.ensureInstanceOf(t.position.spread,u.Vector3,new u.Vector3),_spreadClamp:e.ensureInstanceOf(t.position.spreadClamp,u.Vector3,new u.Vector3),_distribution:e.ensureTypedArg(t.position.distribution,n.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1),_radius:e.ensureTypedArg(t.position.radius,n.NUMBER,10),_radiusScale:e.ensureInstanceOf(t.position.radiusScale,u.Vector3,new u.Vector3(1,1,1)),_distributionClamp:e.ensureTypedArg(t.position.distributionClamp,n.NUMBER,0)},this.velocity={_value:e.ensureInstanceOf(t.velocity.value,u.Vector3,new u.Vector3),_spread:e.ensureInstanceOf(t.velocity.spread,u.Vector3,new u.Vector3),_distribution:e.ensureTypedArg(t.velocity.distribution,n.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.acceleration={_value:e.ensureInstanceOf(t.acceleration.value,u.Vector3,new u.Vector3),_spread:e.ensureInstanceOf(t.acceleration.spread,u.Vector3,new u.Vector3),_distribution:e.ensureTypedArg(t.acceleration.distribution,n.NUMBER,this.type),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.drag={_value:e.ensureTypedArg(t.drag.value,n.NUMBER,0),_spread:e.ensureTypedArg(t.drag.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.wiggle={_value:e.ensureTypedArg(t.wiggle.value,n.NUMBER,0),_spread:e.ensureTypedArg(t.wiggle.spread,n.NUMBER,0)},this.rotation={_axis:e.ensureInstanceOf(t.rotation.axis,u.Vector3,new u.Vector3(0,1,0)),_axisSpread:e.ensureInstanceOf(t.rotation.axisSpread,u.Vector3,new u.Vector3),_angle:e.ensureTypedArg(t.rotation.angle,n.NUMBER,0),_angleSpread:e.ensureTypedArg(t.rotation.angleSpread,n.NUMBER,0),_static:e.ensureTypedArg(t.rotation.static,n.BOOLEAN,!1),_center:e.ensureInstanceOf(t.rotation.center,u.Vector3,this.position._value.clone()),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.maxAge={_value:e.ensureTypedArg(t.maxAge.value,n.NUMBER,2),
_spread:e.ensureTypedArg(t.maxAge.spread,n.NUMBER,0)},this.color={_value:e.ensureArrayInstanceOf(t.color.value,u.Color,new u.Color),_spread:e.ensureArrayInstanceOf(t.color.spread,u.Vector3,new u.Vector3),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.opacity={_value:e.ensureArrayTypedArg(t.opacity.value,n.NUMBER,1),_spread:e.ensureArrayTypedArg(t.opacity.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.size={_value:e.ensureArrayTypedArg(t.size.value,n.NUMBER,1),_spread:e.ensureArrayTypedArg(t.size.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.angle={_value:e.ensureArrayTypedArg(t.angle.value,n.NUMBER,0),_spread:e.ensureArrayTypedArg(t.angle.spread,n.NUMBER,0),_randomise:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)},this.particleCount=e.ensureTypedArg(t.particleCount,n.NUMBER,100),this.duration=e.ensureTypedArg(t.duration,n.NUMBER,null),this.isStatic=e.ensureTypedArg(t.isStatic,n.BOOLEAN,!1),this.activeMultiplier=e.ensureTypedArg(t.activeMultiplier,n.NUMBER,1),this.direction=e.ensureTypedArg(t.direction,n.NUMBER,1),this.alive=e.ensureTypedArg(t.alive,n.BOOLEAN,!0),this.particlesPerSecond=0,this.activationIndex=0,this.attributeOffset=0,this.attributeEnd=0,this.age=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.resetFlags={position:e.ensureTypedArg(t.position.randomise,n.BOOLEAN,!1)||e.ensureTypedArg(t.radius.randomise,n.BOOLEAN,!1),velocity:e.ensureTypedArg(t.velocity.randomise,n.BOOLEAN,!1),acceleration:e.ensureTypedArg(t.acceleration.randomise,n.BOOLEAN,!1)||e.ensureTypedArg(t.drag.randomise,n.BOOLEAN,!1),rotation:e.ensureTypedArg(t.rotation.randomise,n.BOOLEAN,!1),rotationCenter:e.ensureTypedArg(t.rotation.randomise,n.BOOLEAN,!1),size:e.ensureTypedArg(t.size.randomise,n.BOOLEAN,!1),color:e.ensureTypedArg(t.color.randomise,n.BOOLEAN,!1),opacity:e.ensureTypedArg(t.opacity.randomise,n.BOOLEAN,!1),angle:e.ensureTypedArg(t.angle.randomise,n.BOOLEAN,!1)},this.updateFlags={},this.updateCounts={},this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var r in this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));this.bufferUpdateRanges={},this.attributeKeys=null,this.attributeCount=0,e.ensureValueOverLifetimeCompliance(this.color,i,i),e.ensureValueOverLifetimeCompliance(this.opacity,i,i),e.ensureValueOverLifetimeCompliance(this.size,i,i),e.ensureValueOverLifetimeCompliance(this.angle,i,i)},l.Emitter.constructor=l.Emitter,l.Emitter.prototype._createGetterSetters=function(t,e){"use strict";var n=this;for(var i in t)if(t.hasOwnProperty(i)){var r=i.replace("_","");Object.defineProperty(t,r,{get:function(t){return function(){return this[t]}}(i),set:function(t){return function(i){var r=n.updateMap[e],o=this[t],a=l.valueOverLifetimeLength;"_rotationCenter"===t?(n.updateFlags.rotationCenter=!0,n.updateCounts.rotationCenter=0):"_randomise"===t?n.resetFlags[r]=i:(n.updateFlags[r]=!0,n.updateCounts[r]=0),n.group._updateDefines(),this[t]=i,Array.isArray(o)&&l.utils.ensureValueOverLifetimeCompliance(n[e],a,a)}}(i)})}},l.Emitter.prototype._setBufferUpdateRanges=function(t){"use strict";this.attributeKeys=t,this.attributeCount=t.length;for(var e=this.attributeCount-1;e>=0;--e)this.bufferUpdateRanges[t[e]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}},l.Emitter.prototype._calculatePPSValue=function(t){"use strict";var e=this.particleCount;this.duration?this.particlesPerSecond=e/(t<this.duration?t:this.duration):this.particlesPerSecond=e/t},l.Emitter.prototype._setAttributeOffset=function(t){this.attributeOffset=t,this.activationIndex=t,this.activationEnd=t+this.particleCount},l.Emitter.prototype._assignValue=function(t,e){"use strict";switch(t){case"position":this._assignPositionValue(e);break;case"velocity":case"acceleration":this._assignForceValue(e,t);break;case"size":case"opacity":this._assignAbsLifetimeValue(e,t);break;case"angle":this._assignAngleValue(e);break;case"params":this._assignParamsValue(e);break;case"rotation":this._assignRotationValue(e);break;case"color":this._assignColorValue(e)}},l.Emitter.prototype._assignPositionValue=function(t){"use strict";var e=l.distributions,n=l.utils,i=this.position,r=this.attributes.position,o=i._value,a=i._spread,s=i._distribution;switch(s){case e.BOX:n.randomVector3(r,t,o,a,i._spreadClamp);break;case e.SPHERE:n.randomVector3OnSphere(r,t,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x,i._distributionClamp||this.particleCount);break;case e.DISC:n.randomVector3OnDisc(r,t,o,i._radius,i._spread.x,i._radiusScale,i._spreadClamp.x)}},l.Emitter.prototype._assignForceValue=function(t,e){"use strict";var n,i,r,o,a,s=l.distributions,u=l.utils,c=this[e],h=c._value,f=c._spread,d=c._distribution;switch(d){case s.BOX:u.randomVector3(this.attributes[e],t,h,f);break;case s.SPHERE:n=this.attributes.position.typedArray.array,a=3*t,i=n[a],r=n[a+1],o=n[a+2],u.randomDirectionVector3OnSphere(this.attributes[e],t,i,r,o,this.position._value,c._value.x,c._spread.x);break;case s.DISC:n=this.attributes.position.typedArray.array,a=3*t,i=n[a],r=n[a+1],o=n[a+2],u.randomDirectionVector3OnDisc(this.attributes[e],t,i,r,o,this.position._value,c._value.x,c._spread.x)}if("acceleration"===e){var p=u.clamp(u.randomFloat(this.drag._value,this.drag._spread),0,1);this.attributes.acceleration.typedArray.array[4*t+3]=p}},l.Emitter.prototype._assignAbsLifetimeValue=function(t,e){"use strict";var n,i=this.attributes[e].typedArray,r=this[e],o=l.utils;o.arrayValuesAreEqual(r._value)&&o.arrayValuesAreEqual(r._spread)?(n=Math.abs(o.randomFloat(r._value[0],r._spread[0])),i.setVec4Components(t,n,n,n,n)):i.setVec4Components(t,Math.abs(o.randomFloat(r._value[0],r._spread[0])),Math.abs(o.randomFloat(r._value[1],r._spread[1])),Math.abs(o.randomFloat(r._value[2],r._spread[2])),Math.abs(o.randomFloat(r._value[3],r._spread[3])))},l.Emitter.prototype._assignAngleValue=function(t){"use strict";var e,n=this.attributes.angle.typedArray,i=this.angle,r=l.utils;r.arrayValuesAreEqual(i._value)&&r.arrayValuesAreEqual(i._spread)?(e=r.randomFloat(i._value[0],i._spread[0]),n.setVec4Components(t,e,e,e,e)):n.setVec4Components(t,r.randomFloat(i._value[0],i._spread[0]),r.randomFloat(i._value[1],i._spread[1]),r.randomFloat(i._value[2],i._spread[2]),r.randomFloat(i._value[3],i._spread[3]))},l.Emitter.prototype._assignParamsValue=function(t){"use strict";this.attributes.params.typedArray.setVec4Components(t,this.isStatic?1:0,0,Math.abs(l.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),l.utils.randomFloat(this.wiggle._value,this.wiggle._spread))},l.Emitter.prototype._assignRotationValue=function(t){"use strict";this.attributes.rotation.typedArray.setVec3Components(t,l.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),l.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1),this.attributes.rotationCenter.typedArray.setVec3(t,this.rotation._center)},l.Emitter.prototype._assignColorValue=function(t){"use strict";l.utils.randomColorAsHex(this.attributes.color,t,this.color._value,this.color._spread)},l.Emitter.prototype._resetParticle=function(t){"use strict";for(var e,n,i=this.resetFlags,r=this.updateFlags,o=this.updateCounts,a=this.attributeKeys,s=this.attributeCount-1;s>=0;--s)e=a[s],n=r[e],i[e]!==!0&&n!==!0||(this._assignValue(e,t),this._updateAttributeUpdateRange(e,t),n===!0&&o[e]===this.particleCount?(r[e]=!1,o[e]=0):1==n&&++o[e])},l.Emitter.prototype._updateAttributeUpdateRange=function(t,e){"use strict";var n=this.bufferUpdateRanges[t];n.min=Math.min(e,n.min),n.max=Math.max(e,n.max)},l.Emitter.prototype._resetBufferRanges=function(){"use strict";var t,e=this.bufferUpdateRanges,n=this.bufferUpdateKeys,i=this.bufferUpdateCount-1;for(i;i>=0;--i)t=n[i],e[t].min=Number.POSITIVE_INFINITY,e[t].max=Number.NEGATIVE_INFINITY},l.Emitter.prototype._onRemove=function(){"use strict";this.particlesPerSecond=0,this.attributeOffset=0,this.activationIndex=0,this.activeParticleCount=0,this.group=null,this.attributes=null,this.paramsArray=null,this.age=0},l.Emitter.prototype._decrementParticleCount=function(){"use strict";--this.activeParticleCount},l.Emitter.prototype._incrementParticleCount=function(){"use strict";++this.activeParticleCount},l.Emitter.prototype._checkParticleAges=function(t,e,n,i){"use strict";for(var r,o,a,s,u=e-1;u>=t;--u)r=4*u,s=n[r],0!==s&&(a=n[r+1],o=n[r+2],1===this.direction?(a+=i,a>=o&&(a=0,s=0,this._decrementParticleCount())):(a-=i,a<=0&&(a=o,s=0,this._decrementParticleCount())),n[r]=s,n[r+1]=a,this._updateAttributeUpdateRange("params",u))},l.Emitter.prototype._activateParticles=function(t,e,n,i){"use strict";for(var r,o,a=this.direction,s=t;s<e;++s)r=4*s,0!=n[r]&&1!==this.particleCount||(this._incrementParticleCount(),n[r]=1,this._resetParticle(s),o=i*(s-t),n[r+1]=a===-1?n[r+2]-o:o,this._updateAttributeUpdateRange("params",s))},l.Emitter.prototype.tick=function(t){"use strict";if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var e=this.attributeOffset,n=e+this.particleCount,i=this.paramsArray,r=this.particlesPerSecond*this.activeMultiplier*t,o=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(e,n,i,t),this.alive===!1)return void(this.age=0);if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);var a=1===this.particleCount?o:0|o,s=Math.min(a+r,this.activationEnd),u=s-this.activationIndex|0,l=u>0?t/u:0;this._activateParticles(a,s,i,l),this.activationIndex+=r,this.activationIndex>n&&(this.activationIndex=e),this.age+=t}},l.Emitter.prototype.reset=function(t){"use strict";if(this.age=0,this.alive=!1,t===!0){for(var e,n=this.attributeOffset,i=n+this.particleCount,r=this.paramsArray,o=this.attributes.params.bufferAttribute,a=i-1;a>=n;--a)e=4*a,r[e]=0,r[e+1]=0;o.updateRange.offset=0,o.updateRange.count=-1,o.needsUpdate=!0}return this},l.Emitter.prototype.enable=function(){"use strict";return this.alive=!0,this},l.Emitter.prototype.disable=function(){"use strict";return this.alive=!1,this},l.Emitter.prototype.remove=function(){"use strict";return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){var e=new c.default,n=t.getAllResponseHeaders().trim().split("\n");return n.forEach(function(t){var n=t.trim().split(":"),i=n.shift().trim(),r=n.join(":").trim();i&&0!==i.length&&e.append(i,r)}),e}Object.defineProperty(e,"__esModule",{value:!0});var o=n(40),a=i(o),s=n(41),u=i(s),l=n(20),c=i(l),h="undefined"==typeof Promise?n(14).Promise:Promise,f=function(t,e){var n=new XMLHttpRequest;return new h(function(i,o){function s(){return"responseURL"in n?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var l=void 0;l=a.default.prototype.isPrototypeOf(t)&&!e?t:new a.default(t,e),n.onload=function(){var t=n.status,e=n.statusText,o={status:t,statusText:e,headers:r(n),url:s()},a="response"in n?n.response:n.responseText;i(new u.default(a,o))},n.onerror=function(){o(new TypeError("Network request failed"))},n.open(l.method,l.url,!0),"include"===l.credientials&&(n.withCredientials=!0),l.headers.forEach(function(t,e){return n.setRequestHeader(t,e)}),n.send(l._bodyInit?l._bodyInit:null)})};e.default=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i="undefined"==typeof Promise?n(14).Promise:Promise,r=function(t){return new i(function(e){return setTimeout(e,t)})},o=function(t,e){return i.race([t,r(e).then(function(){throw new Error("Request Timeout after "+e+" ms")})])};o.wait=r,e.default=o},function(t,e,n){"use strict";var i=n(213);t.exports=function t(e){function n(t){var e=toString.call(t);if(void 0===g[e])return!1;var n=i(""+t);if(void 0===g[e][n])return!1;for(var r=g[e][n],o=0;o<r.length;++o)if(this.fEquals&&this.fEquals(r[o],t)||r[o]===t)return!0;return!1}function r(t){var e=toString.call(t);void 0===g[e]&&(g[e]=Object.create(null));var n=i(""+t);if(void 0===g[e][n])return g[e][n]=[t],p++,!0;for(var r=0,o=-1,a=g[e][n];r<a.length;++r){if(this.fEquals&&this.fEquals(a[r],t)||a[r]===t)return!1;void 0===a[r]&&(o=r)}return o>=0?a[o]=t:a.push(t),p++,!0}function o(t){var e=toString.call(t);if(void 0===g[e])return!1;var n=i(""+t);if(void 0===g[e][n])return!1;for(var r=g[e][n],o=0;o<r.length;++o)if(this.fEquals&&this.fEquals(r[o],t)||r[o]===t)return r[o]=void 0,p--,!0;return!1}function a(){var t,e=[],n=Object.keys(g);return n.forEach(function(n){t=Object.keys(g[n]),t.forEach(function(t){for(var i=g[n][t],r=0;r<i.length;++r)e.push(i[r])})}),e}function s(t){if(p<1)return!0;if(t.length<1)return!1;var e=a();for(var n in e)if(!t.contains(e[n]))return!1;return!0}function u(t){if(0===t.length)return!0;if(this.length<t.length)return!1;var e=t.toArray();for(var i in e)if(!n(e[i]))return!1;return!0}function l(t){var e=t.toArray();e.forEach(function(t){r(t)})}function c(t){if(p!==t.length)return!1;var e=t.toArray();for(var i in e)if(!n(e[i]))return!1;return!0}function h(t){if(0!==p)for(var e=a(),n=0;n<e.length;++n)t.contains(e[n])||o(e[n])}if(!(this instanceof t)){for(var f=new t,d=0;d<arguments.length;++d)f.add(arguments[d]);return f}var p=0,g=Object.create(null);Object.defineProperty(this,"length",{get:function(){return p}});var v=this;[].forEach.call(arguments,function(t){"function"==typeof t?v.fEquals=e:r(t)}),this.contains=n,this.equals=c,this.add=r,this.remove=o,this.toArray=a,this.isSubSetOf=s,this.isSuperSetOf=u,this.unionWith=l,this.intersectWith=h}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){return t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")};e.default=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)};e.default=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=function(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")},o=function(t){var e=[];return Object.keys(t).forEach(function(n){var o=t[n];(0,i.isPresent)(o)&&e.push(r(n)+"="+r(o))}),e.join("&")};e.default=o},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(84),o=i(r);e.default=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}function o(t,e,n){var i=a(t,e,n),u=i.endpoint,l=r(i,["endpoint"]),c=(0,h.default)(u,l).then(s);return b(c,o.defaults.timeout).catch(function(t){return y.reject(t)})}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],i=void 0;i=(0,m.default)(t)?t:(0,g.default)(o.defaults.baseURL,t);var r={method:n,endpoint:i,headers:x()};return r=l({},r,e),e.json&&(r.headers["Content-Type"]="application/json;charset=utf-8",r.body=JSON.stringify(e.json)),e.form&&(r.headers["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",r.body=(0,d.default)(e.form)),e.body&&(r.body=e.body),e.params&&(i+="?"+(0,d.default)(l({},e.params,o.defaults.params)),r.endpoint=i),r}function s(t){return new y(function(e,n){var i=[204,205];if(i.indexOf(t.status)!==-1)return e(t.ok);if(t.ok){var r=t.headers.get("Content-Type");r.indexOf("application/json")!==-1&&e(t.json()),e(t)}var o=new Error(t.statusText);try{t.clone().json().then(function(e){o.body=e,o.response=t,n(o)})}catch(e){o.response=t,n(o)}})}Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=u||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},c=n(9),h=i(c),f=n(82),d=i(f),p=n(80),g=i(p),v=n(81),m=i(v),y="undefined"==typeof Promise?n(14).Promise:Promise,_=function(t){return new y(function(e){return setTimeout(e,t)})},b=function(t,e){return y.race([t,_(e).then(function(){var t=new Error("");throw t.statusCode=408,t})])};o.defaults={baseURL:"https://api.ipalmap.com",timeout:1e4,headers:{Accept:"application/json"},params:{}};var x=function(){var t=l({},o.defaults.headers);return o.defaults.jwt&&(t.Authorization="Bearer "+o.defaults.jwt),t};o.get=function(t,e){return o(t,e,"GET")},o.head=function(t,e){return o(t,e,"HEAD")},o.options=function(t,e){return o(t,e,"OPTIONS")},o.post=function(t,e){return o(t,e,"POST")},o.put=function(t,e){return o(t,e,"PUT")},o.delete=function(t,e){return o(t,e,"DELETE")},o.del=o.delete,e.default=o},function(t,e,n){var i,r;(function(t){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function a(t){switch(this.clear(),arguments.length){case 0:break;case 1:this.copy(t);break;default:u(this,arguments)}}function s(t){var e=Object.prototype.toString.call(t),n=e.slice(8,-1).toLowerCase();return"domwindow"!==n||t?n:t+""}function u(t,e){for(var n=0;n<e.length;n+=2)t.set(e[n],e[n+1])}function l(t){return function(){return t.apply(this,arguments),this}}function c(t,e){Object.defineProperty&&Object.defineProperty(t,e,{enumerable:!1})}function h(t,e){this.x=t,this.y=e}function f(t,e){this.firstPoint=t,this.secondPoint=e}function d(t,e){this.scope=t,this.intercept=e}function p(t,e){this.firstLine=t,this.secondLine=e}function g(t,e){this.center=t,this.radius=e}function v(t,e){this.firstCircle=t,this.secondCircle=e}function m(t,e,n,i,r,o,a,s,u,l,c){this.beaconId=t,this.mapId=e,this.sceneId=n,this.floorId=i,this.uuid=r,this.major=o,this.minor=a,this.x=s,this.y=u,this.atten=l,this.lossCoe=c}function y(t,e,n,i){this.uuid=t,this.major=e,this.minor=n,this.distance=i}function _(){}function b(t){return this.rssiBoundary=t&&t.rssiBoundary?t.rssiBoundary:10,this.distBoundary=t&&t.distBoundary?t.distBoundary:6,this}function x(){}var w=a.prototype={constructor:a,get:function(t){var e=this._data[this.hash(t)];return e&&e[1]},put:function(t,e){var n=this.hash(t);n in this._data||this._count++,this._data[n]=[t,e]},multi:function(){u(this,arguments)},copy:function(t){for(var e in t._data)e in this._data||this._count++,this._data[e]=t._data[e]},containsKey:function(t){var e=this.hash(t),n=e in this._data;return n},search:function(t){for(var e in this._data)if(this._data[e][1]===t)return this._data[e][0];return null},remove:function(t){var e=this.hash(t);e in this._data&&(this._count--,delete this._data[e])},isEmpty:function(){return 0==this._count},keyArray:function(){var t=[];return this.forEach(function(e,n){t.push(n)}),t},values:function t(){var t=[];return this.forEach(function(e){t.push(e)}),t},size:function(){return this._count},clear:function(){this._data={},this._count=0},clone:function(){return new a(this)},hash:function(t){switch(s(t)){case"undefined":case"null":case"boolean":case"number":case"regexp":return t+"";case"date":return""+t.getTime();case"string":return""+t;case"array":for(var e=[],n=0;n<t.length;n++)e[n]=this.hash(t[n]);return""+e.join("");default:return t.hasOwnProperty("_hmuid_")||(t._hmuid_=++a.uid,c(t,"_hmuid_")),""+t._hmuid_}},forEach:function(t,e){for(var n in this._data){var i=this._data[n];t.call(e||this,i[1],i[0])}}};a.uid=0;for(var E in w)if("constructor"!==E&&w.hasOwnProperty(E)){var S=w[E];S.toString().indexOf("return ")===-1&&(w[E]=l(S))}h.prototype.setPoint=function(t,e){this.x=t,this.y=e},f.prototype.setPoints=function(t,e){this.firstPoint=t,this.secondPoint=e},f.prototype.getRelation=function(){var t=this.firstPoint.x==this.secondPoint.x?10:20,e=this.firstPoint.y==this.secondPoint.y?1:2,n=t+e,i=0;switch(n){case 11:i=1;break;case 12:i=2;break;case 21:i=3;break;case 22:i=4}return i},f.prototype.getDistance=function(){return Math.sqrt((this.firstPoint.x-this.secondPoint.x)*(this.firstPoint.x-this.secondPoint.x)+(this.firstPoint.y-this.secondPoint.y)*(this.firstPoint.y-this.secondPoint.y))},d.prototype.setLine=function(t,e){this.scope=t,this.intercept=e},d.prototype.lineGenerateByTwoPoints=function(t,e){this.scope=(t.y-e.y)/(t.x-e.x),this.intercept=t.y-this.scope*t.x},d.prototype.lineGenerateByPointScope=function(t,e){this.scope=e,this.intercept=t.y-e*t.x},p.prototype.setLines=function(t,e){this.firstLine=t,this.secondLine=e},p.prototype.getRelation=function(){var t=this.firstLine.scope==this.secondLine.scope?10:20,e=this.firstLine.intercept==this.secondLine.intercept?1:2,n=t+e,i=0;switch(n){case 11:i=1;break;case 12:i=2;break;case 21:i=3;break;case 22:i=4}return i},p.prototype.insect=function(){var t=this.getRelation(),e=Object.create(h.prototype);switch(t){case 3:e.setPoint(0,this.firstLine.intercept);break;case 4:var n=(this.secondLine.intercept-this.firstLine.intercept)/(this.firstLine.scope-this.secondLine.scope),i=this.firstLine.scope*n+this.firstLine.intercept;e.setPoint(n,i);break;default:console.log("no crossPoint between lines")}return e},g.prototype.setCircle=function(t,e){this.center=t,this.radius=e},v.prototype.setCircles=function(t,e){this.firstCircle=t,this.secondCircle=e},v.prototype.getRelation=function(){var t=this.firstCircle.center==this.secondCircle.center?1:2,e=this.firstCircle.radius==this.secondCircle.radius?10:20,n=t+e,i=0;switch(n){case 11:i=1;break;case 12:i=2;break;case 21:i=3;break;case 22:i=4}return i},v.prototype.insect=function(){for(var t=Object.create(Array.prototype),e=0;e<2;e++)t[e]=Object.create(h.prototype);var n=Object.create(f.prototype);n.setPoints(this.firstCircle.center,this.secondCircle.center);var i=n.getRelation();return t=this.locationOption(i)},v.prototype.locationOption=function(t){switch(t){case 1:return this.CenterXYEqual();case 2:return this.CenterXEqual();case 3:return this.CenterYEqual();case 4:return this.CenterNoEqual();default:return 1}},v.prototype.CenterXYEqual=function(){console.warn("the centers of the circle are the same!");for(var t=Object.create(Array.prototype),e=0;e<2;e++)t[e]=Object.create(h.prototype);return t[0]=C,t[1]=C,t},v.prototype.CenterXEqual=function(){for(var t=Object.create(Array.prototype),e=0;e<2;e++)t[e]=Object.create(h.prototype);var n=0,i=Math.abs(this.firstCircle.center.y-this.secondCircle.center.y);return this.firstCircle.center.y<this.secondCircle.center.y?(n=(Math.pow(i,2)+Math.pow(this.firstCircle.radius,2)-Math.pow(this.secondCircle.radius,2))/(2*this.firstCircle.radius*i),t[0].y=this.firstCircle.center.y+this.firstCircle.radius*n,t[1].y=t[0].y,t[0].x=this.firstCircle.center.x+this.firstCircle.radius*Math.sqrt(1-Math.pow(n,2)),t[1].x=this.firstCircle.center.x-this.firstCircle.radius*Math.sqrt(1-Math.pow(n,2))):(n=(Math.pow(i,2)+Math.pow(this.secondCircle.radius,2)-Math.pow(this.firstCircle.radius,2))/(2*this.secondCircle.radius*i),t[0].y=this.secondCircle.center.y+this.secondCircle.radius*n,t[1].y=t[0].y,t[0].x=this.secondCircle.center.x+this.secondCircle.radius*Math.sqrt(1-Math.pow(n,2)),t[1].x=this.secondCircle.center.x-this.secondCircle.radius*Math.sqrt(1-Math.pow(n,2))),t},v.prototype.CenterYEqual=function(){for(var t=Object.create(Array.prototype),e=0;e<3;e++)t[e]=Object.create(h.prototype);var n=0,i=Math.abs(this.firstCircle.center.x-this.secondCircle.center.x);return this.firstCircle.center.x<this.secondCircle.center.x?(n=(Math.pow(i,2)+Math.pow(this.firstCircle.radius,2)-Math.pow(this.secondCircle.radius,2))/(2*this.firstCircle.radius*i),t[0].x=this.firstCircle.center.x+this.firstCircle.radius*n,t[1].x=t[0].x,t[0].y=this.firstCircle.center.y+this.firstCircle.radius*Math.sqrt(1-Math.pow(n,2)),t[1].y=this.firstCircle.center.y-this.firstCircle.radius*Math.sqrt(1-Math.pow(n,2))):(n=(Math.pow(i,2)+Math.pow(this.secondCircle.radius,2)-Math.pow(this.firstCircle.radius,2))/(2*this.secondCircle.radius*i),t[0].x=this.secondCircle.center.x+this.secondCircle.radius*n,t[1].x=t[0].x,t[0].y=this.secondCircle.center.y+this.secondCircle.radius*Math.sqrt(1-Math.pow(n,2)),t[1].y=this.secondCircle.center.y-this.secondCircle.radius*Math.sqrt(1-Math.pow(n,2))),t},v.prototype.CenterNoEqual=function(){for(var t=Object.create(Array.prototype),e=0;e<2;e++)t[e]=Object.create(h.prototype);var n,i,r,o,a,s,u=Object.create(Array.prototype),l=Object.create(Array.prototype),c=Object.create(Array.prototype),d=Object.create(_.prototype);for(e=0;e<3;e++)c[e]=Object.create(f.prototype);return c[0].setPoints(this.firstCircle.center,this.secondCircle.center),n=2*this.firstCircle.radius*(this.firstCircle.center.x-this.secondCircle.center.x),i=2*this.firstCircle.radius*(this.firstCircle.center.y-this.secondCircle.center.y),r=this.secondCircle.radius*this.secondCircle.radius-this.firstCircle.radius*this.firstCircle.radius-c[0].getDistance()*c[0].getDistance(),o=n*n+i*i,a=-2*n*r,s=r*r-i*i,u[0]=(Math.sqrt(a*a-4*o*s)-a)/(2*o),u[1]=(-Math.sqrt(a*a-4*o*s)-a)/(2*o),l[0]=Math.sqrt(1-u[0]*u[0]),l[1]=Math.sqrt(1-u[1]*u[1]),t[0].x=this.firstCircle.radius*u[0]+this.firstCircle.center.x,t[1].x=this.firstCircle.radius*u[1]+this.firstCircle.center.x,t[0].y=this.firstCircle.radius*l[0]+this.firstCircle.center.y,t[1].y=this.firstCircle.radius*l[1]+this.firstCircle.center.y,c[1].setPoints(t[0],this.secondCircle.center),c[2].setPoints(t[1],this.secondCircle.center),d.varEquals(c[1].getDistance(),this.secondCircle.radius)||(t[0].y=this.firstCircle.center.y-this.firstCircle.radius*l[0]),d.varEquals(c[2].getDistance(),this.secondCircle.radius)||(t[1].y=this.firstCircle.center.y-this.firstCircle.radius*l[1]),d.varEquals(t[0].y,t[1].y)&&d.varEquals(t[0].x,t[1].x)&&(t[0].y>0?t[1].y=-t[1].y:t[0].y=-t[0].y),t},_.prototype.varEquals=function(t,e){var n=.001;return t.constructor==Number&&e.constructor==Number?Math.abs(t-e)<n:(console.log("type error!"),-1)},_.prototype.sortRule=function(t,e){return t-e},_.prototype.calcDistByRssi=function(t,e,n){var i=Math.abs(t),r=Math.abs(e),o=(i-r)/(10*n);return Math.pow(10,o)},b.prototype.setBoundaries=function(t){return this.rssiBoundary=t&&t.rssiBoundary?t.rssiBoundary:this.rssiBoundary?this.rssiBoundary:10,this.distBoundary=t&&t.distBoundary?t.distBoundary:this.distBoundary?this.distBoundary:6,this},b.prototype.rssiFilter=function(t,e){return t<0&&t>e-this.rssiBoundary},b.prototype.distanceFilter=function(t){return t>0&&t<this.distBoundary},b.prototype.locationFilter=function(t,e){var n=Object.create(h.prototype),i=Object.create(f.prototype),r=Object.create(h.prototype),o=4;n.x=(t[0].x+t[1].x+t[2].x)/3,n.y=(t[0].y+t[1].y+t[2].y)/3,i.setPoints(n,e);var a=i.getDistance();return a>o?(r.x=n.x+(e.x-n.x)*(o/a),r.y=n.y+(e.y-n.y)*(o/a),r):e},b.prototype.historyLocationFilter=function(t){var e=Object.create(f.prototype),n=Object.create(h.prototype);e.setPoints(t,I);var i=2,r=e.getDistance();return r<=i||0==I.x&&0==I.y?(I=t,t):(n.x=I.x+(I.x-t.x)*(i/r),n.y=I.y+(I.y-t.y)*(i/r),I=n,n)},x.prototype.parseInfo=function(t){try{return JSON.parse(t)}catch(t){return t}},x.prototype.stringifyInfo=function(t){try{return JSON.stringify(t)}catch(t){return t}};var M={BEACON_USE_NUM:"3",DIS_A:"0",DIS_B:"1",DIS_C:"2"},C=new h(-1e3,-1e3),I=new h(0,0),O=function(t,e){this.BeaconsCfg=t,this.bleConfig=e,this.bleLocationInfo=function(){function t(){return void 0==n&&(n=new e),n}function e(){return e.instance={type:"FeatureCollection",features:[{type:"Feature",properties:{floor_id:0},geometry:{type:"Point",coordinates:[0,0]}}]},e.instance}var n;return{getInstance:t}}(),this.bleLocationInfoInstance=this.bleLocationInfo.getInstance(),this.bleLocationStrategy=function(t,e,n,i){var r;switch(t){case 1:r="beaconNumEqualOne";break;case 2:r="beaconNumEqualTwo";break;case 3:r="beaconNumEqualThree";break;default:r="beaconNumMoreThanThree"}var o=function(t,e){for(var n=Object.create(Array.prototype),i=Object.create(Array.prototype),r=Object.create(Array.prototype),o=0;o<M.BEACON_USE_NUM;o++)r[o]=Object.create(f.prototype);r[0].setPoints(t[0],t[1]),r[1].setPoints(t[0],t[2]),r[2].setPoints(t[1],t[2]),n[0]=r[0].getDistance(),n[1]=r[1].getDistance(),n[2]=r[2].getDistance(),i[0]=e[M.DIS_A]+e[M.DIS_B],i[1]=e[M.DIS_A]+e[M.DIS_C],i[2]=e[M.DIS_B]+e[M.DIS_C],i[3]=Math.abs(e[M.DIS_A]-e[M.DIS_B]),i[4]=Math.abs([M.DIS_A]-e[M.DIS_C]),i[5]=Math.abs(e[M.DIS_B]-e[M.DIS_C]);var a,s=(n[0]>i[0]?300:n[0]<i[3]?100:200,n[1]>i[1]?30:n[1]<i[4]?10:20,n[2]>i[2]?3:n[2]<i[5]?1:2,333);switch(s){case 333:a="allDeviation",console.info("C0-C1 C0-C2 C1-C2");break;case 222:a="disWeightAlg",console.info("C0+C1 C0+C2 C1+C2");break;case 233:a="CirTwoDeviation",console.info("C0+C1 C0-C2 C1-C2");break;case 323:a="CirOneDeviation",console.info("C0-C1 C0+C2 C1-C2");break;case 332:a="CirZeroDeviation",console.info("C0-C1 C0-C2 C1+C2");break;case 221:case 223:a="CirOneTwoDeviation",console.info("C0+C1 C0+C2 C1-&C2");break;case 212:case 232:a="CirZeroTwoDeviation",console.info("C0+C1 C0-&C2 C1+C2");break;case 122:case 322:a="CirZeroOneDeviation",console.info("C0-&C1 C0+C2 C1+C2");break;default:console.log("no Result!")}var u={allDeviation:function(t,e){for(var n=Object.create(Array.prototype),i=0,r=0,o=0,a=0;a<3;++a)i+=1/e[a];for(var s=0;s<3;++s)n[s]=1/e[s]/i;for(var u=Object.create(h.prototype),l=0;l<3;++l)r+=n[l]*t[l].x,o+=n[l]*t[l].y;return u.setPoint(r,o),u},disWeightAlg:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(Array.prototype),o=Object.create(Array.prototype),a=Object.create(Array.prototype),s=0;s<M.BEACON_USE_NUM;s++)i[s]=Object.create(g.prototype),r[s]=Object.create(v.prototype);i[0].setCircle(t[0],e[M.DIS_A]),i[1].setCircle(t[1],e[M.DIS_B]),i[2].setCircle(t[2],e[M.DIS_C]),r[0].setCircles(i[0],i[1]),r[1].setCircles(i[0],i[2]),r[2].setCircles(i[1],i[2]),a[0]=r[0].insect(),a[1]=r[1].insect(),a[2]=r[2].insect();var u=Object.create(Array.prototype);for(s=0;s<2*Number(M.BEACON_USE_NUM);s++)u[s]=Object.create(f.prototype);return u[0].setPoints(a[0][0],t[2]),u[1].setPoints(a[0][1],t[2]),u[2].setPoints(a[1][0],t[1]),u[3].setPoints(a[1][1],t[1]),u[4].setPoints(a[2][0],t[0]),u[5].setPoints(a[2][1],t[0]),u[0].getDistance()<u[1].getDistance()?o[0]=a[0][0]:o[0]=a[0][1],u[2].getDistance()<u[3].getDistance()?o[1]=a[1][0]:o[1]=a[1][1],u[4].getDistance()<u[5].getDistance()?o[2]=a[2][0]:o[2]=a[2][1],n.x=(o[0].x/(e[M.DIS_A]*e[M.DIS_A])+o[1].x/(e[M.DIS_B]*e[M.DIS_B])+o[2].x/(e[M.DIS_C]*e[M.DIS_C]))/(1/(e[M.DIS_A]*e[M.DIS_A])+1/(e[M.DIS_B]*e[M.DIS_B])+1/(e[M.DIS_C]*e[M.DIS_C])),n.y=(o[0].y/(e[M.DIS_A]*e[M.DIS_A])+o[1].y/(e[M.DIS_B]*e[M.DIS_B])+o[2].y/(e[M.DIS_C]*e[M.DIS_C]))/(1/(e[M.DIS_A]*e[M.DIS_A])+1/(e[M.DIS_B]*e[M.DIS_B])+1/(e[M.DIS_C]*e[M.DIS_C])),n},CirZeroDeviation:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(v.prototype),o=Object.create(Array.prototype),a=0;a<2;a++)i[a]=Object.create(g.prototype),o[a]=Object.create(f.prototype);i[0].setCircle(t[1],e[1]),i[1].setCircle(t[2],e[2]),r.setCircles(i[0],i[1]);var s=r.insect();return o[0].setPoints(s[0],t[0]),o[1].setPoints(s[1],t[0]),n=o[0].getDistance()<o[1].getDistance()?s[0]:s[1]},CirOneDeviation:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(v.prototype),o=Object.create(Array.prototype),a=0;a<2;a++)i[a]=Object.create(g.prototype),o[a]=Object.create(f.prototype);i[0].setCircle(t[0],e[0]),i[1].setCircle(t[2],e[2]),r.setCircles(i[0],i[1]);var s=r.insect();return o[0].setPoints(s[0],t[1]),o[1].setPoints(s[1],t[1]),n=o[0].getDistance()<o[1].getDistance()?s[0]:s[1]},CirTwoDeviation:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(v.prototype),o=Object.create(Array.prototype),a=0;a<2;a++)i[a]=Object.create(g.prototype),
o[a]=Object.create(f.prototype);i[0].setCircle(t[0],e[0]),i[1].setCircle(t[1],e[1]),r.setCircles(i[0],i[1]);var s=r.insect();return o[0].setPoints(s[0],t[2]),o[1].setPoints(s[1],t[2]),n=o[0].getDistance()<o[1].getDistance()?s[0]:s[1]},CirOneTwoDeviation:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(Array.prototype),o=Object.create(Array.prototype),a=Object.create(Array.prototype),s=Object.create(Array.prototype),u=0;u<2;u++)i[u]=Object.create(h.prototype),o[u]=Object.create(v.prototype),a[u]=Object.create(f.prototype);for(u=0;u<3;u++)r[u]=Object.create(g.prototype);for(u=0;u<4;u++)s[u]=Object.create(f.prototype);return r[0].setCircle(t[0],e[0]),r[1].setCircle(t[1],e[1]),r[2].setCircle(t[2],e[2]),o[0].setCircles(r[0],r[1]),o[1].setCircles(r[0],r[2]),a[0]=o[0].insect(),a[1]=o[1].insect(),s[0].setPoints(a[0][0],t[2]),s[1].setPoints(a[0][1],t[2]),s[2].setPoints(a[1][0],t[1]),s[3].setPoints(a[1][1],t[1]),s[0].getDistance()<s[1].getDistance()?i[0]=a[0][0]:i[0]=a[0][1],s[2].getDistance()<s[3].getDistance()?i[1]=a[1][0]:i[1]=a[1][1],n.setPoint((i[0].x+i[1].x)/2,(i[0].y+i[1].y)/2),n},CirZeroTwoDeviation:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(Array.prototype),o=Object.create(Array.prototype),a=Object.create(Array.prototype),s=Object.create(Array.prototype),u=0;u<2;u++)i[u]=Object.create(h.prototype),o[u]=Object.create(v.prototype),a[u]=Object.create(f.prototype);for(u=0;u<3;u++)r[u]=Object.create(g.prototype);for(u=0;u<4;u++)s[u]=Object.create(f.prototype);return r[0].setCircle(t[0],e[0]),r[1].setCircle(t[1],e[1]),r[2].setCircle(t[2],e[2]),o[0].setCircles(r[0],r[1]),o[1].setCircles(r[1],r[2]),a[0]=o[0].insect(),a[1]=o[1].insect(),s[0].setPoints(a[0][0],t[2]),s[1].setPoints(a[0][1],t[2]),s[2].setPoints(a[1][0],t[0]),s[3].setPoints(a[1][1],t[0]),s[0].getDistance()<s[1].getDistance()?i[0]=a[0][0]:i[0]=a[0][1],s[2].getDistance()<s[3].getDistance()?i[1]=a[1][0]:i[1]=a[1][1],n.setPoint((i[0].x+i[1].x)/2,(i[0].y+i[1].y)/2),n},CirZeroOneDeviation:function(t,e){for(var n=Object.create(h.prototype),i=Object.create(Array.prototype),r=Object.create(Array.prototype),o=Object.create(Array.prototype),a=Object.create(Array.prototype),s=Object.create(Array.prototype),u=0;u<2;u++)i[u]=Object.create(h.prototype),o[u]=Object.create(v.prototype),a[u]=Object.create(f.prototype);for(u=0;u<3;u++)r[u]=Object.create(g.prototype);for(u=0;u<4;u++)s[u]=Object.create(f.prototype);return r[0].setCircle(t[0],e[0]),r[1].setCircle(t[1],e[1]),r[2].setCircle(t[2],e[2]),o[0].setCircles(r[0],r[2]),o[1].setCircles(r[1],r[2]),a[0]=o[0].insect(),a[1]=o[1].insect(),s[0].setPoints(a[0][0],t[1]),s[1].setPoints(a[0][1],t[1]),s[2].setPoints(a[1][0],t[0]),s[3].setPoints(a[1][1],t[0]),s[0].getDistance()<s[1].getDistance()?i[0]=a[0][0]:i[0]=a[0][1],s[2].getDistance()<s[3].getDistance()?i[1]=a[1][0]:i[1]=a[1][1],n.setPoint((i[0].x+i[1].x)/2,(i[0].y+i[1].y)/2),n}},l=Object.create(b.prototype),c=u[a](t,e);return l.locationFilter(t,c)},a={beaconNumEqualOne:function(t,e,n){var i,r=Object.create(h.prototype),o=t.keyArray()[0];r.setPoint(e.get(o).x,e.get(o).y),i=t.get(o).distance,n.features[0].properties.floor_id=e.get(o).floorId,n.features[0].geometry.coordinates[0]=e.get(o).x,n.features[0].geometry.coordinates[1]=e.get(o).y},beaconNumEqualTwo:function(t,e,n){for(var i,r=2,o=Object.create(Array.prototype),a=Object.create(Array.prototype),s=Object.create(Array.prototype),u=Object.create(Array.prototype),l=0,c=0,f=0,d=0;d<r;d++)o[d]=Object.create(h.prototype);var p=t.keyArray();for(d=0;d<r;d++)s[d]=p[d],a[d]=Number(t.get(s[d]).distance),o[d].setPoint(e.get(s[d]).x,e.get(s[d]).y);for(i=a[M.DIS_A]<a[M.DIS_B]?0:1,d=0;d<r;++d)l+=1/a[d];for(d=0;d<r;++d)u[d]=1/a[d]/l;for(d=0;d<r;++d)c+=u[d]*o[d].x,f+=u[d]*o[d].y;n.features[0].properties.floor_id=e.get(s[i]).floorId,n.features[0].geometry.coordinates[0]=c,n.features[0].geometry.coordinates[1]=f},beaconNumEqualThree:function(t,e,n){for(var i,r=3,a=Object.create(Array.prototype),s=Object.create(Array.prototype),u=Object.create(Array.prototype),l=Object.create(Array.prototype),c=new Array(3),f=1e3,d=0;d<r;d++)a[d]=Object.create(h.prototype);var p=t.keyArray();for(d=0;d<r;d++)u[d]=p[d],s[d]=Number(t.get(u[d]).distance),a[d].setPoint(e.get(u[d]).x,e.get(u[d]).y),l[d]=Number(t.get(u[d]).distance),c[d]=e.get(u[d]).floorId,f>l[d]&&(f=l[d],i=e.get(u[d]).floorId);var g=o(a,s);c.sort(_.sortRule),s.sort(_.sortRule),s[0]!=s[1]?n.features[0].properties.floor_id=i:n.features[0].properties.floor_id=floorArrayToUse[(Number(M.BEACON_USE_NUM)+1)/2-1],n.features[0].geometry.coordinates[0]=g.x,n.features[0].geometry.coordinates[1]=g.y},beaconNumMoreThanThree:function(t,e,n){for(var i,r=t.size(),a=new Array(r),s=Object.create(Array.prototype),u=Object.create(Array.prototype),l=Object.create(Array.prototype),c=new Array(3),f=1e3,d=0;d<M.BEACON_USE_NUM;d++)s[d]=Object.create(h.prototype);var p=t.keyArray();for(d=0;d<r;d++)a[d]=Number(t.get(p[d]).distance);for(a.sort(_.sortRule),d=0;d<M.BEACON_USE_NUM;d++)for(var g=0;g<t.size();g++){var v=t.get(p[g]);if(v&&v.distance&&v.distance==a[d]){u[d]=p[g],s[d].setPoint(e.get(u[d]).x,e.get(u[d]).y),l[d]=Number(t.get(u[d]).distance),c[d]=e.get(u[d]).floorId,f>l[d]&&(f=l[d],i=e.get(u[d]).floorId);break}}var m=o(s,l);c.sort(_.sortRule),l.sort(_.sortRule),l[0]!=l[1]?n.features[0].properties.floor_id=i:n.features[0].properties.floor_id=c[(Number(M.BEACON_USE_NUM)+1)/2-1],n.features[0].geometry.coordinates[0]=m.x,n.features[0].geometry.coordinates[1]=m.y}};a[r](e,n,i)}};O.prototype.init=function(t){this.BeaconsCfg=t},O.prototype.locate=function(t){var e,n,i,r,o,s=Object.create(_.prototype),u=Object.create(b.prototype),l=new a,c=new a;if(u.setBoundaries(this.bleConfig),i=this.BeaconsCfg,e=t,r=i.length,n=e.length,0==r)return console.warn("beaconsCfg is empty!"),this.bleLocationInfoInstance;for(var h=0;h<r;h++){var f,d;"atten"in i[h]&&"lossCoe"in i[h]?(f=i[h].atten,d=i[h].lossCoe):(f=-59,d=2);var p=new m(i[h].beaconId,i[h].mapId,i[h].sceneId,i[h].floorId,i[h].uuid,i[h].major,i[h].minor,Number(i[h].geom.x),Number(i[h].geom.y),f,d),g=new String(i[h].uuid+i[h].major+i[h].minor);l.put(g,p)}if(l.isEmpty())return console.log("BeaconCfgNum = 0"),this.bleLocationInfoInstance;if(0==n)return console.warn("beacons is empty!"),this.bleLocationInfoInstance;for(h=0;h<n;h++){var v=new String(e[h].uuid+e[h].major+e[h].minor);if(l.containsKey(v)){var x=0;if("distance"in e[h]?u.distanceFilter(e[h].distance)&&(x=e[h].distance):u.rssiFilter(Number(e[h].rssi),l.get(v).atten)&&(x=s.calcDistByRssi(Number(e[h].rssi),l.get(v).atten,l.get(v).lossCoe)),x){var w=new y(e[h].uuid,e[h].major,e[h].minor,x);c.put(v,w)}}}return c.isEmpty()?(console.warn("BeaconNum = 0"),this.bleLocationInfoInstance):(o=c.size(),l.isEmpty()||c.isEmpty()?(console.warn("beaconsCfgMap or beaconsMap is empty!"),this.bleLocationInfoInstance):(this.bleLocationStrategy(o,c,l,this.bleLocationInfoInstance),c.clear(),l.clear(),this.bleLocationInfoInstance))},O.prototype.getBleLocationInfo=function(){var t=Object.create(x.prototype);return t.stringifyInfo(this.bleLocationInfoInstance)},"object"===o(t)&&"object"===o(t.exports)?t.exports=O:(i=O,r="function"==typeof i?i.call(e,n,e,t):i,!(void 0!==r&&(t.exports=r)))}()}).call(e,n(37)(t))},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var n=l[e];if(!n){var i=document.getElementsByTagName("body")[0],r=document.createElement("div"),o=document.createTextNode(t);r.appendChild(o),r.setAttribute("style","font:"+e+";position:absolute;top:0;left:0"),i.appendChild(r),n=r.offsetHeight,l[e]=n,i.removeChild(r)}return n}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(2),u=i(s),l={},c=function(){function t(){r(this,t),this.textWidth=null,this.textHeight=null,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}return a(t,[{key:"drawText",value:function(t,e){return e.optTextRect?this.drawTextOpt(t,e):this.drawTextRect(t,e)}},{key:"drawTextOpt",value:function(t,e){var n=this.canvas,i=this.ctx;i.font=e.font;var r=Math.ceil(this.ctx.measureText(t).width),a=o(t,i.font),s=r+(e.lineWidth?2*e.lineWidth:0)+30,l=a+30,c=0;e.lineWidth&&(c=2*e.lineWidth);var h=0,f=0,d=c+r,p=c/2+a;return s=d-h,l=p-f,this.textWidth=s,this.textHeight=l,n.width=u.Math.nextPowerOfTwo(s),n.height=u.Math.nextPowerOfTwo(l),i.font=e.font,i.textAlign="left",i.textBaseline="top",e.lineWidth&&e.strokeStyle&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.lineWidth,i.strokeText(t,c,c)),i.shadowColor=e.shadowColor?e.shadowColor:i.shadowColor,i.shadowBlur=e.shadowBlur?e.shadowBlur:i.shadowColor,i.fillStyle=e.fillStyle,i.fillText(t,c,c),this.canvas}},{key:"drawTextRect",value:function(t,e){var n=this.canvas,i=this.ctx;i.font=e.font;var r=Math.ceil(this.ctx.measureText(t).width),a=o(t,i.font),s=r+(e.lineWidth?2*e.lineWidth:0)+30,l=a+30;n.width=s,n.height=l,i.clearRect(0,0,this.canvas.width,this.canvas.height);var c=0;e.lineWidth&&(c=2*e.lineWidth),i.font=e.font,i.textAlign="left",i.textBaseline="top",e.lineWidth&&e.strokeStyle&&(i.strokeStyle=e.strokeStyle,i.lineWidth=e.lineWidth,i.strokeText(t,c,c)),i.shadowColor=e.shadowColor?e.shadowColor:i.shadowColor,i.shadowBlur=e.shadowBlur?e.shadowBlur:i.shadowColor,i.fillStyle=e.fillStyle,i.fillText(t,c,c);var h=i.getImageData(0,0,s,l),f=0,d=0,p=0,g=0,v=void 0,m=void 0,y=void 0,_=h.data;for(m=c;m>0;--m){for(y=0;y<h.height&&(v=4*(y*h.width+m)+3,!_[v]);++y);if(!_[v]){f=m+1;break}}for(m=c;m>0;--m){for(y=f;y<h.width&&(v=4*(m*h.width+y)+3,!_[v]);++y);if(!_[v]){d=m+1;break}}var b=c-f,x=c-d;for(m=a-x;m<h.height;++m){for(y=f;y<h.width&&(v=4*(m*h.width+y)+3,!_[v]);++y);if(!_[v]){g=m-1;break}}for(m=r-b;m<h.width;++m){for(y=d;y<=g&&(v=4*(y*h.width+m)+3,!_[v]);++y);if(!_[v]){p=m-1;break}}return s=p-f,l=g-d,h=i.getImageData(f,d,s,l),this.textWidth=s,this.textHeight=l,n.width=u.Math.nextPowerOfTwo(s),n.height=u.Math.nextPowerOfTwo(l),i.putImageData(h,0,0,0,0,this.textWidth,this.textHeight),this.canvas}},{key:"width",get:function(){return this.canvas.width}},{key:"height",get:function(){return this.canvas.height}}]),t}();e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(2),h=r(c),f=n(42),d=i(f),p=n(86),g=i(p),v=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments[1];o(this,e);var i=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._options=u({font:"30px Arial",fillStyle:"#FFFFFF",depthTest:!1,antialias:!0,align:d.default.center,optTextRect:!1},n||{}),i.canvas=new g.default,i.text=t,i}return s(e,t),l(e,[{key:"raycast",value:function(){var t;return(t=this.sprite).raycast.apply(t,arguments)}},{key:"updateText",value:function(){this.canvas&&(this.canvas.drawText(this._text,this._options),this.cleanUp(),this.texture=new h.Texture(this.canvas.canvas),this.texture.needsUpdate=!0,this.applyAntiAlias(),this.material?this.material.map=this.texture:this.material=new h.SpriteMaterial({map:this.texture,depthTest:this._options.depthTest,alphaTest:.01}),this.texture.offset.x=0,this.texture.offset.y=1-this.canvas.textHeight/this.canvas.height,this.texture.repeat.x=this.canvas.textWidth/this.canvas.width,this.texture.repeat.y=this.canvas.textHeight/this.canvas.height,this.sprite||(this.sprite=new h.Sprite(this.material),this.geometry=this.sprite.geometry,this.add(this.sprite)),this.sprite.scale.set(this.canvas.textWidth/2,this.canvas.textHeight/2,0),this.sprite.position.x=this.canvas.textWidth/2*this._options.align.x,this.sprite.position.y=this.canvas.textHeight/2*this._options.align.y)}},{key:"cleanUp",value:function(){this.texture&&this.texture.dispose()}},{key:"applyAntiAlias",value:function(){this._options.antialias===!1?(this.texture.magFilter=h.LinearFilter,this.texture.minFilter=h.LinearFilter):(this.texture.magFilter=h.LinearFilter,this.texture.minFilter=h.LinearFilter)}},{key:"getAABB",value:function(t){var e=new h.Vector3(0,0,0),n=this.margin||0,i=this.sprite.scale,r=i.x/2,o=i.y/2,a=[],s=this.sprite.matrixWorld;e.setFromMatrixPosition(s),e=t.toScreenCoordinate(e.x,e.y,e.z);var u=this.sprite.material.anchor,l=0,c=0;return u&&(l=r-i.x*u[0],c=o-i.y*u[1],e.setX(e.x+l),e.setY(e.y+c)),a.push(e.x-r-n),a.push(e.y-o-n),a.push(0),a.push(e.x+r+n),a.push(e.y+o+n),a.push(0),a}},{key:"makeCollision",value:function(t){var e=!t,n=this.destOpacity?this.destOpacity:1;this.visible=e,this.material.opacity=n;for(var i=this.children,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;s.visible=e}return this}},{key:"width",get:function(){return this.canvas.textWidth}},{key:"height",get:function(){return this.canvas.textHeight}},{key:"text",get:function(){return this._text},set:function(t){this._text!==t&&(this._text=t,this.updateText())}},{key:"font",get:function(){return this._options.font},set:function(t){this._options.font!==t&&(this._options.font=t,this.updateText())}},{key:"fillStyle",get:function(){return this._options.fillStyle},set:function(t){this._options.fillStyle!==t&&(this._options.fillStyle=t,this.updateText())}}]),e}(h.Object3D);e.default=v},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var r=n(2),o=i(r);o.CSS2DObject=function(t){o.Object3D.call(this),this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="all",this.addEventListener("removed",function(t){null!==this.element.parentNode&&this.element.parentNode.removeChild(this.element)})},o.CSS2DObject.prototype=Object.create(o.Object3D.prototype),o.CSS2DObject.prototype.constructor=o.CSS2DObject,o.CSS2DRenderer=function(){console.log("THREE.CSS2DRenderer",o.REVISION);var t,e,n,i,r=new o.Vector3,a=new o.Matrix4,s=new o.Matrix4,u=document.createElement("div");u.style.overflow="hidden",this.domElement=u,this.setSize=function(r,o){t=r,e=o,n=t/2,i=e/2,u.style.width=r+"px",u.style.height=o+"px"};var l=function t(e,a){if(e instanceof o.CSS2DObject){r.setFromMatrixPosition(e.matrixWorld),r.applyMatrix4(s);var l=e.element,c="translate(-50%,-50%) translate("+(r.x*n+n)+"px,"+(-r.y*i+i)+"px)";l.style.WebkitTransform=c,l.style.MozTransform=c,l.style.oTransform=c,l.style.transform=c,l.parentNode!==u&&u.appendChild(l)}for(var h=0,f=e.children.length;h<f;h++)t(e.children[h],a)};this.render=function(t,e){t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),a.copy(e.matrixWorldInverse.getInverse(e.matrixWorld)),s.multiplyMatrices(e.projectionMatrix,a),l(t,e)}}},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var r=n(2),o=i(r);o.ColladaLoader=function(){function t(t,n,i,r){var o=0;if(document.implementation&&document.implementation.createDocument){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState?0===a.status||200===a.status?a.response?(jt=n,e(a.response,void 0,t)):r?r({type:"error",url:t}):console.error("ColladaLoader: Empty or non-existing file ("+t+")"):r?r({type:"error",url:t}):console.error("ColladaLoader: Couldn't load \""+t+'" ('+a.status+")"):3===a.readyState&&i&&(0===o&&(o=a.getResponseHeader("Content-Length")),i({total:o,loaded:a.responseText.length}))},a.open("GET",t,!0),a.send(null)}else alert("Don't know how to parse XML!")}function e(t,e,n){if(Ft=(new DOMParser).parseFromString(t,"text/xml"),e=e||jt,void 0!==n){var l=n.split("/");l.pop(),kt=(l.length<1?".":l.join("/"))+"/"}i(),xt(),zt=r("library_images image",I,"image"),Ht=r("library_materials material",Y,"material"),qt=r("library_effects effect",Q,"effect"),Xt=r("library_geometries geometry",F,"geometry"),Yt=r("library_cameras camera",rt,"camera"),Wt=r("library_lights light",at,"light"),Vt=r("library_controllers controller",O,"controller"),Gt=r("library_animations animation",tt,"animation"),Lt=r("library_visual_scenes visual_scene",A,"visual_scene"),Nt=r("library_kinematics_models kinematics_model",ut,"kinematics_model"),Rt=[],Dt=[],Ot=a(),Bt=new o.Group;for(var c=0;c<Ot.nodes.length;c++)Bt.add(y(Ot.nodes[c]));Bt.scale.multiplyScalar(Kt),u(),Tt=s(),m();var h={scene:Bt,morphs:Rt,skins:Dt,animations:Pt,kinematics:At,dae:{images:zt,materials:Ht,cameras:Yt,lights:Wt,effects:qt,geometries:Xt,controllers:Vt,animations:Gt,visualScenes:Lt,visualScene:Ot,scene:Ot,kinematicsModels:Nt,kinematicsModel:Tt}};return e&&e(h),h}function n(t){Zt=t}function i(){var t=Ft.querySelectorAll("asset"),e=t[0];if(e&&e.childNodes)for(var n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];switch(i.nodeName){case"unit":var r=i.getAttribute("meter");r&&(Kt=parseFloat(r));break;case"up_axis":Qt=i.textContent.charAt(0)}}}function r(t,e,n){for(var i=Ft.querySelectorAll(t),r={},o=0,a=i.length,s=0;s<a;s++){var u=i[s],l=(new e).parse(u);l.id&&0!==l.id.length||(l.id=n+o++),r[l.id]=l}return r}function a(){var t=Ft.querySelectorAll("scene instance_visual_scene")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return Lt[e.length>0?e:"visual_scene0"]}return null}function s(){var t=Ft.querySelectorAll("instance_kinematics_model")[0];if(t){var e=t.getAttribute("url").replace(/^#/,"");return Nt[e.length>0?e:"kinematics_model0"]}return null}function u(){Pt=[],l(Bt)}function l(t){var e=Ot.getChildById(t.colladaId,!0),n=null;if(e&&e.keys){n={fps:60,hierarchy:[{node:e,keys:e.keys,sids:e.sids}],node:t,name:"animation_"+t.name,length:0},Pt.push(n);for(var i=0,r=e.keys.length;i<r;i++)n.length=Math.max(n.length,e.keys[i].time)}else n={hierarchy:[{keys:[],sids:[]}]};for(var i=0,r=t.children.length;i<r;i++)for(var o=l(t.children[i]),a=0,s=o.hierarchy.length;a<s;a++)n.hierarchy.push({keys:[],sids:[]});return n}function c(){var t,e=1e6,n=-e,i=0;for(var r in Gt){var o=Gt[r];t=t||o.id;for(var a=0;a<o.sampler.length;a++){var s=o.sampler[a];s.create(),e=Math.min(e,s.startTime),n=Math.max(n,s.endTime),i=Math.max(i,s.input.length)}}return{start:e,end:n,frames:i,ID:t}}function h(t,e){var n=e instanceof k?Vt[e.url]:e;if(!n||!n.morph)return void console.log("could not find morph controller!");for(var i=n.morph,r=0;r<i.targets.length;r++){var o=i.targets[r],a=Xt[o];if(a.mesh&&a.mesh.primitives&&a.mesh.primitives.length){var s=a.mesh.primitives[0].geometry;s.vertices.length===t.vertices.length&&t.morphTargets.push({name:"target_1",vertices:s.vertices})}}t.morphTargets.push({name:"target_Z",vertices:t.vertices})}function f(t,e,n,i){if(t.world=t.world||new o.Matrix4,t.localworld=t.localworld||new o.Matrix4,t.world.copy(t.matrix),t.localworld.copy(t.matrix),t.channels&&t.channels.length){var r=t.channels[0],a=r.sampler.output[n];a instanceof o.Matrix4&&(t.world.copy(a),t.localworld.copy(a),0===n&&t.matrix.copy(a))}i&&t.world.multiplyMatrices(i,t.world),e.push(t);for(var s=0;s<t.nodes.length;s++)f(t.nodes[s],e,n,t.world)}function d(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=-1;if("JOINT"==i.type){for(var a=0;a<e.joints.length;a++)if(i.sid===e.joints[a]){r=a;break}if(r>=0){var s=e.invBindMatrices[r];i.invBindMatrix=s,i.skinningMatrix=new o.Matrix4,i.skinningMatrix.multiplyMatrices(i.world,s),i.animatrix=new o.Matrix4,i.animatrix.copy(i.localworld),i.weights=[];for(var a=0;a<e.weights.length;a++)for(var u=0;u<e.weights[a].length;u++){var l=e.weights[a][u];l.joint===r&&i.weights.push(l)}}else console.warn("ColladaLoader: Could not find joint '"+i.sid+"'."),i.skinningMatrix=new o.Matrix4,i.weights=[]}}}function p(t){var e=[],n=function t(e,n,i){var r={};r.name=n.sid,r.parent=e,r.matrix=n.matrix;var a=[new o.Vector3,new o.Quaternion,new o.Vector3];r.matrix.decompose(a[0],a[1],a[2]),r.pos=[a[0].x,a[0].y,a[0].z],r.scl=[a[2].x,a[2].y,a[2].z],r.rotq=[a[1].x,a[1].y,a[1].z,a[1].w],i.push(r);for(var s in n.nodes)t(n.sid,n.nodes[s],i)};return n(-1,t,e),e}function g(t,e,n){var i=[];f(e,i,-1),d(i,n.skin);for(var r=new o.Vector3,a=[],s=0;s<t.vertices.length;s++)a.push(new o.Vector3);for(s=0;s<i.length;s++)if("JOINT"==i[s].type)for(var u=0;u<i[s].weights.length;u++){var l=i[s].weights[u],c=l.index,h=l.weight,p=t.vertices[c],g=a[c];r.x=p.x,r.y=p.y,r.z=p.z,r.applyMatrix4(i[s].skinningMatrix),g.x+=r.x*h,g.y+=r.y*h,g.z+=r.z*h}for(var s=0;s<t.vertices.length;s++)t.vertices[s]=a[s]}function v(t,e,n){var i=Vt[e.url];if(n=void 0!==n?n:40,!i||!i.skin)return void console.log("ColladaLoader: Could not find skin controller.");if(!e.skeleton||!e.skeleton.length)return void console.log("ColladaLoader: Could not find the skeleton for the skin. ");for(var r=c(),a=Ot.getChildById(e.skeleton[0],!0)||Ot.getChildBySid(e.skeleton[0],!0),s=p(a),u=i.skin.joints,l=[],h=0;h<u.length;h++)for(var v=0;v<s.length;v++)s[v].name===u[h]&&(l[h]=s[v]);for(var h=0;h<l.length;h++)for(var v=0;v<l.length;v++)l[h].parent===l[v].name&&(l[h].parent=v);var h,v,m;new o.Vector3;for(h=0;h<t.vertices.length;h++)t.vertices[h].applyMatrix4(i.skin.bindShapeMatrix);for(var y=[],_=[],b=i.skin.weights,h=0;h<b.length;h++){var x=new o.Vector4(b[h][0]?b[h][0].joint:0,b[h][1]?b[h][1].joint:0,b[h][2]?b[h][2].joint:0,b[h][3]?b[h][3].joint:0),m=new o.Vector4(b[h][0]?b[h][0].weight:0,b[h][1]?b[h][1].weight:0,b[h][2]?b[h][2].weight:0,b[h][3]?b[h][3].weight:0);y.push(x),_.push(m)}t.skinIndices=y,t.skinWeights=_,t.bones=l;for(var w={name:r.ID,fps:30,length:r.frames/30,hierarchy:[]},v=0;v<l.length;v++)w.hierarchy.push({parent:l[v].parent,name:l[v].name,keys:[]});for(console.log("ColladaLoader:",r.ID+" has "+l.length+" bones."),g(t,a,i),n=0;n<r.frames;n++){var E=[];f(a,E,n),d(E,i.skin);for(var h=0;h<E.length;h++)for(var v=0;v<w.hierarchy.length;v++)if(w.hierarchy[v].name===E[h].sid){var S={};S.time=n/30,S.matrix=E[h].animatrix,0===n&&(E[h].matrix=S.matrix);var M=[new o.Vector3,new o.Quaternion,new o.Vector3];S.matrix.decompose(M[0],M[1],M[2]),S.pos=[M[0].x,M[0].y,M[0].z],S.scl=[M[2].x,M[2].y,M[2].z],S.rot=M[1],w.hierarchy[v].keys.push(S)}t.animation=w}}function m(){if(Tt&&0===Tt.joints.length)return void(At=void 0);var t={},e=function(e,n){var i=n.getAttribute("id"),r=Ot.getChildById(i,!0),o=Tt.joints[e];Bt.traverse(function(n){n.colladaId==i&&(t[e]={node:n,transforms:r.transforms,joint:o,position:o.zeroPosition})})};At={joints:Tt&&Tt.joints,getJointValue:function(e){var n=t[e];return n?n.position:void console.log("getJointValue: joint "+e+" doesn't exist")},setJointValue:function(e,n){var r=t[e];if(r){var a=r.joint;if(n>a.limits.max||n<a.limits.min)console.log("setJointValue: joint "+e+" value "+n+" outside of limits (min: "+a.limits.min+", max: "+a.limits.max+")");else if(a.static)console.log("setJointValue: joint "+e+" is static");else{var s=r.node,u=a.axis,l=r.transforms,c=new o.Matrix4;for(i=0;i<l.length;i++){var h=l[i];if(h.sid&&h.sid.indexOf("joint"+e)!==-1)switch(a.type){case"revolute":c.multiply(f.makeRotationAxis(u,o.Math.degToRad(n)));break;case"prismatic":c.multiply(f.makeTranslation(u.x*n,u.y*n,u.z*n));break;default:console.warn("setJointValue: unknown joint type: "+a.type)}else{var f=new o.Matrix4;switch(h.type){case"matrix":c.multiply(h.obj);break;case"translate":c.multiply(f.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"rotate":c.multiply(f.makeRotationAxis(h.obj,h.angle))}}}var d=c.elements,p=Array.prototype.slice.call(d),g=[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]];s.matrix.set.apply(s.matrix,g),s.matrix.decompose(s.position,s.quaternion,s.scale)}}else console.log("setJointValue: joint "+e+" doesn't exist")}};var n=Ft.querySelector("scene instance_kinematics_scene");if(n)for(var i=0;i<n.childNodes.length;i++){var r=n.childNodes[i];if(1==r.nodeType)switch(r.nodeName){case"bind_joint_axis":var a=r.getAttribute("target").split("/").pop(),s=r.querySelector("axis param").textContent,u=parseInt(s.split("joint").pop().split(".")[0]),l=Ft.querySelector('[sid="'+a+'"]');if(l){var c=l.parentElement;e(u,c)}}}}function y(t,e){var n,i,r,a,s=new o.Object3D,u=!1;for(r=0;r<t.controllers.length;r++){var l=Vt[t.controllers[r].url];switch(l.type){case"skin":if(Xt[l.skin.source]){var c=new D;c.url=l.skin.source,c.instance_material=t.controllers[r].instance_material,t.geometries.push(c),u=!0,n=t.controllers[r]}else if(Vt[l.skin.source]){var f=Vt[l.skin.source];if(i=f,f.morph&&Xt[f.morph.source]){var c=new D;c.url=f.morph.source,c.instance_material=t.controllers[r].instance_material,t.geometries.push(c)}}break;case"morph":if(Xt[l.morph.source]){var c=new D;c.url=l.morph.source,c.instance_material=t.controllers[r].instance_material,t.geometries.push(c),i=t.controllers[r]}console.log("ColladaLoader: Morph-controller partially supported.")}}var d={};for(r=0;r<t.geometries.length;r++){var p,g=t.geometries[r],m=g.instance_material,_=Xt[g.url],b={},x=[],w=0;if(_){if(!_.mesh||!_.mesh.primitives)continue;if(0===s.name.length&&(s.name=_.id),m)for(a=0;a<m.length;a++){var E=m[a],S=Ht[E.target],M=S.instance_effect.url,C=qt[M].shader,I=C.material;if(_.doubleSided){if(!(E.symbol in d)){var O=I.clone();O.side=o.DoubleSide,d[E.symbol]=O}I=d[E.symbol]}I.opacity=I.opacity?I.opacity:1,b[E.symbol]=w,x.push(I),p=I,p.name=null===S.name||""===S.name?S.id:S.name,w++}var T,P=p||new o.MeshLambertMaterial({color:14540253,side:_.doubleSided?o.DoubleSide:o.FrontSide}),A=_.mesh.geometry3js;if(w>1)for(P=new o.MultiMaterial(x),a=0;a<A.faces.length;a++){var L=A.faces[a];L.materialIndex=b[L.daeMaterial]}void 0!==n?(v(A,n),A.morphTargets.length>0?(P.morphTargets=!0,P.skinning=!1):(P.morphTargets=!1,P.skinning=!0),T=new o.SkinnedMesh(A,P,!1),T.name="skin_"+Dt.length,Dt.push(T)):void 0!==i?(h(A,i),P.morphTargets=!0,T=new o.Mesh(A,P),T.name="morph_"+Rt.length,Rt.push(T)):T=A.isLineStrip===!0?new o.Line(A):new o.Mesh(A,P),s.add(T)}}for(r=0;r<t.cameras.length;r++){var N=t.cameras[r],k=Yt[N.url],R=new o.PerspectiveCamera(k.yfov,parseFloat(k.aspect_ratio),parseFloat(k.znear),parseFloat(k.zfar));s.add(R)}for(r=0;r<t.lights.length;r++){var F=null,B=t.lights[r],j=Wt[B.url];if(j&&j.technique){var U=j.color.getHex(),z=j.intensity,G=j.distance,V=j.falloff_angle;switch(j.technique){case"directional":F=new o.DirectionalLight(U,z,G),F.position.set(0,0,1);break;case"point":F=new o.PointLight(U,z,G);break;case"spot":F=new o.SpotLight(U,z,G,V),F.position.set(0,0,1);break;case"ambient":F=new o.AmbientLight(U)}}F&&s.add(F)}if(s.name=t.name||t.id||"",s.colladaId=t.id||"",s.layer=t.layer||"",s.matrix=t.matrix,s.matrix.decompose(s.position,s.quaternion,s.scale),Jt.centerGeometry&&s.geometry){var X=s.geometry.center();X.multiply(s.scale),X.applyQuaternion(s.quaternion),s.position.sub(X)}for(r=0;r<t.nodes.length;r++)s.add(y(t.nodes[r],t));return s}function _(t){for(var e=Ft.querySelectorAll("library_nodes node"),n=0;n<e.length;n++){var i=e[n].attributes.getNamedItem("id");if(i&&i.value===t)return e[n]}}function b(t){var e=[],n=1e6,i=-1e6;for(var r in Gt)for(var o=Gt[r],a=0;a<o.channel.length;a++){var s=o.channel[a],u=o.sampler[a],r=s.target.split("/")[0];r==t.id&&(u.create(),s.sampler=u,n=Math.min(n,u.startTime),i=Math.max(i,u.endTime),e.push(s))}return e.length&&(t.startTime=n,t.endTime=i),e}function x(t){if(t.channels&&t.channels.length){for(var e=[],n=[],i=0,r=t.channels.length;i<r;i++){var o,a=t.channels[i],s=a.fullSid,u=a.sampler,l=u.input,c=t.getTransformBySid(a.sid);if(a.arrIndices){o=[];for(var h=0,f=a.arrIndices.length;h<f;h++)o[h]=Ct(a.arrIndices[h])}else o=It(a.member);if(c){n.indexOf(s)===-1&&n.push(s);for(var h=0,f=l.length;h<f;h++){var d=l[h],p=u.getData(c.type,h,o),g=w(e,d);if(!g){g=new it(d);var v=E(e,d);e.splice(v===-1?e.length:v,0,g)}g.addTarget(s,c,o,p)}}else console.log('Could not find transform "'+a.sid+'" in node '+t.id)}for(var i=0;i<n.length;i++)for(var m=n[i],h=0;h<e.length;h++){var g=e[h];g.hasTarget(m)||S(e,g,h,m)}t.keys=e,t.sids=n}}function w(t,e){for(var n=null,i=0,r=t.length;i<r&&null===n;i++){var o=t[i];if(o.time===e)n=o;else if(o.time>e)break}return n}function E(t,e){for(var n=-1,i=0,r=t.length;i<r&&n===-1;i++){var o=t[i];o.time>=e&&(n=i)}return n}function S(t,e,n,i){var r=C(t,i,n?n-1:0),o=M(t,i,n+1);if(r&&o){var a,s=(e.time-r.time)/(o.time-r.time),u=r.getTarget(i),l=o.getTarget(i).data,c=u.data;if("matrix"===u.type)a=c;else if(c.length){a=[];for(var h=0;h<c.length;++h)a[h]=c[h]+(l[h]-c[h])*s}else a=c+(l-c)*s;e.addTarget(i,u.transform,u.member,a)}}function M(t,e,n){for(;n<t.length;n++){var i=t[n];if(i.hasTarget(e))return i}return null}function C(t,e,n){for(n=n>=0?n:n+t.length;n>=0;n--){var i=t[n];if(i.hasTarget(e))return i}return null}function I(){this.id="",this.init_from=""}function O(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function T(){this.method=null,this.source=null,this.targets=null,this.weights=null}function P(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function A(){this.id="",this.name="",this.nodes=[],this.scene=new o.Group}function L(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new o.Matrix4}function N(){this.sid="",this.type="",this.data=[],this.obj=null}function k(){this.url="",this.skeleton=[],this.instance_material=[]}function R(){this.symbol="",this.target=""}function D(){this.url="",this.instance_material=[]}function F(){this.id="",this.mesh=null}function B(t){this.geometry=t.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function j(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new o.Geometry}function U(){j.call(this),this.vcount=[]}function z(){j.call(this),this.vcount=1}function G(){j.call(this),this.vcount=3}function V(){this.source="",this.count=0,this.stride=0,this.params=[]}function X(){this.input={}}function H(){this.semantic="",this.offset=0,this.source="",this.set=0}function q(t){this.id=t,this.type=null}function Y(){this.id="",this.name="",this.instance_effect=null}function W(){this.color=new o.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function Z(t,e){this.type=t,this.effect=e,this.material=null}function J(t){this.effect=t,this.init_from=null,this.format=null}function K(t){this.effect=t,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function Q(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function $(){this.url=""}function tt(){this.id="",
this.name="",this.source={},this.sampler=[],this.channel=[]}function et(t){this.animation=t,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function nt(t){this.id="",this.animation=t,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function it(t){this.targets=[],this.time=t}function rt(){this.id="",this.name="",this.technique=""}function ot(){this.url=""}function at(){this.id="",this.name="",this.technique=""}function st(){this.url=""}function ut(){this.id="",this.name="",this.joints=[],this.links=[]}function lt(){this.sid="",this.name="",this.axis=new o.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0}function ct(){this.sid="",this.name="",this.transforms=[],this.attachments=[]}function ht(){this.joint="",this.transforms=[],this.links=[]}function ft(t){var e=t.getAttribute("id");return void 0!=Ut[e]?Ut[e]:(Ut[e]=new q(e).parse(t),Ut[e])}function dt(t){for(var e=vt(t),n=[],i=0,r=e.length;i<r;i++)n.push("true"===e[i]||"1"===e[i]);return n}function pt(t){for(var e=vt(t),n=[],i=0,r=e.length;i<r;i++)n.push(parseFloat(e[i]));return n}function gt(t){for(var e=vt(t),n=[],i=0,r=e.length;i<r;i++)n.push(parseInt(e[i],10));return n}function vt(t){return t.length>0?mt(t).split(/\s+/):[]}function mt(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}function yt(t,e,n){return t.hasAttribute(e)?parseInt(t.getAttribute(e),10):n}function _t(t,e){var n=new o.ImageLoader;n.load(e,function(e){t.image=e,t.needsUpdate=!0})}function bt(t,e){t.doubleSided=!1;var n=e.querySelectorAll("extra double_sided")[0];n&&n&&1===parseInt(n.textContent,10)&&(t.doubleSided=!0)}function xt(){if(Jt.convertUpAxis!==!0||Qt===Jt.upAxis)$t=null;else switch(Qt){case"X":$t="Y"===Jt.upAxis?"XtoY":"XtoZ";break;case"Y":$t="X"===Jt.upAxis?"YtoX":"YtoZ";break;case"Z":$t="X"===Jt.upAxis?"ZtoX":"ZtoY"}}function wt(t,e){if(Jt.convertUpAxis===!0&&Qt!==Jt.upAxis)switch($t){case"XtoY":var n=t[0];t[0]=e*t[1],t[1]=n;break;case"XtoZ":var n=t[2];t[2]=t[1],t[1]=t[0],t[0]=n;break;case"YtoX":var n=t[0];t[0]=t[1],t[1]=e*n;break;case"YtoZ":var n=t[1];t[1]=e*t[2],t[2]=n;break;case"ZtoX":var n=t[0];t[0]=t[1],t[1]=t[2],t[2]=n;break;case"ZtoY":var n=t[1];t[1]=t[2],t[2]=e*n}}function Et(t,e){if(Jt.convertUpAxis!==!0||Qt===Jt.upAxis)return e;switch(t){case"X":e="XtoY"===$t?e*-1:e;break;case"Y":e="YtoZ"===$t||"YtoX"===$t?e*-1:e;break;case"Z":e="ZtoY"===$t?e*-1:e}return e}function St(t,e){var n=[t[e],t[e+1],t[e+2]];return wt(n,-1),new o.Vector3(n[0],n[1],n[2])}function Mt(t){if(Jt.convertUpAxis){var e=[t[0],t[4],t[8]];wt(e,-1),t[0]=e[0],t[4]=e[1],t[8]=e[2],e=[t[1],t[5],t[9]],wt(e,-1),t[1]=e[0],t[5]=e[1],t[9]=e[2],e=[t[2],t[6],t[10]],wt(e,-1),t[2]=e[0],t[6]=e[1],t[10]=e[2],e=[t[0],t[1],t[2]],wt(e,-1),t[0]=e[0],t[1]=e[1],t[2]=e[2],e=[t[4],t[5],t[6]],wt(e,-1),t[4]=e[0],t[5]=e[1],t[6]=e[2],e=[t[8],t[9],t[10]],wt(e,-1),t[8]=e[0],t[9]=e[1],t[10]=e[2],e=[t[3],t[7],t[11]],wt(e,-1),t[3]=e[0],t[7]=e[1],t[11]=e[2]}return(new o.Matrix4).set(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Ct(t){if(t>-1&&t<3){var e=["X","Y","Z"],n={X:0,Y:1,Z:2};t=It(e[t]),t=n[t]}return t}function It(t){if(Jt.convertUpAxis)switch(t){case"X":switch($t){case"XtoY":case"XtoZ":case"YtoX":t="Y";break;case"ZtoX":t="Z"}break;case"Y":switch($t){case"XtoY":case"YtoX":case"ZtoX":t="X";break;case"XtoZ":case"YtoZ":case"ZtoY":t="Z"}break;case"Z":switch($t){case"XtoZ":t="X";break;case"YtoZ":case"ZtoX":case"ZtoY":t="Y"}}return t}var Ot,Tt,Pt,At,Lt,Nt,kt,Rt,Dt,Ft=null,Bt=null,jt=null,Ut={},zt={},Gt={},Vt={},Xt={},Ht={},qt={},Yt={},Wt={},Zt=o.SmoothShading,Jt={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Kt=1,Qt="Y",$t=null;return I.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];"init_from"===n.nodeName&&(this.init_from=n.textContent)}return this},O.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.type="none";for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"skin":this.skin=(new P).parse(n),this.type=n.nodeName;break;case"morph":this.morph=(new T).parse(n),this.type=n.nodeName}}return this},T.prototype.parse=function(t){var e,n={},i=[];for(this.method=t.getAttribute("method"),this.source=t.getAttribute("source").replace(/^#/,""),e=0;e<t.childNodes.length;e++){var r=t.childNodes[e];if(1==r.nodeType)switch(r.nodeName){case"source":var o=(new q).parse(r);n[o.id]=o;break;case"targets":i=this.parseInputs(r);break;default:console.log(r.nodeName)}}for(e=0;e<i.length;e++){var a=i[e],o=n[a.source];switch(a.semantic){case"MORPH_TARGET":this.targets=o.read();break;case"MORPH_WEIGHT":this.weights=o.read()}}return this},T.prototype.parseInputs=function(t){for(var e=[],n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1==i.nodeType)switch(i.nodeName){case"input":e.push((new H).parse(i))}}return e},P.prototype.parse=function(t){var e,n,i={};this.source=t.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<t.childNodes.length;r++){var o=t.childNodes[r];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var a=pt(o.textContent);this.bindShapeMatrix=Mt(a);break;case"source":var s=(new q).parse(o);i[s.id]=s;break;case"joints":e=o;break;case"vertex_weights":n=o;break;default:console.log(o.nodeName)}}return this.parseJoints(e,i),this.parseWeights(n,i),this},P.prototype.parseJoints=function(t,e){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1==i.nodeType)switch(i.nodeName){case"input":var r=(new H).parse(i),o=e[r.source];"JOINT"===r.semantic?this.joints=o.read():"INV_BIND_MATRIX"===r.semantic&&(this.invBindMatrices=o.read())}}},P.prototype.parseWeights=function(t,e){for(var n,i,r=[],o=0;o<t.childNodes.length;o++){var a=t.childNodes[o];if(1==a.nodeType)switch(a.nodeName){case"input":r.push((new H).parse(a));break;case"v":n=gt(a.textContent);break;case"vcount":i=gt(a.textContent)}}for(var s=0,o=0;o<i.length;o++){for(var u=i[o],l=[],c=0;c<u;c++){for(var h={},f=0;f<r.length;f++){var d=r[f],p=n[s+d.offset];switch(d.semantic){case"JOINT":h.joint=p;break;case"WEIGHT":h.weight=e[d.source].data[p]}}l.push(h),s+=r.length}for(var c=0;c<l.length;c++)l[c].index=o;this.weights.push(l)}},A.prototype.getChildById=function(t,e){for(var n=0;n<this.nodes.length;n++){var i=this.nodes[n].getChildById(t,e);if(i)return i}return null},A.prototype.getChildBySid=function(t,e){for(var n=0;n<this.nodes.length;n++){var i=this.nodes[n].getChildBySid(t,e);if(i)return i}return null},A.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.nodes=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"node":this.nodes.push((new L).parse(n))}}return this},L.prototype.getChannelForTransform=function(t){for(var e=0;e<this.channels.length;e++){var n,i,r=this.channels[e],o=r.target.split("/"),a=(o.shift(),o.shift()),s=a.indexOf(".")>=0,u=a.indexOf("(")>=0;if(s)o=a.split("."),a=o.shift(),i=o.shift();else if(u){n=a.split("("),a=n.shift();for(var l=0;l<n.length;l++)n[l]=parseInt(n[l].replace(/\)/,""))}if(a===t)return r.info={sid:a,dotSyntax:s,arrSyntax:u,arrIndices:n},r}return null},L.prototype.getChildById=function(t,e){if(this.id===t)return this;if(e)for(var n=0;n<this.nodes.length;n++){var i=this.nodes[n].getChildById(t,e);if(i)return i}return null},L.prototype.getChildBySid=function(t,e){if(this.sid===t)return this;if(e)for(var n=0;n<this.nodes.length;n++){var i=this.nodes[n].getChildBySid(t,e);if(i)return i}return null},L.prototype.getTransformBySid=function(t){for(var e=0;e<this.transforms.length;e++)if(this.transforms[e].sid===t)return this.transforms[e];return null},L.prototype.parse=function(t){var e;this.id=t.getAttribute("id"),this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.type=t.getAttribute("type"),this.layer=t.getAttribute("layer"),this.type="JOINT"===this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new o.Matrix4;for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new L).parse(i));break;case"instance_camera":this.cameras.push((new ot).parse(i));break;case"instance_controller":this.controllers.push((new k).parse(i));break;case"instance_geometry":this.geometries.push((new D).parse(i));break;case"instance_light":this.lights.push((new st).parse(i));break;case"instance_node":e=i.getAttribute("url").replace(/^#/,"");var r=_(e);r&&this.nodes.push((new L).parse(r));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new N).parse(i));break;case"extra":break;default:console.log(i.nodeName)}}return this.channels=b(this),x(this),this.updateMatrix(),this},L.prototype.updateMatrix=function(){this.matrix.identity();for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(this.matrix)},N.prototype.parse=function(t){return this.sid=t.getAttribute("sid"),this.type=t.nodeName,this.data=pt(t.textContent),this.convert(),this},N.prototype.convert=function(){switch(this.type){case"matrix":this.obj=Mt(this.data);break;case"rotate":this.angle=o.Math.degToRad(this.data[3]);case"translate":wt(this.data,-1),this.obj=new o.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":wt(this.data,1),this.obj=new o.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},N.prototype.apply=function(){var t=new o.Matrix4;return function(e){switch(this.type){case"matrix":e.multiply(this.obj);break;case"translate":e.multiply(t.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":e.multiply(t.makeRotationAxis(this.obj,this.angle));break;case"scale":e.scale(this.obj)}}}(),N.prototype.update=function(t,e){var n=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(e)if(1===e.length)switch(e[0]){case 0:this.obj.n11=t[0],this.obj.n21=t[1],this.obj.n31=t[2],this.obj.n41=t[3];break;case 1:this.obj.n12=t[0],this.obj.n22=t[1],this.obj.n32=t[2],this.obj.n42=t[3];break;case 2:this.obj.n13=t[0],this.obj.n23=t[1],this.obj.n33=t[2],this.obj.n43=t[3];break;case 3:this.obj.n14=t[0],this.obj.n24=t[1],this.obj.n34=t[2],this.obj.n44=t[3]}else if(2===e.length){var i="n"+(e[0]+1)+(e[1]+1);this.obj[i]=t}else console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(t);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=n[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(e)&&(e=n[e[0]]),e){case"X":this.obj.x=t;break;case"Y":this.obj.y=t;break;case"Z":this.obj.z=t;break;case"ANGLE":this.angle=o.Math.degToRad(t);break;default:this.obj.x=t[0],this.obj.y=t[1],this.obj.z=t[2],this.angle=o.Math.degToRad(t[3])}}},k.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1===n.nodeType)switch(n.nodeName){case"skeleton":this.skeleton.push(n.textContent.replace(/^#/,""));break;case"bind_material":for(var i=n.querySelectorAll("instance_material"),r=0;r<i.length;r++){var o=i[r];this.instance_material.push((new R).parse(o))}break;case"extra":}}return this},R.prototype.parse=function(t){return this.symbol=t.getAttribute("symbol"),this.target=t.getAttribute("target").replace(/^#/,""),this},D.prototype.parse=function(t){this.url=t.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType&&"bind_material"===n.nodeName){for(var i=n.querySelectorAll("instance_material"),r=0;r<i.length;r++){var o=i[r];this.instance_material.push((new R).parse(o))}break}}return this},F.prototype.parse=function(t){this.id=t.getAttribute("id"),bt(this,t);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"mesh":this.mesh=new B(this).parse(n);break;case"extra":}}return this},B.prototype.parse=function(t){this.primitives=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"source":ft(n);break;case"vertices":this.vertices=(new X).parse(n);break;case"linestrips":this.primitives.push((new z).parse(n));break;case"triangles":this.primitives.push((new G).parse(n));break;case"polygons":this.primitives.push((new j).parse(n));break;case"polylist":this.primitives.push((new U).parse(n))}}if(this.geometry3js=new o.Geometry,null===this.vertices)return this;for(var i=Ut[this.vertices.input.POSITION.source].data,e=0;e<i.length;e+=3)this.geometry3js.vertices.push(St(i,e).clone());for(var e=0;e<this.primitives.length;e++){var r=this.primitives[e];r.setVertices(this.vertices),this.handlePrimitive(r,this.geometry3js)}return this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},B.prototype.handlePrimitive=function(t,e){if(t instanceof z)return void(e.isLineStrip=!0);var n,i,r,a,s,u,l,c=t.p,h=t.inputs,f=0,d=3,p=0,g=[];for(n=0;n<h.length;n++){r=h[n];var v=r.offset+1;switch(p=p<v?v:p,r.semantic){case"TEXCOORD":g.push(r.set)}}for(var m=0;m<c.length;++m)for(var y=c[m],_=0;_<y.length;){var b=[],x=[],w=null,E=[];for(d=t.vcount?t.vcount.length?t.vcount[f++]:t.vcount:y.length/p,n=0;n<d;n++)for(i=0;i<h.length;i++)switch(r=h[i],u=Ut[r.source],a=y[_+n*p+r.offset],l=u.accessor.params.length,s=a*l,r.semantic){case"VERTEX":b.push(a);break;case"NORMAL":x.push(St(u.data,s));break;case"TEXCOORD":w=w||{},void 0===w[r.set]&&(w[r.set]=[]),w[r.set].push(new o.Vector2(u.data[s],u.data[s+1]));break;case"COLOR":E.push((new o.Color).setRGB(u.data[s],u.data[s+1],u.data[s+2]))}if(0===x.length)if(r=this.vertices.input.NORMAL){u=Ut[r.source],l=u.accessor.params.length;for(var S=0,M=b.length;S<M;S++)x.push(St(u.data,b[S]*l))}else e.calcNormals=!0;if(!w&&(w={},r=this.vertices.input.TEXCOORD)){g.push(r.set),u=Ut[r.source],l=u.accessor.params.length;for(var S=0,M=b.length;S<M;S++)s=b[S]*l,void 0===w[r.set]&&(w[r.set]=[]),w[r.set].push(new o.Vector2(u.data[s],1-u.data[s+1]))}if(0===E.length&&(r=this.vertices.input.COLOR)){u=Ut[r.source],l=u.accessor.params.length;for(var S=0,M=b.length;S<M;S++)s=b[S]*l,E.push((new o.Color).setRGB(u.data[s],u.data[s+1],u.data[s+2]))}var C,I,O=null,T=[];if(3===d)T.push(new o.Face3(b[0],b[1],b[2],x,E.length?E:new o.Color));else if(4===d)T.push(new o.Face3(b[0],b[1],b[3],x.length?[x[0].clone(),x[1].clone(),x[3].clone()]:[],E.length?[E[0],E[1],E[3]]:new o.Color)),T.push(new o.Face3(b[1],b[2],b[3],x.length?[x[1].clone(),x[2].clone(),x[3].clone()]:[],E.length?[E[1],E[2],E[3]]:new o.Color));else if(d>4&&Jt.subdivideFaces){var P=E.length?E:new o.Color;for(i=1;i<d-1;)T.push(new o.Face3(b[0],b[i],b[i+1],x.length?[x[0].clone(),x[i++].clone(),x[i].clone()]:[],P))}if(T.length)for(var S=0,M=T.length;S<M;S++)for(O=T[S],O.daeMaterial=t.material,e.faces.push(O),i=0;i<g.length;i++)C=w[g[i]],I=d>4?[C[0],C[S+1],C[S+2]]:4===d?0===S?[C[0],C[1],C[3]]:[C[1].clone(),C[2],C[3].clone()]:[C[0],C[1],C[2]],void 0===e.faceVertexUvs[i]&&(e.faceVertexUvs[i]=[]),e.faceVertexUvs[i].push(I);else console.log("dropped face with vcount "+d+" for geometry with id: "+e.id);_+=p*d}},j.prototype.setVertices=function(t){for(var e=0;e<this.inputs.length;e++)this.inputs[e].source===t.id&&(this.inputs[e].source=t.input.POSITION.source)},j.prototype.parse=function(t){this.material=t.getAttribute("material"),this.count=yt(t,"count",0);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"input":this.inputs.push((new H).parse(t.childNodes[e]));break;case"vcount":this.vcount=gt(n.textContent);break;case"p":this.p.push(gt(n.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},U.prototype=Object.create(j.prototype),U.prototype.constructor=U,z.prototype=Object.create(j.prototype),z.prototype.constructor=z,G.prototype=Object.create(j.prototype),G.prototype.constructor=G,V.prototype.parse=function(t){this.params=[],this.source=t.getAttribute("source"),this.count=yt(t,"count",0),this.stride=yt(t,"stride",0);for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if("param"===n.nodeName){var i={};i.name=n.getAttribute("name"),i.type=n.getAttribute("type"),this.params.push(i)}}return this},X.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++)if("input"===t.childNodes[e].nodeName){var n=(new H).parse(t.childNodes[e]);this.input[n.semantic]=n}return this},H.prototype.parse=function(t){return this.semantic=t.getAttribute("semantic"),this.source=t.getAttribute("source").replace(/^#/,""),this.set=yt(t,"set",-1),this.offset=yt(t,"offset",0),"TEXCOORD"===this.semantic&&this.set<0&&(this.set=0),this},q.prototype.parse=function(t){this.id=t.getAttribute("id");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"bool_array":this.data=dt(n.textContent),this.type=n.nodeName;break;case"float_array":this.data=pt(n.textContent),this.type=n.nodeName;break;case"int_array":this.data=gt(n.textContent),this.type=n.nodeName;break;case"IDREF_array":case"Name_array":this.data=vt(n.textContent),this.type=n.nodeName;break;case"technique_common":for(var i=0;i<n.childNodes.length;i++)if("accessor"===n.childNodes[i].nodeName){this.accessor=(new V).parse(n.childNodes[i]);break}}}return this},q.prototype.read=function(){var t=[],e=this.accessor.params[0];switch(e.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var n=0;n<this.data.length;n+=16){var i=this.data.slice(n,n+16),r=Mt(i);t.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+e.type+".")}return t},Y.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++)if("instance_effect"===t.childNodes[e].nodeName){this.instance_effect=(new $).parse(t.childNodes[e]);break}return this},W.prototype.isColor=function(){return null===this.texture},W.prototype.isTexture=function(){return null!=this.texture},W.prototype.parse=function(t){"transparent"===t.nodeName&&(this.opaque=t.getAttribute("opaque"));for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"color":var i=pt(n.textContent);this.color=new o.Color,this.color.setRGB(i[0],i[1],i[2]),this.color.a=i[3];break;case"texture":this.texture=n.getAttribute("texture"),this.texcoord=n.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(n)}}return this},W.prototype.parseTexture=function(t){if(!t.childNodes)return this;t.childNodes[1]&&"extra"===t.childNodes[1].nodeName&&(t=t.childNodes[1],t.childNodes[1]&&"technique"===t.childNodes[1].nodeName&&(t=t.childNodes[1]));for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?this.texOpts[n.nodeName]=1:this.texOpts[n.nodeName]=parseInt(n.textContent);break;default:this.texOpts[n.nodeName]=n.textContent}}return this},Z.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"transparent":this[n.nodeName]=(new W).parse(n);break;case"bump":var i=n.getAttribute("bumptype");i?"heightfield"===i.toLowerCase()?this.bump=(new W).parse(n):"normalmap"===i.toLowerCase()?this.normal=(new W).parse(n):(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+i+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new W).parse(n)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new W).parse(n));break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var r=n.querySelectorAll("float");r.length>0&&(this[n.nodeName]=parseFloat(r[0].textContent))}}return this.create(),this},Z.prototype.create=function(){var t={},e=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var n=(this.transparent,(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency);n>0&&(e=!0,t.transparent=!0,t.opacity=1-n)}var i={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"};for(var r in this)switch(r){case"ambient":case"emission":case"diffuse":case"specular":case"bump":case"normal":var a=this[r];if(a instanceof W)if(a.isTexture()){var s=a.texture,u=this.effect.sampler[s];if(void 0!==u&&void 0!==u.source){var l=this.effect.surface[u.source];if(void 0!==l){var c=zt[l.init_from];if(c){var h,f=kt+c.init_from,d=o.Loader.Handlers.get(f);null!==d?h=d.load(f):(h=new o.Texture,_t(h,f)),h.wrapS=a.texOpts.wrapU?o.RepeatWrapping:o.ClampToEdgeWrapping,h.wrapT=a.texOpts.wrapV?o.RepeatWrapping:o.ClampToEdgeWrapping,h.offset.x=a.texOpts.offsetU,h.offset.y=a.texOpts.offsetV,h.repeat.x=a.texOpts.repeatU,h.repeat.y=a.texOpts.repeatV,t[i[r]]=h,"emission"===r&&(t.emissive=16777215)}}}}else"diffuse"!==r&&e||("emission"===r?t.emissive=a.color.getHex():t[r]=a.color.getHex());break;case"shininess":t[r]=this[r];break;case"reflectivity":t[r]=this[r],t[r]>0&&(t.envMap=Jt.defaultEnvMap),t.combine=o.MixOperation;break;case"index_of_refraction":t.refractionRatio=this[r],1!==this[r]&&(t.envMap=Jt.defaultEnvMap);break;case"transparency":}switch(t.shading=Zt,t.side=this.effect.doubleSided?o.DoubleSide:o.FrontSide,void 0!==t.diffuse&&(t.color=t.diffuse,delete t.diffuse),this.type){case"constant":void 0!=t.emissive&&(t.color=t.emissive),this.material=new o.MeshBasicMaterial(t);break;case"phong":case"blinn":this.material=new o.MeshBasicMaterial(t);break;case"lambert":default:this.material=new o.MeshLambertMaterial(t)}return this.material},J.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"init_from":this.init_from=n.textContent;break;case"format":this.format=n.textContent;break;default:console.log("unhandled Surface prop: "+n.nodeName)}}return this},K.prototype.parse=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"source":this.source=n.textContent;break;case"minfilter":this.minfilter=n.textContent;break;case"magfilter":this.magfilter=n.textContent;break;case"mipfilter":this.mipfilter=n.textContent;break;case"wrap_s":this.wrap_s=n.textContent;break;case"wrap_t":this.wrap_t=n.textContent;break;default:console.log("unhandled Sampler2D prop: "+n.nodeName)}}return this},Q.prototype.create=function(){if(null===this.shader)return null},Q.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),bt(this,t),this.shader=null;for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(n))}}return this},Q.prototype.parseNewparam=function(t){for(var e=t.getAttribute("sid"),n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1==i.nodeType)switch(i.nodeName){case"surface":this.surface[e]=new J(this).parse(i);break;case"sampler2D":this.sampler[e]=new K(this).parse(i);break;case"extra":break;default:console.log(i.nodeName)}}},Q.prototype.parseProfileCOMMON=function(t){for(var e,n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseProfileCOMMON(i);break;case"technique":e=i;break;case"newparam":this.parseNewparam(i);break;case"image":var r=(new I).parse(i);zt[r.id]=r;break;case"extra":break;default:console.log(i.nodeName)}}return e},Q.prototype.parseTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new Z(n.nodeName,this).parse(n);break;case"extra":this.parseExtra(n)}}},Q.prototype.parseExtra=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique":this.parseExtraTechnique(n)}}},Q.prototype.parseExtraTechnique=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"bump":this.shader.parse(t)}}},$.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},tt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.source={};for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"animation":var i=(new tt).parse(n);for(var r in i.source)this.source[r]=i.source[r];for(var o=0;o<i.channel.length;o++)this.channel.push(i.channel[o]),this.sampler.push(i.sampler[o]);break;case"source":var r=(new q).parse(n);this.source[r.id]=r;break;case"sampler":this.sampler.push(new nt(this).parse(n));break;case"channel":this.channel.push(new et(this).parse(n))}}return this},et.prototype.parse=function(t){this.source=t.getAttribute("source").replace(/^#/,""),this.target=t.getAttribute("target");var e=this.target.split("/"),n=(e.shift(),e.shift()),i=n.indexOf(".")>=0,r=n.indexOf("(")>=0;if(i)e=n.split("."),this.sid=e.shift(),this.member=e.shift();else if(r){var o=n.split("(");this.sid=o.shift();for(var a=0;a<o.length;a++)o[a]=parseInt(o[a].replace(/\)/,""));this.arrIndices=o}else this.sid=n;return this.fullSid=n,this.dotSyntax=i,this.arrSyntax=r,this},nt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.inputs=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"input":this.inputs.push((new H).parse(n))}}return this},nt.prototype.create=function(){for(var t=0;t<this.inputs.length;t++){var e=this.inputs[t],n=this.animation.source[e.source];switch(e.semantic){case"INPUT":this.input=n.read();break;case"OUTPUT":this.output=n.read(),this.strideOut=n.accessor.stride;break;case"INTERPOLATION":this.interpolation=n.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(e.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var t=0;t<this.input.length;t++)this.startTime=Math.min(this.startTime,this.input[t]),this.endTime=Math.max(this.endTime,this.input[t]);this.duration=this.endTime-this.startTime}},nt.prototype.getData=function(t,e,n){var i;if("matrix"===t&&16===this.strideOut)i=this.output[e];else if(this.strideOut>1){i=[],e*=this.strideOut;for(var r=0;r<this.strideOut;++r)i[r]=this.output[e+r];if(3===this.strideOut)switch(t){case"rotate":case"translate":wt(i,-1);break;case"scale":wt(i,1)}else 4===this.strideOut&&"matrix"===t&&wt(i,-1)}else i=this.output[e],n&&"translate"===t&&(i=Et(n,i));return i},it.prototype.addTarget=function(t,e,n,i){this.targets.push({sid:t,member:n,transform:e,data:i})},it.prototype.apply=function(t){for(var e=0;e<this.targets.length;++e){var n=this.targets[e];t&&n.sid!==t||n.transform.update(n.data,n.member)}},it.prototype.getTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return this.targets[e];return null},it.prototype.hasTarget=function(t){for(var e=0;e<this.targets.length;++e)if(this.targets[e].sid===t)return!0;return!1},it.prototype.interpolate=function(t,e){for(var n=0,i=this.targets.length;n<i;n++){var r,o=this.targets[n],a=t.getTarget(o.sid);if("matrix"!==o.transform.type&&a){var s=(e-this.time)/(t.time-this.time),u=a.data,l=o.data;if(s<0&&(s=0),s>1&&(s=1),l.length){r=[];for(var c=0;c<l.length;++c)r[c]=l[c]+(u[c]-l[c])*s}else r=l+(u-l)*s}else r=o.data;o.transform.update(r,o.member)}},rt.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"optics":this.parseOptics(n)}}return this},rt.prototype.parseOptics=function(t){for(var e=0;e<t.childNodes.length;e++)if("technique_common"===t.childNodes[e].nodeName)for(var n=t.childNodes[e],i=0;i<n.childNodes.length;i++)if(this.technique=n.childNodes[i].nodeName,"perspective"===this.technique)for(var r=n.childNodes[i],o=0;o<r.childNodes.length;o++){var a=r.childNodes[o];switch(a.nodeName){case"yfov":this.yfov=a.textContent;break;case"xfov":this.xfov=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}else if("orthographic"===this.technique)for(var s=n.childNodes[i],o=0;o<s.childNodes.length;o++){var a=s.childNodes[o];switch(a.nodeName){case"xmag":this.xmag=a.textContent;break;case"ymag":this.ymag=a.textContent;break;case"znear":this.znear=a.textContent;break;case"zfar":this.zfar=a.textContent;break;case"aspect_ratio":this.aspect_ratio=a.textContent}}return this},ot.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},at.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique_common":this.parseCommon(n);break;case"technique":this.parseTechnique(n)}}return this},at.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++)switch(t.childNodes[e].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=t.childNodes[e].nodeName;for(var n=t.childNodes[e],i=0;i<n.childNodes.length;i++){var r=n.childNodes[i];switch(r.nodeName){case"color":var a=pt(r.textContent);this.color=new o.Color(0),this.color.setRGB(a[0],a[1],a[2]),this.color.a=a[3];break;case"falloff_angle":this.falloff_angle=parseFloat(r.textContent);break;case"quadratic_attenuation":var s=parseFloat(r.textContent);this.distance=s?Math.sqrt(1/s):0}}}return this},at.prototype.parseTechnique=function(t){this.profile=t.getAttribute("profile");for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];switch(n.nodeName){case"intensity":this.intensity=parseFloat(n.textContent)}}return this},st.prototype.parse=function(t){return this.url=t.getAttribute("url").replace(/^#/,""),this},ut.prototype.parse=function(t){this.id=t.getAttribute("id"),this.name=t.getAttribute("name"),this.joints=[],this.links=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"technique_common":this.parseCommon(n)}}return this},ut.prototype.parseCommon=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(t.childNodes[e].nodeName){case"joint":this.joints.push((new lt).parse(n));break;case"link":this.links.push((new ct).parse(n))}}return this},lt.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.axis=new o.Vector3,this.limits={min:0,max:0},this.type="",this.static=!1,this.zeroPosition=0,this.middlePosition=0;var e=t.querySelector("axis"),n=pt(e.textContent);this.axis=St(n,0);var i=t.querySelector("limits min")?parseFloat(t.querySelector("limits min").textContent):-360,r=t.querySelector("limits max")?parseFloat(t.querySelector("limits max").textContent):360;this.limits={min:i,max:r};for(var a=["prismatic","revolute"],s=0;s<a.length;s++){var u=a[s],l=t.querySelector(u);l&&(this.type=u)}return this.limits.min>=this.limits.max&&(this.static=!0),
this.middlePosition=(this.limits.min+this.limits.max)/2,this},ct.prototype.parse=function(t){this.sid=t.getAttribute("sid"),this.name=t.getAttribute("name"),this.transforms=[],this.attachments=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"attachment_full":this.attachments.push((new ht).parse(n));break;case"rotate":case"translate":case"matrix":this.transforms.push((new N).parse(n))}}return this},ht.prototype.parse=function(t){this.joint=t.getAttribute("joint").split("/").pop(),this.links=[];for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];if(1==n.nodeType)switch(n.nodeName){case"link":this.links.push((new ct).parse(n));break;case"rotate":case"translate":case"matrix":this.transforms.push((new N).parse(n))}}return this},{load:t,parse:e,setPreferredShading:n,applySkin:v,geometries:Xt,options:Jt}}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i,r){n(this,t),this._center=e,this._radius=i,this._height=r}return i(t,[{key:"containsPoint",value:function(t){var e=t.clone();return e.sub(this._center).setZ(0).length()<this._radius&&Math.abs(t.z-this._center.z)<this._height}},{key:"clone",value:function(){return new this.constructor(this._center,this._radius,this._height)}},{key:"scaleRadius",value:function(t){this._radius*=t}}]),t}(),o=function(){function t(e,i,r){n(this,t),this._center=e,this._a=i,this._b=r}return i(t,[{key:"containsPoint",value:function(t){var e=t.clone();return(e.x-this._center.x)*(e.x-this._center.x)/this._a/this._a+(e.y-this._center.y)*(e.y-this._center.y)/this._b/this._b<1}},{key:"clone",value:function(){return new this.constructor(this._center,this._a,this._b)}},{key:"scaleRadius",value:function(t){this._a*=t,this._b*=t}}]),t}();e.EllipticCylinder=o,e.Cylinder=r},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var r=n(1),o=n(2),a=i(o);!function(){function t(){this.position=new a.Vector3,this.normal=new a.Vector3,this.uv=new a.Vector2,this.skinIndices=new a.Vector4(0,0,0,0),this.skinWeights=new a.Vector4(0,0,0,0)}function e(){this.vertices=[]}function n(){this.triangles=[],this.materialIndex=0}function i(){this.faces=[],this.skeleton=null}function o(){}function s(){}function u(t){for(var e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0,i=function(e){var i=t[e-1];return t=t.slice(n+e),n++,i},r=0;r<e.length;++r){var o=i(1);if(o==e[r])return!1}return!0}function l(t){var e=/FBXVersion: (\d+)/,n=t.match(e);if(n){var i=parseInt(n[1]);return i}throw new Error("FBXLoader: Cannot find the version number for the file given.")}function c(t){return t/46186158e3}function h(t){return t.split(",").map(function(t){return parseFloat(t)})}function f(t){return t.split(",").map(function(t){return parseInt(t)})}function d(t){return(new a.Matrix4).fromArray(h(t))}function p(t){return t*Math.PI/180}a.FBXLoader=function(t){a.Loader.call(this),this.manager=void 0!==t?t:a.DefaultLoadingManager,this.fileLoader=new a.FileLoader(this.manager),this.textureLoader=new a.TextureLoader(this.manager)},r(a.FBXLoader.prototype,a.Loader.prototype),a.FBXLoader.prototype.constructor=a.FBXLoader,r(a.FBXLoader.prototype,{load:function(t,e,n,i){var r=this,o=t.split(/[\\\/]/);o.pop(),o=o.join("/"),this.fileLoader.load(t,function(n){if(!u(n))return console.error("FBXLoader: FBX Binary format not supported."),void r.manager.itemError(t);if(l(n)<7e3)return console.error("FBXLoader: FBX version not supported for file at "+t+", FileVersion: "+l(n)),void r.manager.itemError(t);var i=r.parse(n,o);e(i)},n,i)},parse:function(e,r){function s(t){var e=new Map;if("Connections"in t){var n=t.Connections.properties.connections;n.forEach(function(t){e.has(t[0])||e.set(t[0],{parents:[],children:[]});var n={ID:t[1],relationship:t[2]};e.get(t[0]).parents.push(n),e.has(t[1])||e.set(t[1],{parents:[],children:[]});var i={ID:t[0],relationship:t[2]};e.get(t[1]).children.push(i)})}return e}function u(t){function e(t){var e=t.id,n=t.name,i=t.properties.FileName,o=i.split(/[\\\/]/);if(o.length>0)var a=o[o.length-1];else var a=i;var s=w.textureLoader.load(r+"/"+a);return s.name=n,s.FBX_ID=e,s}var n=new Map;if("Texture"in t.Objects.subNodes){var i=t.Objects.subNodes.Texture;for(var o in i){var a=e(i[o]);n.set(parseInt(o),a)}}return n}function l(t,e,n){function i(t,e,n){function i(t,e,n){var i={};return t.Diffuse&&(i.color=x(t.Diffuse)),t.Specular&&(i.specular=x(t.Specular)),t.Shininess&&(i.shininess=t.Shininess.value),t.Emissive&&(i.emissive=x(t.Emissive)),t.EmissiveFactor&&(i.emissiveIntensity=t.EmissiveFactor.value),t.Opacity&&(i.opacity=t.Opacity.value),i.opacity<1&&(i.transparent=!0),n.forEach(function(t){var n=t.relationship;switch(n){case' "AmbientColor':break;case' "DiffuseColor':i.map=e.get(t.ID);break;default:console.warn("Unknown texture application of type "+n+", skipping texture")}}),i}var r,o=t.id,s=t.attrName,u=t.properties.ShadingModel,l=n.get(o).children,c=i(t.properties,e,l);switch(u){case"phong":r=new a.MeshPhongMaterial;break;case"lambert":r=new a.MeshLambertMaterial;break;default:console.warn("No implementation given for material type "+u+" in FBXLoader.js.  Defaulting to basic material"),r=new a.MeshBasicMaterial({color:3342591})}return r.setValues(c),r.name=s,r}var r=new Map;if("Material"in t.Objects.subNodes){var o=t.Objects.subNodes.Material;for(var s in o){var u=i(o[s],e,n);r.set(parseInt(s),u)}}return r}function g(t,e){function n(t,e){var n=new Map,i=[];return t.children.forEach(function(t){var r=e[t.ID],o={FBX_ID:t.ID,indices:f(r.subNodes.Indexes.properties.a),weights:h(r.subNodes.Weights.properties.a),transform:d(r.subNodes.Transform.properties.a),transformLink:d(r.subNodes.TransformLink.properties.a),linkMode:r.properties.Mode};n.set(t.ID,o),i.push(o)}),{map:n,array:i,bones:[]}}var i=new Map;if("Deformer"in t.Objects.subNodes){var r=t.Objects.subNodes.Deformer;for(var o in r){var a=r[o];if("Skin"===a.attrType){var s=e.get(parseInt(o)),u=n(s,r);u.FBX_ID=parseInt(o),i.set(parseInt(o),u)}}}return i}function v(e,r,o){function s(e,r,o){function s(e,r,o){function s(e,r){function o(t){var e=t.subNodes.LayerElementNormal[0],n=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType,r=h(e.subNodes.Normals.properties.a),o=[];return"IndexToDirect"===i&&(o=f(e.subNodes.NormalIndex.properties.a)),{dataSize:3,buffer:r,indices:o,mappingType:n,referenceType:i}}function s(t){var e=t.subNodes.LayerElementUV[0],n=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType,r=h(e.subNodes.UV.properties.a),o=[];return"IndexToDirect"===i&&(o=f(e.subNodes.UVIndex.properties.a)),{dataSize:2,buffer:r,indices:o,mappingType:n,referenceType:i}}function u(t){var e=t.subNodes.LayerElementMaterial[0],n=e.properties.MappingInformationType,i=e.properties.ReferenceInformationType,r=f(e.subNodes.Materials.properties.a),o=[];return r.forEach(function(t,e){o.push(e)}),{dataSize:1,buffer:r,indices:o,mappingType:n,referenceType:i}}function l(t,e,n,i){var r={ByPolygonVertex:{Direct:function(t,e,n,i){return i.buffer.slice(t*i.dataSize,t*i.dataSize+i.dataSize)},IndexToDirect:function(t,e,n,i){var r=i.indices[t];return i.buffer.slice(r*i.dataSize,r*i.dataSize+i.dataSize)}},ByPolygon:{Direct:function(t,e,n,i){return i.buffer.slice(e*i.dataSize,e*i.dataSize+i.dataSize)},IndexToDirect:function(t,e,n,i){var r=i.indices[e];return i.buffer.slice(r*i.dataSize,r*i.dataSize+i.dataSize)}},AllSame:{IndexToDirect:function(t,e,n,i){return i.buffer.slice(i.indices[0]*i.dataSize,i.indices[0]*i.dataSize+i.dataSize)}}};return r[i.mappingType][i.referenceType](t,e,n,i)}var c=new i,d=h(e.subNodes.Vertices.properties.a),p=f(e.subNodes.PolygonVertexIndex.properties.a);if("LayerElementNormal"in e.subNodes)var g=o(e);if("LayerElementUV"in e.subNodes)var v=s(e);if("LayerElementMaterial"in e.subNodes)var m=u(e);for(var y=[],_=0,b=0;b<p.length;++b){var x,w=p[b];p[b]<0&&(w^=-1,p[b]=w,x=!0);var E=new t,S=[],M=[];if(E.position.fromArray(d,3*w),r){for(var C=0;C<r.array.length;++C){var I=r.array[C].indices.findIndex(function(t){return t===p[b]});I!==-1&&(M.push(r.array[C].weights[I]),S.push(C))}if(M.length>4){console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex.  Deleting additional weights.");for(var O=[0,0,0,0],T=[0,0,0,0],b=0;b<M.length;++b)for(var P=M[b],A=S[b],C=0;C<T.length;++C)if(P>T[C]){var L=T[C];T[C]=P,P=L,L=O[C],O[C]=A,A=L}S=O,M=T}for(var N=M.length;N<4;N++)M[N]=0,S[N]=0;E.skinWeights.fromArray(M),E.skinIndices.fromArray(S)}if(g&&E.normal.fromArray(l(b,_,w,g)),v&&E.uv.fromArray(l(b,_,w,v)),y.push(E),x){var k=new n,R=l(b,_,w,m);k.genTrianglesFromVertices(y),k.materialIndex=R[0],c.faces.push(k),y=[],_++,x=!1}}var D=c.flattenToBuffers(),F=new a.BufferGeometry;F.name=e.name,F.addAttribute("position",new a.BufferAttribute(new Float32Array(D.vertexBuffer),3)),D.normalBuffer.length>0&&F.addAttribute("normal",new a.BufferAttribute(new Float32Array(D.normalBuffer),3)),D.uvBuffer.length>0&&F.addAttribute("uv",new a.BufferAttribute(new Float32Array(D.uvBuffer),2)),r&&(F.addAttribute("skinIndex",new a.BufferAttribute(new Float32Array(D.skinIndexBuffer),4)),F.addAttribute("skinWeight",new a.BufferAttribute(new Float32Array(D.skinWeightBuffer),4)),F.FBX_Deformer=r);for(var B=D.materialIndexBuffer[0],j=0,U=0;U<D.materialIndexBuffer.length;++U)D.materialIndexBuffer[U]!==B&&(F.addGroup(j,U-j,B),j=U,B=D.materialIndexBuffer[U]);return F}for(var u=(e.id,e.attrName,0);u<r.children.length;++u)if(o.has(r.children[u].ID)){var l=o.get(r.children[u].ID);break}var c=s(e,l);return c}function u(t,e){if(void 0===a.NURBSCurve)return console.error("THREE.FBXLoader relies on THREE.NURBSCurve for any nurbs present in the model.  Nurbs will show up as empty geometry."),new a.BufferGeometry;var n=parseInt(t.properties.Order);if(isNaN(n))return console.error("FBXLoader: Invalid Order "+t.properties.Order+" given for geometry ID: "+t.id),new a.BufferGeometry;for(var i=h(t.subNodes.KnotVector.properties.a),r=[],o=h(t.subNodes.Points.properties.a),s=0;s<o.length;s+=4)r.push(new a.Vector4(o[s],o[s+1],o[s+2],o[s+3]));"Closed"===t.properties.Form&&r.push(r[0]);var u=new a.NURBSCurve(n-1,i,r),l=u.getPoints(1.5*r.length),c=[];l.forEach(function(t){var e=t.toArray();c=c.concat(e)});var f=new a.BufferGeometry;return f.addAttribute("position",new a.BufferAttribute(new Float32Array(c),3)),f}switch(e.attrType){case"Mesh":return s(e,r,o);case"NurbsCurve":return u(e,r,o)}}var u=new Map;if("Geometry"in e.Objects.subNodes){var l=e.Objects.subNodes.Geometry;for(var c in l){var d=r.get(parseInt(c)),p=s(l[c],d,o);u.set(parseInt(c),p)}}return u}function m(t,e,n,i,r){var o=new a.Group,s=t.Objects.subNodes.Model,u=[],l=new Map;for(var c in s){for(var f=parseInt(c),p=s[c],g=e.get(f),v=null,m=0;m<g.parents.length;++m)n.forEach(function(t){if(t.map.has(g.parents[m].ID)){v=new a.Bone;var e=t.array.findIndex(function(t){return t.FBX_ID===g.parents[m].ID});t.bones[e]=v}});if(!v)switch(p.attrType){case"Mesh":var b=null,x=null,w=[];g.children.forEach(function(t){i.has(t.ID)&&(b=i.get(t.ID)),r.has(t.ID)&&w.push(r.get(t.ID))}),x=w.length>1?new a.MultiMaterial(w):w.length>0?w[0]:new a.MeshBasicMaterial({color:3342591}),b.FBX_Deformer?(w.forEach(function(t){t.skinning=!0}),x.skinning=!0,v=new a.SkinnedMesh(b,x)):v=new a.Mesh(b,x);break;case"NurbsCurve":var b=null;g.children.forEach(function(t){i.has(t.ID)&&(b=i.get(t.ID))}),x=new a.LineBasicMaterial({color:3342591,linewidth:5}),v=new a.Line(b,x);break;default:v=new a.Object3D}v.name=p.attrName.replace(/:/,"").replace(/_/,"").replace(/-/,""),v.FBX_ID=f,u.push(v),l.set(f,v)}u.forEach(function(t){var n=s[t.FBX_ID];if("Lcl_Translation"in n.properties&&t.position.fromArray(h(n.properties.Lcl_Translation.value)),"Lcl_Rotation"in n.properties){var i=h(n.properties.Lcl_Rotation.value).map(function(t){return t*Math.PI/180});i.push("ZYX"),t.rotation.fromArray(i)}"Lcl_Scaling"in n.properties&&t.scale.fromArray(h(n.properties.Lcl_Scaling.value));for(var r=e.get(t.FBX_ID),a=0;a<r.parents.length;a++){var l=u.findIndex(function(t){return t.FBX_ID===r.parents[a].ID});if(l>-1){u[l].add(t);break}}null===t.parent&&o.add(t)}),o.updateMatrixWorld(!0);var E=t.Objects.subNodes.Pose;for(var c in E)if("BindPose"===E[c].attrType){E=E[c];break}if(E){var S=E.subNodes.PoseNode,M=new Map;S.forEach(function(t){var e=d(t.subNodes.Matrix.properties.a);M.set(parseInt(t.id),e)})}n.forEach(function(t,n){t.array.forEach(function(e,n){var i=t.bones[n];if(M.has(i.FBX_ID)){var r=M.get(i.FBX_ID);i.matrixWorld.copy(r)}}),t.skeleton=new a.Skeleton(t.bones);var r=e.get(n);r.parents.forEach(function(n){if(i.has(n.ID))for(var r=n.ID,o=e.get(r),a=0;a<o.parents.length;++a)if(l.has(o.parents[a].ID)){var s=l.get(o.parents[a].ID);s.bind(t.skeleton,s.matrixWorld);break}})}),u.forEach(function(t){var e=s[t.FBX_ID];if("Lcl_Translation"in e.properties&&t.position.fromArray(h(e.properties.Lcl_Translation.value)),"Lcl_Rotation"in e.properties){var n=h(e.properties.Lcl_Rotation.value).map(function(t){return t*Math.PI/180});n.push("ZYX"),t.rotation.fromArray(n)}"Lcl_Scaling"in e.properties&&t.scale.fromArray(h(e.properties.Lcl_Scaling.value))}),o.skeleton={bones:u};var C=y(t,e,o);return _(o,C),o}function y(t,e,n){function i(t,e,n,i){var r={id:e.id,attr:e.attrName,internalID:e.id,attrX:!1,attrY:!1,attrZ:!1,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null}};if(!r.attr.match(/S|R|T/))return null;for(var o in e.properties)o.match(/X/)&&(r.attrX=!0),o.match(/Y/)&&(r.attrY=!0),o.match(/Z/)&&(r.attrZ=!0);for(var a=n.get(r.id),s=a.parents,u=s.length-1;u>=0;--u){var l=i.skeleton.bones.findIndex(function(t){return t.FBX_ID===s[u].ID});if(l>-1){r.containerBoneID=l,r.containerID=s[u].ID;break}}return r}function r(t){return{version:null,id:t.id,internalID:t.id,times:h(t.subNodes.KeyTime.properties.a).map(function(t){return c(t)}),values:h(t.subNodes.KeyValueFloat.properties.a),attrFlag:f(t.subNodes.KeyAttrFlags.properties.a),attrData:h(t.subNodes.KeyAttrDataFloat.properties.a)}}var o=t.Objects.subNodes.AnimationCurveNode,a=t.Objects.subNodes.AnimationCurve,s=t.Objects.subNodes.AnimationLayer,u=t.Objects.subNodes.AnimationStack,l={curves:new Map,layers:new Map,stacks:new Map,length:0,fps:30,frames:0},d=[];for(var p in o)if(p.match(/\d+/)){var g=i(t,o[p],e,n);d.push(g)}for(var v=new Map,m=0;m<d.length;++m)null!==d[m]&&v.set(d[m].id,d[m]);var y=[];for(p in a)if(p.match(/\d+/)){var _=r(a[p]);y.push(_);var b=e.get(_.id).parents[0],x=b.ID,w=b.relationship,E="";if(w.match(/X/))E="x";else if(w.match(/Y/))E="y";else{if(!w.match(/Z/))continue;E="z"}v.get(x).curves[E]=_}v.forEach(function(t){var e=t.containerBoneID;l.curves.has(e)||l.curves.set(e,{T:null,R:null,S:null}),l.curves.get(e)[t.attr]=t});for(var p in s){for(var S=[],M=e.get(parseInt(p)).children,C=0;C<M.length;C++)if(v.has(M[C].ID)){var I=v.get(M[C].ID),O=I.containerBoneID;void 0===S[O]&&(S[O]={T:null,R:null,S:null}),S[O][I.attr]=I}l.layers.set(parseInt(p),S)}for(var p in u){for(var T=[],M=e.get(parseInt(p)).children,P=0,A=Number.MAX_VALUE,C=0;C<M.length;++C)if(l.layers.has(M[C].ID)){var L=l.layers.get(M[C].ID);T.push(L),L.forEach(function(t){function e(t){function e(t){function e(t){P=t.times[t.times.length-1]>P?t.times[t.times.length-1]:P,A=t.times[0]<A?t.times[0]:A}t.x&&e(t.x),t.y&&e(t.y),t.z&&e(t.z)}t.R&&e(t.R.curves),t.S&&e(t.S.curves),t.T&&e(t.T.curves)}t&&e(t)})}P>A&&l.stacks.set(parseInt(p),{name:u[p].attrName,layers:T,length:P-A,frames:30*(P-A)})}return l}function _(t,e){void 0===t.animations&&(t.animations=[]),e.stacks.forEach(function(n){function i(t,n,i){function r(t,e){if(void 0===t)return!1;var n=t[e];return!!n&&["x","y","z"].every(function(t){return void 0!==n.curves[t]})}function o(t,e){return["x","y","z"].every(function(n){function i(t,e){return void 0!==t.values[e]}return i(t.curves[n],e)})}var s={time:i/e.fps,pos:n.position.toArray(),rot:n.quaternion.toArray(),scl:n.scale.toArray()};if(void 0===t)return s;try{if(r(t,"T")&&o(t.T,i)&&(s.pos=[t.T.curves.x.values[i],t.T.curves.y.values[i],t.T.curves.z.values[i]]),r(t,"R")&&o(t.R,i)){var u=p(t.R.curves.x.values[i]),l=p(t.R.curves.y.values[i]),c=p(t.R.curves.z.values[i]),h=new a.Euler(u,l,c,"ZYX");s.rot=(new a.Quaternion).setFromEuler(h).toArray()}r(t,"S")&&o(t.S,i)&&(s.scl=[t.S.curves.x.values[i],t.S.curves.y.values[i],t.S.curves.z.values[i]])}catch(t){console.log(n),console.log(t)}return s}var r={name:n.name,fps:30,length:n.length,hierarchy:[]},o=t.skeleton.bones;o.forEach(function(t){var e=t.name.replace(/.*:/,""),n=o.findIndex(function(e){return t.parent===e});r.hierarchy.push({parent:n,name:e,keys:[]})});for(var s=0;s<n.frames;s++)o.forEach(function(t,e){var o=n.layers[0][e];r.hierarchy.forEach(function(e){e.name===t.name&&e.keys.push(i(o,t,s))})});t.animations.push(a.AnimationClip.parseAnimation(r,o))})}function b(t){return new a.Vector3(parseFloat(t.value.x),parseFloat(t.value.y),parseFloat(t.value.z))}function x(t){return(new a.Color).fromArray(b(t).toArray())}var w=this,E=(new o).parse(e),S=s(E),M=u(E),C=l(E,M,S),I=g(E,S),O=v(E,S,I),T=m(E,S,I,O,C);return T}}),r(t.prototype,{copy:function(e){var n=e||new t;return n.position.copy(this.position),n.normal.copy(this.normal),n.uv.copy(this.uv),n.skinIndices.copy(this.skinIndices),n.skinWeights.copy(this.skinWeights),n},flattenToBuffers:function(){var t=this.position.toArray(),e=this.normal.toArray(),n=this.uv.toArray(),i=this.skinIndices.toArray(),r=this.skinWeights.toArray();return{vertexBuffer:t,normalBuffer:e,uvBuffer:n,skinIndexBuffer:i,skinWeightBuffer:r}}}),r(e.prototype,{copy:function(t){for(var n=t||new e,i=0;i<this.vertices.length;++i)this.vertices[i].copy(n.vertices[i]);return n},flattenToBuffers:function(){var t=[],e=[],n=[],i=[],r=[];return this.vertices.forEach(function(o){var a=o.flattenToBuffers();t=t.concat(a.vertexBuffer),e=e.concat(a.normalBuffer),n=n.concat(a.uvBuffer),i=i.concat(a.skinIndexBuffer),r=r.concat(a.skinWeightBuffer)}),{vertexBuffer:t,normalBuffer:e,uvBuffer:n,skinIndexBuffer:i,skinWeightBuffer:r}}}),r(n.prototype,{copy:function(t){for(var e=t||new n,i=0;i<this.triangles.length;++i)this.triangles[i].copy(e.triangles[i]);return e.materialIndex=this.materialIndex,e},genTrianglesFromVertices:function(t){for(var n=2;n<t.length;++n){var i=new e;i.vertices[0]=t[0],i.vertices[1]=t[n-1],i.vertices[2]=t[n],this.triangles.push(i)}},flattenToBuffers:function(){var t=[],e=[],n=[],i=[],r=[],o=[],a=this.materialIndex;return this.triangles.forEach(function(s){var u=s.flattenToBuffers();t=t.concat(u.vertexBuffer),e=e.concat(u.normalBuffer),n=n.concat(u.uvBuffer),i=i.concat(u.skinIndexBuffer),r=r.concat(u.skinWeightBuffer),o=o.concat([a,a,a])}),{vertexBuffer:t,normalBuffer:e,uvBuffer:n,skinIndexBuffer:i,skinWeightBuffer:r,materialIndexBuffer:o}}}),r(i.prototype,{flattenToBuffers:function(){var t=[],e=[],n=[],i=[],r=[],o=[];return this.faces.forEach(function(a){var s=a.flattenToBuffers();t=t.concat(s.vertexBuffer),e=e.concat(s.normalBuffer),n=n.concat(s.uvBuffer),i=i.concat(s.skinIndexBuffer),r=r.concat(s.skinWeightBuffer),o=o.concat(s.materialIndexBuffer)}),{vertexBuffer:t,normalBuffer:e,uvBuffer:n,skinIndexBuffer:i,skinWeightBuffer:r,materialIndexBuffer:o}}}),r(o.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(t){this.nodeStack.push(t),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(t,e){this.currentProp=t,this.currentPropName=e},parse:function(t){this.currentIndent=0,this.allNodes=new s,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var e=t.split("\n");for(var n in e){var i=e[n];if(!i.match(/^[\s\t]*;/)&&!i.match(/^[\s\t]*$/)){var r=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){",""),o=i.match(r);if(o){var a=o[1].trim().replace(/^"/,"").replace(/"$/,""),u=o[2].split(",").map(function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")});this.parseNodeBegin(i,a,u||null)}else{var l=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),o=i.match(l);if(o){var c=o[1].replace(/^"/,"").replace(/"$/,"").trim(),h=o[2].replace(/^"/,"").replace(/"$/,"").trim();this.parseNodeProperty(i,c,h)}else{var f=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");i.match(f)?this.nodeEnd():i.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(i)}}}}return this.allNodes},parseNodeBegin:function(t,e,n){var i={name:e,properties:{},subNodes:{}},r=this.parseNodeAttr(n),o=this.getCurrentNode();if(0===this.currentIndent)this.allNodes.add(e,i);else if(e in o.subNodes){var a=o.subNodes[e];this.isFlattenNode(o.subNodes[e])&&(""===r.id?(o.subNodes[e]=[],o.subNodes[e].push(a)):(o.subNodes[e]={},o.subNodes[e][a.id]=a)),""===r.id?o.subNodes[e].push(i):o.subNodes[e][r.id]=i}else"number"==typeof r.id||r.id.match(/^\d+$/)?(o.subNodes[e]={},o.subNodes[e][r.id]=i):o.subNodes[e]=i;n&&(i.id=r.id,i.attrName=r.name,i.attrType=r.type),this.pushStack(i)},parseNodeAttr:function(t){var e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));var n,i;return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),i=t[2]),{id:e,name:n||"",type:i||""}},parseNodeProperty:function(t,e,n){var i=this.getCurrentNode(),r=i.name;if(void 0!==r){var o=r.match(/Properties(\d)+/);if(o)return void this.parseNodeSpecialProperty(t,e,n)}if("C"==e){var a=n.split(",").slice(1),s=parseInt(a[0]),u=parseInt(a[1]),l=n.split(",").slice(3);e="connections",n=[s,u],n=n.concat(l),void 0===i.properties[e]&&(i.properties[e]=[])}if("Node"==e){var c=parseInt(n);i.properties.id=c,i.id=c}e in i.properties?Array.isArray(i.properties[e])?i.properties[e].push(n):i.properties[e]+=n:Array.isArray(i.properties[e])?i.properties[e].push(n):i.properties[e]=n,this.setCurrentProp(i.properties,e)},parseNodePropertyContinued:function(t){this.currentProp[this.currentPropName]+=t},parseNodeSpecialProperty:function(t,e,n){var i=n.split('",').map(function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")}),r=i[0],o=i[1],s=i[2],u=i[3],l=i[4];switch(o){case"int":l=parseInt(l);break;case"double":l=parseFloat(l);break;case"ColorRGB":case"Vector3D":var c=l.split(",");l=new a.Vector3(c[0],c[1],c[2])}this.getPrevNode().properties[r]={type:o,type2:s,flag:u,value:l},this.setCurrentProp(this.getPrevNode().properties,r)},nodeEnd:function(){this.popStack()},isFlattenNode:function(t){return"subNodes"in t&&"properties"in t}}),r(s.prototype,{add:function(t,e){this[t]=e},searchConnectionParent:function(t){if(void 0===this.__cache_search_connection_parent&&(this.__cache_search_connection_parent=[]),void 0!==this.__cache_search_connection_parent[t])return this.__cache_search_connection_parent[t];this.__cache_search_connection_parent[t]=[];for(var e=this.Connections.properties.connections,n=[],i=0;i<e.length;++i)if(e[i][0]==t){var r=0===e[i][1]?-1:e[i][1];n.push(r)}return n.length>0?(this.__cache_search_connection_parent[t]=this.__cache_search_connection_parent[t].concat(n),n):(this.__cache_search_connection_parent[t]=[-1],[-1])},searchConnectionChildren:function(t){if(void 0===this.__cache_search_connection_children&&(this.__cache_search_connection_children=[]),void 0!==this.__cache_search_connection_children[t])return this.__cache_search_connection_children[t];this.__cache_search_connection_children[t]=[];for(var e=this.Connections.properties.connections,n=[],i=0;i<e.length;++i)e[i][1]==t&&n.push(0===e[i][0]?-1:e[i][0]);return n.length>0?(this.__cache_search_connection_children[t]=this.__cache_search_connection_children[t].concat(n),n):(this.__cache_search_connection_children[t]=[],[])},searchConnectionType:function(t,e){var n=t+","+e;if(void 0===this.__cache_search_connection_type&&(this.__cache_search_connection_type={}),void 0!==this.__cache_search_connection_type[n])return this.__cache_search_connection_type[n];this.__cache_search_connection_type[n]="";for(var i=this.Connections.properties.connections,r=0;r<i.length;++r)if(i[r][0]==t&&i[r][1]==e)return this.__cache_search_connection_type[n]=i[r][2],i[r][2];return this.__cache_search_connection_type[t]=null,null}})}()},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var r=n(2),o=i(r);o.MTLLoader=function(t){this.manager=void 0!==t?t:o.DefaultLoadingManager},o.MTLLoader.prototype={constructor:o.MTLLoader,load:function(t,e,n,i){var r=this,a=new o.FileLoader(this.manager);a.setPath(this.path),a.load(t,function(t){e(r.parse(t))},n,i)},setPath:function(t){this.path=t},setTexturePath:function(t){this.texturePath=t},setBaseUrl:function(t){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead."),this.setTexturePath(t)},setCrossOrigin:function(t){this.crossOrigin=t},setMaterialOptions:function(t){this.materialOptions=t},parse:function(t){for(var e=t.split("\n"),n={},i=/\s+/,r={},a=0;a<e.length;a++){var s=e[a];if(s=s.trim(),0!==s.length&&"#"!==s.charAt(0)){var u=s.indexOf(" "),l=u>=0?s.substring(0,u):s;l=l.toLowerCase();var c=u>=0?s.substring(u+1):"";if(c=c.trim(),"newmtl"===l)n={name:c},r[c]=n;else if(n)if("ka"===l||"kd"===l||"ks"===l){var h=c.split(i,3);n[l]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else n[l]=c}}var f=new o.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);return f.setCrossOrigin(this.crossOrigin),f.setManager(this.manager),f.setMaterials(r),f}},o.MTLLoader.MaterialCreator=function(t,e){this.baseUrl=t||"",this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:o.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:o.RepeatWrapping},o.MTLLoader.MaterialCreator.prototype={constructor:o.MTLLoader.MaterialCreator,setCrossOrigin:function(t){this.crossOrigin=t},setManager:function(t){this.manager=t},setMaterials:function(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(t){if(!this.options)return t;var e={};for(var n in t){var i=t[n],r={};e[n]=r;for(var o in i){var a=!0,s=i[o],u=o.toLowerCase();switch(u){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(a=!1)}a&&(r[u]=s)}}return e},preload:function(){for(var t in this.materialsInfo)this.create(t)},getIndex:function(t){return this.nameLookup[t]},getAsArray:function(){var t=0;for(var e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray},create:function(t){return void 0===this.materials[t]&&this.createMaterial_(t),this.materials[t]},createMaterial_:function(t){function e(t,e){return"string"!=typeof e||""===e?"":/^https?:\/\//i.test(e)?e:t+e}function n(t,n){if(!a[t]){var r=i.getTextureParams(n,a),o=i.loadTexture(e(i.baseUrl,r.url));o.repeat.copy(r.scale),o.offset.copy(r.offset),o.wrapS=i.wrap,o.wrapT=i.wrap,a[t]=o}}var i=this,r=this.materialsInfo[t],a={name:t,side:this.side};for(var s in r){var u=r[s];if(""!==u)switch(s.toLowerCase()){case"kd":a.color=(new o.Color).fromArray(u);break;case"ks":a.specular=(new o.Color).fromArray(u);break;case"map_kd":n("map",u);break;case"map_ks":n("specularMap",u);break;case"map_bump":case"bump":n("bumpMap",u);break;case"ns":a.shininess=parseFloat(u);break;case"d":u<1&&(a.opacity=u,a.transparent=!0);break;case"Tr":u>0&&(a.opacity=1-u,a.transparent=!0)}}return this.materials[t]=new o.MeshPhongMaterial(a),this.materials[t]},getTextureParams:function(t,e){var n,i={scale:new o.Vector2(1,1),offset:new o.Vector2(0,0)},r=t.split(/\s+/);return n=r.indexOf("-bm"),n>=0&&(e.bumpScale=parseFloat(r[n+1]),r.splice(n,2)),n=r.indexOf("-s"),n>=0&&(i.scale.set(parseFloat(r[n+1]),parseFloat(r[n+2])),r.splice(n,4)),n=r.indexOf("-o"),n>=0&&(i.offset.set(parseFloat(r[n+1]),parseFloat(r[n+2])),r.splice(n,4)),i.url=r.join(" ").trim(),i},loadTexture:function(t,e,n,i,r){var a,s=o.Loader.Handlers.get(t),u=void 0!==this.manager?this.manager:o.DefaultLoadingManager;return null===s&&(s=new o.TextureLoader(u)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),a=s.load(t,n,i,r),void 0!==e&&(a.mapping=e),a}}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=function t(e,n,i,r){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var a=Object.getPrototypeOf(e);null!==a&&t(a,n,i,r)}else if("value"in o&&o.writable)o.value=i;else{var s=o.set;void 0!==s&&s.call(r,i)}return i},u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},l=n(2),c=function(t){function e(){i(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.type="MeshProxy",t._proxy=null;var n=t;return t._removedListener=function(){n.removeEventListener("removed",n._removedListener),n._proxy=null},t.addEventListener("removed",t._removedListener),t}return o(e,t),a(e,[{key:"addProxy",value:function(t){this._proxy=t,u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"add",this).call(this,t)}},{key:"proxyPosition",get:function(){return this._proxy?this._proxy.position:u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",this)},set:function(t){this._proxy?this._proxy.position=t:s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"positon",t,this)}},{key:"proxyRotation",get:function(){return this._proxy?this._proxy.rotation:u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"rotation",this)},set:function(t){this._proxy?this._proxy.rotation=t:s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"rotation",t,this)}},{key:"proxyScale",get:function(){return this._proxy?this._proxy.scale:u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"scale",this)},set:function(t){this._proxy?this._proxy.scale=t:s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"scale",t,this)}}]),e}(l.Group);e.default=c},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),
Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),s=i(a),u=function(){function t(e,n){var i=this;r(this,t);var o=e.context,a=e.state,u=null,l=null,c=null,h=null,f=null,d=void 0,p=new s.Vector3,g=new s.Vector3;this.init=function(){var t=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),e=new Uint16Array([0,1,2,0,2,3]);u=o.createBuffer(),l=o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,u),o.bufferData(o.ARRAY_BUFFER,t,o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e,o.STATIC_DRAW),c=i.createProgram(),h={position:o.getAttribLocation(c,"position"),uv:o.getAttribLocation(c,"uv")},f={uvOffset:o.getUniformLocation(c,"uvOffset"),uvScale:o.getUniformLocation(c,"uvScale"),rotation:o.getUniformLocation(c,"rotation"),scale:o.getUniformLocation(c,"scale"),offset:o.getUniformLocation(c,"offset"),anchor:o.getUniformLocation(c,"anchor"),color:o.getUniformLocation(c,"color"),map:o.getUniformLocation(c,"map"),opacity:o.getUniformLocation(c,"opacity"),modelViewMatrix:o.getUniformLocation(c,"modelViewMatrix"),projectionMatrix:o.getUniformLocation(c,"projectionMatrix"),fogType:o.getUniformLocation(c,"fogType"),fogDensity:o.getUniformLocation(c,"fogDensity"),fogNear:o.getUniformLocation(c,"fogNear"),fogFar:o.getUniformLocation(c,"fogFar"),fogColor:o.getUniformLocation(c,"fogColor"),alphaTest:o.getUniformLocation(c,"alphaTest")};var n=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");n.width=8,n.height=8;var r=n.getContext("2d");r.fillStyle="white",r.fillRect(0,0,8,8),d=new s.Texture(n),d.needsUpdate=!0},this.render=function(t,r){if(0!==n.length){c||i.init(),o.useProgram(c),a.initAttributes(),a.enableAttribute(h.position),a.enableAttribute(h.uv),a.disableUnusedAttributes(),a.disable(o.CULL_FACE),a.enable(o.BLEND),o.bindBuffer(o.ARRAY_BUFFER,u),o.vertexAttribPointer(h.position,2,o.FLOAT,!1,16,0),o.vertexAttribPointer(h.uv,2,o.FLOAT,!1,16,8),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,l),o.uniformMatrix4fv(f.projectionMatrix,!1,r.projectionMatrix.elements),a.activeTexture(o.TEXTURE0),o.uniform1i(f.map,0);var v=0,m=0,y=t.fog;y?(o.uniform3f(f.fogColor,y.color.r,y.color.g,y.color.b),y instanceof s.Fog?(o.uniform1f(f.fogNear,y.near),o.uniform1f(f.fogFar,y.far),o.uniform1i(f.fogType,1),v=1,m=1):y instanceof s.FogExp2&&(o.uniform1f(f.fogDensity,y.density),o.uniform1i(f.fogType,2),v=2,m=2)):(o.uniform1i(f.fogType,0),v=0,m=0);for(var _=e.domElement.width,b=e.domElement.height,x=e.getPixelRatio(),w=[],E=0,S=n.length;E<S;E++){var M=n[E],C=M.material;if(C.visible){M.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,M.matrixWorld),o.uniform1f(f.alphaTest,C.alphaTest),o.uniformMatrix4fv(f.modelViewMatrix,!1,M.modelViewMatrix.elements),p.setFromMatrixPosition(M.modelViewMatrix),o.uniform3f(f.offset,p.x,p.y,p.z),C.materialScale?(w[0]=M.scale.x/_*(x+1),w[1]=M.scale.y/b*(x+1)):(w[0]=g.x,w[1]=g.y);var I=0;t.fog&&C.fog&&(I=m),v!==I&&(o.uniform1i(f.fogType,I),v=I),null!==C.map?(o.uniform2f(f.uvOffset,C.map.offset.x,C.map.offset.y),o.uniform2f(f.uvScale,C.map.repeat.x,C.map.repeat.y)):(o.uniform2f(f.uvOffset,0,0),o.uniform2f(f.uvScale,1,1)),o.uniform1f(f.opacity,C.opacity),o.uniform3f(f.color,C.color.r,C.color.g,C.color.b),o.uniform1f(f.rotation,C.rotation),C.anchor&&o.uniform2f(f.anchor,C.anchor[0],C.anchor[1]),o.uniform2fv(f.scale,w),a.setBlending(C.blending,C.blendEquation,C.blendSrc,C.blendDst),a.buffers.depth.setTest(C.depthTest),a.buffers.depth.setMask(C.depthWrite),C.map?e.setTexture2D(C.map,0):e.setTexture2D(d,0),o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)}}e.resetGLState()}},this.createProgram=function(){var t=o.createProgram(),n=o.createShader(o.VERTEX_SHADER),i=o.createShader(o.FRAGMENT_SHADER),r=e.getPrecision(),a="precision "+r+" float;";return o.shaderSource(n,[a,"uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","uniform vec3 offset;","uniform vec2 anchor;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = vec2(position.x + (0.5 - anchor.x), position.y - (0.5 - anchor.y)) * scale;","vec4 basePosition = projectionMatrix * vec4(offset, 1.0);","vec4 finalPosition = vec4(basePosition.x / basePosition.w, basePosition.y / basePosition.w, basePosition.z / basePosition.w, 1.0);","finalPosition.xy += alignedPosition;","gl_Position = finalPosition;","}"].join("\n")),o.shaderSource(i,[a,"uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),o.compileShader(n),o.compileShader(i),o.attachShader(t,n),o.attachShader(t,i),o.linkProgram(t),t},this.painterSortStable=function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:e.id-t.id}}return o(t,[{key:"getAABB",value:function(){return"getAABB"}}]),t}();e.default=u},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var r=n(2),o=i(r);o.OBJLoader=function(t){this.manager=void 0!==t?t:o.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},o.OBJLoader.prototype={constructor:o.OBJLoader,load:function(t,e,n,i){var r=this,a=new o.FileLoader(r.manager);a.setPath(this.path),a.load(t,function(t){e(r.parse(t))},n,i)},setPath:function(t){this.path=t},setMaterials:function(t){this.materials=t},_createParserState:function(){var t={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(t,e){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=t,void(this.object.fromDeclaration=e!==!1);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:e!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(t,e){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&e.groupEnd===-1&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},n&&n.name&&"function"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseNormalIndex:function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},parseUVIndex:function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},addVertex:function(t,e,n){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addVertexLine:function(t){var e=this.vertices,n=this.object.geometry.vertices;n.push(e[t+0]),n.push(e[t+1]),n.push(e[t+2])},addNormal:function(t,e,n){var i=this.normals,r=this.object.geometry.normals;r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addUV:function(t,e,n){var i=this.uvs,r=this.object.geometry.uvs;r.push(i[t+0]),r.push(i[t+1]),r.push(i[e+0]),r.push(i[e+1]),r.push(i[n+0]),r.push(i[n+1])},addUVLine:function(t){var e=this.uvs,n=this.object.geometry.uvs;n.push(e[t+0]),n.push(e[t+1])},addFace:function(t,e,n,i,r,o,a,s,u,l,c,h){var f,d=this.vertices.length,p=this.parseVertexIndex(t,d),g=this.parseVertexIndex(e,d),v=this.parseVertexIndex(n,d);if(void 0===i?this.addVertex(p,g,v):(f=this.parseVertexIndex(i,d),this.addVertex(p,g,f),this.addVertex(g,v,f)),void 0!==r){var m=this.uvs.length;p=this.parseUVIndex(r,m),g=this.parseUVIndex(o,m),v=this.parseUVIndex(a,m),void 0===i?this.addUV(p,g,v):(f=this.parseUVIndex(s,m),this.addUV(p,g,f),this.addUV(g,v,f))}if(void 0!==u){var y=this.normals.length;p=this.parseNormalIndex(u,y),g=u===l?p:this.parseNormalIndex(l,y),v=u===c?p:this.parseNormalIndex(c,y),void 0===i?this.addNormal(p,g,v):(f=this.parseNormalIndex(h,y),this.addNormal(p,g,f),this.addNormal(g,v,f))}},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var n=this.vertices.length,i=this.uvs.length,r=0,o=t.length;r<o;r++)this.addVertexLine(this.parseVertexIndex(t[r],n));for(var a=0,o=e.length;a<o;a++)this.addUVLine(this.parseUVIndex(e[a],i))}};return t.startObject("",!1),t},parse:function(t){console.time("OBJLoader");var e=this._createParserState();t.indexOf("\r\n")!==-1&&(t=t.replace(/\r\n/g,"\n")),t.indexOf("\\\n")!==-1&&(t=t.replace(/\\\n/g,""));for(var n=t.split("\n"),i="",r="",a="",s=0,u=[],l="function"==typeof"".trimLeft,c=0,h=n.length;c<h;c++)if(i=n[c],i=l?i.trimLeft():i.trim(),s=i.length,0!==s&&(r=i.charAt(0),"#"!==r))if("v"===r)if(a=i.charAt(1)," "===a&&null!==(u=this.regexp.vertex_pattern.exec(i)))e.vertices.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));else if("n"===a&&null!==(u=this.regexp.normal_pattern.exec(i)))e.normals.push(parseFloat(u[1]),parseFloat(u[2]),parseFloat(u[3]));else{if("t"!==a||null===(u=this.regexp.uv_pattern.exec(i)))throw new Error("Unexpected vertex/normal/uv line: '"+i+"'");e.uvs.push(parseFloat(u[1]),parseFloat(u[2]))}else if("f"===r)if(null!==(u=this.regexp.face_vertex_uv_normal.exec(i)))e.addFace(u[1],u[4],u[7],u[10],u[2],u[5],u[8],u[11],u[3],u[6],u[9],u[12]);else if(null!==(u=this.regexp.face_vertex_uv.exec(i)))e.addFace(u[1],u[3],u[5],u[7],u[2],u[4],u[6],u[8]);else if(null!==(u=this.regexp.face_vertex_normal.exec(i)))e.addFace(u[1],u[3],u[5],u[7],void 0,void 0,void 0,void 0,u[2],u[4],u[6],u[8]);else{if(null===(u=this.regexp.face_vertex.exec(i)))throw new Error("Unexpected face line: '"+i+"'");e.addFace(u[1],u[2],u[3],u[4])}else if("l"===r){var f=i.substring(1).trim().split(" "),d=[],p=[];if(i.indexOf("/")===-1)d=f;else for(var g=0,v=f.length;g<v;g++){var m=f[g].split("/");""!==m[0]&&d.push(m[0]),""!==m[1]&&p.push(m[1])}e.addLineGeometry(d,p)}else if(null!==(u=this.regexp.object_pattern.exec(i))){var y=(" "+u[0].substr(1).trim()).substr(1);e.startObject(y)}else if(this.regexp.material_use_pattern.test(i))e.object.startMaterial(i.substring(7).trim(),e.materialLibraries);else if(this.regexp.material_library_pattern.test(i))e.materialLibraries.push(i.substring(7).trim());else{if(null===(u=this.regexp.smoothing_pattern.exec(i))){if("\0"===i)continue;throw new Error("Unexpected line: '"+i+"'")}var _=u[1].trim().toLowerCase();e.object.smooth="1"===_||"on"===_;var b=e.object.currentMaterial();b&&(b.smooth=e.object.smooth)}e.finalize();var x=new o.Group;x.materialLibraries=[].concat(e.materialLibraries);for(var c=0,h=e.objects.length;c<h;c++){var w=e.objects[c],E=w.geometry,S=w.materials,M="Line"===E.type;if(0!==E.vertices.length){var C=new o.BufferGeometry;C.addAttribute("position",new o.BufferAttribute(new Float32Array(E.vertices),3)),E.normals.length>0?C.addAttribute("normal",new o.BufferAttribute(new Float32Array(E.normals),3)):C.computeVertexNormals(),E.uvs.length>0&&C.addAttribute("uv",new o.BufferAttribute(new Float32Array(E.uvs),2));for(var I=[],O=0,T=S.length;O<T;O++){var P=S[O],b=void 0;if(null!==this.materials&&(b=this.materials.create(P.name),M&&b&&!(b instanceof o.LineBasicMaterial))){var A=new o.LineBasicMaterial;A.copy(b),b=A}b||(b=M?new o.LineBasicMaterial:new o.MeshPhongMaterial,b.name=P.name),b.shading=P.smooth?o.SmoothShading:o.FlatShading,I.push(b)}var L;if(I.length>1){for(var O=0,T=S.length;O<T;O++){var P=S[O];C.addGroup(P.groupStart,P.groupCount,O)}L=M?new o.LineSegments(C,I):new o.Mesh(C,I)}else L=M?new o.LineSegments(C,I[0]):new o.Mesh(C,I[0]);L.name=w.name,x.add(L)}}return console.timeEnd("OBJLoader"),x}}},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t){return!isNaN(t)&&isFinite(t)}function a(t){return"[object Array]"===Object.prototype.toString.call(t)}function s(t){return t?a(t)!==!0?[t]:t:[]}function u(t,e){for(var n in t)if(t[n]===e)return n;return-1}function l(t,e,n){for(var i in t)if(t[i][e]===n)return i;return-1}Object.defineProperty(e,"__esModule",{value:!0}),e.RaycasterUtils=e.Octree=void 0;var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=n(2),f=i(h),d=null,p=function(){function t(e,n){r(this,t),this.object=e,n instanceof f.Face3?(this.faces=n,this.face3=!0,this.utilVec31FaceBounds=new f.Vector3):n instanceof f.Vector3&&(this.vertices=n),this.radius=0,this.position=new f.Vector3,this.object instanceof f.Object3D&&this.update(),this.positionLast=this.position.clone()}return c(t,[{key:"update",value:function(){this.face3?(this.radius=this.getFace3BoundingRadius(this.object,this.faces),this.position.copy(this.faces.centroid).applyMatrix4(this.object.matrixWorld)):this.vetices?(this.radius=this.object.material.size||1,this.position.copy(this.vertices).applyMatrix4(this.object.matrixWorld)):this.object.geometry?(null===this.object.geometry.boundingSphere&&this.object.geometry.computeBoundingSphere(),this.radius=this.object.geometry.boundingSphere.radius,this.position.copy(this.object.geometry.boundingSphere.center).applyMatrix4(this.object.matrixWorld)):(this.radius=this.object.boundRadius,this.position.setFromMatrixPosition(this.object.matrixWorld)),this.radius=this.radius*Math.max(this.object.scale.x,this.object.scale.y,this.object.scale.z)}},{key:"getFace3BoundingRadius",value:function(t,e){"undefined"==typeof e.centroid&&(e.centroid=new f.Vector3);var n=t.geometry||t,i=n.vertices,r=e.centroid,o=i[e.a],a=i[e.b],s=i[e.c],u=this.utilVec31FaceBounds;return r.addVectors(o,a).add(s).divideScalar(3),Math.max(u.subVectors(r,o).length(),u.subVectors(r,a).length(),u.subVectors(r,s).length())}}]),t}(),g=function(){function t(e){r(this,t),this.utilVec31Branch=new f.Vector3,this.utilVec31Expand=new f.Vector3,this.utilVec31Ray=new f.Vector3;var n=e||{};n.tree instanceof d?this.tree=n.tree:n.parent instanceof t!=!0&&(n.root=this,this.tree=new d(n)),this.id=this.tree.nodeCount++,this.position=n.position instanceof f.Vector3?n.position:new f.Vector3,this.radius=n.radius>0?n.radius:1,this.indexOctant=n.indexOctant,this.depth=0,this.reset(),this.setParent(n.parent),this.overlap=this.radius*this.tree.overlapPct,this.radiusOverlap=this.radius+this.overlap,this.left=this.position.x-this.radiusOverlap,this.right=this.position.x+this.radiusOverlap,this.bottom=this.position.y-this.radiusOverlap,this.top=this.position.y+this.radiusOverlap,this.back=this.position.z-this.radiusOverlap,this.front=this.position.z+this.radiusOverlap,this.tree.scene&&(this.visual=new f.Mesh(this.tree.visualGeometry,this.tree.visualMaterial),this.visual.scale.set(2*this.radiusOverlap,2*this.radiusOverlap,2*this.radiusOverlap),this.visual.position.copy(this.position),this.tree.scene.add(this.visual))}return c(t,[{key:"setParent",value:function(t){t!==this&&this.parent!==t&&(this.parent=t,this.updateProperties())}},{key:"updateProperties",value:function(){this.parent instanceof t?(this.tree=this.parent.tree,this.depth=this.parent.depth+1):this.depth=0;for(var e=this.nodesIndices,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;this.nodesByIndex[o].updateProperties()}}},{key:"reset",value:function(t,e){var n=this.nodesIndices||[],i=this.nodesByIndex;this.objects=[],this.nodesIndices=[],this.nodesByIndex={};for(var r=n,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s,l=i[u];l.setParent(),t===!0&&l.reset(t,e)}e===!0&&this.visual&&this.visual.parent&&this.visual.parent.remove(this.visual)}},{key:"addNode",value:function(t,e){t.indexOctant=e,u(this.nodesIndices,e)===-1&&this.nodesIndices.push(e),this.nodesByIndex[e]=t,t.parent!==this&&t.setParent(this)}},{key:"removeNode",value:function(t){var e=u(this.nodesIndices,t),n=this.nodesByIndex[t];this.nodesIndices.splice(e,1),delete this.nodesByIndex[t],n&&n.parent===this&&n.setParent()}},{key:"addObject",value:function(e){var n=this.getOctantIndex(e);if(n>-1&&this.nodesIndices.length>0){var i=this.branch(n);i.addObject(e)}else if(n<-1&&this.parent instanceof t)this.parent.addObject(e);else{var r=u(this.objects,e);r===-1&&this.objects.push(e),e.node=this,this.checkGrow()}}},{key:"addObjectWithoutCheck",value:function(t){for(var e=t,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;this.objects.push(o),o.node=this}}},{key:"removeObject",value:function(t){var e=this.removeObjectRecursive(t,{searchComplete:!1,nodesRemovedFrom:[],objectsDataRemoved:[]}),n=e.nodesRemovedFrom;if(n.length>0)for(var i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;s.shrink()}return e.objectsDataRemoved}},{key:"removeObjectRecursive",value:function(t,e){var n=void 0;if(t instanceof p){var i=u(this.objects,t);i!==-1&&(this.objects.splice(i,1),delete t.node,e.objectsDataRemoved.push(t),e.searchComplete=n=!0)}else for(var r=this.objects.length-1;r>=0;r--){var o=this.objects[r];if(o.object===t&&(this.objects.splice(r,1),delete o.node,e.objectsDataRemoved.push(o),n=!0,!o.faces&&!o.vertices)){e.searchComplete=!0;break}}if(n===!0&&e.nodesRemovedFrom.push(this),e.searchComplete!==!0)for(var a=this.nodesIndices,s=Array.isArray(a),l=0,a=s?a:a[Symbol.iterator]();;){var c;if(s){if(l>=a.length)break;c=a[l++]}else{if(l=a.next(),l.done)break;c=l.value}var h=c,f=this.nodesByIndex[h];if(e=f.removeObjectRecursive(t,e),e.searchComplete===!0)break}return e}},{key:"checkGrow",value:function(){this.objects.length>this.tree.objectsThreshold&&this.tree.objectsThreshold>0&&this.grow()}},{key:"grow",value:function(){for(var t=[],e=[],n=[],i=[],r=[],o=this.objects,a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(s>=o.length)break;u=o[s++]}else{if(s=o.next(),s.done)break;u=s.value}var l=u,c=this.getOctantIndex(l);c>-1?(n.push(l),i.push(c)):c<-1?(t.push(l),e.push(c)):r.push(l)}n.length>0&&(r=r.concat(this.split(n,i))),t.length>0&&(r=r.concat(this.expand(t,e))),this.objects=r,this.checkMerge()}},{key:"split",value:function(t,e){var n=void 0;if(this.depth<this.tree.depthMax){var i=t||this.objects,r=e||[];n=[];for(var o=0;o<i.length;o++){var a=i[o],s=r[o];if(s>-1){var u=this.branch(s);u.addObject(a)}else n.push(a)}i===this.objects&&(this.objects=n)}else n=this.objects;return n}},{key:"branch",value:function(e){var n=void 0;if(this.nodesByIndex[e]instanceof t)n=this.nodesByIndex[e];else{var i=.5*this.radiusOverlap,r=i*this.tree.overlapPct,o=i-r,a=this.utilVec31Branch.set(1&e?o:-o,2&e?o:-o,4&e?o:-o),s=(new f.Vector3).addVectors(this.position,a);n=new t({tree:this.tree,parent:this,position:s,radius:i,indexOctant:e}),this.addNode(n,e)}return n}},{key:"expand",value:function(e,n){var i=void 0;if(this.tree.root.getDepthEnd()<this.tree.depthMax){var r=this.tree.INDEX_OUTSIDE_MAP,o=this.utilVec31Expand,a=[];e=e||this.objects,n=n||[],i=[];for(var s=r,u=Array.isArray(s),l=0,s=u?s:s[Symbol.iterator]();;){var c;if(u){if(l>=s.length)break;c=s[l++]}else{if(l=s.next(),l.done)break;c=l.value}var h=c;h.count=0}for(var d=0;d<e.length;d++){var p=e[d],g=n[d];if(g<-1){var v=-g-this.tree.INDEX_OUTSIDE_OFFSET;v&this.tree.FLAG_POS_X?r[this.tree.INDEX_OUTSIDE_POS_X].count++:v&this.tree.FLAG_NEG_X&&r[this.tree.INDEX_OUTSIDE_NEG_X].count++,v&this.tree.FLAG_POS_Y?r[this.tree.INDEX_OUTSIDE_POS_Y].count++:v&this.tree.FLAG_NEG_Y&&r[this.tree.INDEX_OUTSIDE_NEG_Y].count++,v&this.tree.FLAG_POS_Z?r[this.tree.INDEX_OUTSIDE_POS_Z].count++:v&this.tree.FLAG_NEG_Z&&r[this.tree.INDEX_OUTSIDE_NEG_Z].count++,a.push(p)}else i.push(p)}if(a.length>0){var m=r.slice(0);m.sort(function(t,e){return e.count-t.count});var y=void 0,_=void 0,b=void 0,x=m[0],w=1|x.index;_=m[1],b=m[2];var E=(1|_.index)!==w?_:b,S=1|E.index;_=m[2],b=m[3];var M=m[4],C=1|_.index,I=1|b.index;y=C!==w&&C!==S?_:I!==w&&I!==S?b:M;var O=x.x+E.x+y.x,T=x.y+E.y+y.y,P=x.z+E.z+y.z,A=this.getOctantIndexFromPosition(O,T,P),L=this.getOctantIndexFromPosition(-O,-T,-P),N=this.overlap,k=this.radius,R=this.tree.overlapPct>0?N/(.5*this.tree.overlapPct*(1+this.tree.overlapPct)):2*k,D=R*this.tree.overlapPct,F=R+D-(k+N);o.set(1&A?F:-F,2&A?F:-F,4&A?F:-F);var B=(new f.Vector3).addVectors(this.position,o),j=new t({tree:this.tree,position:B,radius:R});j.addNode(this,L),this.tree.setRoot(j);for(var U=a,z=Array.isArray(U),G=0,U=z?U:U[Symbol.iterator]();;){var V;if(z){if(G>=U.length)break;V=U[G++]}else{if(G=U.next(),G.done)break;V=G.value}var X=V;this.tree.root.addObject(X)}}e===this.objects&&(this.objects=i)}else i=e;return i}},{key:"shrink",value:function(){this.checkMerge(),this.tree.root.checkContract()}},{key:"checkMerge",value:function(){for(var e=this,n=void 0;e.parent instanceof t&&e.getObjectCountEnd()<this.tree.objectsThreshold;)n=e,e=e.parent;e!==this&&e.merge(n)}},{key:"merge",value:function(t){t=s(t);for(var e=t,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;this.addObjectWithoutCheck(o.getObjectsEnd()),o.reset(!0,!0),this.removeNode(o.indexOctant,o)}this.checkMerge()}},{key:"checkContract",value:function(){if(this.nodesIndices.length>0){for(var e=0,n=this.objects.length,i=void 0,r=this.nodesIndices,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s,l=this.nodesByIndex[u],c=l.getObjectCountEnd();n+=c,(i instanceof t==!1||c>e)&&(i=l,e=c)}n-=e,n<this.tree.objectsThreshold&&i instanceof t&&this.contract(i)}}},{key:"contract",value:function(t){for(var e=this.nodesIndices,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r,a=this.nodesByIndex[o];a!==t&&(t.addObjectWithoutCheck(a.getObjectsEnd()),a.reset(!0,!0))}t.addObjectWithoutCheck(this.objects),this.reset(!1,!0),this.tree.setRoot(t),t.checkContract()}},{key:"getOctantIndex",value:function(e){var n=void 0,i=void 0;e instanceof p?(i=e.radius,n=e.position,e.positionLast.copy(n)):e instanceof t&&(n=e.position,i=0);var r=this.position,o=n.x-r.x,a=n.y-r.y,s=n.z-r.z,u=Math.abs(o),l=Math.abs(a),c=Math.abs(s),h=Math.max(u,l,c),f=this.radiusOverlap,d=0;if(h+i>f)return u+i>f&&(d^=o>0?this.tree.FLAG_POS_X:this.tree.FLAG_NEG_X),l+i>f&&(d^=a>0?this.tree.FLAG_POS_Y:this.tree.FLAG_NEG_Y),c+i>f&&(d^=s>0?this.tree.FLAG_POS_Z:this.tree.FLAG_NEG_Z),e.indexOctant=-d-this.tree.INDEX_OUTSIDE_OFFSET,e.indexOctant;var g=this.overlap;if(o-i>-g)d|=1;else if(!(o+i<g))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;if(a-i>-g)d|=2;else if(!(a+i<g))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;if(s-i>-g)d|=4;else if(!(s+i<g))return e.indexOctant=this.tree.INDEX_INSIDE_CROSS,e.indexOctant;return e.indexOctant=d,e.indexOctant}},{key:"getOctantIndexFromPosition",value:function(t,e,n){var i=0;return t>0&&(i|=1),e>0&&(i|=2),n>0&&(i|=4),i}},{key:"search",value:function(t,e,n,i,r){var o=void 0;if(o=i?this.intersectRay(t,i,e,r):this.intersectSphere(t,e),o===!0){n=n.concat(this.objects);for(var a=this.nodesIndices,s=Array.isArray(a),u=0,a=s?a:a[Symbol.iterator]();;){var l;if(s){if(u>=a.length)break;l=a[u++]}else{if(u=a.next(),u.done)break;l=u.value}var c=l,h=this.nodesByIndex[c];n=h.search(t,e,n,i)}}return n}},{key:"intersectSphere",value:function(t,e){var n=t.x,i=t.y,r=t.z,o=e*e;return n<this.left?o-=Math.pow(n-this.left,2):n>this.right&&(o-=Math.pow(n-this.right,2)),i<this.bottom?o-=Math.pow(i-this.bottom,2):i>this.top&&(o-=Math.pow(i-this.top,2)),r<this.back?o-=Math.pow(r-this.back,2):r>this.front&&(o-=Math.pow(r-this.front,2)),o>=0}},{key:"intersectRay",value:function(t,e,n,i){"undefined"==typeof i&&(i=this.utilVec31Ray.set(1,1,1).divide(e));var r=(this.left-t.x)*i.x,o=(this.right-t.x)*i.x,a=(this.bottom-t.y)*i.y,s=(this.top-t.y)*i.y,u=(this.back-t.z)*i.z,l=(this.front-t.z)*i.z,c=Math.min(Math.min(Math.max(r,o),Math.max(a,s)),Math.max(u,l));if(c<0)return!1;var h=Math.max(Math.max(Math.min(r,o),Math.min(a,s)),Math.min(u,l));return!(h>c||h>n)}},{key:"getDepthEnd",value:function(t){if(this.nodesIndices.length>0)for(var e=this.nodesIndices,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r,a=this.nodesByIndex[o];t=a.getDepthEnd(t)}else t=!t||this.depth>t?this.depth:t;return t}},{key:"getNodeCountEnd",value:function(){return this.tree.root.getNodeCountRecursive()+1}},{key:"getNodeCountRecursive",value:function(){for(var t=this.nodesIndices.length,e=this.nodesIndices,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;t+=this.nodesByIndex[o].getNodeCountRecursive()}return t}},{key:"getObjectsEnd",value:function(t){t=(t||[]).concat(this.objects);for(var e=this.nodesIndices,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r,a=this.nodesByIndex[o];t=a.getObjectsEnd(t)}return t}},{key:"getObjectCountEnd",value:function(){for(var t=this.objects.length,e=this.nodesIndices,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;t+=this.nodesByIndex[o].getObjectCountEnd()}return t}},{key:"getObjectCountStart",value:function(){for(var e=this.objects.length,n=this.parent;n instanceof t;)e+=n.objects.length,n=n.parent;return e}},{key:"toConsole",value:function(t){var e="   ";t="string"==typeof t?t:e,console.log(this.parent?t+" octree NODE > ":" octree ROOT > ",this," // id: ",this.id," // indexOctant: ",this.indexOctant," // position: ",this.position.x,this.position.y,this.position.z," // radius: ",this.radius," // depth: ",this.depth),console.log(this.parent?t+" ":" ","+ objects ( ",this.objects.length," ) ",this.objects),console.log(this.parent?t+" ":" ","+ children ( ",this.nodesIndices.length," )",this.nodesIndices,this.nodesByIndex);for(var n=this.nodesIndices,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o,s=this.nodesByIndex[a];s.toConsole(t+e)}}}]),t}(),v=function(){function t(e){r(this,t);var n=e||{};n.tree=this,this.nodeCount=0,this.INDEX_INSIDE_CROSS=-1,this.INDEX_OUTSIDE_OFFSET=2,this.INDEX_OUTSIDE_POS_X=o(n.INDEX_OUTSIDE_POS_X)?n.INDEX_OUTSIDE_POS_X:0,this.INDEX_OUTSIDE_NEG_X=o(n.INDEX_OUTSIDE_NEG_X)?n.INDEX_OUTSIDE_NEG_X:1,this.INDEX_OUTSIDE_POS_Y=o(n.INDEX_OUTSIDE_POS_Y)?n.INDEX_OUTSIDE_POS_Y:2,this.INDEX_OUTSIDE_NEG_Y=o(n.INDEX_OUTSIDE_NEG_Y)?n.INDEX_OUTSIDE_NEG_Y:3,this.INDEX_OUTSIDE_POS_Z=o(n.INDEX_OUTSIDE_POS_Z)?n.INDEX_OUTSIDE_POS_Z:4,this.INDEX_OUTSIDE_NEG_Z=o(n.INDEX_OUTSIDE_NEG_Z)?n.INDEX_OUTSIDE_NEG_Z:5,this.INDEX_OUTSIDE_MAP=[],this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_X]={index:this.INDEX_OUTSIDE_POS_X,count:0,x:1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_X]={index:this.INDEX_OUTSIDE_NEG_X,count:0,x:-1,y:0,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Y]={index:this.INDEX_OUTSIDE_POS_Y,count:0,x:0,y:1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Y]={index:this.INDEX_OUTSIDE_NEG_Y,count:0,x:0,y:-1,z:0},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_POS_Z]={index:this.INDEX_OUTSIDE_POS_Z,count:0,x:0,y:0,z:1},this.INDEX_OUTSIDE_MAP[this.INDEX_OUTSIDE_NEG_Z]={index:this.INDEX_OUTSIDE_NEG_Z,count:0,x:0,y:0,z:-1},this.FLAG_POS_X=1<<this.INDEX_OUTSIDE_POS_X+1,this.FLAG_NEG_X=1<<this.INDEX_OUTSIDE_NEG_X+1,this.FLAG_POS_Y=1<<this.INDEX_OUTSIDE_POS_Y+1,this.FLAG_NEG_Y=1<<this.INDEX_OUTSIDE_NEG_Y+1,this.FLAG_POS_Z=1<<this.INDEX_OUTSIDE_POS_Z+1,this.FLAG_NEG_Z=1<<this.INDEX_OUTSIDE_NEG_Z+1,this.utilVec31Search=new f.Vector3,this.utilVec32Search=new f.Vector3,this.scene=n.scene,this.scene&&(this.visualGeometry=new f.BoxGeometry(1,1,1),this.visualMaterial=new f.MeshBasicMaterial({color:16711782,wireframe:!0,wireframeLinewidth:1})),this.objects=[],this.objectsMap={},this.objectsData=[],this.objectsDeferred=[],this.depthMax=o(n.depthMax)?n.depthMax:1/0,this.objectsThreshold=o(n.objectsThreshold)?n.objectsThreshold:8,this.overlapPct=o(n.overlapPct)?n.overlapPct:.15,this.undeferred=n.undeferred||!1,this.root=n.root instanceof g?n.root:new g(n)}return c(t,[{key:"update",value:function(){if(this.objectsDeferred.length>0){for(var t=this.objectsDeferred,e=Array.isArray(t),n=0,t=e?t:t[Symbol.iterator]();;){var i;if(e){if(n>=t.length)break;i=t[n++]}else{if(n=t.next(),n.done)break;i=n.value}var r=i;this.addDeferred(r.object,r.options)}this.objectsDeferred.length=0}}},{key:"add",value:function(t,e){this.undeferred?(this.updateObject(t),this.addDeferred(t,e)):this.objectsDeferred.push({object:t,options:e})}},{key:"addDeferred",value:function(t,e){var n=void 0,i=void 0,r=void 0;if(t instanceof p&&(t=t.object),t.uuid||(t.uuid=f.Math.generateUUID()),!this.objectsMap[t.uuid])if(this.objects.push(t),
this.objectsMap[t.uuid]=t,e&&(i=e.useFaces,r=e.useVertices),r===!0){n=t.geometry;for(var o=n.vertices,a=o,s=Array.isArray(a),u=0,a=s?a:a[Symbol.iterator]();;){var l;if(s){if(u>=a.length)break;l=a[u++]}else{if(u=a.next(),u.done)break;l=u.value}var c=l;this.addObjectData(t,c)}}else if(i===!0){n=t.geometry;for(var h=n.faces,d=h,g=Array.isArray(d),v=0,d=g?d:d[Symbol.iterator]();;){var m;if(g){if(v>=d.length)break;m=d[v++]}else{if(v=d.next(),v.done)break;m=v.value}var y=m;this.addObjectData(t,y)}}else this.addObjectData(t)}},{key:"addObjectData",value:function(t,e){var n=new p(t,e);this.objectsData.push(n),this.root.addObject(n)}},{key:"remove",value:function(t){var e=void 0,n=void 0;if(t instanceof p&&(t=t.object),this.objectsMap[t.uuid]){if(delete this.objectsMap[t.uuid],e=u(this.objects,t),e!==-1){this.objects.splice(e,1),n=this.root.removeObject(t);for(var i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;e=u(this.objectsData,s),e!==-1&&this.objectsData.splice(e,1)}}}else this.objectsDeferred.length>0&&(e=l(this.objectsDeferred,"object",t),e!==-1&&this.objectsDeferred.splice(e,1))}},{key:"extend",value:function(e){if(e instanceof t)for(var n=e.objectsData,i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;this.add(s,{useFaces:s.faces,useVertices:s.vertices})}}},{key:"rebuild",value:function(){for(var t=[],e=this.objectsData,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r,a=o.node;if(o.update(),a instanceof g&&!o.positionLast.equals(o.position)){var s=o.indexOctant,u=a.getOctantIndex(o);u!==s&&t.push(o)}}for(var l=t,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var d=f;d.node.removeObject(d),this.root.addObject(d)}}},{key:"updateObject",value:function(t){for(var e=[t],n=t.parent,i=void 0;n;)e.push(n),n=n.parent;for(var r=e,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;u.matrixWorldNeedsUpdate===!0&&(i=u)}"undefined"!=typeof i&&i.updateMatrixWorld()}},{key:"setRoot",value:function(t){t instanceof g&&(this.root=t,this.root.updateProperties())}},{key:"search",value:function(t,e,n,i){var r=void 0,o=void 0,a=void 0;r=[].concat(this.root.objects),e>0||(e=Number.MAX_VALUE),i instanceof f.Vector3&&(i=this.utilVec31Search.copy(i).normalize(),a=this.utilVec32Search.set(1,1,1).divide(i));for(var s=this.root.nodesIndices,l=Array.isArray(s),c=0,s=l?s:s[Symbol.iterator]();;){var h;if(l){if(c>=s.length)break;h=s[c++]}else{if(c=s.next(),c.done)break;h=c.value}var d=h,p=this.root.nodesByIndex[d];r=p.search(t,e,r,i,a)}if(n===!0){var g=[];o=[];for(var v=r,m=Array.isArray(v),y=0,v=m?v:v[Symbol.iterator]();;){var _;if(m){if(y>=v.length)break;_=v[y++]}else{if(y=v.next(),y.done)break;_=y.value}var b=_,x=b.object,w=u(g,x),E=void 0;w===-1?(E={object:x,faces:[],vertices:[]},o.push(E),g.push(x)):E=o[w],b.faces?E.faces.push(b.faces):b.vertices&&E.vertices.push(b.vertices)}}else o=r;return o}},{key:"getDepthEnd",value:function(){return this.root.getDepthEnd()}},{key:"getNodeCountEnd",value:function(){return this.root.getNodeCountEnd()}},{key:"getObjectCountEnd",value:function(){return this.root.getObjectCountEnd()}},{key:"toConsole",value:function(){this.root.toConsole()}}]),t}();d=v;var m=function(){function t(){r(this,t)}return c(t,null,[{key:"intersectOctreeObject",value:function(t,e,n){var i=void 0;if(e.object instanceof f.Object3D){var r=e,o=e.object,a=r.faces,s=o.geometry.faces;a.length>0&&(o.geometry.faces=a),i=t.intersectObject(o,n),a.length>0&&(o.geometry.faces=s)}else i=t.intersectObject(e,n);return i}},{key:"intersectOctreeObjects",value:function(e,n,i){for(var r=[],o=function(t,e){return t.distance<e.distance?-1:t.distance>e.distance?1:0},a=n,s=Array.isArray(a),u=0,a=s?a:a[Symbol.iterator]();;){var l;if(s){if(u>=a.length)break;l=a[u++]}else{if(u=a.next(),u.done)break;l=u.value}var c=l;r=r.concat(t.intersectOctreeObject(e,c,i))}return r.sort(o)}}]),t}();e.Octree=v,e.RaycasterUtils=m},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){var i,r,o=1,a=t.x-e.x,s=t.y-e.y,l=n.x-t.x,c=n.y-t.y,h=a*a+s*s,f=a*c-s*l;if(Math.abs(f)>Number.EPSILON){var d=Math.sqrt(h),p=Math.sqrt(l*l+c*c),g=e.x-s/d,v=e.y+a/d,m=n.x-c/p,y=n.y+l/p,_=((m-g)*c-(y-v)*l)/(a*c-s*l);i=g+a*_-t.x,r=v+s*_-t.y;var b=i*i+r*r;if(b<=2)return new u.Vector2(i,r);o=Math.sqrt(b/2)}else{var x=!1;a>Number.EPSILON?l>Number.EPSILON&&(x=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(x=!0):Math.sign(s)===Math.sign(c)&&(x=!0),x?(i=-s,r=a,o=Math.sqrt(h)):(i=a,r=s,o=Math.sqrt(h/2))}return new u.Vector2(i/o,r/o)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(2),u=i(s),l=function(){function t(){r(this,t)}return a(t,null,[{key:"createExpandedPointsGeometry",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=t.extractPoints(i).shape,a=!u.ShapeUtils.isClockWise(r),s=r.length,l=new u.Geometry;a&&(r=r.reverse(),a=!1),(t.autoClose||r[0].equals(r[s-1]))&&(r.pop(),s--);for(var c=0;c<s;c++){var h=(c-1+s)%s,f=(c+1)%s,d=o(r[c],r[h],r[f]),p=e*Math.sin(n*Math.PI/2),g=d.clone().multiplyScalar(p).add(r[c]);l.vertices.push(new u.Vector3(g.x,g.y,0))}return l.vertices.push(l.vertices[0].clone()),l}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(2),l=i(u),c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"getAABB",value:function(t){var e=new l.Vector3(0,0,0),n=this.margin||0,i=this.scale,r=i.x/2,o=i.y/2,a=[],s=this.matrixWorld,u=this.material.anchor,c=0,h=0;return e.setFromMatrixPosition(s),e=t.toScreenCoordinate(e.x,e.y,e.z),u&&(c=r-i.x*u[0],h=o-i.y*u[1],e.setX(e.x+c),e.setY(e.y+h)),a.push(e.x-r-n),a.push(e.y-o-n),a.push(0),a.push(e.x+r+n),a.push(e.y+o+n),a.push(0),a}},{key:"makeCollision",value:function(t){return this.visible=!t,this.material.opacity=this.destOpacity?this.destOpacity:1,this}}]),e}(l.Sprite);e.default=c},function(t,e,n){(function(t){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function t(){function e(t){return r.appendChild(t.dom),t}function n(t){for(var e=0;e<r.children.length;e++)r.children[e].style.display=e===t?"block":"none";i=t}var i=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(t){t.preventDefault(),n(++i%r.children.length)},!1);var o=(performance||Date).now(),a=o,s=0,u=e(new t.Panel("FPS","#0ff","#002")),l=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:r,addPanel:e,showPanel:n,begin:function(){o=(performance||Date).now()},end:function(){s++;var t=(performance||Date).now();if(l.update(t-o,200),t>a+1e3&&(u.update(1e3*s/(t-a),100),a=t,s=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){o=this.end()},domElement:r,setMode:n}};n.Panel=function(t,e,n){var i=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),s=80*a,u=48*a,l=3*a,c=2*a,h=3*a,f=15*a,d=74*a,p=30*a,g=document.createElement("canvas");g.width=s,g.height=u,g.style.cssText="width:80px;height:48px";var v=g.getContext("2d");return v.font="bold "+9*a+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=n,v.fillRect(0,0,s,u),v.fillStyle=e,v.fillText(t,l,c),v.fillRect(h,f,d,p),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h,f,d,p),{dom:g,update:function(u,m){i=Math.min(i,u),r=Math.max(r,u),v.fillStyle=n,v.globalAlpha=1,v.fillRect(0,0,s,f),v.fillStyle=e,v.fillText(o(u)+" "+t+" ("+o(i)+"-"+o(r)+")",l,c),v.drawImage(g,h+a,f,d-a,p,h,f,d-a,p),v.fillRect(h+d-a,f,a,p),v.fillStyle=n,v.globalAlpha=.9,v.fillRect(h+d-a,f,a,o((1-u/m)*p))}}},"object"===e(t)&&(t.exports=n)}).call(e,n(37)(t))},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(26),l=r(u),c=n(19),h=r(c),f=n(6),d=r(f),p=n(2),g=i(p),v={duration:500},m=function(){function t(e,n,i){if(o(this,t),!(e instanceof h.default&&n instanceof l.default))throw new Error("PlaneLineOffsetAnimation: Invalid parameter");this._options=a({},v,i);var r=e.sceneManager.get(-1),s=r._findMesh(n);if(!(s&&s.children[0]&&s.children[0].geometry instanceof g.TubeGeometry))throw new Error("PlaneLineOffsetAnimation: Can not find tube");this._tube=s.children[0],this._onUpdate=this._onUpdate.bind(this),this._animator=d.default.getInstance().ofNumber(1,0,this._options.duration).repeat(1/0).on("update",this._onUpdate)}return s(t,[{key:"_onUpdate",value:function(t,e){this._tube.material.map&&this._tube.material.map.offset.setX(e.num)}},{key:"start",value:function(){this._animator.start()}},{key:"stop",value:function(){this._animator.stop(),this._animator=null,this._tube=null}}]),t}();e.default=m},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),c=r(l),h=n(2),f=i(h),d=function(t){function e(t){if(o(this,e),!(t instanceof f.Group))throw new Error("Invalid three group");var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._root=t,n._originRadius=n._root.children[0].geometry.parameters.radius,n.scaleX=n.scaleX.bind(n),n}return s(e,t),u(e,[{key:"scaleX",value:function(t){if(isNaN(t)||!isFinite(t)||t<=0)return console.warn("TubeScaleHandler: Invalid scale"),this;var e=this._root.children[0],n=e.geometry.parameters,i=new f.TubeGeometry(n.path,n.segments,this._originRadius*t,n.radialSegments,n.closed),r=e.material.clone(),o=new f.Mesh(i,r);return o._sceneId=e._sceneId,this._root.remove(e),e.geometry.dispose(),e.material.map.dispose(),e.material.dispose(),this._root.add(o),this}},{key:"dispose",value:function(){var t=this._root.children[0],e=t.geometry;this._root.remove(t),e.dispose(),t.material.map.dispose(),t.material.map.dispose(),this._root=null}}]),e}(c.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.TubeOffsetAnimation=e.TubeScaleHandler=void 0;var r=n(101),o=i(r),a=n(100),s=i(a);e.TubeScaleHandler=o.default,e.TubeOffsetAnimation=s.default},function(t,e,n){"use strict";var i=n(75),r=n(1);t.exports=function(t){return function(e){e=e||{};var n=r({transparent:!0,uniforms:{thickness:{value:i(e.thickness,.1)},opacity:{value:i(e.opacity,1)},diffuse:{value:new t.Color(e.diffuse)},dashSteps:{value:12},dashDistance:{value:.2},dashSmooth:{value:.01}},vertexShader:["uniform float thickness;","attribute float lineMiter;","attribute vec2 lineNormal;","attribute float lineDistance;","varying float lineU;","void main() {","lineU = lineDistance;","vec3 pointPos = position.xyz + vec3(lineNormal * thickness/2.0 * lineMiter, 0.0);","gl_Position = projectionMatrix * modelViewMatrix * vec4( pointPos, 1.0 );","}"].join("\n"),fragmentShader:["varying float lineU;","uniform float opacity;","uniform vec3 diffuse;","uniform float dashSteps;","uniform float dashSmooth;","uniform float dashDistance;","void main() {","float lineUMod = mod(lineU, 1.0/dashSteps) * dashSteps;","float dash = smoothstep(dashDistance, dashDistance+dashSmooth, length(lineUMod-0.5));","gl_FragColor = vec4(diffuse * vec3(dash), opacity * dash);","}"].join("\n")},e);delete n.thickness,delete n.opacity,delete n.diffuse;var o=0|(parseInt(t.REVISION,10)||0);return o<72&&(n.attributes={lineMiter:{type:"f",value:0},lineDistance:{type:"f",value:0},lineNormal:{type:"v2",value:new t.Vector2}}),n}}},function(t,e,n){var i;!function(r,o,a,s){"use strict";function u(t,e,n,i,r){i=i||0,r=r||0,this.identifier=e,this.target=t,this.clientX=n.clientX+i,this.clientY=n.clientY+r,this.screenX=n.screenX+i,this.screenY=n.screenY+r,this.pageX=n.pageX+i,this.pageY=n.pageY+r}function l(){var t=[];return t.item=function(t){return this[t]||null},t.identifiedTouch=function(t){return this[t+1]||null},t}function c(){for(var t=[r,o.documentElement],e=["ontouchstart","ontouchmove","ontouchcancel","ontouchend"],n=0;n<t.length;n++)for(var i=0;i<e.length;i++)t[n]&&t[n][e[i]]==s&&(t[n][e[i]]=null)}function h(){return"ontouchstart"in r||r.Modernizr&&r.Modernizr.touch||(navigator.msMaxTouchPoints||navigator.maxTouchPoints)>2}function f(t){t.preventDefault(),t.stopPropagation()}function d(t){return function(e){f(e),1===e.which&&(("mousedown"==e.type||!x||x&&!x.dispatchEvent)&&(x=e.target),w&&!e.shiftKey&&(p("touchend",e),w=!1),p(t,e),!w&&e.shiftKey&&(w=!0,b={pageX:e.pageX,pageY:e.pageY,clientX:e.clientX,clientY:e.clientY,screenX:e.screenX,screenY:e.screenY},p("touchstart",e)),"mouseup"==e.type&&(b=null,w=!1,x=null))}}function p(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.altKey=e.altKey,n.ctrlKey=e.ctrlKey,n.metaKey=e.metaKey,n.shiftKey=e.shiftKey,n.touches=v(e,t),n.targetTouches=v(e,t),n.changedTouches=m(e,t),x.dispatchEvent(n)}function g(t){var e=new l;if(w){var n=_.multiTouchOffset,i=b.pageX-t.pageX,r=b.pageY-t.pageY;e.push(new u(x,1,b,i*-1-n,r*-1)),e.push(new u(x,2,b,i+n,r))}else e.push(new u(x,1,t,0,0));return e}function v(t,e){if("mouseup"==t.type)return new l;var n=g(t);return w&&"mouseup"!=t.type&&"touchend"==e&&n.splice(1,1),n}function m(t,e){var n=g(t);return!w||"mouseup"==t.type||"touchstart"!=e&&"touchend"!=e||n.splice(0,1),n}function y(t){var e,n,i,r;for(n=0;n<t.touches.length;n++){e=t.touches[n],i=E[e.identifier],i||(i=E[e.identifier]=o.createElement("div"),o.body.appendChild(i)),r=_.template(e);for(var a in r)i.style[a]=r[a]}if("touchend"==t.type||"touchcancel"==t.type)for(n=0;n<t.changedTouches.length;n++)e=t.changedTouches[n],i=E[e.identifier],i&&(i.parentNode.removeChild(i),delete E[e.identifier])}function _(){h()||(c(),r.addEventListener("mousedown",d("touchstart"),!0),r.addEventListener("mousemove",d("touchmove"),!0),r.addEventListener("mouseup",d("touchend"),!0),r.addEventListener("mouseenter",f,!0),r.addEventListener("mouseleave",f,!0),r.addEventListener("mouseout",f,!0),r.addEventListener("mouseover",f,!0),r.addEventListener("touchstart",y,!1),r.addEventListener("touchmove",y,!1),r.addEventListener("touchend",y,!1),r.addEventListener("touchcancel",y,!1))}var b,x,w=!1,E={};o.createTouch||(o.createTouch=function(t,e,n,i,o,a,l,c,h){return c!=s&&h!=s||(c=i-r.pageXOffset,h=o-r.pageYOffset),new u(e,n,{pageX:i,pageY:o,screenX:a,screenY:l,clientX:c,clientY:h})}),o.createTouchList||(o.createTouchList=function(){for(var t=new l,e=0;e<arguments.length;e++)t[e]=arguments[e];return t.length=arguments.length,t}),_.multiTouchOffset=75,_.template=function(t){var e=30,n="translate("+(t.clientX-e/2)+"px, "+(t.clientY-e/2)+"px)";return{position:"fixed",left:0,top:0,background:"#fff",border:"solid 1px #999",opacity:.6,borderRadius:"100%",height:e+"px",width:e+"px",padding:0,margin:0,display:"block",overflow:"hidden",pointerEvents:"none",webkitUserSelect:"none",mozUserSelect:"none",userSelect:"none",webkitTransform:n,mozTransform:n,transform:n}},i=function(){return _}.call(e,n,e,t),!(i!==s&&(t.exports=i))}(window,document,"TouchEmulator")},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"start",value:function(t){}},{key:"stop",value:function(){return this}},{key:"end",value:function(){}},{key:"repeat",value:function(t){return this}},{key:"delay",value:function(t){return this}},{key:"timeInterpolator",get:function(){return this._timeInterpolator},set:function(t){this._timeInterpolator=t}},{key:"typeEvaluator",get:function(){return this._typeEvaluator},set:function(t){this._typeEvaluator=t}}]),e}(l.default);e.default=c},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"update",value:function(t){}},{key:"ofNumber",value:function(){}},{key:"ofObject",value:function(){}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i,r){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var a=Object.getPrototypeOf(e);null!==a&&t(a,n,i,r)}else if("value"in o&&o.writable)o.value=i;else{var s=o.set;void 0!==s&&s.call(r,i)}return i},l=n(105),c=i(l),h=n(73),f=i(h),d=function(t){function e(t,n,i){r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));a._t=new f.default.Tween(t).to(n,i);var s=a;return a._t.onStart(function(t){s.emit("start",s,t)}),a._t.onUpdate(function(t){s.emit("update",s,this,t)}),a._t.onComplete(function(){s.emit("complete",s,this)}),a._t.onStop(function(){s.emit("stop",s,this)}),a}return a(e,t),s(e,[{key:"start",value:function(t){return this._t.start(t),this}},{key:"stop",value:function(){return this._t.stop(),this}},{key:"repeat",value:function(t){return this._t.repeat(t),this}},{key:"delay",value:function(t){return this._t.delay(t),this}},{key:"easing",value:function(t){return this._t.easing(t),this}},{key:"interpolation",value:function(t){return this._t.interpolation(t),this}},{key:"Easing",get:function(){return f.default.Easing}},{key:"Interpolation",get:function(){return f.default.Interpolation}},{key:"timeInterpolator",set:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"timeInterpolator",t,this),this._t.easing(function(e){return t.getInterpolation(e)})}},{key:"typeEvaluator",set:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"typeEvaluator",t,this),this._t.interpolation(function(e,n){t.evaluate(n,e,e)})}}]),e}(c.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(106),l=i(u),c=n(107),h=i(c),f=n(73),d=i(f),p=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"update",value:function(t){d.default.update(t)}},{key:"ofNumber",value:function(){var t,e;if(arguments.length<3)throw new Error("At least three parameters are required!");var n={num:arguments.length<=0?void 0:arguments[0]},i={num:(t=arguments.length-2,arguments.length<=t?void 0:arguments[t])},r=(e=arguments.length-1,arguments.length<=e?void 0:arguments[e]);return new h.default(n,i,r)}},{key:"ofObject",value:function(){var t,e;if(arguments.length<3)throw new Error("At least three parameters are required!");var n=arguments.length<=0?void 0:arguments[0],i=(t=arguments.length-2,arguments.length<=t?void 0:arguments[t]),r=(e=arguments.length-1,arguments.length<=e?void 0:arguments[e]);return new h.default(n,i,r)}}]),e}(l.default);e.default=p},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.AnimatorFactory=void 0;var r=n(6),o=i(r);e.AnimatorFactory=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(17),l=i(u),c=n(4),h=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._position=new c.geom.Coordinate(0,0,0),n._target=new c.geom.Coordinate(0,0,0),n._up=new c.geom.Coordinate(0,0,0),n}return a(e,t),s(e,[{key:"initRect",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:.667,arguments.length>2&&void 0!==arguments[2]?arguments[2]:60}},{key:"reSize",value:function(t,e){}},{key:"onActiveCamera",value:function(t){this._mapView=t}},{key:"toScreenCoordinate",value:function(t,e,n){}},{key:"toCameraCoordinate",value:function(t,e,n){}},{key:"lookAt",value:function(t,e,n){}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}},{key:"target",get:function(){return this._target},set:function(t){this._target=t}},{key:"up",get:function(){return this._up},set:function(t){this._up=t}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),c=r(l),h=n(2),f=i(h),d=n(27),p=i(d),g=n(35),v=r(g),m=n(18),y=n(6),_=r(y),b=n(3),x=180/Math.PI,w=Math.PI/180,E=0,S=0,M=function(t){function e(t,n){o(this,e);var i=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._activeCamera=t,i._camera=t.camera,i._mapView=n,i._EPS=1e-6,i._target=new f.Vector3,i._minDistance=30,i._maxDistance=1/0,i._curDistance=0,i._curZoomStatus=0,i._minSkewAngle=0,i._maxSkewAngle=60,i._boundScale=1.5,i._enableVerticalMove=!1,i._passMinMove=!0,i._staticMove=!0,i._staticZoom=!1,i._target0=i._target.clone(),i._position0=i._camera.position.clone(),i._spherical=new f.Spherical,i._sphericalDelta=new f.Spherical,i._scale=1,i._panOffset=new f.Vector3,i._zoomChanged=!1,i.__rotateStart=0,i.__rotateEnd=0,i.__rotateDelta=0,i._panStart=new f.Vector2,i._panEnd=new f.Vector2,i._panDelta=new f.Vector2,i._shoveStart=0,i._shoveEnd=0,i._shoveDelta=0,i._shoveStart0=0,i._shoveStart1=0,i._shoveDelta0=0,i._shoveDelta1=0,i._dollyStart=0,i._dollyEnd=0,i._dollyDelta=0,i._offset=new f.Vector3,i._quat=(new f.Quaternion).setFromUnitVectors(i._camera.up,new f.Vector3(0,1,0)),i._quatInverse=i._quat.clone().inverse(),i._rotateMatrixAngle=new f.Matrix4,i._rotateAxis=new f.Vector3(0,0,1),i._rotatePan=new f.Vector3(0,0,0),i._rotateCenter=new f.Vector3(0,0,0),i._skewMatrixAngle=new f.Matrix4,i._lastPosition=new f.Vector3,i._lastQuaternion=new f.Quaternion,i._moveStart=i._moveStart.bind(i),i._moveEnd=i._moveEnd.bind(i),i._move=i._move.bind(i),i._rotateStart=i._rotateStart.bind(i),i._rotateEnd=i._rotateEnd.bind(i),i._rotate=i._rotate.bind(i),i._zoomStart=i._zoomStart.bind(i),i._zoomEnd=i._zoomEnd.bind(i),i._zoom=i._zoom.bind(i),i._skewStart=i._skewStart.bind(i),i._skewEnd=i._skewEnd.bind(i),i._skew=i._skew.bind(i),i._doubleTapZoom=i._doubleTapZoom.bind(i),i._changePlanarGraph=i._changePlanarGraph.bind(i),i._mapView.gestureManager.on("moveStart",i._moveStart),i._mapView.gestureManager.on("moveEnd",i._moveEnd),i._mapView.gestureManager.on("move",i._move),i._mapView.gestureManager.on("rotateStart",i._rotateStart),i._mapView.gestureManager.on("rotateEnd",i._rotateEnd),i._mapView.gestureManager.on("rotate",i._rotate),i._mapView.gestureManager.on("zoomStart",i._zoomStart),i._mapView.gestureManager.on("zoomEnd",i._zoomEnd),i._mapView.gestureManager.on("zoom",i._zoom),i._mapView.gestureManager.on("skewStart",i._skewStart),i._mapView.gestureManager.on("skewEnd",i._skewEnd),i._mapView.gestureManager.on("skewUp",i._skew),i._mapView.gestureManager.on("skewDown",i._skew),i._mapView.gestureManager.on("doubleTap",i._doubleTapZoom),i._mapView.on("changePlanarGraph",i._changePlanarGraph),i}return s(e,t),u(e,[{key:"_doubleTapZoom",value:function(){var t=this;_.default.getInstance().ofNumber(1.5,0,300).on("update",function(){t.zoom(.95,!0,!1,!1)}).on("start",function(){}).on("complete",function(){}).start();var e=new v.default;e.type="cameraControl",this._mapView.gestureManager.emit("zoomEnd",e)}},{key:"_moveStart",value:function(t){var e=t.touches[0],n=e.clientX,i=e.clientY;this._panStart.set(n,i),this._moveOrigin=this._panStart.clone()}},{key:"_moveEnd",value:function(t){var e=this,n=t.type,i=new f.Vector2;this._moveOrigin?i.subVectors(this._panEnd,this._moveOrigin):this._passMinMove=!1,i.length()<50&&(this._passMinMove=!1),this._staticMove&&this._passMinMove&&_.default.getInstance().ofNumber(1.5,0,300).on("update",function(t,n){var i=n.num;e.move(e._panDelta.x*i,e._panDelta.y*i,0,!0,!1,!1)}).on("start",function(){}).on("complete",function(){}).start(),"cameraControl"!==n&&(this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),this._moveOrigin=null)}},{key:"_move",value:function(t){var e=t.touches[0],n=e.clientX,i=e.clientY;
this._panEnd.set(n,i),this._panDelta.subVectors(this._panEnd,this._panStart),this.move(this._panDelta.x,this._panDelta.y,0,!1,!1,!1),this._passMinMove=!0,this._panDelta.length()<19,this._panStart.copy(this._panEnd),this.update()}},{key:"_rotateStart",value:function(t){var e=t.rotate;this.__rotateStart=e}},{key:"_rotateEnd",value:function(t){var e=t.type;"cameraControl"!==e&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0)}},{key:"_rotate",value:function(t){var e=t.rotate,n=this._activeCamera.toCameraCoordinate(this._mapView.width/2,this._mapView.length/2,0),i=n.x,r=n.y;this.__rotateEnd=e,this.__rotateDelta=this.__rotateEnd-this.__rotateStart,Math.abs(this.__rotateDelta)>.2&&this.rotate(i,r,this.__rotateDelta,!1,!1,!1),this.__rotateStart=this.__rotateEnd,this.update()}},{key:"_zoomStart",value:function(t){var e=t.scale;this._dollyStart=e}},{key:"_zoomEnd",value:function(t){var e=this,n=t.type;this._staticZoom&&_.default.getInstance().ofNumber(1.5,1,300).on("update",function(t,n){var i=n.num;e.zoom(i,!0,!1,!1)}).on("start",function(){}).on("complete",function(){}).start(),"cameraControl"!==n&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0)}},{key:"_zoom",value:function(t){var e=t.scale,n=t.touches.length;this._dollyEnd=e,1===n?(this._dollyDelta=this._dollyEnd-this._dollyStart,this.zoom(1-this._dollyDelta,!1,!1,!1)):(this._dollyDelta=this._dollyStart/this._dollyEnd,this.zoom(this._dollyDelta,!1,!1,!1)),this._dollyStart=this._dollyEnd,this.update()}},{key:"_skewStart",value:function(t){var e=t.touches;this._shoveStart=e[0].clientY,e.length>1&&(this._shoveStart0=e[0].clientY,this._shoveStart1=e[1].clientY)}},{key:"_skewEnd",value:function(t){var e=t.type;"cameraControl"!==e&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0)}},{key:"_skew",value:function(t){var e=t.type,n=t.touches;this._shoveEnd=n[0].clientY,n.length>1&&(this._shoveDelta0=n[0].clientY-this._shoveStart0,this._shoveDelta1=n[1].clientY-this._shoveStart1),this._shoveDelta=this._shoveEnd-this._shoveStart,(this._shoveDelta0*this._shoveDelta1>0||1===n.length)&&Math.abs(this._shoveDelta/4)>.1&&("skewUp"===e?this.skew(this._shoveDelta/4,!1,!1,!1):"skewDown"===e&&this.skew(this._shoveDelta/4,!1,!1,!1)),this._shoveStart=this._shoveEnd,n.length>1&&(this._shoveStart0=n[0].clientY,this._shoveStart1=n[1].clientY),this.update()}},{key:"_changePlanarGraph",value:function(t,e){this._bound=this._activeCamera.bound.clone(),this._bound.scaleRadius(this._boundScale),1===e.length?this._maxDistance=1.2*this._activeCamera.originDistance:this._maxDistance=this._activeCamera.originDistance+this._mapView._floorHeight*(e.length-1),this._minDistance>=this._maxDistance&&(this._minDistance=.6*this._maxDistance),this._position0.setZ(this._camera.position.z),this._calculateCameraZ(),this.update()}},{key:"dispose",value:function(){return this._mapView.gestureManager.off("moveStart",this._moveStart),this._mapView.gestureManager.off("moveEnd",this._moveEnd),this._mapView.gestureManager.off("move",this._move),this._mapView.gestureManager.off("rotateStart",this._rotateStart),this._mapView.gestureManager.off("rotateEnd",this._rotateEnd),this._mapView.gestureManager.off("rotate",this._rotate),this._mapView.gestureManager.off("skewStart",this._skewStart),this._mapView.gestureManager.off("skewEnd",this._skewEnd),this._mapView.gestureManager.off("skew",this._skew),this._mapView.gestureManager.off("doubleTap",this._doubleTapZoom),this._mapView.off("changePlanarGraph",this._changePlanarGraph),this._activeCamera=null,this._camera=null,this._mapView=null,this._skewMatrixAngle=null,this._rotateMatrixAngle=null,this}},{key:"reset",value:function(){return this._target=this._target0,this._activeCamera.position=this._position0,this._activeCamera.up=new f.Vector3(0,1,0),this._camera.updateProjectionMatrix(),this.update(),this}},{key:"update",value:function(){var t=this._camera.position;this._offset.copy(t).sub(this._target),this._offset.applyQuaternion(this._quat),this._spherical.setFromVector3(this._offset),this._spherical.makeSafe(),this._spherical.radius*=this._scale,this._spherical.radius=Math.max(this._minDistance,Math.min(this._maxDistance,this._spherical.radius)),1!==this._scale&&(this._spherical.radius>=this._maxDistance?this._changeZoomStatus(1):this._spherical.radius<=this._minDistance?this._changeZoomStatus(2):this._changeZoomStatus(0));var e=this._target.clone();return e.add(this._panOffset),this._bound&&this._bound.containsPoint(e)&&this._target.copy(e),this._offset.setFromSpherical(this._spherical),this._offset.applyQuaternion(this._quatInverse),t.copy(this._target).add(this._offset),this._activeCamera.target=this._target,this._camera.lookAt(this._target),this._curDistance=t.distanceTo(this._target),this._sphericalDelta.set(0,0,0),this._scale=1,this._panOffset.set(0,0,0),this._zoomChanged||this._lastPosition.distanceToSquared(this._camera.position)>this._EPS||8*(1-this._lastQuaternion.dot(this._camera.quaternion))>this._EPS?(this._lastPosition.copy(this._camera.position),this._lastQuaternion.copy(this._camera.quaternion),this._zoomChanged=!1,!0):(this._lastPosition.copy(this._camera.position),!1)}},{key:"enableVerticalMove",value:function(){return this._enableVerticalMove=!0,this}},{key:"disableVerticalMove",value:function(){return this._enableVerticalMove=!1,this}},{key:"move",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=n;if(E+=t,S+=e,E>300)return E=300;if(E<-300)return E=-300;if(S>500)return S=500;if(S<-500)return S=-500;a=this._enableVerticalMove===!1?0:n;var s=this._camera.position,u=(new f.Vector3).copy(s).sub(this._target),l=u.length();if(l*=Math.tan(this._camera.fov/2*w),this._moveLeft(2*t*l/this._mapView.height,this._camera.matrix),this._moveForward(2*e*l/this._mapView.height,this._camera.matrix),this._camera.position.z-=a,this._target.z-=a,i&&this.update(),r&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),o){var c=new v.default;c.type="cameraControl",this._mapView.gestureManager.emit("moveEnd",c)}return this}},{key:"moveToPoint",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=t-this._target.x,s=e-this._target.y;if(this._enableVerticalMove===!0&&(0,b.isPresent)(n)){var u=n-this._target.z;this._panOffset.set(a,s,u)}else this._panOffset.setX(a),this._panOffset.setY(s);if(i&&this.update(),r&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),o){var l=new v.default;l.type="cameraControl",this._mapView.gestureManager.emit("moveEnd",l)}return this}},{key:"fitBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(4!==t.length&&6!==t.length)throw new Error("Invalid bounds");var u=this.getRotate(),l=this.getSkew();return this.skewTo(.1,i,r,o),this._fitBoundsInVerticalView(t,l,e,n,i,r,o,a),this.skewTo(l,i,r,o),s||this.rotateTo(this._target.x,this._target.y,u,i,r,o),this}},{key:"_fitBoundsInVerticalView",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=(!(arguments.length>3&&void 0!==arguments[3])||arguments[3],!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=this,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=t.slice(),l=this._mapView.activeCamera;l.camera.updateMatrix(),l.camera.updateMatrixWorld(),4===t.length&&(u=[t[0],t[1],0,t[2],t[3],0]);var c=(u[0]+u[3])/2,h=(u[1]+u[4])/2,d=(u[2]+u[5])/2;this.moveToPoint(c,h,d,i,r,a),this.rotateTo(c,h,0);var p=new f.Vector3(u[0]-c,u[1]-h,u[2]-d),g=new f.Vector3(u[3]-c,u[4]-h,u[5]-d),y=l.toScreenCoordinate(p.x,p.y,p.z),b=l.toScreenCoordinate(p.x,g.y,p.z),x=l.toScreenCoordinate(g.x,p.y,p.z),w=l.toScreenCoordinate(g.x,g.y,p.z),E=l.toScreenCoordinate(p.x,p.y,g.z),S=l.toScreenCoordinate(p.x,g.y,g.z),M=l.toScreenCoordinate(g.x,p.y,g.z),C=l.toScreenCoordinate(g.x,g.y,g.z),I=Math.min(y.x,b.x,x.x,w.x,E.x,S.x,M.x,C.x),O=Math.max(y.x,b.x,x.x,w.x,E.x,S.x,M.x,C.x),T=Math.min(y.y,b.y,x.y,w.y,E.y,S.y,M.y,C.y),P=Math.max(y.y,b.y,x.y,w.y,E.y,S.y,M.y,C.y),A=(O-I)/this._mapView.width,L=(P-T)/this._mapView.height,N=Math.max(A,L),k=this._camera.position.clone(),R=this._target,D=k.clone().sub(R).multiplyScalar(N/n),F=R.clone().add(D);if(s&&i){var B=new f.Vector3;_.default.getInstance().ofNumber(1,0,500).on("update",function(t,n){var i=n.num;B.setX(i*k.x+(1-i)*F.x),B.setY(i*k.y+(1-i)*F.y),B.setZ(i*k.z+(1-i)*F.z),o._camera.position.copy(B),o.skewTo(e,!0,!1,!1)}).on("start",function(){}).on("complete",function(){if(r&&o._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),a){var t=new v.default;t.type="cameraControl",o._mapView.gestureManager.emit("zoomEnd",t)}}).start()}else if(this._camera.position.copy(F),i&&this.update(),r&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),a){var j=new v.default;j.type="cameraControl",this._mapView.gestureManager.emit("zoomEnd",j)}return this}},{key:"zoom",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this._scale=t,e&&this.update(),n&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),i){var r=new v.default;r.type="cameraControl",this._mapView.gestureManager.emit("zoomEnd",r)}return this}},{key:"zoomByFocalLength",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=new f.Vector3;if(r.subVectors(this._camera.position,this._target),this._scale=t/r.length(),e&&this.update(),n&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),i){var o=new v.default;o.type="cameraControl",this._mapView.gestureManager.emit("zoomEnd",o)}return this}},{key:"skewTo",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=t;t>this._maxSkewAngle+.01?r=this._maxSkewAngle+.01:t<this._minSkewAngle+.01&&(r=this._minSkewAngle+.01),0===r&&(r=.01);var o=this._camera.position,a=this._target,s=o.clone().sub(a),u=a.clone().setZ(s.length()+a.z);s=u.sub(a),this._camera.up.setZ(0);var l=new f.Vector3(this._camera.up.y,-this._camera.up.x,0).normalize();if(this._skewMatrixAngle.makeRotationAxis(l,r*w),s.applyMatrix4(this._skewMatrixAngle),o.copy(a).add(s),this._camera.up.applyMatrix4(this._skewMatrixAngle),e&&this.update(),n&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),i){var c=new v.default;c.type="cameraControl",this._mapView.gestureManager.emit("skewEnd",c)}return this}},{key:"getSkew",value:function(){var t=this._camera.position.clone().sub(this._target).normalize();return t.angleTo(this._rotateAxis)*x}},{key:"skew",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=this._camera.position,o=this._target,a=(new f.Vector3).copy(r).sub(o),s=a.angleTo(this._rotateAxis)*x,u=t;if(u+s>this._maxSkewAngle+.01||u+s<this._minSkewAngle+.01)u=0;else{var l=this._camera.up.clone();l.cross(a).normalize(),this._skewMatrixAngle.makeRotationAxis(l,u*w),a.applyMatrix4(this._skewMatrixAngle),r.copy(o).add(a),this._camera.up.applyMatrix4(this._skewMatrixAngle)}if(e&&this.update(),n&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),i){var c=new v.default;c.type="cameraControl",this._mapView.gestureManager.emit("skewEnd",c)}return this}},{key:"getRotate",value:function(){var t=this._camera.position.clone().sub(this._target),e=this._camera.up.clone().cross(t).normalize();return 360-this._getAngle(e)}},{key:"rotate",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];this._rotateCenter.set(t,e,this._target.z),this._rotateMatrixAngle.makeRotationAxis(this._rotateAxis,n*w),this._rotateMatrixAngle.setPosition(this._rotateCenter);var a=new f.Vector3,s=new f.Vector3;a.subVectors(this._camera.position,this._rotateCenter),a.setZ(0),s.subVectors(this._target,this._rotateCenter),s.setZ(0),s=p.default.getRelCoordOnPlane(s,a,new f.Vector3(-a.y,a.x,0)),this._rotatePan.subVectors(this._camera.position,this._rotateCenter),this._rotatePan.applyMatrix4(this._rotateMatrixAngle),this._camera.position.copy(this._rotatePan),a.subVectors(this._camera.position,this._rotateCenter),a.setZ(0),this._target=p.default.directionalAdd(this._rotateCenter,a,s.x),this._target=p.default.directionalAdd(this._target,new f.Vector3(-a.y,a.x,0),s.y),this._activeCamera.target=this._target;var u=new f.Vector3;if(u.subVectors(this._camera.position,this._target),Math.abs(u.x)<1e-4&&Math.abs(u.y)<1e-4?this._camera.up.applyMatrix4(this._rotateMatrixAngle):(this._camera.up.x=-u.x,this._camera.up.y=-u.y,this._camera.up.z=(u.x*u.x+u.y*u.y)/u.z,this._camera.up.normalize()),i&&this.update(),r&&this._mapView.collisionSceneManager.animation(m.CAType.Opacity).updateCollision(!0),o){var l=new v.default;l.type="cameraControl",this._mapView.gestureManager.emit("rotateEnd",l)}return this}},{key:"rotateTo",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];if(this.rotate(t,e,-this.getRotate(),!1,!1,!1),this.rotate(t,e,n,!1,!1,!1),i&&this.update(),r&&this._mapView.collisionSceneManager.updateCollision(),o){var a=new v.default;a.type="cameraControl",this._mapView.gestureManager.emit("rotateEnd",a)}return this}},{key:"_changeZoomStatus",value:function(t){return t===this._curZoomStatus?null:(this._curZoomStatus=t,this.emit("changeZoomStatus",this,this._curZoomStatus),this)}},{key:"_moveLeft",value:function(t,e){var n=new f.Vector3;return n.setFromMatrixColumn(e,0),n.multiplyScalar(-t),this._panOffset.add(n),this._panOffset.z=0,this}},{key:"_moveForward",value:function(t,e){var n=new f.Vector3;return n.setFromMatrixColumn(e,1),n.multiplyScalar(t),this._panOffset.add(n),this._panOffset.z=0,this}},{key:"_setFromSpherical",value:function(t,e){var n=Math.sin(e.phi)*e.radius;return t.y=n*Math.sin(e.theta),t.z=Math.cos(e.phi)*e.radius,t.x=n*Math.cos(e.theta),t}},{key:"_calculateCameraZ",value:function(){if(0===this._curDistance)return null;var t=this._camera.position,e=t.distanceTo(this._target);return e>this._maxDistance&&(e=this._maxDistance),e<this._minDistance&&(e=this._minDistance),this._offset.copy(this._lastPosition).sub(this._target),this._offset.normalize().multiplyScalar(e),t.copy(this._target).add(this._offset),this}},{key:"_setFromVector3",value:function(t,e){return t.radius=e.length(),0===t.radius?(t.theta=0,t.phi=0):(t.theta=Math.atan2(e.y,e.x),t.phi=Math.acos(f.Math.clamp(e.z/t.radius,-1,1))),t}},{key:"_getVectorAngle",value:function(t,e){var n=t.length(),i=e.length();return 0===n||0===i?0:Math.acos(e.dot(t)/(n*i))*x}},{key:"_getAngle1",value:function(t){if(0===t.z)return t.y>0?180:0;if(0===t.y)return t.z>0?90:270;var e=f.Math.clamp(t.z/Math.sqrt(t.y*t.y+t.z*t.z),-1,1),n=Math.atan(Math.sqrt(1-e*e)/e)*x;return t.y<0&&t.z<0?n+270:t.y<0&&t.z>0?n+90:t.y>0&&t.z>0?90-n:t.y>0&&t.z<0?270-n:n}},{key:"_getAngle",value:function(t){if(0===t.y)return t.x<0?180:0;if(0===t.x)return t.y<0?90:270;var e=f.Math.clamp(t.y/Math.sqrt(t.x*t.x+t.y*t.y),-1,1),n=Math.atan(Math.sqrt(1-e*e)/e)*x;return t.x>0&&t.y>0?n+270:t.x>0&&t.y<0?n+90:t.x<0&&t.y<0?90-n:t.x<0&&t.y>0?270-n:n}},{key:"minDistance",set:function(t){t>=0&&t<this._maxDistance&&(this._minDistance=t)},get:function(){return this._minDistance}},{key:"maxDistance",set:function(t){t>this._minDistance&&(this._maxDistance=t)},get:function(){return this._maxDistance}},{key:"minSkewAngle",set:function(t){t>=0&&t<=this._maxSkewAngle&&(this._minSkewAngle=t,this.getSkew()<this._minSkewAngle&&this.skewTo(this._minSkewAngle))},get:function(){return this._minSkewAngle}},{key:"maxSkewAngle",set:function(t){t<=90&&t>=this._minSkewAngle&&(this._maxSkewAngle=t,this.getSkew()>this._maxSkewAngle&&this.skewTo(this._maxSkewAngle))},get:function(){return this._maxSkewAngle}},{key:"boundScale",set:function(t){if(isNaN(t)||!isFinite(t)||t<=0)throw new Error("Invalid bound scale");this._boundScale=t},get:function(){return this._boundScale}},{key:"target",set:function(t){this._target=t},get:function(){return this._target}},{key:"focalLength",get:function(){var t=new f.Vector3;return t.subVectors(this._camera.position,this._target).length()}}]),e}(c.default);e.default=M},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.ThreeCamera=void 0;var r=n(21),o=i(r);e.ThreeCamera=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(11),h=i(c),f=n(7),d=n(6),p=i(d),g=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=t.name?"compass-"+t.name:"compass",i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,s({position:"topright"},t)));return i._currentAngle=null,i._disabled=!0,i._element||(i._element=f.DOMUtils.createElement("div","ngr-compass"),i._button=f.DOMUtils.createElement("div","compass-button",i._element),i._divCompass=f.DOMUtils.createElement("div","compass-icon",i._button)),i.rotateCompass=i.rotateCompass.bind(i),i._onClick=i._onClick.bind(i),i}return a(e,t),u(e,[{key:"_onAdd",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this._disabled=!1,this._map.gestureManager.on("rotate","rotateEnd",this.rotateCompass),this._button.addEventListener("click",this._onClick),this}},{key:"_onRemove",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this._disabled=!0,this._map.gestureManager.off("rotate","rotateEnd",this.rotateCompass),this._button.removeEventListener("click",this._onClick),this}},{key:"disable",value:function(){this._disabled=!0}},{key:"enable",value:function(){this._disabled=!1}},{key:"rotateCompass",value:function(){if(this._map.activeControl){var t=this._map.activeControl.getRotate();this._currentAngle=t,this.onUpdate(this._divCompass||this._element,t)}}},{key:"onUpdate",value:function(t,e){t.style.webkitTransform="rotate("+e+"deg)"}},{key:"onClick",value:function(){var t=this._map.activeControl,e=this._currentAngle,n=e>180?360:0;p.default.getInstance().ofNumber(e,n,300).on("update",function(e,n){var i=n.num;t.rotateTo(0,0,i,!0,!1,!1)}).on("complete",function(){t.rotateTo(0,0,n,!0,!0,!0)}).start()}},{key:"_onClick",value:function(){this.onClick()}},{key:"getCurrentAngle",value:function(){return this._currentAngle}}]),e}(h.default);e.default=g},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(22),h=i(c),f=n(6),d=i(f),p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s({name:"dimension",innerHTML:"2D",className:"toggle-dimension",minSkewAngle:0,maxSkewAngle:60},t)));return n._onToggle=n._onToggle.bind(n),n}return a(e,t),u(e,[{key:"_onToggle",value:function(t){var e=t.selected,n=this._map.activeControl,i=this._options,r=i.maxSkewAngle,o=i.minSkewAngle,a=this._button,s=n.getSkew(),u=0;return e?(a.innerHTML="3D",u=o):(a.innerHTML="2D",u=r),d.default.getInstance().ofNumber(s,u,300).on("update",function(t,e){var i=e.num;n.skewTo(i,!0,!1,!1)}).on("complete",function(){n.skewTo(u,!0,!0,!0)}).start(),this}},{key:"_onAdd",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this.on("toggle",this._onToggle),this}},{key:"_onRemove",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this.off("toggle",this._onToggle),this}}]),e}(h.default);e.default=p},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(22),h=i(c),f=n(6),d=i(f),p=n(7),g=n(3),v={className:"ngr-toggle-facility",selectedDisplay:"block",floorControlName:"multiFloor",blurOpacity:.3,animation:{type:"scale",minScale:25,maxScale:50}},m=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=(0,g.isArray)(t)?t:[],a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,s({},v,n)));a._name=a._options.name?"facility-"+a._options.name:"facility",a.facilityContainer=p.DOMUtils.createElement("div","ngr-facility-container"),a.facilityItems=[];for(var u=i,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var h;if(l){if(c>=u.length)break;h=u[c++]}else{if(c=u.next(),c.done)break;h=c.value}var f=h,d=p.DOMUtils.createElement("div","ngr-facility-button",a.facilityContainer),m=f.id,y=f.backgroudImage,_=f.innerHTML,b=f.categories;d.categories=b,m&&(d.id=m),_&&(d.innerHTML=_),y&&(d.style["background-image"]="url("+f.backgroudImage+")"),a.facilityItems.push(d)}return a._blurOpacity=a._options.blurOpacity,a.unblur=!1,a.facilityAnimationId=0,a.facilityAnimationCounts={},a.onToggle=a.onToggle.bind(a),a.onFacilityClick=a.onFacilityClick.bind(a),a}return a(e,t),u(e,[{key:"_onAdd",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this._container.appendChild(this.facilityContainer),this.onToggle({selected:this._selected,targetControl:this}),this.on("toggle",this.onToggle);for(var n=this.facilityItems,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;a.addEventListener("click",this.onFacilityClick,!1)}return this}},{key:"_onRemove",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this._container.removeChild(this.facilityContainer),this.off("toggle",this.onToggle);for(var n=this.facilityItems,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;a.removeEventListener("click",this.onFacilityClick)}return this}},{key:"onToggle",value:function(t){var e=t.selected;return this.facilityContainer.style.display=e?this._options.selectedDisplay:"none",this}},{key:"onFacilityClick",value:function(t){var e=t.target.categories;return e&&this._initFacilityAnimationByCategory(e),this}},{key:"_initFacilityAnimationByCategory",value:function(t){var e=this,n=this._map,i=n.currentPlanarGraphIds,r=n.getDomControl(this._options.floorControlName),o=this._options.animation,a=o.minScale,s=o.maxScale;if(!r)throw new Error("FacilityControl: Invalid floor control name");var u=r.getCurrentFloor(),l={maxCount:i.length,curCount:0},c=this.facilityAnimationId++;this.facilityAnimationCounts[c]=l;for(var h=i,f=Array.isArray(h),d=0,h=f?h:h[Symbol.iterator]();;){var p;if(f){if(d>=h.length)break;p=h[d++]}else{if(d=h.next(),d.done)break;p=d.value}var g=p,v=n.getLayer(g).getLayer("Facility");n.sceneManager.setVisible(v,"category",t,!0),n.sceneManager.setOpacity(v,"category",t,this.unblur||g===Number(u)?1:this.blurOpacity),this._startFacilityAnimation(v,t,a,s,function(){var t=e.facilityAnimationCounts[c];t.curCount++,t.curCount>=t.maxCount&&(delete e.facilityAnimationCounts[c],n.collisionSceneManager.updateCollision())})}}},{key:"_startFacilityAnimation",value:function(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=this,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:300,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2;d.default.getInstance().ofNumber(n,i+n,s).on("update",function(r,o){var s=o.num,u=s>2*n?2*i-s:s;a._map.sceneManager.setScale(t,"category",e,u,u,0)}).on("complete",r).delay(o).repeat(u).start()}},{key:"hide",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"hide",this).call(this),this.facilityContainer.style.display="none"}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"display",this).call(this,t),"none"!==t&&this.getSelected()&&(this.facilityContainer.style.display=this._options.selectedDisplay)}},{key:"unblur",set:function(t){this._unblur=t},get:function(){return this._unblur}},{key:"blurOpacity",set:function(t){this._blurOpacity=t},get:function(){return this._blurOpacity}}]),e}(h.default);e.default=m},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(43),h=i(c),f=n(22),d=i(f),p=n(6),g=i(p),v=n(18),m=n(3),y={className:"ngr-multi-floor-switcher",scrollOptions:{disabled:!1,barHeight:27,maxBarCount:null}},_={selected:!0,className:"ngr-toggle-floor",position:"bottomright",name:"floor"},b=function(t){function e(t){r(this,e);var n=s({},y,t),i=s({},_,n.toggleOptions),a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return a._name=n.name?"multiFloor-"+n.name:"multiFloor",a.toggle=new d.default(i),a._defaulPriority=a._options.defaulPriority?a._options.defaulPriority:4,a._ignoreOpacityLayers=a._options.ignoreOpacityLayers?a._options.ignoreOpacityLayers:["pickMarker"],a._blurOpacity=a._options.blurOpacity?a._options.blurOpacity:.3,a._floorAnimationCount=0,a._options.scrollOptions.maxBarCount&&(a._element.style["max-height"]=a._options.scrollOptions.maxBarCount*a._options.scrollOptions.barHeight+"px"),a.onToggle=a.onToggle.bind(a),a.onFloorChange=a.onFloorChange.bind(a),a}return a(e,t),u(e,[{key:"setContainer",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setContainer",this).call(this,t),this.toggle.setContainer(t),this}},{key:"_onAdd",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this.toggle._onAdd(t),this.on("change",this.onFloorChange),this.toggle.on("toggle",this.onToggle)}},{key:"_onRemove",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this.toggle._onRemove(t),this.toggle._map=null,this.off("change",this.onFloorChange),this.toggle.off("toggle",this.onToggle)}},{key:"hide",value:function(){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"hide",this).call(this),
this.toggle.hide(),this}},{key:"display",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"block";return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"display",this).call(this,t),this.toggle.display(t),this}},{key:"disable",value:function(){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disable",this).call(this),this.toggle.disable(),this}},{key:"enable",value:function(){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"enable",this).call(this),this.toggle.enable(),this}},{key:"_startFloorAnimation",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:300;if(!this._map)return this;var s=this._map.getLayer(t);return g.default.getInstance().ofNumber(e,n,a).on("update",function(t,e){var n=e.num;r._map.sceneManager.quickSetPosition(s,null,null,0,0,n)}).on("complete",i).delay(o).start(),this}},{key:"_setPGPriority",value:function(t,e,n){var i=this;if(e&&this._setPGPriority(e,null,this._defaulPriority+1),!t)return this;var r=this._map.getLayer(t),o=r.getLayer("AreaText"),a=r.getLayer("Facility");return o&&o.visit(function(t){t.priority=n===i._defaulPriority?n-1:n}),a&&a.visit(function(t){t.priority=n}),this}},{key:"_setPGOpacity",value:function(t,e){var n=this,i=this._map.getLayer(t);return i?(i.foreach(function(t,i){var r=n._ignoreOpacityLayers.indexOf(t);r===-1&&n._map.sceneManager.setOpacity(i,null,null,e)}),this):this}},{key:"_highlightPG",value:function(t,e,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=e,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;u===Number(t)?this._setPGOpacity(u,i):this._setPGOpacity(u,n)}return this}},{key:"highlightPGs",value:function(t){if((0,m.isArray)(t))if(1===t.length)this._highlightPG(t[0],this._map.currentPlanarGraphIds,this._blurOpacity),this._setPGPriority(t[0],null,this._defaulPriority);else{for(var e=t,n=Array.isArray(e),i=0,e=n?e:e[Symbol.iterator]();;){var r;if(n){if(i>=e.length)break;r=e[i++]}else{if(i=e.next(),i.done)break;r=i.value}var o=r;this._setPGOpacity(o,1)}this._setPGPriority(null,this.currentFloor,this._defaulPriority)}return this}},{key:"onMultiFloorChange",value:function(t){var e=this,n=this._map,i=n.planarGraphs,r=n.activeControl._target,o=r.x,a=r.y,s=r.z;return g.default.getInstance().ofNumber(s,i.indexOf(Number(t.to))*n._floorHeight,300).on("update",function(t,e){var i=e.num;n.activeControl.moveToPoint(o,a,i,!0,!1,!1)}).on("complete",function(){n.collisionSceneManager.animation(v.CAType.Opacity).updateCollision(!0),e.enable(),e.toggle.disabled=!1,e.fire("animationCompleted",{targetControl:e})}).start(),this._highlightPG(t.to,i,this._blurOpacity),this._setPGPriority(t.to,t.from,this._defaulPriority),this}},{key:"onSingleFloorChange",value:function(t){var e=this,n=this._map,i=n.planarGraphs.indexOf(Number(t.from)),r=n.planarGraphs.indexOf(Number(t.to)),o=n.activeControl.maxDistance+50;if(r===-1||i===-1)throw new Error("MultiFloorControl: Invalid index");var a=n.getLayer(t.to),s=a.getLayer("AreaText"),u=a.getLayer("Facility");return this._setPGOpacity(t.to,1),n.showPlanarGraphs([t.to],!1),n.sceneManager.setOpacity(s,null,null,0),n.sceneManager.setOpacity(u,null,null,0),n.collisionSceneManager.animation(v.CAType.Opacity).updateCollision(!0),this._startFloorAnimation(t.to,r<i?-o:o,0,function(){n.sceneManager.setOpacity(s,null,null,1),n.sceneManager.setOpacity(u,null,null,1),n.collisionSceneManager.animation(v.CAType.Opacity).updateCollision(!0),e.enable(),e.toggle.disabled=!1,e.fire("animationCompleted",{targetControl:e})}),this}},{key:"onToggle",value:function(t){var e=this,n=t.selected,i=this._map,r=this.getCurrentFloor(),o=i.planarGraphs,a=i._floorHeight,s=i.activeControl.maxDistance+50,u=i.activeControl._target,l=u.x,c=u.y,h=0,f=!0,d=void 0,p=void 0;if(this.disable(),this.toggle.disabled=!1,n){var g=function(){e._floorAnimationCount++,e._floorAnimationCount>=o.length&&(i.next(1,function(){i.collisionSceneManager.animation(v.CAType.Opacity).updateCollision(!0)}),e.enable(),e.toggle.disabled=!1,e.fire("animationCompleted",{targetControl:e}),e._floorAnimationCount=0,e._map.sceneManager._octreeManager.rebuild())};this._setPGPriority(r,null,this._defaulPriority),i.showPlanarGraphs(o),this._highlightPG(r,o,this._blurOpacity);for(var m=o,y=Array.isArray(m),_=0,m=y?m:m[Symbol.iterator]();;){var b;if(y){if(_>=m.length)break;b=m[_++]}else{if(_=m.next(),_.done)break;b=_.value}var x=b;x===Number(r)?(d=0,f=!1):d=f?-s:s,this._startFloorAnimation(x,d,h,g),h+=a}i.activeControl.moveToPoint(l,c,o.indexOf(Number(r))*a,!0,!0,!1)}else{var w=function(){e._floorAnimationCount++,e._floorAnimationCount>=o.length&&(i.showPlanarGraphs([r]),e.enable(),e.toggle.disabled=!1,e.fire("animationCompleted",{targetControl:e}),e._floorAnimationCount=0,e._map.sceneManager._octreeManager.rebuild())};this._setPGPriority(null,r,this._defaulPriority);for(var E=o,S=Array.isArray(E),M=0,E=S?E:E[Symbol.iterator]();;){var C;if(S){if(M>=E.length)break;C=E[M++]}else{if(M=E.next(),M.done)break;C=M.value}var I=C;I===Number(r)?(p=0,f=!1):p=f?-s:s,this._startFloorAnimation(I,h,p,w)}i.activeControl.moveToPoint(l,c,0,!0,!1,!1)}}},{key:"_scrollByFloor",value:function(t){var e=this._map.height,n=this._element,i=this._map.planarGraphs.concat().reverse(),r=i.indexOf(Number(t)),o=this._options.scrollOptions.barHeight,a=this._options.scrollOptions.maxBarCount,s=void 0;if(r===-1)return this;a||(a=e<=510?4:e<=550?5:7);var u=(i.length-a)*o;return u<=0?this:(s=o*(r-window.Math.floor((a-1)/2)),s<0?s=0:s>u&&(s=u),g.default.getInstance().ofNumber(n.scrollTop,s,300).on("update",function(t,e){var i=e.num;n.scrollTop=i}).start(),this)}},{key:"onFloorChange",value:function(t){return t.from===t.to?this:(this._options.scrollOptions.disabled||this._scrollByFloor(Number(t.to)),this.disable(),this.toggle.disabled=!1,this.toggle.getSelected()?this.onMultiFloorChange(t):this.onSingleFloorChange(t),this.setCurrentFloor(t.to),this)}},{key:"setCurrentFloor",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setCurrentFloor",this).call(this,t),this._options.scrollOptions.disabled||this._scrollByFloor(Number(t)),this}}]),e}(h.default);e.default=b},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(11),h=i(c),f=n(7),d=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e);var n=t.name?"scale-"+t.name:"scale",i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n,s({maxWidth:100,position:"bottomleft"},t)));return i._element=f.DOMUtils.createElement("div","ngr-control-scale"),i.update=i.update.bind(i),i}return a(e,t),u(e,[{key:"disable",value:function(){return this.hide(),this}},{key:"enable",value:function(){return this.display(),this}},{key:"update",value:function(){var t=this;this._map.next(1,function(){var e=t._map.activeCamera.getMetersPerPixel()*t._options.maxWidth,n=t._getRoundNum(e),i=Math.round(n/e*t._options.maxWidth);t._scaleMiddle.style.width=i+"px",t._scaleEdgeRight.style.left=i+1+"px",t._scaleText.innerHTML=n+"",t._scaleText.style.width=i+"px"})}},{key:"_onAdd",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t);var n="ngr-control-scale";return this._scaleText=f.DOMUtils.createElement("div",n+"-text",this._element),this._scaleLine=f.DOMUtils.createElement("div",n+"-line",this._element),this._scaleEdgeLeft=f.DOMUtils.createElement("div",n+"-edgeleft",this._scaleLine),this._scaleEdgeRight=f.DOMUtils.createElement("div",n+"-edgeright",this._scaleLine),this._scaleMiddle=f.DOMUtils.createElement("div",n+"-middle",this._scaleLine),this._map.gestureManager.on("zoomEnd",this.update),this}},{key:"_onRemove",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this._map.gestureManager.off("zoomEnd",this.update),this}},{key:"_getRoundNum",value:function(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=2?2:1,e*n}}]),e}(h.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(11),h=i(c),f=n(7),d=n(3),p={size:"100px",min:0,max:250,step:1,id:"slider",value:50,collapsed:!0,title:"NGR Slider",logo:"S",orientation:"horizontal",increment:!1,getValue:function(t){return t},showValue:!0,syncSlider:!1},g=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n.name?"slider-"+n.name:"slider",s({},p,n)));return(0,d.isFunction)(t)?i.update=t:i.update=function(t){console.log(t)},(0,d.isFunction)(i._options.getValue)||(i._options.getValue=function(t){return t}),"vertical"!==i._options.orientation&&(i._options.orientation="horizontal"),i._updateValue=i._updateValue.bind(i),i._expand=i._expand.bind(i),i._collapse=i._collapse.bind(i),i._increment=i._increment.bind(i),i._decrement=i._decrement.bind(i),i}return a(e,t),u(e,[{key:"_onAdd",value:function(t){return this._initLayout(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this}},{key:"_updateValue",value:function(){var t=this._options,e=t.showValue,n=t.getValue;this.value=this.slider.value,e&&(this._sliderValue.innerHTML=n(this.value)),this.update(this.value)}},{key:"_expand",value:function(){f.DOMUtils.addClass(this._element,"ngr-control-slider-expanded"),this.slider.focus()}},{key:"_collapse",value:function(){f.DOMUtils.removeClass(this._element,"ngr-control-slider-expanded")}},{key:"_increment",value:function(){this.slider.value=Number(this.slider.value)+Number(this.slider.step),this._updateValue()}},{key:"_decrement",value:function(){this.slider.value=Number(this.slider.value)-Number(this.slider.step),this._updateValue()}},{key:"setValue",value:function(t){var e=this._options,n=e.min,i=e.max,r=e.showValue,o=e.getValue;return(0,d.isNumber)(t)&&t>=n&&t<=i&&(this.slider.value=t,this.value=this.slider.value,r&&(this._sliderValue.innerHTML=o(this.value))),this}},{key:"_initLayout",value:function(){var t=this,e="ngr-control-slider",n=this._options,i=n.orientation,r=n.title,o=n.logo,a=n.getValue,s=n.value,u=n.showValue,l=n.increment,c=n.id,h=n.min,d=n.max,p=n.step,g=n.syncSlider,v=n.size,m=n.collapsed;this._element&&console.warn("SliderControl: Element will be overrided"),this._element=f.DOMUtils.createElement("div",e+" "+e+"-"+i),this._sliderLink=f.DOMUtils.createElement("a",e+"-toggle",this._element),this._sliderLink.setAttribute("title",r),this._sliderLink.setAttribute("href","#"),this._sliderLink.innerHTML=o,u&&(this._sliderValue=f.DOMUtils.createElement("p",e+"-value",this._element),this._sliderValue.innerHTML=a(s)),l&&(this._plus=f.DOMUtils.createElement("a",e+"-plus",this._element),this._plus.innerHTML="+",this._plus.addEventListener("click",this._increment,!1),f.DOMUtils.addClass(this._element,"ngr-control-slider-incdec")),this._sliderContainer=f.DOMUtils.createElement("div","ngr-slider-container",this._element),this.slider=f.DOMUtils.createElement("input","ngr-slider",this._sliderContainer),"vertical"===i&&this.slider.setAttribute("orient","vertical"),this.slider.setAttribute("title",r),this.slider.setAttribute("id",c),this.slider.setAttribute("type","range"),this.slider.setAttribute("min",h),this.slider.setAttribute("max",d),this.slider.setAttribute("step",p),this.slider.setAttribute("value",s),g?this.slider.addEventListener("input",this._updateValue,!1):this.slider.addEventListener("change",this._updateValue,!1),this.slider.addEventListener("change",function(){t.emit("slideEnd",t.slider.value)},!1),l&&(this._minius=f.DOMUtils.createElement("a",e+"-minus",this._element),this._minius.innerHTML="-",this._minius.addEventListener("click",this._decrement,!1)),u?window.matchMedia("screen and (-webkit-min-device-pixel-ratio:0)").matches&&"vertical"===i?(this.slider.style.width=v.replace("px","")-36+"px",this._sliderContainer.style.height=v.replace("px","")-36+"px"):"vertical"===i?this._sliderContainer.style.height=v.replace("px","")-36+"px":this._sliderContainer.style.width=v.replace("px","")-56+"px":window.matchMedia("screen and (-webkit-min-device-pixel-ratio:0)").matches&&"vertical"===i?(this.slider.style.width=v.replace("px","")-10+"px",this._sliderContainer.style.height=v.replace("px","")-10+"px"):"vertical"===i?this._sliderContainer.style.height=v.replace("px","")-10+"px":this._sliderContainer.style.width=v.replace("px","")-25+"px",f.DOMUtils.disableClickPropagation(this._element),m?(this._sliderLink.addEventListener("click",f.DOMUtils.stop),this._sliderLink.addEventListener("click",this._expand),this.slider.addEventListener("blur",this._collapse)):this._expand()}}]),e}(h.default);e.default=g},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(11),h=i(c),f=n(7),d=n(6),p=i(d),g=n(3),v=function(t){function e(t){r(this,e);var n=s({zoomInText:"+",zoomInTitle:"",zoomOutText:"-",zoomOutTitle:"",animation:{disabled:!1,duration:300},position:"bottomright"},t),i=n.name?"zoom-"+n.name:"zoom",a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,i,n));return a._element||(a._element=f.DOMUtils.createElement("div","ngr-control-zoom ngr-bar"),a._zoomInButton=a._createButton(a._options.zoomInText,a._options.zoomInTitle,"ngr-control-zoom-in",a._element,a.zoomIn),a._zoomOutButton=a._createButton(a._options.zoomOutText,a._options.zoomOutTitle,"ngr-control-zoom-out",a._element,a.zoomOut)),a.updateDisabled=a.updateDisabled.bind(a),a.zoomIn=a.zoomIn.bind(a),a.zoomOut=a.zoomOut.bind(a),a}return a(e,t),u(e,[{key:"_onAdd",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdd",this).call(this,t),this._map.activeControl&&this._zoomInButton&&this._zoomOutButton&&this._map.activeControl.on("changeZoomStatus",this.updateDisabled),this}},{key:"_onRemove",value:function(t){return l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onRemove",this).call(this,t),this._map.activeControl&&this._zoomInButton&&this._zoomOutButton&&this._map.activeControl.off("changeZoomStatus",this.updateDisabled),this}},{key:"_createButton",value:function(t,e,n,i,r){var o=this,a=f.DOMUtils.createElement("a",n,i);return a.innerHTML=t,a.href="#",a.title=e,a.addEventListener("click",function(t){var e=null;return f.DOMUtils.stopPropagation(t),f.DOMUtils.preventDefault(t),e=r.call(o,t),o._refocusOnMap(),e},!1),a.addEventListener("mousedown",f.DOMUtils.stopPropagation,!1),a.addEventListener("dblclick",f.DOMUtils.stopPropagation,!1),a}},{key:"updateDisabled",value:function(t,e){var n="ngr-disabled";return this._zoomInButton&&this._zoomOutButton&&(f.DOMUtils.removeClass(this._zoomInButton,n),f.DOMUtils.removeClass(this._zoomOutButton,n),2===e&&f.DOMUtils.addClass(this._zoomInButton,n),1===e&&f.DOMUtils.addClass(this._zoomOutButton,n)),this}},{key:"_startZoomAnimation",value:function(t,e,n){var i=this;return p.default.getInstance().ofNumber(t,e,n).on("update",function(t,e){var n=e.num;i._map.activeControl.zoomByFocalLength(n,!0,!1,!1)}).on("complete",function(){i._map.activeControl.zoomByFocalLength(e,!0,!0,!0)}).start(),this}},{key:"zoomIn",value:function(){if(this._map&&this._map.activeControl)if(this._options.animation.disabled)this._map.activeControl.zoom(.5,!0,!0,!1);else{var t=this._map.activeControl._curDistance,e=(0,g.isNumber)(this._options.animation.duration)?this._options.animation.duration:300;this._startZoomAnimation(t,t/2,e)}return this}},{key:"zoomOut",value:function(){if(this._map&&this._map.activeControl)if(this._options.animation.disabled)this._map.activeControl.zoom(2,!0,!0,!1);else{var t=this._map.activeControl._curDistance,e=(0,g.isNumber)(this._options.animation.duration)?this._options.animation.duration:300;this._startZoomAnimation(t,2*t,e)}return this}}]),e}(h.default);e.default=v},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=1,o=function(){function t(){n(this,t)}return i(t,null,[{key:"generate",value:function(){return r++}}]),t}();e.default=o},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=a||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(36),c=n(83),h=i(c),f=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var n=e.server,i=e.appKey,a=e.headers,u=r(e,["server","appKey","headers"]),c=s({Accept:"application/json","NAG-Version":l.version,"NAG-Key":i},a);n&&(this.server=n),this.options=s({headers:c},u)}return u(t,[{key:"requestRegions",value:function(t){return h.default.get("region",s({},this.options,{params:t}))}},{key:"requestCategory",value:function(t){return h.default.get("category/"+t,this.options)}},{key:"requestCategories",value:function(t){return h.default.get("category/list",s({},this.options,{params:t}))}},{key:"requestMap",value:function(t){return h.default.get("map/"+t,this.options)}},{key:"requestMaps",value:function(t){return h.default.get("map/list",s({},this.options,{params:t}))}},{key:"requestPlanarGraph",value:function(t){return h.default.get("planar_graph/"+t,this.options)}},{key:"requestPOI",value:function(t){return h.default.get("poi/"+t,this.options)}},{key:"requestPOIChildren",value:function(t){return h.default.get("poi/"+t+"/children",this.options)}},{key:"searchPOI",value:function(t){return h.default.post("poi/search",s({},this.options,{body:JSON.stringify(t)}))}},{key:"searchPOIByCoord",value:function(t){return h.default.post("poi/coord",s({},this.options,{body:JSON.stringify(t)}))}},{key:"requestNavigation",value:function(t){return h.default.get("navi",s({},this.options,{params:t}))}},{key:"requestTransitNavigation",value:function(t){return h.default.post("navi/transit",s({},this.options,{body:JSON.stringify(t)}))}},{key:"server",set:function(t){h.default.defaults.baseURL=t}}]),t}();e.default=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(49),u=i(s),l=function(){function t(e){r(this,t);var n=null;n="string"==typeof e?JSON.parse(e):e,this.features={};for(var i in n)"object"===o(n[i])&&(this.features[i]=u.default.parse(i,n[i]));t:for(var a in this.features)for(var s=this.features[a].features,l=s,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var d=f,p=d.properties.planar_graph;if(p){this._planarGraphId=p;break t}}}return a(t,[{key:"planarGraphId",get:function(){return this._planarGraphId}},{key:"features",get:function(){return this._features},set:function(t){this._features=t}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=n(12),h=n(104),f=i(h);c.touchEmulator&&(0,f.default)();var d=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._mapViews={},t}return a(e,t),s(e,[{key:"initMapView",value:function(t,e){return!this.hasMapView(t)&&(this._mapViews[t.name]=t,!0)}},{key:"reSize",value:function(t,e,n){}},{key:"hasMapView",value:function(t){return!!t&&(t in this._mapViews||t.name in this._mapViews)}},{key:"remove",value:function(t){return!!this.hasMapView(t)&&(delete this._mapViews[t.name],!0)}},{key:"type",value:function(){return null}}]),e}(l.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.ThreeEngine=void 0;var r=n(48),o=i(r);e.ThreeEngine=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(4),s=n(8),u=i(s),l=function(){function t(e){r(this,t),this.pruneEmptyGeometry=!0,this.preserveGeometryCollectionType=!0,this.preserveCollections=!1,this.preserveType=!1,this._callback=e}return o(t,[{key:"transformPoint",value:function(t){return u.default.getFactory().createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))}},{key:"transformPolygon",value:function(t){var e=this.transformLinearRing(t.getExteriorRing(),t);null===e||!(e instanceof a.geom.LinearRing)||e.isEmpty();for(var n=[],i=0;i<t.getNumInteriorRing();i++){var r=this.transformLinearRing(t.getInteriorRingN(i),t);null===r||r.isEmpty()||(!(r instanceof a.geom.LinearRing),n.push(r))}return u.default.getFactory().createPolygon(e,n)}},{key:"createCoordinateSequence",value:function(t){return u.default.getFactory().getCoordinateSequenceFactory().create(t)}},{key:"transformMultiLineString",value:function(t){for(var e=[],n=0;n<t.getNumGeometries();n++){var i=this.transformLineString(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||e.push(i))}return u.default.getFactory().createMultiLineString(e)}},{key:"transformCoordinates",value:function(t,e){return this._callback(t,e)}},{key:"transformLineString",value:function(t){return u.default.getFactory().createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))}},{key:"transformMultiPoint",value:function(t){for(var e=[],n=0;n<t.getNumGeometries();n++){var i=this.transformPoint(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||e.push(i))}return u.default.getFactory().createMultiPoint(e)}},{key:"transformMultiPolygon",value:function(t){for(var e=[],n=0;n<t.getNumGeometries();n++){var i=this.transformPolygon(t.getGeometryN(n),t);null!==i&&(i.isEmpty()||e.push(i))}return u.default.getFactory().createMultiPolygon(e)}},{key:"copy",value:function(t){return t.copy()}},{key:"transformGeometryCollection",value:function(t){for(var e=[],n=0;n<t.getNumGeometries();n++){var i=this.transform(t.getGeometryN(n));null!==i&&(this.pruneEmptyGeometry&&i.isEmpty()||e.push(i))}return this.preserveGeometryCollectionType?u.default.getFactory().createGeometryCollection(u.default.getFactory().toGeometryArray(e)):u.default.getFactory().createGeometryCollection(e)}},{key:"transform",value:function(t){return t instanceof a.geom.Point?this.transformPoint(t,null):t instanceof a.geom.MultiPoint?this.transformMultiPoint(t,null):t instanceof a.geom.LinearRing?this.transformLinearRing(t,null):t instanceof a.geom.LineString?this.transformLineString(t,null):t instanceof a.geom.MultiLineString?this.transformMultiLineString(t,null):t instanceof a.geom.Polygon?this.transformPolygon(t,null):t instanceof a.geom.MultiPolygon?this.transformMultiPolygon(t,null):t instanceof a.geom.GeometryCollection?this.transformGeometryCollection(t,null):null}},{key:"transformLinearRing",value:function(t){var e=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===e)return u.default.getFactory().createLinearRing(null);var n=e.size();return n>0&&n<4&&!this.preserveType?u.default.getFactory().createLineString(e):u.default.getFactory().createLinearRing(e)}}]),t}();e.default=l},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e){n(this,t),this._polygon=e,this._linearRingCouet=e.getNumInteriorRing()}return i(t,[{key:"shellCreator",value:function(t){return this._shellCreator=t,this}},{key:"shell",value:function t(e){var n=this._shellCreator();if(n)for(var t=this._polygon.getExteriorRing(),i=t.getCoordinates(),r=0;r<i.length;r++)e(n,i[r],r);return this}},{key:"holeCreator",value:function(t){return this._holeCreator=t,this}},{key:"holes",value:function(t){if(this._linearRingCouet>0)for(var e=0;e<this._linearRingCouet;e++){var n=this._holeCreator();if(n)for(var i=this._polygon.getInteriorRingN(e),r=i.getCoordinates(),o=0;o<r.length;o++)t(n,r[o],o)}return this}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.JTSUtils=e.Coordinate=e.GeometryFactory=void 0;var r=n(24),o=i(r),a=n(4),s=n(8),u=i(s),l=a.geom.Coordinate;e.GeometryFactory=o.default,e.Coordinate=l,e.JTSUtils=u.default},function(t,e,n){var i,r;(function(t){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=n(1),l=n(12),c=n(36);n(199),n(193),n(195),n(197),n(192),n(201),n(198),n(200),n(194),n(196);var h=n(2),f=a(h),d=n(4),p=a(d),g=n(109),v=a(g),m=n(112),y=a(m),_=n(44),b=a(_),x=n(15),w=a(x),E=n(46),S=a(E),M=n(7),C=a(M),I=n(124),O=a(I),T=n(127),P=a(T),A=n(131),L=a(A),N=n(50),k=a(N),R=n(138),D=a(R),F=n(139),B=a(F),j=n(157),U=a(j),z=n(59),G=a(z),V=n(161),X=a(V),H=n(176),q=a(H),Y=n(178),W=a(Y),Z=n(181),J=a(Z),K=n(187),Q=a(K),$=n(9),tt=o($),et=n(102),nt=a(et);l.isDev&&(window.THREE=f),window.JSTS=p;var it={animation:v,camera:y,core:w,data:S,dom:C,engine:O,geom:P,fetch:tt.default,layer:L,location:k,map:D,math:B,navi:U,overlay:G,scene:q,sensor:W,style:J,view:Q,version:c.version};if(l.supportParticle&&u(it,{particle:X}),!l.isLite){var rt={tubeHelper:nt};it.helper=rt,it.control=b}"object"===s(t)&&"object"===s(t.exports)?t.exports=it:(i=it,r="function"==typeof i?i.call(e,n,e,t):i,!(void 0!==r&&(t.exports=r))),window.NGR=it,Array.prototype.fill&&Object.defineProperty(Array.prototype,"fill",{enumerable:!1})}).call(e,n(37)(t))},function(t,e){"use strict";
Object.defineProperty(e,"__esModule",{value:!0});e.serialize=function(t){var e="",n=[];for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];n.push(encodeURIComponent(i)+"="+encodeURIComponent(r))}return n.join("&").length>0&&(e="?"+n.join("&")),e},e.checkStatus=function(t){if(t.status>=200&&t.status<300)return t;var e=new Error(t.statusText);throw e.response=t,e}},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(2),s=i(a),u=function(){function t(e){r(this,t),this._loader=e,this._loader.setCrossOrigin(""),this._cache={}}return o(t,[{key:"load",value:function(t,e,n,i){var r=this,o=s.Cache.get(t);if(o)return this._loader.load(t,e,n,i),void delete this._cache[t];var a=this._cache[t];return a?void a.push({load:e,error:i}):(a=[],this._cache[t]=a,void this._loader.load(t,function(n){e&&e(n),r._forCache(a,function(t){t.load&&t.load(n)}),delete r._cache[t]},function(t){n&&n(t)},function(e){r._forCache(a,function(t){t.error&&t.error(e)}),delete r._cache[t],i&&i(e)}))}},{key:"_forCache",value:function(t,e){for(;0!==t.length;)e(t.pop())}}]),t}();e.default=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.LayerGroup=e.FeatureLayer=void 0;var r=n(25),o=i(r),a=n(30),s=i(a);e.FeatureLayer=o.default,e.LayerGroup=s.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(215),l=i(u),c=n(190),h=i(c),f=n(191),d=i(f),p=n(9),g=i(p),v=n(38),m=i(v),y=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._beaconContext=t,i._config=n||{},i}return a(e,t),s(e,[{key:"name",value:function(){return"InitBeaconConfigProtocal"}},{key:"params",value:function(){return{beaconContext:this._beaconContext,config:this._config}}},{key:"success",value:function(t,e,n){}}]),e}(h.default),_=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._beacons=t,n}return a(e,t),s(e,[{key:"name",value:function(){return"LocationProtocal"}},{key:"params",value:function(){return{beacons:this._beacons}}},{key:"success",value:function(t,e,n){e(n.result.location)}}]),e}(h.default),b=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._beacons=t,n}return a(e,t),s(e,[{key:"name",value:function(){return"BeaconsProtocal"}},{key:"params",value:function(){return{beacons:this._beacons}}},{key:"success",value:function(t,e,n){e(n.result.location)}}]),e}(h.default),x=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=new l.default;return t._workerExecutor=new d.default(n),t.startPositioning=!1,t}return a(e,t),s(e,[{key:"fetchBeaconConfig",value:function(t){if(!t||!t.appKey||!t.mapId)throw new Error("Invalid appKey or mapId");var e=t.server||"https://www.ipalmap.com/open/scene/ble/beacons",n=e+"?appKey="+t.appKey+"&mapId="+t.mapId;return(0,g.default)(n,{headers:{Accept:"application/json"}}).then(function(t){return t.json()})}},{key:"initBeaconConfig",value:function(t,e){var n=e||{};return this._intervalID=setInterval(this.calculatingPos.bind(this),n.interval||1e3),this._workerExecutor.exec(new y(JSON.stringify(t),n))}},{key:"updateReceivedBeacons",value:function(t){var e=this;return this._workerExecutor.exec(new b(JSON.stringify(t))).then(function(){e.startPositioning=!0})}},{key:"destroy",value:function(){clearInterval(this._intervalID),this._workerExecutor.destroy()}},{key:"calculatingPos",value:function(){var t=this;this.startPositioning&&this._workerExecutor.exec(new _).then(function(e){t.emit("locationChange",e)})}}]),e}(m.default);e.default=x},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(85),s=i(a),u=n(9),l=i(u),c=function(){function t(){r(this,t),this._bluetoothLocationEngine=null}return o(t,[{key:"initBeaconConfig",value:function(t,e){var n={};return n.BeaconsCfgArray=t,n=JSON.stringify(n),this._bluetoothLocationEngine=new s.default(n,e),this}},{key:"fetchBeaconConfig",value:function(t){if(!t||!t.appKey||!t.mapId)throw new Error("Invalid appKey or mapId");var e=t.server||"https://www.ipalmap.com/open/scene/ble/beacons",n=e+"?appKey="+t.appKey+"&mapId="+t.mapId;return(0,l.default)(n,{headers:{Accept:"application/json"}}).then(function(t){return t.json()})}},{key:"locate",value:function(t){if(!this._bluetoothLocationEngine)throw new Error("Invalid BleLocationEngine");var e={};return e.BeaconsArray=t,e=JSON.stringify(e),JSON.parse(this._bluetoothLocationEngine.locate(e))}},{key:"getBleLocationInfo",value:function(){return JSON.parse(this._bluetoothLocationEngine.getBleLocationInfo())}}]),t}();e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(9),u=i(s),l=function(){function t(e){r(this,t);var n=e.baseUrl,i=e.MAC;if(!n||!i)throw new Error("Invalid options");this._options=o({},e)}return a(t,[{key:"_parseBeacon",value:function(t){var e=t.major,n=t.minor,i=t.accuracy,r=t.rssi;return{mac:e+":"+n,accuracy:Number(i),rssi:Number(r)}}},{key:"fetchLocation",value:function(t){var e=this,n=this._options,i=n.baseUrl,r=n.MAC,o={};if(!Array.isArray(t))throw new Error("Invalid beacons");return o.ble=t.map(function(t){return e._parseBeacon(t)}).filter(function(t){var e=t.accuracy;return e>-1}),o.userid=r,o.wifi=[],(0,u.default)(i,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)}).then(function(t){return t.json()})}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(134),s=i(a),u=function(){function t(){r(this,t)}return o(t,[{key:"provide",value:function(t){var e=t.type,n=t.MAC,i=t.baseUrl,r=void 0===i?"http://locationtest.palmap.cn:80":i;if(!n)throw new Error("MAC");switch(e){case"BLE":return new s.default({baseUrl:r,MAC:n});default:throw new Error("Invalid locator type")}}}]),t}();e.default=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.LocationStatus=e.LocationType=e.WiFiLocationManager=void 0;var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),c=i(l),h=n(9),f=i(h),d=n(129),p=n(36),g={server:"https://api.ipalmap.com",headers:{"NAG-Version":p.version,Accept:"application/json"}},v={MAC:"mac",PLANARGRAPH:"floorId",IP:"ip",UUID:"uuid",TAG:"tag"},m={ENTER:0,MOVE:1,OUT:2,HEARTBEAT:3},y=function(t){function e(t,n,i){r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if("undefined"==typeof i.appKey)throw new Error("should provide an appKey");return a.server=i.server||g.server,a.options={headers:s({},g.headers,{"NAG-Key":i.appKey})},a._parseURL(t,n),a._working=!1,a._cooldDownTime=1e3,a._type=t,a._value=n,a}return a(e,t),u(e,[{key:"start",value:function(){this._working||(this._working=!0,this._loop())}},{key:"stop",value:function(){this._working&&(this._working=!1)}},{key:"_parseURL",value:function(t,e){var n=void 0,i=t;switch(e instanceof Array?(n=e.join(","),i=t+"s"):n=e,t){case v.MAC:case v.PLANARGRAPH:case v.IP:case v.UUID:case v.TAG:this._url=this.server+"/pos?"+i+"="+n;break;default:this._url=this.server+"/pos?mac="+n}}},{key:"_loop",value:function(){var t=this;this._url&&(this._loopRequest=function(){return function(){return(0,f.default)(t._url,t.options).then(d.checkStatus).then(function(e){t._working&&(t._parse(e._bodyText),1e3!==t._cooldDownTime&&(t._cooldDownTime=1e3),t._loopRequest())}).catch(function(e){console.error(e),t._working&&setTimeout(function(){t._loopRequest()},t._cooldDownTime*=2)})}}(),this._loopRequest())}},{key:"_parse",value:function(t){if(t&&0!==t.length)try{var e=JSON.parse(t);if("Feature"===e.type)this._parseFeature(e);else if("FeatureCollection"===e.type)for(var n=e.features,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;this._parseFeature(a)}}catch(t){console.error("parse error!")}}},{key:"_parseFeature",value:function(t){this.emit("onParseFeature",{result:t,type:this._type,value:this._value})}}]),e}(c.default),_=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t._loops={},t._macPool={};var n=t;return t._onParseFeature=function(t){n._fireFeature(t)},t}return a(e,t),u(e,[{key:"watch",value:function(t,e,n){var i=this._generatorKey(t,e);if(!this.has(i)){var r=new y(t,e,n);this._loops[i]=r,r.on("onParseFeature",this._onParseFeature),r.start()}}},{key:"unWatch",value:function(t,e){var n=this._generatorKey(t,e);if(this.has(n)){var i=this._loops[n];i.off("onParseFeature",this._onParseFeature),i.stop(),delete this._loops[n]}}},{key:"has",value:function(t){return t in this._loops}},{key:"_generatorKey",value:function(t,e){return t+e}},{key:"_fireFeature",value:function(t){var e=t.result;if(e){var n=e.properties;if(n&&n.status){var i=n.id_data,r=void 0;switch(n.status){case"ENTER":i in this._macPool?r=m.MOVE:(r=m.ENTER,this._macPool[i]=1);break;case"MOVE":r=m.MOVE;break;case"OUT":r=m.OUT,delete this._macPool[i];break;case"HEARTBEAT":r=m.HEARTBEAT;break;default:r=m.OUT,delete this._macPool[i]}t.locationStatus=r,this.emit("onLocationChange",t)}}}}]),e}(c.default);e.WiFiLocationManager=_,e.LocationType=v,e.LocationStatus=m},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){var n={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.lifecycleEnum=void 0;var s=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=l||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},l=n(1),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=n(9),f=i(h),d=n(46),p=n(64),g=i(p),v=n(48),m=i(v),y=n(21),_=i(y),b=n(19),x=i(b),w=n(25),E=i(w),S=n(24),M=i(S),C=n(44),I=n(3),O=n(4),T=n(59),P=n(32),A=i(P),L=n(56),N=i(L),k=n(50),R=n(6),D=i(R),F="undefined"==typeof Promise?n(14).Promise:Promise,B={UNLOADED:0,LOADING:1,LOADED:2,RUNNING:3,STOPPING:4,DESTROYED:5},j=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t);var n=e.appKey,i=e.styleTemplate;if(!n||!i)throw new Error("Invalid appKey or sytleTemplate");this._options=l({target:"#ngr-webgl",server:"https://api.ipalmap.com",initRotationAngle:0,initSkewAngle:60,floorControl:{},zoomControl:{},compassControl:{},scaleControl:{},dimensionControl:{},multiFloorControl:{},buildingControl:{},light:{},navi:{},location:{},dynamicNavi:{}},e);var r=this._options,o=r.server,s=r.navi,u=r.location;this._status=B.UNLOADED,this._engine=new m.default,this.planarGraphs={},this.dataSource=new d.DataSource({appKey:n,server:o}),this.navigationManager=this._initNaviManager(this.dataSource,s),this.locationManager=this._initLocationManager(u),this._onClick=this._onClick.bind(this),this.renderPlanarGraph=this.renderPlanarGraph.bind(this),this.addOverlay=this.addOverlay.bind(this),this.removeOverlay=this.removeOverlay.bind(this),this.addLayer=this.addLayer.bind(this),this.removeLayer=this.removeLayer.bind(this)}return c(t,[{key:"_initNaviManager",value:function(t,e){var n=e.enable,i=void 0===n||n,r=o(e,["enable"]);return i?new A.default(t,r):null}},{key:"_initDynimicNaviManager",value:function(t){var e=t.enable,n=void 0!==e&&e,i=t.messageOptions,r=t.cameraOptions,o=t.locationOptions,a=this.mapView,s=this.navigationManager;return n&&s?new N.default(a,s,i,r,o):null}},{key:"_initLocationManager",value:function(t){var e=t.type;switch(e){case"Wi-Fi":return new k.WiFiLocationManager;case"bluetooth":return new k.BleWorkerManager;default:return null}}},{key:"_genLightLayer",value:function(t,e){var n=e.enable,i=void 0===n||n,r=e.position,o=void 0===r?[0,300,300]:r,a=e.id,s=void 0===a?1:a,u=null;if(i){var l=new d.Feature(M.default.createPoint(o.concat()),{id:s});u=new E.default("light",t),u.addFeature(l)}return u}},{key:"_genControl",value:function(t,e){var n=this,i=e.enable,r=void 0===i||i,a=o(e,["enable"]),s=null;if(r){switch(t){case"zoom":s=new C.ZoomControl(a);break;case"scale":s=new C.ScaleControl(a);break;case"compass":s=new C.CompassControl(a);break;case"dimension":s=new C.DimensionControl(a);break;case"floor":var l=a.floorList,c=o(a,["floorList"]);s=new C.FloorControl(c),s.setFloorList(l.concat().reverse()),s.on("change",function(t){var e=t.from,i=t.to,r=t.targetControl,o=Number(r.floorMap[i].altitude)||0,a=Number(r.floorMap[e].altitude)||0;console.log("floor change from "+e+" to "+i),r.setCurrentFloor(i),n.renderPlanarGraph(Number(i),{direction:o-a>0?"up":"down"})});break;case"multiFloor":var h=a.floorList,f=o(a,["floorList"]);s=new C.MultiFloorControl(f),s.setFloorList(h.concat().reverse());break;case"building":var d=a.baseAddress,p=void 0===d?"base":d,g=a.buildingList,v=o(a,["baseAddress","buildingList"]),m=g.concat();m.push({id:this._baseFloorId,address:p}),s=new C.FloorControl(u({name:"multiBuilding",className:"ngr-building-switcher"},v)),s.setFloorList(m.reverse()),s.on("change",function(t){var e=t.from,i=t.to,r=t.targetControl;console.log("building change from "+e+" to "+i),r.setCurrentFloor(i,function(t){n._clearFloorControl(),t===n.baseFloorId?n.loadBaseFloor():n.renderBuilding(t)})});break;default:console.warn("Invalid control type")}s&&s.addTo(this.mapView)}return s}},{key:"_clear",value:function(){return this._clearBuildingControl(),this._clearFloorControl(),this.planarGraphs={},this._baseFloorId=null,this._buildingInfoList=null,this._buildingList=null,this._floorInfoMap=null,this._mapId=null,this._offsetCoord=null,this}},{key:"_createOverlay",value:function(t){var e=t.element,n=t.url,i=o(t,["element","url"]),r=null;if(e&&e instanceof HTMLElement)r=new T.Overlay(e);else{if(!n)throw new Error("Invalid element or url");r=new T.IconOverlay(u({},i,{url:n}))}return r}},{key:"_createLayer",value:function(t,e){var n=this;if(!(0,I.isString)(t))throw new Error("Invalid layer name");var i=new E.default(t,this.mapView.styleGenerator);return e.forEach(function(t){return i.addFeature(n.createFeature(t))},this),i}},{key:"_checkRunning",value:function(){if(this._status!==B.RUNNING)throw new Error("map is not running");return this}},{key:"offset",value:function t(e,n){var t=this.getOffset();return{x:e+t.x,y:n+t.y}}},{key:"unoffset",value:function(t,e){var n=this.getOffset();return{x:t-n.x,y:e-n.y}}},{key:"_onClick",value:function(t){var e=s(t.touches,1),n=e[0],i=n.clientX,r=n.clientY;if(!(0,I.isFunction)(this.onClick)||this._status!==B.RUNNING)return this;var o=this.mapView.searchObjectsByClient(i,r);if(0===o.length)return this;var a=o[0],u=a.feature,l=a.point,c=l.x,h=l.y,f=l.z,d=this.unoffset(c,h),p=d.x,g=d.y;return this.onClick({point:{x:p,y:g,z:f},feature:u,layer:u.parent}),this}},{key:"_clearFloorControl",value:function(){var t=this.floorControl||this.multiFloorControl;return this.mapView&&t&&(this.mapView.removeDomControl(t),this.floorControl=null,this.multiFloorControl=null),this}},{key:"_clearBuildingControl",value:function(){var t=this.buildingControl;return this.mapView&&t&&(this.mapView.removeDomControl(t),this.buildingControl=null),this}},{key:"_initMapView",value:function(){if(this.mapView)return this;var t=this._options,e=t.dynamicNavi,n=t.target,i=t.initRotationAngle,r=t.initSkewAngle,o=t.light,a=t.zoomControl,s=t.compassControl,l=t.scaleControl,c=t.dimensionControl,h=t.width,f=t.height,d=t.devicePixelRatio,p=void 0===d?1:d,v=t.clearColor,m=t.clearImage,y=t.fps,b=(h||window.innerWidth)/(f||window.innerHeight),w=new _.default(45,b,1,8e4),E=new g.default(this._styleJson),S=new x.default(n,{styleGenerator:E,initSkewAngle:r,initRotationAngle:i});return w.camera.position.set(0,0,100),S.activeCamera=w,this._engine.initMapView(S,{width:h,height:f,devicePixelRatio:p,clearColor:v,clearImage:m,fps:y}),this.mapView=S,this._sceneManager=S.sceneManager,this._activeControl=S.activeControl,this._light=this._genLightLayer(E,o),this.zoomControl=this._genControl("zoom",a),this.compassControl=this._genControl("compass",s),this.scaleControl=this._genControl("scale",l),this.dimensionControl=this._genControl("dimension",u({enable:!1},c)),S.start(),S.gestureManager.on("tap",this._onClick),this.dynamicNavigationManager=this._initDynimicNaviManager(e),this}},{key:"_renderBuilding",value:function(t){var e=this;this._status=B.LOADED;var n=this._options,i=n.defaultFloorId,r=n.floorControl,o=n.multiFloorControl,a=this.mapView,s=this.onLoad,l=this._floorInfoMap[t].concat(),c=void 0;if(this.floorControl=this._genControl("floor",u({},r,{floorList:l})),this.floorControl||(this.multiFloorControl=this._genControl("multiFloor",u({enable:!1,floorList:l},o))),i)c=i;else{c=l[0].id;for(var h=l,f=Array.isArray(h),d=0,h=f?h:h[Symbol.iterator]();;){var p;if(f){if(d>=h.length)break;p=h[d++]}else{if(d=h.next(),d.done)break;p=d.value}var g=p;if(g.default||g.defaultFloor){c=g.id;break}}}return this._status=B.RUNNING,this.multiFloorControl?(this.multiFloorControl.defaultFloorId=c,this.multiFloorControl.setCurrentFloor(c),this._renderMultiPlanarGraphs(t),this.multiFloorControl.highlightPGs([c])):(this.renderPlanarGraph(c),this.floorControl&&(this.floorControl.defaultFloorId=c,this.floorControl.setCurrentFloor(c))),this._baseFloorId||a.next(1,function(){e.scaleControl&&e.scaleControl.update(),(0,I.isFunction)(s)&&s(e)}),this}},{key:"_renderMultiPlanarGraphs",value:function(t){var e=this,n=this._options.floorHeight,i=void 0===n?60:n,r=this._light,o=this.mapView,a=this._floorInfoMap[t].concat().map(function(t){var n=t.id;return new d.PlanarGraph(e.planarGraphs[n])});o.floorHeight=i,o.activeControl._enableVerticalMove=!0,o.drawMultiPlanarGraph(a),r&&o.addLayer(r)}},{key:"getLayer",value:function(t){var e=null;return this.mapView&&(e=this.mapView.getLayer(t)),e}},{key:"hasLayer",value:function(t){return!!this.getLayer(t)}},{key:"showPlanarGraphs",value:function(t){return this._checkRunning(),this.multiFloorControl||console.warn("map is not in multi-floor mode"),this.mapView.showPlanarGraphs(t)}},{key:"renderPlanarGraph",value:function(t,e){var n=this;this._checkRunning(),this.multiFloorControl&&console.warn("map is in multi-floor mode");var i=this.planarGraphs[t];if(!i)throw new Error("planarGraph unloaded");if(this.mapView.drawPlanarGraph(new d.PlanarGraph(i)),this._light&&this.mapView.addLayer(this._light),e){var r=e.direction,o=this.mapView.activeControl.target,a=this.unoffset(o.x,o.y),s=a.x,u=a.y,l=0;this.enableVerticalMove(),"up"===r?l=-100:"down"===r&&(l=100),D.default.getInstance().ofNumber(l,0,300).on("update",function(t,e){var i=e.num;n.moveToPoint({x:s,y:u,z:i},{needUpdate:!0,needCollision:!1,emitEnd:!1})}).on("complete",function(){n.move({x:s,y:u,z:0},{needUpdate:!0,needCollision:!0,emitEnd:!0})}).start()}return this}},{key:"renderBuilding",value:function(t){var e=this;if(this._buildingList.indexOf(t)===-1)throw new Error("Invalid building id");var n=this.dataSource;return this._status=B.LOADING,this._floorInfoMap[t]?this._renderBuilding(t):n.requestPOIChildren(t).then(function(i){return e._floorInfoMap[t]=i.concat(),F.all(i.map(function(t){return n.requestPlanarGraph(t.id)}))}).then(function(n){var i=e._floorInfoMap[t].map(function(t){return t.id});n.forEach(function(t,n){e.planarGraphs[i[n]]=t}),e._renderBuilding(t)}),this}},{key:"createFeature",value:function(t){var e=t.id,n=t.type,i=t.coordinates,r=t.properties,o=null;if(!(0,I.isNumber)(e))throw new Error("Invalid id: id must be a number");switch(n){case"Point":o=M.default.createPoint(i);break;case"Polygon":o=M.default.createPolygon(i);break;case"LineString":o=M.default.createLineString(i);break;case"MultiPoint":o=M.default.createMultiPoint(i);break;case"MultiPolygon":o=M.default.createMultiPolygon(i);break;case"MultiLineString":o=M.default.createMultiLineString(i);break;default:throw new Error("Invalid geometry type")}return new d.Feature(o,u({},r,{id:e}))}},{key:"createLayer",value:function(t){var e=this,n=t.name,i=t.needOffset,r=void 0===i||i,o=t.features;if(!(0,I.isString)(n))throw new Error("Invalid layer name");var a=new E.default(n,this.mapView.styleGenerator);if(r)try{a.coordinateSystem=this.mapView.coordinateSystem}catch(t){throw new Error("Invalid map coordinate system")}return o.forEach(function(t){return a.addFeature(e.createFeature(t))},this),a}},{key:"addLayer",value:function(t){var e=null;return this._checkRunning(),e=t instanceof E.default?t:this.createLayer(t),this.mapView.addLayer(e),e}},{key:"removeLayer",value:function(t){return this._checkRunning(),this.mapView.removeLayer(t),this}},{key:"addOverlay",value:function(t){var e=t.needOffset,n=void 0===e||e,i=t.position,a=o(t,["needOffset","position"]);if(this._checkRunning(),!(0,I.isArray)(i))throw new Error("Invalid position: position must be an array");var s=this._createOverlay(a);return n&&(s.coordinateSystem=this.mapView.coordinateSystem),this.mapView.addOverlay(s),s.position=new(Function.prototype.bind.apply(O.geom.Coordinate,[null].concat(r(i)))),s}},{key:"removeOverlay",value:function(t){return this._checkRunning(),this.mapView.removeOverlay(t),this}},{key:"getOffset",value:function(){if(this._offsetCoord)return this._offsetCoord.copy();try{return this._offsetCoord=new(Function.prototype.bind.apply(O.geom.Coordinate,[null].concat(r(this.mapView.coordinateSystem.getOffset())))),this._offsetCoord.copy()}catch(t){return null}}},{key:"setScale",value:function(t,e,n,i,r,o){return this._sceneManager.setScale(t,e,n,i,r,o),this}},{key:"setPosition",value:function(t,e,n,i,r,o){return this._sceneManager.setPosition(t,e,n,i,r,o),this}},{key:"quickSetPosition",value:function(t,e,n,i,r,o){return this._sceneManager.quickSetPosition(t,e,n,i,r,o),this}},{key:"setRotation",value:function(t,e,n,i,r,o){return this._sceneManager.setRotation(t,e,n,i,r,o),this}},{key:"setVisible",value:function(t,e,n,i){return this._sceneManager.setVisible(t,e,n,i),this}},{key:"setColor",value:function(t,e,n,i){return this._sceneManager.setColor(t,e,n,i),this}},{key:"resetColor",value:function(t,e,n){return this._sceneManager.resetColor(t,e,n),this}},{key:"setOpacity",value:function(t,e,n,i){return this._sceneManager.setOpacity(t,e,n,i),this}},{key:"resetStyle",value:function(t,e,n,i){return this._sceneManager.resetStyle(t,e,n,i),this}},{key:"setValueChangeByFeatures",value:function(t,e,n){for(var i,r=arguments.length,o=Array(r>3?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];return(i=this._sceneManager).setValueChangeByFeatures.apply(i,[t,e,n].concat(o)),this}},{key:"setDistanceRange",value:function(t){var e=t.minDistance,n=t.maxDistance;return(0,I.isNumber)(e)&&(this._activeControl.minDistance=e),(0,I.isNumber)(n)&&(this._activeControl.maxDistance=n),this}},{key:"getDistance",value:function(){return this._activeControl.getfocalLength()}},{key:"setSkewAngleRange",value:function(t){var e=t.minAngle,n=t.maxAngle;return(0,I.isNumber)(e)&&(this._activeControl.minAngle=e),(0,I.isNumber)(n)&&(this._activeControl.maxAngle=n),this}},{key:"getSkewAngle",value:function(){return this._activeControl.getSkew()}},{key:"getRotationAngle",value:function(){return this._activeControl.getRotate()}},{key:"enableVerticalMove",value:function(){return this._activeControl.enableVerticalMove(),this}},{key:"disableVerticalMove",value:function(){return this._activeControl.disableVerticalMove(),this}},{key:"move",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.x,i=t.y,r=t.z,o=void 0===r?0:r,a=e.needUpdate,s=e.needCollision,u=e.emitEnd;return this._activeControl.move(n,i,o,a,s,u),this}},{key:"moveToPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.x,i=t.y,r=t.z,o=void 0===r?0:r,a=this.offset(n,i),s=a.x,u=a.y,l=e.needUpdate,c=e.needCollision,h=e.emitEnd;return this._activeControl.moveToPoint(s,u,o,l,c,h),this}},{key:"fitBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(4!==t.length&&6!==t.length)throw new Error("Invalid bounds");var n=e.ratio,i=e.hasOffset,r=e.needUpdate,o=e.needCollision,a=e.emitEnd,u=e.needAnimation,l=e.needRotateToZero,c=null;if(4===t.length){var h=s(t,4),f=h[0],d=h[1],p=h[2],g=h[3],v=this.offset(f,d),m=v.x,y=v.y,_=this.offset(p,g),b=_.x,x=_.y;c=[m,y,b,x]}else{if(6!==t.length)throw new Error("Invalid bounds");var w=s(t,6),E=w[0],S=w[1],M=w[2],C=w[3],I=w[4],O=w[5],T=this.offset(E,S),P=T.x,A=T.y,L=this.offset(C,I),N=L.x,k=L.y;c=[P,A,M,N,k,O]}this._activeControl(c,n,i,r,o,a,u,l)}},{key:"zoom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.needUpdate,i=e.needCollision,r=e.emitEnd;return this._activeControl.zoom(t,n,i,r),this}},{key:"zoomByFocalLength",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.needUpdate,i=e.needCollision,r=e.emitEnd;return this._activeControl.zoomByFocalLength(t,n,i,r),this}},{key:"skewTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.needUpdate,i=e.needCollision,r=e.emitEnd;return this._activeControl.skewTo(t,n,i,r),this}},{key:"skew",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.needUpdate,i=e.needCollision,r=e.emitEnd;return this._activeControl.skew(t,n,i,r),this}},{key:"rotate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.center,i=e.needUpdate,r=e.needCollision,o=e.emitEnd,a=0,s=0;if(n&&n.x&&n.y){var u=this.offset(n.x,n.y),l=u.x,c=u.y;a=l,s=c}return this._activeControl.rotate(a,s,t,i,r,o),this}},{key:"rotateTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.center,i=e.needUpdate,r=e.needCollision,o=e.emitEnd,a=0,s=0;if(n&&n.x&&n.y){var u=this.offset(n.x,n.y),l=u.x,c=u.y;a=l,s=c}return this._activeControl.rotateTo(a,s,t,i,r,o),this}},{key:"getBuildingIdList",value:function(){return[].concat(this._buildingList||[])}},{key:"loadBaseFloor",value:function(){var t=this,e=this.dataSource,n=this.mapView,i=this._baseFloorId,r=this.onLoad,o=this._options.buildingControl,a=[];return i?(this._status=B.LOADING,this._buildingList&&0!==this._buildingList.length?a.push(!1):a.push(e.requestPOIChildren(i)),this.planarGraphs[i]?a.push(!1):a.push(e.requestPlanarGraph(i)),F.all(a).then(function(e){var a=s(e,2),l=a[0],c=a[1];t._status=B.LOADED,l&&(t._buildingInfoList=l.filter(function(t){return"BUILDING"===t.type}),t._buildingList=t._buildingInfoList.map(function(t){return t.id})),c&&(t.planarGraphs[i]=c),t.buildingControl||(t.buildingControl=t._genControl("building",u({},o,{buildingList:t._buildingInfoList.concat()}))),t._status=B.RUNNING,t.renderPlanarGraph(i),n.next(1,function(){t.scaleControl&&t.scaleControl.update(),(0,I.isFunction)(r)&&r(t)})}).catch(function(t){return console.error(t,t.stack)}),this):(console.warn("no base floor"),this)}},{key:"render",value:function(t){var e=this;if(this._status===B.LOADING||this._status===B.DESTROYED)throw new Error("map is loading or destroyed");var n=this._options.styleTemplate,i=this.dataSource,r=void 0;return this._clear(),r=this._styleJson?new F(function(t){return t(e._styleJson)}):(0,I.isString)(n)?(0,f.default)(n,{}).then(function(t){return t.json()}):new F(function(t){return t(n)}),this._status=B.LOADING,r.then(function(n){return e._styleJson=n,t?i.requestMap(t):i.requestMaps()}).then(function(t){return e._mapId=t.list?t.list[0].poi:t.poi,i.requestPOI(e._mapId)}).then(function(t){if(e._floorInfoMap={},e._initMapView(),"BUILDING"===t.type)e._buildingList=[t.id],e.renderBuilding(t.id);else{if("PLANAR_GRAPH"!==t.type)throw new Error("Invalid poi type");e._baseFloorId=t.id,e._buildingList=[],e.loadBaseFloor()}}).catch(function(t){return console.error(t,t.stack)}),this}},{key:"destroy",value:function(){if(this._status===B.DESTROYED)throw new Error("map is already destroyed");
return this._clear(),this.mapView.gestureManager.off("tap",this._onClick),this._engine.remove(this.mapView),this.navigationManager=null,this.dynamicNavigationManager=null,this.locationManager=null,this.planarGraphs=null,this.mapView=null,this.dataSource=null,this.floorControl=null,this.zoomControl=null,this.compassControl=null,this.scaleControl=null,this._styleJson=null,this._options=null,this._light=null,this._engine=null,this._status=B.DESTROYED,(0,I.isFunction)(this.onDestoy)&&this.onDestroy(this),this}},{key:"baseFloorId",get:function(){return this._baseFloorId},set:function(t){console.warn("baseFloorId is readonly")}},{key:"currentPlanarGraphIds",get:function(){return this.mapView.currentPlanarGraphIds}}]),t}();e.default=j,e.lifecycleEnum=B},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Map=void 0;var r=n(137),o=i(r);e.Map=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Math=void 0;var r=n(27),o=i(r);e.Math=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(79),s=i(a),u=n(8),l=i(u),c=n(53),h=i(c),f=n(55),d=i(f),p=n(28),g=i(p),v=n(31),m=i(v),y=n(29),_=i(y),b=n(4),x=n(71),w=i(x),E=1e-8,S=function(){function t(e,n,i){r(this,t),this._g=e,this._h=n,this._vertexLoader=i}return o(t,[{key:"astar",value:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=new w.default(_.default.compareTo),a=new s.default(function(t,e){return t.equals(e)}),u=[],l=this._vertexLoader.findNearestPath(t,e),c=this._vertexLoader.findNearestPath(n,i),h=this._vertexLoader.findNearestVertexOnNearestPath(t,l),f=this._vertexLoader.findNearestVertexOnNearestPath(n,c);if(!h||!f)return[];if(h.equals(f)){if(b.operation.distance.DistanceOp.distance(t,n)<.01)return u;var d=void 0;return d=l===c?this.genPathForOneLine(l,t,n):b.operation.distance.DistanceOp.distance(t,h.vertex.shape)<=b.operation.distance.DistanceOp.distance(n,h.vertex.shape)?this.genPathForOneLine(c,h.vertex.shape,n):this.genPathForOneLine(l,t,n.vertex.shape),d&&u.push(d),u}var p=void 0;if(p=r?Math.abs(r.indexOf(e)-r.indexOf(i)):e===i?0:1,!h.equals(f)){o.enq(h);var g=void 0;t:for(;o.size()>0;){g=o.deq(),a.add(g),g.needCalcExtraPath=!0;for(var v=g.paths,m=v,y=Array.isArray(m),x=0,m=y?m:m[Symbol.iterator]();;){var E;if(y){if(x>=m.length)break;E=m[x++]}else{if(x=m.next(),x.done)break;E=x.value}var S=E,M=S.to;if(!a.contains(M)){var C=this._g.g(g,S,p)+g.g,I=this._h.h(g,f);if(this._isContainsByQueue(o,M)?C+I<M.g+M.h&&(M.g=C,M.h=I,M.parent=g,this._removeByQueue(o,M),o.enq(M)):(M.g=C,M.h=I,M.parent=g,o.enq(M)),M.equals(f)){do u.push(M.parent.findPath(M)),M=M.parent;while(!M.equals(h));break t}}}}}return u.reverse(),this._adjustPaths(u,l,c,t,n),this._filterExtraPath(u),u}},{key:"genPathForOneLine",value:function(t,e,n){var i=t.shape.getCoordinates(),r=this.genLineStringByCoordinates(i),o=l.default.getFactory().createPoint(this.getProjectOnLine(e,t.shape)),a=l.default.getFactory().createPoint(this.getProjectOnLine(n,t.shape)),s=this.getIndexProjectliedOn(o,r),u=this.getIndexProjectliedOn(a,r),c=void 0;if(s===u){var h=r[s];c=b.operation.distance.DistanceOp.distance(e,h.getStartPoint())>b.operation.distance.DistanceOp.distance(n,h.getStartPoint())}else c=s>u;c&&i.reverse(),r=this.genLineStringByCoordinates(i),s=this.getIndexProjectliedOn(o,r),u=this.getIndexProjectliedOn(a,r);var f=[];if(f.push(o.getCoordinate()),u-s===1)f.push(r[s].getEndPoint().getCoordinate());else for(var d=s+1;d<u;d++)f.push(r[d].getStartPoint().getCoordinate()),d===u-1&&f.push(r[d].getEndPoint().getCoordinate());f.push(a.getCoordinate());var p=new b.geom.LineString(l.default.getFactory().getCoordinateSequenceFactory().create(f),l.default.getFactory()),g=this._getNewAStarPath(t,p);return g}},{key:"genLineStringByCoordinates",value:function(t){if(!t||0===t.length)return null;for(var e=new Array(t.length-1),n=0;n<t.length-1;n++){var i=t[n],r=t[n+1],o=new b.geom.LineString(l.default.getFactory().getCoordinateSequenceFactory().create([i,r]),l.default.getFactory());e[n]=o}return e}},{key:"getProjectOnLine",value:function(t,e){var n=b.operation.distance.DistanceOp.nearestPoints(t,e)[0];return n}},{key:"getIndexProjectliedOn",value:function(t,e){var n=void 0;for(var i in e)this._checkIfPointOnLine(t,e[i])&&(n=i);return n}},{key:"_getNewAStarPath",value:function(t,e){var n=t.planarGraphId,i=new h.default;i.planarGraphId=n,i.direction=t.direction,i.rank=t.rank,i.shape=e,i.from=this._getNewVertex(e.getStartPoint(),n),i.to=this._getNewVertex(e.getEndPoint(),n);var r=new m.default(i,this._vertexLoader,!1);return r}},{key:"_getNewVertex",value:function(t,e){if(!t)return null;var n=new d.default;return n.planarGraphId=e,n.shape=t,n}},{key:"_checkIfPointOnLine",value:function(t,e){return b.operation.distance.DistanceOp.distance(t,e)<E}},{key:"_needCalcExtraPath",value:function(t,e,n,i){var r=i.vertex.id;return r===e.vertex.id||r===n.vertex.id||r===t.from.id||r===t.to.id}},{key:"_adjustPaths",value:function(t,e,n,i,r){t&&0!==t.length&&(this._adjustFirstPath(t,e,i),this._adjustLastPath(t,n,r),this._filterExtraPath(t))}},{key:"_adjustFirstPath",value:function(t,e,n){var i=this.getProjectOnLine(n,e.shape),r=l.default.getFactory().createPoint(i);this._addFromExactPath(t,r,e)}},{key:"_adjustLastPath",value:function(t,e,n){var i=this.getProjectOnLine(n,e.shape),r=l.default.getFactory().createPoint(i);this._addToExtraPath(t,r,e)}},{key:"_addToExtraPath",value:function(t,e,n){var i=t.length-1,r=this._checkIfPointOnLine(e,n.shape);if(r&&!(t[i]instanceof g.default)){var o=t[i],a=this._genToExactPath(o,n,e);o.path.id===n.id?t.splice(i,0,a):t[0]=a}}},{key:"_addFromExactPath",value:function(t,e,n){var i=this._checkIfPointOnLine(e,n.shape);if(!(i||t[0]instanceof g.default)){var r=t[0],o=this._genFromExtraPath(e,n,r);r.path.id===n.id?t[0]=o:t.splice(0,0,o)}}},{key:"_genFromExtraPath",value:function(t,e,n){var i=this._splitPath(n,e,!0),r=[],o=this.getIndexProjectliedOn(t,i);r.push(t.getCoordinate());for(var a=o+1;a<i.length;a++)r.push(i[a].getStartPoint().getCoordinate()),a===i.length-1&&r.push(i[a].getEndPoint().getCoordinate());if(1===r.length){var s=i.length>o?o:i.length-1;r.push(i[s].getEndPoint().getCoordinate())}var u=new b.geom.LineString(l.default.getFactory().getCoordinateSequenceFactory().create(r),l.default.getFactory());return this._getNewAStarPath(e,u)}},{key:"_genToExactPath",value:function(t,e,n){for(var i=this._splitPath(t,e,!0),r=[],o=this.getIndexProjectliedOn(n,i),a=0;a<o;a++)r.push(i[a].getStartPoint().getCoordinate()),a===o-1&&r.push(i[a].getEndPoint().getCoordinate());if(0===r.length){var s=i.length>o?o:i.length-1;r.push(i[s].getStartPoint().getCoordinate())}r.push(n.getCoordinate());var u=new b.geom.LineString(l.default.getFactory().getCoordinateSequenceFactory().create(r),l.default.getFactory()),c=this._getNewAStarPath(e,u);return c}},{key:"_splitPath",value:function(t,e,n){for(var i=[],r=e.shape.getCoordinates(),o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;i.push(new b.geom.Coordinate(u.x,u.y,u.z))}var l=void 0;if(t.path.id===e.id)l=t.reverse;else if(n){var c=t.reverse?t.path.shape.getEndPoint():t.path.shape.getStartPoint();l=b.operation.distance.DistanceOp.distance(c,e.shape.getEndPoint())>b.operation.distance.DistanceOp.distance(c,e.shape.getStartPoint())}else{var h=t.reverse?t.path.shape.getStartPoint():t.path.shape.getEndPoint();l=b.operation.distance.DistanceOp.distance(h,e.shape.getStartPoint())>b.operation.distance.DistanceOp.distance(h,e.shape.getEndPoint())}l&&i.reverse();var f=this.genLineStringByCoordinates(i);return f}},{key:"_filterExtraPath",value:function(t){if(t&&0!==t.length){var e=t[0],n=void 0;t.length>1&&(n=t[t.length-1]),this._checkThenRemove(t,e),this._checkThenRemove(t,n)}}},{key:"_checkThenRemove",value:function(t,e){if(e&&e instanceof m.default){var n=e.path.rank;if(10===n){var i=t.indexOf(e);t.splice(i,1)}}}},{key:"_isContainsByQueue",value:function(t,e){var n=!1;return t.forEach(function(t){t.equals(e)&&(n=!0)}),n}},{key:"_removeByQueue",value:function(t,e){var n=t._elements,i=null;for(var r in n){var o=n[r];o.equals(e)&&(i=r)}i&&n.splice(i,1)}}]),t}();e.default=S},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i,r,o,a){n(this,t),this.mapId=e,this.direction=i,this.rank=r,this.fromLocationId=o,this.toLocationId=a}return i(t,[{key:"id",get:function(){return this._id},set:function(t){this._id=t}},{key:"mapId",get:function(){return this._mapId},set:function(t){this._mapId=t}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t}},{key:"rank",get:function(){return this._rank},set:function(t){this._rank=t}},{key:"fromLocationId",get:function(){return this._fromLocationId},set:function(t){this._fromLocationId=t}},{key:"toLocationId",get:function(){return this._toLocationId},set:function(t){this._toLocationId=t}},{key:"from",get:function(){return this._from},set:function(t){this._from=t}},{key:"to",get:function(){return this._to},set:function(t){this._to=t}},{key:"categoryId",get:function(){return this._categoryId},set:function(t){this._categoryId=t}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},l=n(52),c=i(l),h=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._func=t,n}return a(e,t),s(e,[{key:"g",value:function(t,n,i){var r=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"g",this).call(this,t,n,i);return r+=this._func(t,n,i)}}]),e}(c.default);e.default=h},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"h",value:function(t,e){return Math.abs(e.vertex.altitude-t.vertex.altitude)+t.vertex.shape.distance(e.vertex.shape)}}]),t}();e.default=r},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"g",value:function(t,e,n){}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.naviFilter=e.NaviUtils=void 0;var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(32),l=i(u),c=n(19),h=i(c),f=n(16),d=i(f),p=n(23),g=i(p),v=n(8),m=i(v),y=n(3),_=n(4),b=function(){function t(){a(this,t)}return s(t,[{key:"onFilter",value:function(t,e){return!1}}]),t}(),x=function(t){function e(t){a(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._distanceThreshold=t,n}return o(e,t),s(e,[{key:"onFilter",value:function(t,e){for(var n=0,i=t,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;n+=s}return!(n>this._distanceThreshold)}}]),e}(b),w=function(t){function e(){return a(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),s(e,[{key:"onFilter",value:function(t,e){return!(!e||2!==e.length||e[0].category!==e[1].category)}}]),e}(b),E=function(){function t(){a(this,t)}return s(t,null,[{key:"getMultiNavigation",value:function(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(!(t instanceof h.default&&e instanceof l.default&&(0,y.isArray)(n)))throw new Error("NaviUtils: Invalid parameters");var o=e.getPlanarGraphOrder();if((0,y.isEmpty)(o))throw new Error("NaviUtils: Empty navigation data");var a=r.floorHeight,s=void 0===a?40:a,u=r.id,c=void 0===u?1:u,f=r.name,p=void 0===f?"multiNavigation":f,v=r.zOffset,_=void 0===v?0:v,b=t._planarGraphs.concat(),x={},w={},E=function(t,e){var n=b.indexOf(t),i=b.indexOf(e);return n<i?-1:n>i?1:0},S=_,M=[];for(var C in o){var I=o[C];if(b.indexOf(I)!==-1){var O=e.getDistancesByPlanarGraph(I),T=e.getConnectionInfoByPlanarGraph(I),P=(0,y.isArray)(i)?i:[],A=!1;if(n.indexOf(I)===-1){var L=!0;A=!0,0===P.length&&(L=!1);for(var N=P,k=Array.isArray(N),R=0,N=k?N:N[Symbol.iterator]();;){var D;if(k){if(R>=N.length)break;D=N[R++]}else{if(R=N.next(),R.done)break;D=R.value}var F=D;if(!F.onFilter(O,T)){L=!1;break}}L&&(A=!1)}A&&n.push(I)}}n.sort(E);for(var B=n,j=Array.isArray(B),U=0,B=j?B:B[Symbol.iterator]();;){var z;if(j){if(U>=B.length)break;z=B[U++]}else{if(U=B.next(),U.done)break;z=U.value}var G=z;x[G]=S,S+=s}for(var V=o,X=Array.isArray(V),H=0,V=X?V:V[Symbol.iterator]();;){var q;if(X){if(H>=V.length)break;q=V[H++]}else{if(H=V.next(),H.done)break;q=H.value}var Y=q;if(Y in x){var W=e.getNavigateByPlanarGraph(Y),Z=x[Y],J=void 0;if((0,y.isPresent)(w[Y])?J=W.features[++w[Y]]:(J=W.features[0],w[Y]=0),!J)throw new Error("getMultiNavigation: Invalid feature");for(var K=J.geometry.points.coordinates,Q=K,$=Array.isArray(Q),tt=0,Q=$?Q:Q[Symbol.iterator]();;){var et;if($){if(tt>=Q.length)break;et=Q[tt++]}else{if(tt=Q.next(),tt.done)break;et=tt.value}var nt=et;nt.z=Z}M=M.concat(K)}}var it=m.default.getFactory().createLineString(M),rt=new d.default(p);return rt.addFeature(new g.default(it,{id:c})),rt}},{key:"getMultiTransits",value:function(){}},{key:"_getDistance",value:function(t,e){var n=0;return n=Math.hypot?Math.hypot(e.x-t.x,e.y-t.y):Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},{key:"getDistance",value:function(e,n){var i=e,r=n;return(0,y.isArray)(e)&&(i=new _.geom.Coordinate(e[0],e[1])),(0,y.isArray)(n)&&(r=new _.geom.Coordinate(n[0],n[1])),t._getDistance(i,r)}}]),t}(),S={NaviCustomFilter:b,NaviDistanceFilter:x,NaviSameCateFilter:w};e.NaviUtils=E,e.naviFilter=S},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(29),u=i(s),l=n(28),c=i(l),h=n(31),f=i(h),d=n(4),p=function(){function t(e){o(this,t),this._pathService=e}return a(t,[{key:"findNearestVertexOnNearestPath",value:function(t,e){if(null===e)return null;var n=e.from,i=e.to,r=this._pathService.queryConnectionsByVertex(n);if(0!==r.length)return new u.default(i,this);if(r=this._pathService.queryConnectionsByVertex(i),0!==r.length)return new u.default(n,this);var o=t.distance(e.from.shape)<t.distance(e.to.shape)?e.from:e.to;return new u.default(o,this)}},{key:"findNearestPath",value:function(t,e){var n=this._pathService.queryQuadTree(e);if(!n)return null;var i=t.getEnvelopeInternal();i.minx-=200,i.miny-=200,i.maxx+=200,i.maxy+=200;var r=n.query(i);r.isEmpty()&&(r=this._pathService.queryAllPathFromIndex(e));for(var o=void 0,a=Number.MAX_VALUE,s=r.array_,u=Array.isArray(s),l=0,s=u?s:s[Symbol.iterator]();;){var c;if(u){if(l>=s.length)break;c=s[l++]}else{if(l=s.next(),l.done)break;c=l.value}var h=c,f=h.shape,p=d.operation.distance.DistanceOp.distance(t,f);a>p&&(a=p,o=h)}return o}},{key:"loadPaths",value:function(t,e){var n=this,i=[],o=this._pathService.queryPathsByVertex(t);e||(o=o.filter(function(t){return 10!==t.rank})),0!==o.length&&i.push.apply(i,r(o.map(function(e){return e.from.id===t.id?new f.default(e,n,!1):new f.default(e,n,!0)})));var a=this._pathService.queryConnectionsByVertex(t);return 0===a.length?i:(i.push.apply(i,r(a.map(function(e){return e.from.id===t.id?new c.default(e,n,!1):new c.default(e,n,!0)}))),i)}}]),t}();e.default=p},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(47),s=n(9),u=i(s),l=function(){function t(){var e=this;r(this,t),this.cuid="palmap",this.accessToken="24.ad5029324bbdd18b08ade3ae8d477cb9.2592000.1496474155.282335-9602705",this.audioElmt=(0,a.createElement)("audio"),this.audioElmt.id="audioElmt",document.body.appendChild(this.audioElmt),this.tokenReqUrl="https://api.ipalmap.com/baidu/oauth/2.0/token?grant_type=client_credentials&client_id=R1DRhpUC1k1B7GhNe5Ol9myt&client_secret=7d37b04b8d197409cef1d385edca99c0",(0,u.default)(this.tokenReqUrl,{}).then(function(t){t.json().then(function(t){e.accessToken=t.access_token})}).catch(function(t){throw Error(t)})}return o(t,[{key:"playMessage",value:function(t){var e="http://tsn.baidu.com/text2audio?lan=zh&cuid="+this.cuid+"&ctp=1&tok="+this.accessToken+"&tex="+t;this.audioElmt.setAttribute("src",e),this.audioElmt.play()}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(153),l=i(u),c=n(155),h=i(c),f=n(57),d=i(f),p=n(151),g=i(p),v=function(){function t(e,n){a(this,t),this.x=e.x-n.x,this.y=e.y-n.y}return s(t,[{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}],[{key:"dot",value:function(t,e){return t.x*e.x+t.y*e.y}}]),t}(),m=function(t){function e(){return a(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),s(e,[{key:"mate",value:function(t){var e={},n=t.property,i=t.lastLineSpot,r=t.nextLineSpot,o=e.startPt=t.lineString.getCoordinate(),a=void 0,s=void 0;return r||(a=t.lineString.points.coordinates[1],s=new v(a,o),e.isEndSegment=!0),!i||i.property.altitude&&n.altitude&&n.altitude!==i.property.altitude?(e.isEndSegment||(a=r.lineString.getCoordinate(),s=new v(a,o)),e.distance=s.length(),e.orientation=this._computeOrientation(s.x,s.y)):n.altitude&&r.property.altitude&&n.altitude!==r.property.altitude?(a=t.lineString.points.coordinates[1],s=new v(a,o),e.distance=s.length(),e.direction=this._computeDirection(i.lineString.getCoordinate(),o,a),e.isUp=n.altitude-r.property.altitude<0,e.targetFloor=r.property.floorAddress):(e.isEndSegment||(a=r.lineString.getCoordinate(),s=new v(a,o)),e.distance=s.length(),e.direction=this._computeDirection(i.lineString.getCoordinate(),o,a)),e.orientationAngle=360*Math.atan2(s.y,s.x)/(2*Math.PI)-90,e}},{key:"_computeOrientation",value:function(t,e){var n=360*-Math.atan2(e,t)/(2*Math.PI);return n>=-15&&n<15?"east":n>=15&&n<75?"southeast":n>=-75&&n<-15?"northeast":n>=75&&n<105?"south":n>=-105&&n<-75?"north":n>=-165&&n<-105?"northwest":n>=105&&n<165?"southwest":n>=165&&n<180||n>=-180&&n<-165?"west":""}},{key:"_computeDirection",value:function(t,e,n){var i=new v(n,e),r=new v(e,t),o=v.dot(i,r)/(i.length()*r.length()),a=360*Math.acos(o)/(2*Math.PI),s=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x),u=void 0;u=s>0?"left":"right";var l=null;if(a>=0&&a<15)l="forward";else if(a>=15&&a<60)switch(u){case"left":l="leftForward";break;case"right":l="rightForward";break;default:throw new Error("WalkingMate#mate: Invalid direction")}else if(a>=60&&a<120)switch(u){case"left":l="left";break;case"right":l="right";break;default:throw new Error("WalkingMate#mate: Invalid direction")}else if(a>=120&&a<165)switch(u){case"left":l="leftBackward";break;case"right":l="rightBackward";break;default:throw new Error("WalkingMate#mate: Invalid direction")}else a>=165&&a<=180&&(l="backward");return l}}]),e}(d.default),y={defaultMate:new d.default,walkingMate:new m},_=function(t){function e(){a(this,e);var t=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.stateMate=new g.default(y.walkingMate),t}return o(e,t),s(e,[{key:"nextMove",get:function(){return this._nextMove},set:function(t){this._nextMove=t}},{key:"distanceToEnd",get:function(){return this._distanceToEnd},set:function(t){this._distanceToEnd=t}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction=t}},{key:"orientation",get:function(){return this._orientation},set:function(t){this._orientation=t}},{key:"orientationAngle",get:function(){return this._orientationAngle},set:function(t){this._orientationAngle=t}},{key:"targetFloor",get:function(){return this._targetFloor},set:function(t){this._targetFloor=t}},{key:"isUp",get:function(){return this._isUp},set:function(t){this._isUp=t}},{key:"isEndSegment",get:function(){return this._isEndSegment},set:function(t){this._isEndSegment=t}}]),e}(h.default),b=[new _],x=function(t){function e(){return a(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,b))}return o(e,t),e}(l.default);e.default=x},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=n(24),h=i(c),f=n(4),d=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.reset(),t}return a(e,t),s(e,[{key:"start",value:function(t,e){for(var n=this._segments.length-1;n>=0;n--){var i=this._segments[n];if(this._isOnSegment(t,e,i))return this._currentIndex!==n&&this._changeSegment(i),this._currentIndex=n,!0}return!1}},{key:"returnNearestSegment",value:function(t,e,n){for(var i={index:-1,segment:null},r=0;r<this._segments.length;++r){var o=this._segments[r];if(o.spot.property.planar_graph===n&&this._isOnSegment(t,e,o)){i.index=r,i.segment=o;break}}return i}},{key:"findNearestSegment",value:function(t,e,n,i,r){var o=this.returnNearestSegment(t,e,n),a=o.index,s=o.segment;if(!s)return!1;if(null!==this._currentIndex)if(this._currentIndex<a){this._currentIndex=a,this._center=new f.geom.Coordinate(t,e);var u=this._segments[this._currentIndex+1],l=!s.state.isEndSegment&&!s.state.targetFloor,c=l?u.spot.lineString.getCoordinate():s.spot.lineString.points.coordinates[1];i&&c.distance(new f.geom.Coordinate(t,e))<=r&&0!==this.currentIndex&&(this._center=c,this.emit("onArriveSegEnd")),this._changeSegment(s,this._center)}else{var h=s.spot.lineString.getCoordinate();if(h.distance(new f.geom.Coordinate(t,e))>h.distance(this._center)){this._center=new f.geom.Coordinate(t,e);var d=this._segments[this._currentIndex+1],p=!s.state.isEndSegment&&!s.state.targetFloor,g=p?d.spot.lineString.getCoordinate():s.spot.lineString.points.coordinates[1];i&&g.distance(new f.geom.Coordinate(t,e))<=r&&0!==this.currentIndex&&(this._center=g,this.emit("onArriveSegEnd")),this._changeLocation(this._center)}}else this._currentIndex=a,this._center=new f.geom.Coordinate(t,e),this._changeSegment(s,this._center);return!0}},{key:"clearCurSt",value:function(){this._currentIndex=0,this._center=null}},{key:"reset",value:function(){var t=this;this._currentIndex=0,this._center=null,this._segments=[],this.clearCurSt(),this._trigger&&this._trigger.forEach(function(e){t._segments.push(e)})}},{key:"_isOnSegment",value:function(t,e,n){for(var i=h.default.createPoint([t,e]),r=n.spot;r;){var o=r.lineString;if(o.buffer(.1).contains(i))return!0;if(r=r.nextLineSpot,r&&r.isValid)break}return!1}},{key:"_changeSegment",value:function(t,e){this.emit("onSegmentChange",t),this.emit("onLocationChange",e)}},{key:"_changeLocation",value:function(t){this.emit("onLocationChange",t)}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"center",get:function(){return this._center}},{key:"trigger",set:function(t){this._trigger=t,this.reset()}}]),e}(l.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(154),s=n(24),u=i(s),l=function(){function t(e){r(this,t),this._spots=[];for(var n=e.features,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{if(o=n.next(),o.done)break;s=o.value}for(var l=s,c=l.properties,h=l.geometry,f=h.coordinates,d=[],p=f,g=Array.isArray(p),v=0,p=g?p:p[Symbol.iterator]();;){var m;if(g){if(v>=p.length)break;m=p[v++]}else{if(v=p.next(),v.done)break;m=v.value}var y=m;if(d.push(y),2===d.length&&!this.needToThrow(d)){var _=new a.LineSpot(c,u.default.createLineString(d)),b=this._spots[this._spots.length-1];b&&(b.nextLineSpot=_),_.lastLineSpot=b,this._spots.push(_)}2===d.length&&d.shift()}}}return o(t,[{key:"next",value:function(){return this._spots.shift()}},{key:"has",value:function(){return 0!==this._spots.length}},{key:"needToThrow",value:function(t){return Math.sqrt(Math.pow(t[0][0]-t[1][0],2)+Math.pow(t[0][1]-t[1][1],2))<.01}}]),t}();e.default=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(57),l=i(u),c=function(t){function e(t,n,i){r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._mate=t,a._map=n,a._reduce=i,a._spots=[],a}return a(e,t),s(e,[{key:"mate",value:function(t){if(!t.isValid)return null;var e=this._mate.mate(t);if(e.distanceToEnd=e.distance,!t.nextLineSpot)return e;for(var n=t.nextLineSpot,i=this._mate.mate(n);n&&(i.direction&&"forward"===i.direction||!i.direction)&&!i.orientation;){if(e.distance+=i.distance,n.isValid=!1,i.isEndSegment){e.isEndSegment=!0;break}if(i.targetFloor){e.targetFloor=i.targetFloor,e.isUp=i.isUp;break}n=n.nextLineSpot,i=this._mate.mate(n)}for(n=t.nextLineSpot;n;)i=this._mate.mate(n),e.distanceToEnd+=i.distance,n=n.nextLineSpot;for(var r=t,o=void 0,a=0,s=!1;r;)o=this._mate.mate(r),a+=o.distance,r=r.nextLineSpot,!s&&o.targetFloor&&(e.distanceToConnection=a,s=!0);return e}}]),e}(l.default);e.default=c},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function");
}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(e,i,r){n(this,t),this._spot=e,this._state=i,this._lastSegment=this._nextSegment=null,this._audioProvider=r}return i(t,[{key:"getMessageInNavi",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=null,i=null;return this._nextSegment&&this._nextSegment.state.direction&&(i=this._parseDirectionInNavi(this._nextSegment.state.direction)),this.state.isEndSegment&&(i=""),this.state.targetFloor&&(i=this.state.isUp?""+this.state.targetFloor+"":""+this.state.targetFloor+""),n=t?""+parseFloat(this.state.distance-t).toFixed(1)+""+i:""+parseFloat(this.state.distance).toFixed(1)+""+i,parseFloat(this.state.distance-t).toFixed(1)<=0&&(n=""+i),e||(this._audioProvider?this._audioProvider.playMessage(n):console.log("Audio not provided when initializing DynamicNavigation")),n}},{key:"_parseDirectionInNavi",value:function(t){var e=null;switch(t){case"leftForward":e="";break;case"leftBackward":e="";break;case"left":e="";break;case"rightForward":e="";break;case"rightBackward":e="";break;case"right":e="";break;case"backward":e="";break;default:throw new Error("WalkingMate#message: Invalid direction or orientation")}return e}},{key:"_parseOrientationInNavi",value:function(t){var e=null;switch(t){case"east":e="";break;case"west":e="";break;case"south":e="";break;case"north":e="";break;case"northeast":e="";break;case"northwest":e="";break;case"southeast":e="";break;case"southwest":e="";break;default:throw new Error("WalkingMate#message: Invalid direction or orientation")}return e}},{key:"getMessageInList",value:function(){var t=null;if(this.state.direction?t=this._parseDirection(this.state.direction):this.state.orientation&&(t=this._parseOrientation(this.state.orientation)),this.state.isEndSegment)return t+"";if(this.state.targetFloor){var e=this.state.isUp?""+this.state.targetFloor+"":""+this.state.targetFloor+"";return""+t+e}return t}},{key:"_parseDirection",value:function(t){var e=null;switch(t){case"forward":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"leftForward":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"leftBackward":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"left":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"rightForward":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"rightBackward":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"right":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"backward":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;default:throw new Error("WalkingMate#message: Invalid direction or orientation")}return e}},{key:"_parseOrientation",value:function(t){var e=null;switch(t){case"east":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"west":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"south":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"north":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"northeast":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"northwest":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"southeast":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;case"southwest":e=""+parseFloat(this.state.distance).toFixed(1)+"";break;default:throw new Error("WalkingMate#message: Invalid direction or orientation")}return e}},{key:"spot",get:function(){return this._spot}},{key:"state",get:function(){return this._state}},{key:"lastSegment",set:function(t){this._lastSegment=t},get:function(){return this._lastSegment}},{key:"nextSegment",set:function(t){this._nextSegment=t},get:function(){return this._nextSegment}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(152),s=i(a),u=function(){function t(e){r(this,t),this.states=e}return o(t,[{key:"provider",value:function(t,e,n){return new s.default(t,e,n)}},{key:"states",get:function(){return this._states},set:function(t){this._states=t}}]),t}();e.default=u},function(t,e){"use strict";function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e){r(this,t),this.property=e||{}}return o(t,[{key:"property",get:function(){return this._property},set:function(t){this._property=t}}]),t}(),s=function(t){function e(t,i){r(this,e);var o=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o._coordinate=i,o}return i(e,t),o(e,[{key:"coordinate",get:function(){return this._coordinate}}]),e}(a),u=function(t){function e(t,i){r(this,e);var o=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o._lineString=i,o._lastLineSpot=o._nextLineSpot=null,o._isValid=!0,o}return i(e,t),o(e,[{key:"lineString",get:function(){return this._lineString}},{key:"lastLineSpot",get:function(){return this._lastLineSpot},set:function(t){this._lastLineSpot=t}},{key:"nextLineSpot",get:function(){return this._nextLineSpot},set:function(t){this._nextLineSpot=t}},{key:"isValid",get:function(){return this._isValid},set:function(t){this._isValid=t}}]),e}(a);e.Spot=a,e.PointSpot=s,e.LineSpot=u},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"message",get:function(){return this._message},set:function(t){this._message=t}},{key:"stateMate",get:function(){return this._stateMate},set:function(t){this._stateMate=t}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(150),s=i(a),u=n(147),l=i(u),c=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r(this,t),this._provider=e,this._audioProvider=n?new l.default:null,this._segments=[]}return o(t,[{key:"addSegment",value:function(t){return 0!==this._segments.length&&(this._segments[this._segments.length-1].nextSegment=t,t.lastSegment=this._segments[this._segments.length-1]),this._segments.push(t),this}},{key:"removeSegment",value:function(t){return this._segments.splice(t,1),this}},{key:"getSegment",value:function(t){return this._segments[t]}},{key:"size",value:function(){return this._segments.length}},{key:"forEach",value:function(t){[].forEach.call(this._segments,t)}},{key:"trigger",value:function(t){var e=new s.default(t),n=this.provider.states;for(this._segments=[];e.has();)for(var i=e.next(),r=n,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var u;if(o){if(a>=r.length)break;u=r[a++]}else{if(a=r.next(),a.done)break;u=a.value}var l=u,c=l.stateMate.mate(i);if(c){var h=Object.create(Object.getPrototypeOf(l));for(var f in c)h[f]=c[f];var d=this._provider.provider(i,h,this._audioProvider);this.addSegment(d)}}}},{key:"provider",get:function(){return this._provider},set:function(t){this._provider=t}}]),t}();e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.CustomG=e.DynamicNavigation=e.naviFilter=e.NaviUtils=e.PathService=e.NavigateManager=void 0;var r=n(32),o=i(r),a=n(54),s=i(a),u=n(145),l=n(56),c=i(l),h=n(142),f=i(h);e.NavigateManager=o.default,e.PathService=s.default,e.NaviUtils=u.NaviUtils,e.naviFilter=u.naviFilter,e.DynamicNavigation=c.default,e.CustomG=f.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(58),c=i(l),h=n(4),f={anchor:[0,0],className:"",crossOrigin:!1,interactive:!0},d=function(t){function e(t){r(this,e);var n=s({},f,t),i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,null,n));return i._dom=i._createIcon(),i}return a(e,t),u(e,[{key:"_createIcon",value:function(){var t=this,e=this._options,n=e.url,i=e.interactive;if(!n)throw new Error("url not set in IconOverlay options.");var r=this._createImg(n);return r.addEventListener("load",function(e){t.emit("load",t,e)},!1),r.addEventListener("error",function(e){t.emit("error",t,e)},!1),r.addEventListener("click",function(e){i&&t.emit("click",t,e)},!1),this._setStyles(r),r}},{key:"_createImg",value:function(t){var e=this._options,n=e.crossOrigin,i=e.alt,r=document.createElement("img");return r.src=t,n&&(r.crossOrigin=""),i&&(r.alt=i),r}},{key:"setStyles",value:function(t){return s({},this._options,t),this._setStyles(this._dom),this}},{key:"_setStyles",value:function(t){var e=this._options.className;e&&(t.className="ngr-iconOverlay "+e);var n=this._options,i=n.anchor,r=n.size;return i=this._translate2Coord(i),r=this._translate2Coord(r),i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),r&&(t.style.width=r.x+"px",t.style.height=r.y+"px"),this}},{key:"_translate2Coord",value:function(t){if(!t)return null;var e=void 0,n=void 0;return Array.isArray(t)?(e=t[0]?t[0]:0,n=t[1]?t[1]:0):(e=t.x?t.x:0,n=t.y?t.y:0),new h.geom.Coordinate(e,n)}},{key:"url",set:function(t){t!==this._options.url&&(this._dom.src=t)}}]),e}(c.default);e.default=d},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=n(4),h=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.particleCount=10,t.colors=[[.5,.5,.5],[1,0,0]],t.position=new c.geom.Coordinate(0,0,0),t}return a(e,t),s(e,[{key:"parent",get:function(){return this._parent},set:function(t){this._parent=t}},{key:"particleCount",get:function(){return this._particleCount},set:function(t){this._particleCount=t,this.emit("valueChange",this,"particleCount",t)}},{key:"position",get:function(){return this._position},set:function(t){this._position=t,this.emit("valueChange",this,"position",t)}},{key:"colors",get:function(){return this._colors},set:function(t){this._colors=t,this.emit("valueChange",this,"colors",t)}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(5),c=i(l),h=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._particlesIndex=[],n._particles={},s(n,t||{}),n}return a(e,t),u(e,[{key:"addParticle",value:function(t){t&&this.has(t)||(this._particles[t.id]=t,this._particlesIndex[this._particlesIndex.length]=t.id,this.emit("addParticle",this,t),t.parent=this)}},{key:"removeParticle",value:function(t){if(t&&this.has(t)){delete this._particles[t.id];var e=this._particlesIndex.indexOf(t.id);e!==-1&&this._particlesIndex.splice(e,1),this.emit("removeParticle",this,t),t.parent=null}}},{key:"forEach",value:function(t){var e=this;this._particlesIndex.forEach(function(n,i){t(e._particles[n],i)})}},{key:"getIndex",value:function(t){return this._particlesIndex.indexOf(t)}},{key:"has",value:function(t){return!!t&&t.id in this._particlesIndex}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t}}]),e}(c.default);e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleEngine=e.ParticleGroup=e.Particle=void 0;var r=n(159),o=i(r),a=n(160),s=i(a),u=n(60),l=i(u);e.Particle=o.default,e.ParticleGroup=s.default,e.ParticleEngine=l.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(61),l=i(u),c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"getStyle",value:function(t){return this.style}},{key:"style",set:function(t){this._style=t},get:function(){return this._style}}]),e}(l.default);e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(61),l=i(u),c=new RegExp,h=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._keys=[],t._styles={},t}return a(e,t),s(e,[{key:"addKey",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(function(e){t._keys.push(e)})}},{key:"addStyle",value:function(t,e){this._styles[t]=e}},{key:"getStyle",value:function(t){for(var e in this._keys){var n=this._keys[e];if(n in t.properties)for(var i in this._styles)if(c.compile(i,"g"),c.test(t.properties[n]))return this._styles[i]}return this.defaultStyle}},{key:"defaultStyle",get:function(){return this._defaultStyle},set:function(t){this._defaultStyle=t}}]),e}(l.default);e.default=h},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"merge",value:function(t,e,n){return this}},{key:"has",value:function(t){return!1}},{key:"destroy",value:function(){}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(2),u=i(s),l=n(96),c=n(3),h={undeferred:!1,depthMax:1/0,objectsThreshold:8,overlap:.15},f=function(){function t(e){r(this,t),this.options=o({},h,e),this._octree=new l.Octree(o({},this.options)),this.featureMapping={},this.groupMapping={},this.virtualGroups={}}return a(t,[{key:"update",value:function(){this._octree.update()}},{key:"_add",value:function(t,e,n){if(t instanceof u.Group)for(var i=t.children,r=i,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var l=s;this._add(l,e,n)}else e.push(t.uuid),this._octree.add(t)}},{key:"add",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!((0,c.isBlank)(t)||(0,c.isBlank)(e)||(0,c.isBlank)(n))){(0,c.isBlank)(this.featureMapping[e])&&(this.featureMapping[e]={}),(0,c.isBlank)(this.featureMapping[e][n])&&(this.featureMapping[e][n]=[]);var r=this.featureMapping[e][n],o=i.layerGroupId,a=i.sceneGroupId,s=null;if(o&&a){if(this.groupMapping[a]){if(o!==this.groupMapping[a])throw new Error("OctreeManager: Unmatch in groupMapping")}else this.groupMapping[a]=o;this.virtualGroups[o]||(this.virtualGroups[o]=new u.Group),s=this.virtualGroups[o],s.add(t),t._virtual=!0}this._add(t,r,s)}}},{key:"remove",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t._virtual&&t.parent.remove(t),t instanceof u.Group)for(var n=t.children,i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;this.remove(s,e)}else this._octree.remove(t),e&&t.geometry.dispose()}},{key:"removeByLayerAndFeature",value:function(t,e){if(this.featureMapping[t]&&this.featureMapping[t][e]){var n=this.featureMapping[t][e];if(n&&n.length>0)for(var i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a,u=this._octree.objectsMap[s];u&&this.remove(u)}delete this.featureMapping[t][e]}}},{key:"has",value:function(t,e){var n=this.featureMapping;return n[t]&&n[t][e]&&n[t][e].length>0}},{key:"rebuild",value:function(){this._octree.rebuild()}},{key:"clearOctree",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this._octree.objects,n=e.length;if(this._octree=new l.Octree(o({},this.options)),this.featureMapping={},this.groupMapping={},this.virtualGroups={},t)for(var i=n-1;i>=0;--i){var r=e[i];e.splice(i,1),r.geometry.dispose()}}},{key:"searchByClientPoint",value:function(t,e,n){var i=new u.Raycaster,r=[];i.setFromCamera(new u.Vector2(t,e),n);for(var o=this._octree.search(i.ray.origin,i.far,!0,i.ray.direction),a=l.RaycasterUtils.intersectOctreeObjects(i,o),s=a,c=Array.isArray(s),h=0,s=c?s:s[Symbol.iterator]();;){var f;if(c){if(h>=s.length)break;f=s[h++]}else{if(h=s.next(),h.done)break;f=h.value}for(var d=f,p=d.object,g=p.visible;p&&(g=p.visible);)p=p.parent;g&&r.push(d)}return r}}]),t}();e.default=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.OverlayNodeId=e.OverlayNode=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(2),h=r(c),f=n(17),d=i(f),p=n(21),g=i(p),v=-2,m=function(t){function e(t){o(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._layerOverlay={},n._overlays={},n._domMapping={},n._domScene=new h.Scene,n._addOverlay=n._addOverlay.bind(n),n._removeOverlay=n._removeOverlay.bind(n),n._reAttachOverlay=n._reAttachOverlay.bind(n),n._removeLayer=n._removeLayer.bind(n),n._onSceneChange=n._onSceneChange.bind(n),n._overlayValueChange=n._overlayValueChange.bind(n),n}return s(e,t),u(e,[{key:"_removeOverlay",value:function(t,e,n){this.removeOverlay(e,n)}},{key:"_reAttachOverlay",value:function(t,e,n){this.reAttachOverlay(e,n)}},{key:"_removeLayer",value:function(t,e){var n=this._layerOverlay[e.id];if(n)for(var i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a,u=this._overlays[s];u&&this.removeOverlay(e,u)}delete this._layerOverlay[e.id]}},{key:"_onSceneChange",value:function(t,e,n){var i=this._layerOverlay[e.id];if(i&&null===n)switch(t){case"visible":for(var r=i,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s,l=this._overlays[u],c=arguments.length<=3?void 0:arguments[3];l&&(c===!0?l.targetDom.style.display=l._options.defaultDisplay:c===!1&&(l.targetDom.style.display="none"))}break;case"position":for(var h=i,f=Array.isArray(h),d=0,h=f?h:h[Symbol.iterator]();;){var p;if(f){if(d>=h.length)break;p=h[d++]}else{if(d=h.next(),d.done)break;p=d.value}var g=p,v=this._domMapping[g];if(v){var m=arguments.length<=3?void 0:arguments[3];v.position.setZ(m[2])}}}}},{key:"_overlayValueChange",value:function(t,e,n){var i=this._domMapping[t.id];"position"===e&&(i.position.setX(n.x),i.position.setY(n.y),i.position.setZ(n.z||i.position.z))}},{key:"_addOverlay",value:function(t,e,n){n.id in this._domMapping&&this.removeOverlay(n.layer,n);var i=new h.CSS2DObject(n.targetDom),r=this._layerOverlay[e.id];r||(r=[],this._layerOverlay[e.id]=r),r.push(n.id),this._overlays[n.id]=n,this._domMapping[n.id]=i,this._domScene.add(i),n.attach(e),n.on("valueChange",this._overlayValueChange),n.position&&this._overlayValueChange(n,"position",n.position)}},{key:"add",value:function(t){t instanceof d.default&&l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"add",this).call(this,t),t instanceof g.default&&(this._camera=t.camera)}},{key:"removeOverlay",value:function(t,e){if(e.id in this._domMapping){var n=this._domMapping[e.id],i=this._layerOverlay[t.id];if(this._domScene.remove(n),delete this._domMapping[e.id],delete this._overlays[e.id],e.detach(t),i){var r=i.indexOf(e.id);r!==-1&&i.splice(r,1),0===i.length&&delete this._layerOverlay[t.id]}e.off("valueChange",this._overlayValueChange),e.targetDom.style.display=e._options.defaultDisplay}}},{key:"reAttachOverlay",value:function(t,e){if(!t||!e)throw new Error("reAttachOverlay: Invalid parameter");var n=e.layer,i=this._layerOverlay[n.id];if(i){var r=i.indexOf(e.id);if(r!==-1){var o=this._layerOverlay[t.id];o||(o=[],this._layerOverlay[t.id]=o),i.splice(r,1),o.push(e.id),e.detach(n),e.attach(t)}}}},{key:"onAdd",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this._domRenderer=t.mapView.engine.getDomRenderer(t.mapView),this._sceneManager.mapView.on("addOverlay",this._addOverlay),this._sceneManager.mapView.on("removeOverlay",this._removeOverlay),this._sceneManager.mapView.on("reAttachOverlay",this._reAttachOverlay),this._sceneManager.mapView.on("removeLayer",this._removeLayer),this._sceneManager.on("onSceneChange",this._onSceneChange)}},{key:"onRemove",value:function(t){this._sceneManager.mapView.off("addOverlay",this._addOverlay),this._sceneManager.mapView.off("removeOverlay",this._removeOverlay),this._sceneManager.mapView.off("reAttachOverlay",this._reAttachOverlay),this._sceneManager.mapView.off("removeLayer",this._removeLayer),this._sceneManager.off("onSceneChange",this._onSceneChange),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t)}},{key:"render",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this),this._domRenderer&&this._camera&&this._domRenderer.render(this._domScene,this._camera)}}]),e}(d.default);e.OverlayNode=m,e.OverlayNodeId=v},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.ParticleNodeId=e.ParticleNode=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(2),h=r(c),f=n(76),d=i(f),p=n(17),g=i(p),v=-3,m=function(t){function e(t){o(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._particleGroup=new h.Group,n._group_group={},n._clock=new h.Clock,n._valueChange=n._valueChange.bind(n),n._addParticle=n._addParticle.bind(n),n._removeParticle=n._removeParticle.bind(n),n._addParticleGroup=n._addParticleGroup.bind(n),n._removeParticleGroup=n._removeParticleGroup.bind(n),n}return s(e,t),u(e,[{key:"_valueChange",value:function(t,e){var n=t.parent;if(n){var i=self._group_group[n.id];if(!i)return;var r=n.getIndex(t);if(r===-1)return;var o=i.emitters[r];if(!o)return;for(var a=arguments.length,s=Array(a>2?a-2:0),u=2;u<a;u++)s[u-2]=arguments[u];switch(e){case"position":o.position.value=o.position.value.set(s[0],s[1],s[2]);break;case"particleCount":o.particleCount=s[0];break;case"colors":for(var l=[],c=s,f=Array.isArray(c),d=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(d>=c.length)break;p=c[d++]}else{if(d=c.next(),d.done)break;p=d.value}var g=p;l[l.length]=new h.Color(g[0],g[1],g[2])}o.color.value=l}}}},{key:"_addParticle",value:function(t,e){var n=this._group_group[t.id];n&&this.addEmitterByParticle(t,n,e)}},{key:"_removeParticle",value:function(t,e){var n=this._group_group[t.id];n&&this.removeEmitterByParticle(t,n,e)}},{key:"_addParticleGroup",value:function(t){var e=self._group_group[t.id];e||(e=new d.default.Group({texture:{value:h.ImageUtils.loadTexture(t.texture)}}),self._group_group[t.id]=e,t.forEach(function(n){self.addEmitterByParticle(t,e,n)}),t.on("addParticle",self._addParticle),t.on("removeParticle",self._addParticle),self._particleGroup.add(e.mesh));
}},{key:"_removeParticleGroup",value:function(t){var e=this,n=this._group_group[t.id];n&&(t.forEach(function(i){e.removeEmitterByParticle(t,n,i)}),this._particleGroup.remove(n.mesh),delete this._group_group[t.id],t.off("addParticle",this._addParticle),t.off("removeParticle",this._addParticle))}},{key:"addEmitterByParticle",value:function(t,e,n){for(var i=[],r=n.colors,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;i[i.length]=new h.Color(u[0],u[1],u[2])}var l=new d.default.Emitter({type:1,maxAge:{value:1},size:{value:1},velocity:{value:new h.Vector3(3,3,3),distribution:d.default.distributions.DISC},position:{value:new h.Vector3(n.position.x,n.position.y,n.position.z||0),radius:5,spread:new h.Vector3(3,3,3)},color:{value:i},particleCount:n.particleCount});e.addEmitter(l),n.on("valueChange",this._valueChange)}},{key:"removeEmitterByParticle",value:function(t,e,n){var i=t.getIndex(n);i!==-1&&(e.removeEmitter(e.emitters[i]),n.off("valueChange",this._valueChange))}},{key:"onAdd",value:function(t){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t);var n=t.get(-1);n.renderScene.add(this._particleGroup),t.mapView&&t.mapView.particleEngine&&t.mapView.particleEngine.on("addParticleGroup",this._addParticleGroup)}},{key:"onRemove",value:function(t){t.mapView&&t.mapView.particleEngine&&t.mapView.particleEngine.off("addParticleGroup",this._addParticleGroup);var n=t.get(-1);n.renderScene.remove(this._particleGroup),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t)}},{key:"render",value:function(){if(l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this),this._group_group)for(var t in this._group_group)this._group_group[t].tick(this._clock.getDelta())}},{key:"particleGroup",get:function(){return this._particleGroup}}]),e}(g.default);e.ParticleNode=m,e.ParticleNodeId=v},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t){return!isNaN(t)&&isFinite(t)}function l(t){return u(t)&&t>=0}Object.defineProperty(e,"__esModule",{value:!0}),e.SceneAnimationManager=void 0;var c=n(1),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),f=n(6),d=r(f),p=n(2),g=i(p),v=n(3),m=function(){function t(){s(this,t),this._animator=null}return h(t,[{key:"hasAnimation",value:function(t){return!1}},{key:"isValidParams",value:function(t){return!1}},{key:"setParams",value:function(t,e){return null}},{key:"getParams",value:function(t){return null}},{key:"parseParams",value:function(t){return t}},{key:"start",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:300,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=this.getParams(t),s=c({},a),u=this.parseParams(e),h=l(r)?r:300,f=l(o)?o:0;if(!this.hasAnimation(t)||!this.isValidParams(a)||!this.isValidParams(u))return console.warn("SceneAnimation: Invalid parameter."),null;var p=function(e,n){i.setParams(t,n)};return this.stop(),this.animator=d.default.getInstance().ofObject(s,u,h).on("update",p).on("complete",function(t){n?d.default.getInstance().ofObject(u,a,h).on("update",p).on("complete",function(t){t.stop()}).start():t.stop()}).repeat(f).start(),this}},{key:"stop",value:function(){this.animator&&this.animator.stop&&this.animator.stop()}}]),t}(),y=function(t){function e(){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),h(e,[{key:"hasAnimation",value:function(t){return t&&t.material&&(0,v.isPresent)(t.material.opacity)}},{key:"isValidParams",value:function(t){return t&&t.num&&l(t.num)&&t.num<=1}},{key:"setParams",value:function(t,e){return!(!this.hasAnimation(t)||!this.isValidParams(e))&&(t.material.opacity=e.num,e.num>=1&&(t.material.transparent=!1),!0)}},{key:"getParams",value:function(t){return this.hasAnimation(t)?{num:t.material.opacity}:null}},{key:"parseParams",value:function(t){return t&&t.num?t:{num:t}}}]),e}(m),_=function(t){function e(){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),h(e,[{key:"hasAnimation",value:function(t){return t&&t.material&&(0,v.isPresent)(t.material.color)}},{key:"_isValidColorCom",value:function(t){return l(t)&&t<=1}},{key:"isValidParams",value:function(t){return t&&this._isValidColorCom(t.r)&&this._isValidColorCom(t.g)&&this._isValidColorCom(t.b)}},{key:"setParams",value:function(t,e){return!(!this.hasAnimation(t)||!this.isValidParams(e))&&(t.material.color.setRGB(e.r,e.g,e.b),!0)}},{key:"getParams",value:function(t){if(this.hasAnimation(t)){var e=t.material.color;return{r:e.r,g:e.g,b:e.b}}return null}},{key:"parseParams",value:function(t){if(t&&t.r&&t.g&&t.b)return t;var e=(new g.Color).set(t);return{r:e.r,g:e.g,b:e.b}}}]),e}(m),b=function(t){function e(){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),h(e,[{key:"hasAnimation",value:function(t){return t&&t.position}},{key:"isValidParams",value:function(t){return t&&u(t.x)&&u(t.y)&&u(t.z)}},{key:"setParams",value:function(t,e){return!(!this.hasAnimation(t)||!this.isValidParams(e))&&(t.position.set(e.x,e.y,e.z),!0)}},{key:"getParams",value:function(t){if(this.hasAnimation(t)){var e=t.position;return{x:e.x,y:e.y,z:e.z}}return null}}]),e}(m),x=function(){function t(){s(this,t),this._animationList={opacity:new y,color:new _,position:new b}}return h(t,[{key:"setAnimation",value:function(t,e){return!!(t&&e instanceof m)&&(this._animationList[t]=e,!0)}},{key:"getAnimation",value:function(t){return this._animationList[t]}},{key:"removeAnimation",value:function(t){return!!this._animationList[t]&&(delete this._animationList[t],!0)}}]),t}();e.SceneAnimationManager=x},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t)}return i(t,[{key:"generator",value:function(t,e){return null}},{key:"find",value:function(t){return null}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return[].concat((0,p.isNumber)(t)||(0,p.isString)(t)||(0,p.isArray)(t)?t:[])}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(17),h=i(c),f=n(165),d=i(f),p=n(3),g=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,0));return n.onAdd(n),n._mapView=t,n._allScene={},n._octreeManager=new d.default,n}return a(e,t),u(e,[{key:"clearOctree",value:function(){this._octreeManager.clearOctree()}},{key:"_searchObjectsInOctree",value:function(t,e){var n=this._mapView.activeCamera.camera;return this._octreeManager.searchByClientPoint(t,e,n)}},{key:"render",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this),this._octreeManager.update()}},{key:"addScene",value:function(t){return t.id&&!this.hasScene(t)&&(this._allScene[t.id]=t,t.onAdd(this)),this}},{key:"setScale",value:function(t,e,n,i,r,o){var a=this._search(t,e,n);return this.emit("onSceneChange","scale",t,a,[i,r,o]),this}},{key:"setPosition",value:function(t,e,n,i,r,o){var a=this._search(t,e,n),s=i,u=r;if(t.coordinateSystem){var l=t.coordinateSystem.getOffset();s=i+l[0],u=r+l[1]}return this.emit("onSceneChange","position",t,a,[s,u,o]),this}},{key:"quickSetPosition",value:function(t,e,n,i,r,o){var a=this._search(t,e,n),s=i,u=r;if(t.coordinateSystem){var l=t.coordinateSystem.offset(i,r);s=l[0],u=l[1]}return this.emit("onSceneChange","quickPosition",t,a,[s,u,o]),this}},{key:"setRotation",value:function(t,e,n,i,r,o){var a=this._search(t,e,n);return this.emit("onSceneChange","rotation",t,a,[i,r,o]),this}},{key:"setVisible",value:function(t,e,n,i){var r=this._search(t,e,n);return this.emit("onSceneChange","visible",t,r,i),this}},{key:"highlight",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.414,r=this._search(t,e,n);return this.emit("onSceneChange","highlight",t,r,i),this}},{key:"setColor",value:function(t,e,n,i,r){var o=this._search(t,e,n);return this.emit("onSceneChange","color",t,o,i,r),this}},{key:"setColors",value:function(t,e,n,i,r){var o=this,a=(0,p.isArray)(n)?n:[n],s=a.map(function(n){return o._search(t,e,n)});return this.emit("onSceneChange","colors",t,s,i,r),this}},{key:"resetStyle",value:function(t,e,n,i){var r=this._search(t,e,n);return this.emit("onSceneChange","styleResetting",t,r,i),this}},{key:"setValueChangeByFeatures",value:function(t,e,n){for(var i=arguments.length,r=Array(i>3?i-3:0),o=3;o<i;o++)r[o-3]=arguments[o];return this.emit.apply(this,["onSceneChange",t,e,n].concat(r)),this}},{key:"resetColor",value:function(t,e,n){var i=this._search(t,e,n);return this.emit("onSceneChange","colorResetting",t,i),this}},{key:"setOpacity",value:function(t,e,n,i,r){var o=this._search(t,e,n);return this.emit("onSceneChange","opacity",t,o,i,r),this}},{key:"setDepthTest",value:function(t,e,n,i){if(!(0,p.isBoolean)(i))throw new Error("Unsupported depthTest type");var r=this._search(t,e,n);this.emit("onSceneChange","depthTest",t,r,i)}},{key:"getAABB",value:function(t,e,n,i){if((0,p.isArray)(i))throw new Error("SceneManager#getAABB: Invalid outBox");var r=this._search(t,e,n),o=void 0;if((0,p.isArray)(r)?(o=r[0],console.warn("SceneManager#getAABB: Get the first feature of several features")):o=r,!o)throw new Error("SceneManager#getAABB: Feature not found");return i.length=0,this.emit("onGetAABB",t,o,i),this}},{key:"removeScene",value:function(t){return t.id&&this.hasScene(t)&&(delete this._allScene[t.id],t.onRemove(this)),this}},{key:"hasScene",value:function(t){return!!t&&(t in this._allScene||t.id in this._allScene)}},{key:"destroy",value:function(){for(var t in this._allScene)this.removeScene(this._allScene[t]);this._mapView=null}},{key:"_search",value:function(t,e,n){if(!e&&!n)return null;var i=s(n),r=[],o=t;if("string"==typeof t&&(o=this._mapView.getLayer(t)),o)if("id"===e){for(var a=i,u=Array.isArray(a),l=0,a=u?a:a[Symbol.iterator]();;){var c;if(u){if(l>=a.length)break;c=a[l++]}else{if(l=a.next(),l.done)break;c=l.value}var h=c;r.push(o.searchById(h))}1===r.length&&(r=r.pop())}else for(var f=i,d=Array.isArray(f),p=0,f=d?f:f[Symbol.iterator]();;){var g;if(d){if(p>=f.length)break;g=f[p++]}else{if(p=f.next(),p.done)break;g=p.value}var v=g;r=r.concat(o.search(e,v))}return r}},{key:"mapView",get:function(){return this._mapView}}]),e}(h.default);e.default=g},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(164),h=r(c),f=n(2),d=i(f),p=n(10),g=r(p),v=n(13),m=r(v),y=n(3),_=function(){function t(e){s(this,t),this._container=e}return l(t,[{key:"reset",value:function(){this._range={},this._rangeIndex=[],this._rangeLength=0}},{key:"merge",value:function(t,e){}},{key:"update",value:function(){}},{key:"remove",value:function(t){}},{key:"has",value:function(t){return t in this._range}},{key:"type",value:function(){return null}},{key:"clear",value:function(){this.reset()}}]),t}(),b=function(t){function e(){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),l(e,[{key:"reset",value:function(){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this),this._lineGeoBuffer&&this._lineGeoBuffer.dispose(),this._lineGeoBuffer=new d.BufferGeometry,this._lineIndex=[],this._linePosition=[],this._lineColor=[],this._lineMesh=new d.LineSegments(this._lineGeoBuffer,new d.LineBasicMaterial({vertexColors:d.VertexColors})),this._lineMesh.material.transparent=!0,this.blending&&(this._lineMesh.material.blending=d.CustomBlending,this._lineMesh.material.blendEquation=d.MinEquation)}},{key:"clear",value:function(){this._container.remove(this._lineMesh),u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clear",this).call(this)}},{key:"setValue",value:function(t,e){switch(e){case"color":break;case"opacity":if(0===t){this._lineMesh.material.opacity=arguments.length<=2?void 0:arguments[2],this._lineMesh.material.blending=d.NormalBlending,1===(arguments.length<=2?void 0:arguments[2])&&(this._lineMesh.material.transparent=!0,this.blending&&(this._lineMesh.material.blending=d.CustomBlending,this._lineMesh.material.blendEquation=d.MinEquation));break}break;case"colorResetting":}}},{key:"merge",value:function(t,e){var n=e.material.color,i=e.geometry.vertices;if(0===i.length)return null;var r=this._range[t];r&&this.remove(t),r=[],this._range[t]=r,this._rangeIndex.push(t),r.push(this._linePosition.length),r.push(this._lineIndex.length);for(var o in i){o>0&&this._lineIndex.push(this._rangeLength-1,this._rangeLength);var a=i[o];this._linePosition[3*this._rangeLength]=a.x,this._linePosition[3*this._rangeLength+1]=a.y,this._linePosition[3*this._rangeLength+2]=a.z,this._lineColor[3*this._rangeLength]=n.r,this._lineColor[3*this._rangeLength+1]=n.g,this._lineColor[3*this._rangeLength+2]=n.b,this._rangeLength++}return r.push(this._linePosition.length),r.push(this._lineIndex.length),e.geometry.dispose(),this._lineMesh}},{key:"update",value:function(){this._resetLineBuffer()}},{key:"remove",value:function(t){var e=this._range[t];if(!e){var n=e[0],i=e[2],r=e[1],o=e[3],a=o-r,s=i-n,u=s/3;this._rangeLength-=u,this._linePosition.splice(n,i-n),this._lineColor.splice(n,i-n),this._lineIndex.splice(r,o-r);for(var l=r;l<this._lineIndex.length;l++)this._lineIndex[l]-=u;var c=this._rangeIndex.indexOf(t);if(c!==-1){for(var h=c+1;h<this._rangeIndex.length;h++){var f=this._range[this._rangeIndex[h]];f&&(f[0]-=s,f[2]-=s,f[1]-=a,f[3]-=a)}this._rangeIndex.splice(c,1)}delete this._range[t]}}},{key:"type",value:function(){return"line"}},{key:"_resetLineBuffer",value:function(){this._lineGeoBuffer.setIndex(new d.BufferAttribute(new Uint16Array(this._lineIndex),1)),this._lineGeoBuffer.addAttribute("position",new d.BufferAttribute(new Float32Array(this._linePosition),3)),this._lineGeoBuffer.addAttribute("color",new d.BufferAttribute(new Float32Array(this._lineColor),3)),this._lineGeoBuffer.computeBoundingSphere(),this._container.add(this._lineMesh)}},{key:"blending",get:function(){return this._blending},set:function(t){this._blending=t}}]),e}(_),x=function(t){function e(){return s(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),l(e,[{key:"reset",value:function(){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this),this._polygonPosition=[],this._polygonId=[],this._polygonColor=[],this._polygonNormals=[],this._range={},this._rangeIndex=[],this._polygonBuffer&&this._polygonBuffer.dispose(),this._polygonBuffer=new d.BufferGeometry,this._polygonMesh=new d.Mesh(this._polygonBuffer,new d.ShaderMaterial({uniforms:{coloredPOI:{value:-1},pickedColor:{value:new d.Vector3(1,0,0)},transparentPOI:{value:-1},opacity:{value:1},universalOpacity:{value:1}},vertexShader:["attribute float polygonId;","attribute vec3 color;","varying vec3 vColor;","varying float vAlpha;","uniform float coloredPOI;","uniform vec3 pickedColor;","uniform float transparentPOI;","uniform float opacity;","uniform float universalOpacity;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);","vColor = color;","vAlpha = universalOpacity;","if (polygonId == coloredPOI) vColor =  pickedColor;","if (polygonId == transparentPOI) vAlpha =  opacity;","}"].join("\n"),fragmentShader:["varying vec3 vColor;","varying float vAlpha;","void main() {","gl_FragColor = vec4(vColor, vAlpha);","}"].join("\n"),transparent:!0})),this._rangeLength=0}},{key:"clear",value:function(){this._container.remove(this._polygonMesh),u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"clear",this).call(this)}},{key:"setColors",value:function(t,e){var n=this;t.map(function(t){if(t<0)return null;for(var i=m.default.parseColor(e),r=new d.Color(i),o=["r","g","b"],a=n._range[t][0],s=n._range[t][1],u=a;u<=s;u++){var l=o[u%3];n._polygonColor[u]=r[l]}return null})}},{key:"setValue",value:function(t,e){switch(e){case"color":var n=m.default.parseColor(arguments.length<=2?void 0:arguments[2]),i=new d.Color(n);this._polygonMesh.material.uniforms.coloredPOI.value=t,this._polygonMesh.material.uniforms.pickedColor.value=new d.Vector3(i.r,i.g,i.b);break;case"colors":if(t<0)break;for(var r=m.default.parseColor(arguments.length<=2?void 0:arguments[2]),o=new d.Color(r),a=["r","g","b"],s=this._range[t][0],u=this._range[t][1],l=s;l<=u;l++){var c=a[l%3];this._polygonColor[l]=o[c]}this._resetPolygonBuffer();break;case"opacity":if(1!==(arguments.length<=2?void 0:arguments[2])?this._polygonMesh.material.transparent=!0:this._polygonMesh.material.transparent=!1,0===t){this._polygonMesh.material.uniforms.transparentPOI.value=-1,this._polygonMesh.material.uniforms.universalOpacity.value=arguments.length<=2?void 0:arguments[2];break}this._polygonMesh.material.uniforms.transparentPOI.value=t,this._polygonMesh.material.uniforms.opacity.value=arguments.length<=2?void 0:arguments[2];break;case"colorResetting":this._polygonMesh.material.uniforms.coloredPOI.value=-1}}},{key:"merge",value:function(t,e){var n=this,i=e.geometry,r=e.position,o=e.material.color;if(!i)return null;if(i.faces.length>0){var a=e.material;!(this._polygonMesh.material instanceof d.MeshPhongMaterial)&&a instanceof d.MeshPhongMaterial&&(this._polygonMesh.material=new d.ShaderMaterial({uniforms:{coloredPOI:{value:-1},pickedColor:{value:new d.Vector3(1,0,0)},transparentPOI:{value:-1},opacity:{value:1},universalOpacity:{value:1},directionalLights:{value:[]},ambientLightColor:{value:[]},spotLights:{value:[]},pointLights:{value:[]},hemisphereLights:{value:[]},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]}},vertexShader:["attribute float polygonId;","attribute vec3 color;","varying vec3 vColor;","varying float vAlpha;","uniform float coloredPOI;","uniform vec3 pickedColor;","uniform float transparentPOI;","uniform float opacity;","uniform float universalOpacity;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);","// vec3 transformedNormal = normalMatrix * normal;","float nDotL = max(dot(vec3(0.57735,0.57735,-0.57735), normal), 0.0);","// vec3 pointLight = vec3(10,10,100);","// float nDotL = dot(normalize( pointLight-position), normal);","vColor = color - color.xyz * nDotL * 0.5;","// vColor = color.xyz * nDotL * 0.5 + color;","vAlpha = universalOpacity;","if (polygonId == coloredPOI) vColor =  pickedColor;","if (polygonId == transparentPOI) vAlpha =  opacity;","}"].join("\n"),fragmentShader:["varying vec3 vColor;","varying float vAlpha;","void main() {","gl_FragColor = vec4(vColor, vAlpha);","}"].join("\n"),transparent:!0,lights:!1}));var s=9,u=["a","b","c"],l=["x","y","z"],c=["r","g","b"],h=this._range[t];h&&this.remove(t,parent),h=[],this._range[t]=h,this._rangeIndex.push(t),h.push(this._polygonPosition.length),i.faces.forEach(function(e){for(var a=o?o:e.color,h=0;h<s;h++){var f=n._rangeLength*s+h,d=u[Math.floor(h/3)],p=l[h%3],g=c[h%3];n._polygonPosition[f]=i.vertices[e[d]][p]+r[p],n._polygonNormals[f]=e.normal[p],n._polygonColor[f]=a[g]}n._polygonId[3*n._rangeLength+0]=t,n._polygonId[3*n._rangeLength+1]=t,n._polygonId[3*n._rangeLength+2]=t,n._rangeLength++}),h.push(this._polygonPosition.length),i.dispose()}return this._polygonMesh}},{key:"update",value:function(){this._resetPolygonBuffer()}},{key:"remove",value:function(t){var e=this._range[t];if(e){var n=e[0],i=e[1],r=i-n,o=r/9,a=this._rangeIndex.indexOf(t);if(this._rangeLength-=o,this._polygonPosition.splice(n,r),this._polygonNormals.splice(n,r),this._polygonColor.splice(n,r),this._polygonId.splice(n/3,r/3),a!==-1){for(var s=a+1;s<this._rangeIndex.length;s++){var u=this._range[this._rangeIndex[s]];u&&(u[0]-=r,u[1]-=r)}this._rangeIndex.splice(a,1)}delete this._range[t]}}},{key:"type",value:function(){return"polygon"}},{key:"_resetPolygonBuffer",value:function(){this._polygonBuffer.addAttribute("position",new d.BufferAttribute(new Float32Array(this._polygonPosition),3)),this._polygonBuffer.addAttribute("normal",new d.BufferAttribute(new Float32Array(this._polygonNormals),3)),this._polygonBuffer.addAttribute("color",new d.BufferAttribute(new Float32Array(this._polygonColor),3)),this._polygonBuffer.addAttribute("polygonId",new d.BufferAttribute(new Float32Array(this._polygonId),1)),this._polygonBuffer.computeBoundingSphere(),this._container.add(this._polygonMesh)}}]),e}(_),w=function(t){function e(t){s(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._sceneManager=t,n._lastLeaf={},n.lastLayerId=0,n._featuresMapping={},n._mergeLeafs={},n._onSceneChange=n._onSceneChange.bind(n),n._sceneManager.on("onSceneChange",n._onSceneChange),n}return a(e,t),l(e,[{key:"_onSceneChange",value:function(t,e,n){if("color"===t||"colors"===t||"opacity"===t||"colorResetting"===t){for(var i=arguments.length,r=Array(i>3?i-3:0),o=3;o<i;o++)r[o-3]=arguments[o];if("colors"===t&&this._setColors(e,n,r[0]),n){if(!(0,y.isArray)(n)&&this.has(n)){if(this.lastLayerId!==e.id){for(var a in this._lastLeaf){var s=this._lastLeaf[a];s.setValue.apply(s,[-1,a].concat(r))}this.lastLayerId=e.id}this.setValue.apply(this,[e,n,t].concat(r))}}else this.setValue.apply(this,[e,null,t].concat(r))}}},{key:"has",value:function(t,e){var n=t.id,i=this._featuresMapping[n];return!!i&&(!e||e.id in i)}},{key:"hasLayer",value:function(t){return t in this._mergeLeafs}},{key:"merge",value:function(t,e,n,i,r){var o=0;if(!e&&!e instanceof g.default)return o;var a=e.type();if("Polygon"===a){var s=e.polygonMerge,u=e.outlineMerge;if(!s&&!u)return o;if(n instanceof d.Group){for(var l=n.children,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var p=f;o=this.merge(t,e,p,i,r),2===o&&n.remove(p)}return 0===n.children.length?2:o}var v=this._featuresMapping[t.id];v||(v=[],this._featuresMapping[t.id]=v);var m=this._mergeLeafs[i];if(m||(m={},this._mergeLeafs[i]=m),u&&n.children.length>0){var y=n.children[0];n.remove(y);var _=m.line;_||(_=new b(r),_.blending=e.outlineBlending,_.reset(),m.line=_),_.merge(y.id,y),v.push(y.id),o=1}if(s){var w=m.polygon;w||(w=new x(r),w.reset(),m.polygon=w),w.merge(n.id,n),v.push(n.id),o=1===o?2:1}}return o}},{key:"update",value:function(t){var e=this._mergeLeafs[t];if(e)for(var n in e){var i=e[n];i.update()}}},{key:"_setColors",value:function(t,e,n){var i=this,r=[],o=this._mergeLeafs[t.id],a=o.polygon;e.map(function(t){if(!t)return null;var e=i._featuresMapping[t.id];return e&&(r=r.concat(e.filter(function(t){return a.has(t)}))),null}),a.setColors(r,n),a.update()}},{key:"setValue",value:function(t,e,n){for(var i=t.id,r=this._mergeLeafs[i],o=arguments.length,a=Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];if(!e&&r)this._setValue.apply(this,[r,null,n].concat(a));else if(e){var u=this._featuresMapping[e.id];if(!u)return;for(var l in this._mergeLeafs)r=this._mergeLeafs[l],this._setValue.apply(this,[r,u,n].concat(a))}}},{key:"_setValue",value:function(t,e,n){for(var i=arguments.length,r=Array(i>3?i-3:0),o=3;o<i;o++)r[o-3]=arguments[o];if(t.line&&!e){var a;(a=t.line).setValue.apply(a,[0,n].concat(r))}var s=t.polygon;if(s)if(e)for(var u=e,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var h;if(l){if(c>=u.length)break;h=u[c++]}else{if(c=u.next(),c.done)break;h=c.value}var f=h;s.has(f)&&(s.setValue.apply(s,[f,n].concat(r)),this._lastLeaf[n]=s)}else s.setValue.apply(s,[0,n].concat(r))}},{key:"remove",value:function(t){var e=t.id,n=this._featuresMapping[e];if(n){for(var i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var s=a;for(var u in this._mergeLeafs){var l=this._mergeLeafs[u];if(l)for(var c in l){var h=l[c];h.remove(s)}}}delete this._featuresMapping[e]}}},{key:"removeByLayer",value:function(t,e){var n=this;t.visit(function(t){var e=n._featuresMapping[t.id];e&&delete n._featuresMapping[t.id]});var i=this._mergeLeafs[e];if(i){for(var r in i){var o=i[r];o.clear()}delete this._mergeLeafs[e]}}},{key:"destroy",value:function(){this._sceneManager.off("onSceneChange",this._onSceneChange),this._lastLeaf=[],this._featuresMapping=[];for(var t in this._mergeLeafs){var e=this._mergeLeafs[t];for(var n in e){var i=e[n];i.clear()}}this._mergeLeafs=[]}}]),e}(h.default);e.default=w},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t){for(var e=this.margin||0,n=Number.MAX_VALUE,i=Number.MIN_VALUE,r=n,o=i,a=this.children,s=Array.isArray(a),u=0,a=s?a:a[Symbol.iterator]();;){var l;if(s){if(u>=a.length)break;l=a[u++]}else{if(u=a.next(),u.done)break;l=u.value}var c=l;if(c.getAABB){var h=c.getAABB(t);n>h[0]&&(n=h[0]),r>h[1]&&(r=h[1]),i<h[3]&&(i=h[3]),o<h[4]&&(o=h[4])}}return[n-e,r-e,0,i+e,o+e,0]}function s(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.children,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;a.makeCollision&&a.makeCollision(t,e)}this.visible=!t}Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(2),h=r(c),f=n(130),d=i(f),p=n(126),g=i(p),v=n(93),m=i(v),y=n(87),_=i(y),b=n(42),x=i(b),w=n(98),E=i(w),S=n(97),M=i(S),C=n(8),I=i(C),O=n(27),T=i(O),P=n(3),A=n(214),L=i(A),N=n(103),k=i(N),R=n(95),D=(i(R),n(89)),F=(i(D),n(92)),B=(i(F),n(91)),j=(i(B),new h.TextureLoader),U=new d.default(new h.TextureLoader),z={},G=(0,L.default)(h),V=(0,k.default)(h),X={Annotation:{outlineColor:"strokeStyle",outlineWidth:"lineWidth",shadowColor:"shadowColor",shadowBlur:"shadowBlur",color:"fillStyle"}},H=function(){function t(){o(this,t)}return l(t,null,[{key:"generator",value:function(e,n,i,r){var o=e.mapView.engine,a=r.type(),s=null;switch(a){case"Polygon":s=t.polygon(e,o,i,r);break;case"Annotation":s=t.annotation(e,n,o,i,r);break;case"Icon":s=t.icon(e,n,o,i,r);break;case"LineString":s=t.lineString(e,o,i,r);break;case"Light":s=t.light(e,o,i,r);break;case"Model":s=t.model(e,n,o,i,r);break;case"Sphere":s=t.sphere(e,n,o,i,r);break;default:console.warn("Invalid style type")}if(s){if(s.originStyle=r,i.properties.id&&(s._sceneId=i.properties.id,s._layerId=n.id,s instanceof h.Group))for(var u=s.children,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var f;if(l){if(c>=u.length)break;f=u[c++]}else{if(c=u.next(),c.done)break;f=c.value}var d=f;d._sceneId=i.properties.id,d._layerId=n.id}if(r.collision&&e.mapView.collisionSceneManager.add(i,s),r.alwaysVisible&&(e.mapView.collisionSceneManager.add(i,s,!0),"PlaneLineGroup"===s.type))for(var p=function(){if(v){if(m>=g.length)return"break";y=g[m++]}else{if(m=g.next(),m.done)return"break";y=m.value}var t=y;t.on("loaded",function(){return e.mapView.collisionSceneManager.add(i,t,!0)})},g=s.children,v=Array.isArray(g),m=0,g=v?g:g[Symbol.iterator]();;){var y,_=p();if("break"===_)break}}return s}},{key:"annotation",value:function(e,n,i,r,o){var u=r.geometry,l=u.getGeometryType(),c=null;if("Point"===l){var f=o.field,d=t.parseParams(r,o,["font","color","outlineColor","outlineWidth","shadowColor","shadowBlur","depthTest","optTextRect"]);if(d.antialias=!1,d.align=x.default.center,f&&r.properties[f]){var p=e.mapView,g=i.getRenderer(p),v=g.getPixelRatio()===window.devicePixelRatio?1:window.devicePixelRatio,m=o.anchorStyle,y=o.z,b=void 0===y?0:y,w=o.margin,E=o.anchor,S=o.anchorAuto,M=null;if(c=new _.default(r.properties[f],d),c.position.set(u.getX(),u.getY(),(u.getCoordinate().z||0)+b),c.sprite.scale.x=c.canvas.textWidth/2*v,c.sprite.scale.y=c.canvas.textHeight/2*v,c.sprite.material.materialScale=!0,c.margin=w,c.sprite.material.anchor=E.slice(),c.sprite.material.transparent=!0,m){var C=m.type();"Icon"===C&&(M=t.icon(e,n,i,r,o.anchorStyle))}if(M){var I=new h.Group;S&&m.width&&(c.sprite.material.anchor[0]=-m.width/2/c.sprite.scale.x),
I.add(c),I.add(M),c=I,I.margin=w,I.getAABB=a,I.makeCollision=s}}}return c}},{key:"icon",value:function(e,n,i,r,o){var a=r.geometry,s=a.getGeometryType(),u=null;if("Point"===s){var l=t.parseParams(r,o,["texture","serverUrl"]),c=o.depthTest,f=void 0===c||c,d=o.plane,p=o.anchor,g=o.margin,v=o.z,m=void 0===v?0:v;if(l.fog=!0,l.depthTest=!!f,l.transparent=!0,l.alphaTest=.01,d){var y=t._generateTexturePlane(1,1),_=new h.MeshBasicMaterial(l);u=new h.Mesh(y,_),u.renderOrder=1,t.parseTexture(e,n,u,o,l)}else u=new E.default(new h.SpriteMaterial(l)),u.margin=g,u.material.anchor=p.slice(),t.parseTexture(e,n,u,o,l);u.position.set(a.getX(),a.getY(),(a.getCoordinate().z||0)+m)}return u}},{key:"lineString",value:function(e,n,i,r){var o=i.geometry,a=o.getGeometryType(),s=void 0;if("LineString"===a){var u=o.getCoordinates();if(0!==u.length){var l=t.parseParams(i,r,["color","depthTest"]);if(l.depthTest=!(0,P.isBoolean)(r.depthTest)||r.depthTest,r["2d"]){var c=r.width,f=r.opacity,d=r.dashSteps,p=void 0===d?12:d,g=r.dashDistance,v=void 0===g?.2:g,m=r.dashSmooth,y=void 0===m?.01:m,_=u.map(function(t){var e=t.x,n=t.y,i=t.z,r=void 0===i?0:i;return[e,n,r]}),b=G(_),x=new h.ShaderMaterial(V({side:h.DoubleSide,diffuse:l.color,thickness:c,opacity:f,depthTest:l.depthTest}));x.uniforms.dashSteps.value=p,x.uniforms.dashDistance.value=v,x.uniforms.dashSmooth.value=y,s=new h.Mesh(b,x),s.position.z+=.1}else{var w=r.tension,E=r.texture,S=r.density,M=r.width,C=void 0===M?1:M,I=u.map(function(t){var e=t.x,n=t.y,i=t.z,r=void 0===i?0:i;return new h.Vector3(e,n,r)}),O=new h.CatmullRomCurve3(I);O.type="catmullrom",O.tension=w>=0&&w<=1?w:0;var T=new h.TubeGeometry(O,Math.ceil(O.getLength()*(S>0?S:1)),C/2,8,!1);E&&(j.load(E,function(t){var e=t.image.width/t.image.height,n=T.parameters.path.getLength(),i=2*T.parameters.radius;s.material.needsUpdate=!0,s.material.map=t,s.material.map.wrapS=h.RepeatWrapping,s.material.map.repeat.setX(n/i/e)}),l.transparent=!0),s=new h.Mesh(T,new h.MeshBasicMaterial(l))}}}return s}},{key:"polygon",value:function(e,n,i,r){var o=i.geometry,a=t.parseParams(i,r,["color","opacity","texture"]),s=o.getGeometryType(),u=null;if("Polygon"===s)u=t._polygon(e,n,o,r,a,o.zIndex,i.id);else if("MultiPolygon"===s){u=new h.Group;for(var l=0;l<o.getNumGeometries();l++){var c=t._polygon(e,n,o.getGeometryN(l),r,a,o.zIndex,i.id);u.add(c)}}return u}},{key:"_polygon",value:function(e,n,i,r,o,a,s){var u=r.height,l=r.bevelEnabled,c=r.bevelThickness,f=r.bevelSize,d=r.bevelSegments,p=r.light,v=r.z,m=r.outlineColor,y=r.lineHeight,_=new h.Shape,b=new g.default(i),x={amount:Math.abs(u),bevelEnabled:!1},w=o.map,E=null,S=void 0,C=null;if(b.shellCreator(function(){return _}),b.shell(function(t,e,n){var i=e.x,r=e.y;0===n?t.moveTo(i,r):t.lineTo(i,r)}),b.holeCreator(function(){var t=new h.Path;return _.holes.push(t),t}),b.holes(function(t,e,n){var i=e.x,r=e.y;0===n?t.moveTo(i,r):t.lineTo(i,r)}),e.mapView._goemMap&&e.mapView._goemMap[s]?S=e.mapView._goemMap[s].geometry:(0,P.isNumber)(u)&&0!==u?(l&&(x.bevelEnabled=!0,x.bevelThickness=(0,P.isNumber)(c)?c:0,x.bevelSize=(0,P.isNumber)(f)&&f>0?f:1,x.bevelSegments=(0,P.isNumber)(d)?d:1),S=new h.ExtrudeGeometry(_,x)):S=new h.ShapeGeometry(_),w&&delete o.map,(0,P.isNumber)(o.opacity)&&(o.transparent=!0),E=new h.Mesh(S,p?new h.MeshPhongMaterial(o):new h.MeshBasicMaterial(o)),v&&E.position.setZ(v),u<0&&E.position.setZ(E.position.z+u),x.bevelEnabled?C=M.default.createExpandedPointsGeometry(_,x.bevelSize):(_.autoClose=!0,C=_.createPointsGeometry()),(0,P.isPresent)(m)){var I=y?y:(u||0)+.03;C.translate(0,0,I+a);var O=new h.Line(C,new h.LineBasicMaterial({color:m}));E.add(O)}if(w){var T=w.depthTest,A=void 0===T||T,L=w.alphaTest,N=void 0===L?.01:L,k=w.size,R=void 0===k?[1,1]:k,D=w.offset,F=void 0===D?[0,0]:D,B=w.url,j=w.rotation;U.load(B,function(e){var n=t._generateTexturePlane(R[0]||1,R[1]||1);e.magFilter=h.LinearFilter,e.minFilter=h.LinearFilter,e.anisotropy=8;var r=new h.MeshBasicMaterial({map:e,transparent:!0,depthTest:!!A,alphaTest:N}),o=new h.Mesh(n,r),a=i.getCentroid();if(E.add(o),o.position.set(a.getX()+(F[0]||0),a.getY()+(F[1]||0),u+.1),(0,P.isNumber)(j)){var s=Math.PI*j/180;o.rotateZ(s),e.dispose()}})}return E}},{key:"light",value:function(t,e,n,i){var r=i.lightType,o=i.intensity,a=void 0===o?1:o,s=i.color,u=void 0===s?16777215:s,l=i.options,c=void 0===l?{}:l,f=n.geometry,d=f.getGeometryType(),p=null;if("Point"===d){switch(r){case"PointLight":p=new h[r];break;case"SpotLight":p=new h[r];break;case"DirectionalLight":p=new h[r];break;case"HemisphereLight":var g=c.groudColorc||16777215;p=new h[r](u,g,a);break;case"AmbientLight":p=new h[r]}if(p){var v=f.getCoordinate();if(p.position.set(v.x,v.y,v.z),p.shadow){var m=20;p.castShadow=!0,p.shadow.mapSize.width=1024,p.shadow.mapSize.height=1024,p.shadow.camera.left=-m,p.shadow.camera.right=m,p.shadow.camera.top=m,p.shadow.camera.bottom=-m,p.shadow.camera.far=1e3}}}return p}},{key:"_postProcessOctreeForModel",value:function(t,e,n,i){if(n instanceof h.Group)for(var r=n.children,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;u._sceneId=i.id,u._layerId=e.id}else n._sceneId=i.id,n._layerId=e.id;t._octreeManager.add(n,e.id,i.id)}},{key:"model",value:function(e,n,i,r,o){var a=o.path,s=o.fileType,l=o.autoAttach,c=o.position,f=o.scale,d=o.rotate,p=o.clickable,g=o.params,v=void 0===g?{}:g;if(!a||!s)return null;var y=new m.default,_=r.geometry,b=_.getGeometryType(),x=u({},{position:c,scale:f,rotate:d});switch(b){case"Point":var w=_.getCoordinate(),E=w.x,S=w.y,M=w.z;u(x,{position:[E,S,M||0]});break;case"Polygon":var C=_.getEnvelope(),O=C.getCentroid(),P=O.getCoordinate(),A=P.x,L=P.y,N=P.z;if(u(x,{position:[A,L,N||0]}),l){var k=I.default.getLongEdge(_),R=T.default.subVector(k.p1,k.p0),D=T.default.getAngle(R,{x:0,y:1,z:0});u(x,{rotate:[0,0,D]})}}switch(s){case"obj":var F=new h.OBJLoader;if(v.mtl){var B=new h.MTLLoader;v.texturePath&&B.setTexturePath(v.texturePath),B.load(v.mtl,function(i){i.preload(),F.setMaterials(i),F.load(a,function(i){t._setModelParam(i,x),y.addProxy(i),p&&t._postProcessOctreeForModel(e,n,i,r)}),r.onload&&r.onload()})}else F.load(a,function(i){var o=null;if(v.texture){var a=new h.ImageLoader;o=new h.Texture,a.load(v.texture,function(t){o.image=t})}i.traverse(function(t){t instanceof h.Mesh&&o&&(t.material.map=o)}),t._setModelParam(i,x),y.addProxy(i),p&&t._postProcessOctreeForModel(e,n,i,r),r.onload&&r.onload()});break;case"dae":var j=new h.ColladaLoader;j.options.convertUpAxis=!0,j.load(a,function(i){var o=i.scene;o.updateMatrix(),t._setModelParam(o,x),y.addProxy(o),p&&t._postProcessOctreeForModel(e,n,o,r)});break;case"fbx":var U=new h.FBXLoader;U.load(a,function(i){y.addProxy(i),p&&t._postProcessOctreeForModel(e,n,i,r)});break;case"js":var z=new h.JSONLoader;z.load(a,function(i,a){var s=new h.Mesh(i,new h.MultiMaterial(a));y.addProxy(s),t._setModelParam(s,o),p&&t._postProcessOctreeForModel(e,n,s,r)})}return y}},{key:"sphere",value:function(e,n,i,r,o){var a=r.geometry,s=a.getGeometryType(),u=null;if("Point"===s){var l=o.radius,c=o.widthSegments,f=o.heightSegments,d=o.light,p=new h.SphereGeometry(l,c,f),g=t.parseParams(r,o,["color","opacity"]),v=a.getCoordinate(),m=v.x,y=v.y,_=v.z;(0,P.isNumber)(g.opacity)&&(g.transparent=!0),u=new h.Mesh(p,d?new h.MeshPhongMaterial(g):new h.MeshBasicMaterial(g)),u.position.set(m,y,_||0)}return u}},{key:"parseParams",value:function(t,e,n){for(var i={},r=X[e.type()],o=n,a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(s>=o.length)break;u=o[s++]}else{if(s=o.next(),s.done)break;u=s.value}var l=u,c=e[l];if((0,P.isPresent)(c)){if("texture"===l||"serverUrl"===l){t.properties[e.field]&&(c+=t.properties[e.field]),e.suffix&&(c+=e.suffix),i.map=c;continue}r&&r[l]?i[r[l]]=c:i[l]=c}}return i}},{key:"beginLayerCount",value:function(t){z[t.id]={layerFeatureCount:t.features.getFeatureCount(),layerFeatureIndex:0}}},{key:"resetLayer",value:function(t){var e=z[t.id];e.async||delete z[t.id]}},{key:"removeLayerCount",value:function(t){delete z[t.id]}},{key:"parseTexture",value:function(e,n,i,r,o){var a=r.width,s=r.height;if(o.map){var u=z[n.id];u||(t.beginLayerCount(n),u=z[n.id]),u.async=!0,i.material.map=null,U.load(o.map,function(r){if(e.mapView&&e.mapView.activeCamera){if(r.minFilter=h.LinearFilter,r.magFilter=h.LinearFilter,i.material.map=r,i.material.needsUpdate=!0,i.scale.set(a||r.image.width,s||r.image.height,1),i.material.materialScale=!0,i.material.map.dispose(),!u)return void e.mapView.collisionSceneManager.updateCollision();t._allComplete(n,e)}else i.scale.set(4,4,0)},function(){},function(){t._allComplete(n,e)})}}},{key:"_allComplete",value:function(t,e){var n=z[t.id];n&&(n.layerFeatureIndex++,t.features.getFeatureCount()===n.layerFeatureIndex&&e.mapView.collisionSceneManager.updateCollision())}},{key:"_setModelParam",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.scale,i=e.rotate,r=e.position;n&&t.scale.set(n[0],n[1],n[2]),i&&t.rotation.set(i[0],i[1],i[2]),r&&t.position.set(r[0],r[1],r[2])}},{key:"_generateTexturePlane",value:function(t,e){var n=(0,P.isNumber)(t)?t/2:.5,i=(0,P.isNumber)(e)?e/2:.5,r=new h.Shape;r.moveTo(-n,-i),r.lineTo(n,-i),r.lineTo(n,i),r.lineTo(-n,i),r.lineTo(-n,-i);var o=new h.ShapeGeometry(r);return o.faceVertexUvs[0]=[[new h.Vector2(0,0),new h.Vector2(1,0),new h.Vector2(1,1)],[new h.Vector2(1,1),new h.Vector2(0,1),new h.Vector2(0,0)]],o}}]),t}();e.default=H},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.ThreeNodeId=e.ThreeNode=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=n(12),h=n(3),f=n(17),d=r(f),p=n(21),g=r(p),v=n(172),m=r(v),y=n(171),_=r(y),b=n(30),x=r(b),w=n(13),E=r(w),S=n(2),M=i(S),C=n(99),I=r(C),O=n(7),T=n(168),P=n(4),A=-1,L=function(t){function e(t){o(this,e);var n=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n._scene=new M.Scene,n._groupLayers={},n._groups={},n._meshMapping={},n._sceneAnimationManager=new T.SceneAnimationManager,n._addLayerToGroup=n._preAddToGroup.bind(n),n._removeLayerToGroup=n._preRemoveToGroup.bind(n),n._addLayer=n._addLayer.bind(n),n._removeLayer=n._removeLayer.bind(n),n._addFeature=n._addSceneByFeature.bind(n),n._addFeatures=n._addFeatures.bind(n),n._updateFeature=n._updateSceneByFeature.bind(n),n._removeFeature=n._removeSceneByFeature.bind(n),n._onSceneChange=n._parseSceneChange.bind(n),n._onGetAABB=n._onGetAABB.bind(n),n}return s(e,t),u(e,[{key:"_addLayer",value:function(t,e){var n=this;return e instanceof x.default?(e.on("addToGroup",this._addLayerToGroup),e.on("removeToGroup",this._removeLayerToGroup),void e.foreach(function(t,i){n._preAddToGroup(e,i)})):void this.addLayer(e)}},{key:"_removeLayer",value:function(t,e){var n=this;return e instanceof x.default?(e.off("addToGroup",this._addLayerToGroup),e.off("removeToGroup",this._removeLayerToGroup),void e.foreach(function(t,i){n._preRemoveToGroup(e,i)})):void this.removeLayer(e)}},{key:"_onGetAABB",value:function(t,e,n){var i=this._findMesh(t,e);if(!i)throw new Error("ThreeNode#_onGetAABB: Mesh not found");var r=(new M.Box3).setFromObject(i),o=r.min,a=r.max;n.push(new P.geom.Coordinate(o.x,o.y,o.z),new P.geom.Coordinate(a.x,a.y,a.z))}},{key:"onAdd",value:function(t){var n=t.mapView.engine;if(l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this._mergeNode=new _.default(t),this._targetRenderer=n.getRenderer(t.mapView),this._sceneManager.mapView.on("addLayer",this._addLayer),this._sceneManager.mapView.on("removeLayer",this._removeLayer),this._sceneManager.on("onSceneChange",this._onSceneChange),this._sceneManager.on("onGetAABB",this._onGetAABB),c.isDev){var i=t.mapView.container;this._stats=new I.default,O.DOMUtils.addClass(this._stats.dom,"ngr-stats"),i.appendChild(this._stats.dom)}}},{key:"onRemove",value:function(t){this._mergeNode.destroy(),this._mergeNode=null,this._sceneManager.mapView.off("addLayer",this._addLayer),this._sceneManager.mapView.off("removeLayer",this._removeLayer),this._sceneManager.off("onSceneChange",this._onSceneChange),this._sceneManager.off("onGetAABB",this._onGetAABB),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t)}},{key:"add",value:function(t){t instanceof d.default&&l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"add",this).call(this,t),t instanceof g.default&&(this._camera=t.camera,this._scene.children.unshift(this._camera))}},{key:"addLayer",value:function(t){var e=this;return this.hasLayer(t)||(t.on("addFeature",this._addFeature),t.on("addFeatures",this._addFeatures),t.on("updateFeature",this._updateFeature),t.on("removeFeature",this._removeFeature),m.default.beginLayerCount(t),t.visit(function(n,i){e._addSceneByFeature(t,n,i,!1)}),m.default.resetLayer(t),this._mergeNode&&this._mergeNode.update(t.id)),this}},{key:"_preAddToGroup",value:function(t,e){var n=this._groups[t.id],i=this._groupLayers[t.id];n||(n=new M.Group,this._groups[t.id]=n,t.height&&n.position.setZ(t.height),this._scene.add(n)),i||(i=[],this._groupLayers[t.id]=i),i.push(e.id),this.addLayer(e)}},{key:"_preRemoveToGroup",value:function(t,e){var n=this._groups[t.id];if(n){var i=this._groupLayers[t.id],r=i.indexOf(e.id);r!==-1&&i.splice(r,1),0===i.length&&(this._scene.remove(n),delete this._groups[t.id],delete this._groupLayers[t.id]),this.removeLayer(e)}}},{key:"removeLayer",value:function(t){var e=this;if(this.hasLayer(t)){var n=this._groups[t.id];t.off("addFeatures",this._addFeatures),t.off("addFeature",this._addFeature),t.off("updateFeature",this._updateFeature),t.off("removeFeature",this._removeFeature),m.default.removeLayerCount(t),n&&n.parent&&n.parent.remove(n),this._mergeNode&&this._mergeNode.hasLayer(t.id)&&this._mergeNode.removeByLayer(t,t.id),t.visit(function(n){e._removeSceneByFeature(t,n,!1)}),this._mergeManger&&this._mergeManger.updateAll(),delete this._groups[t.id]}return this}},{key:"hasLayer",value:function(t){return!!t&&(t in this._groups||t.id in this._groups)}},{key:"render",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this),this._targetRenderer&&this._camera&&(this._targetRenderer.autoClear||this._targetRenderer.clear(),this._targetRenderer.render(this._scene,this._camera),c.isDev&&this._stats.update())}},{key:"_addFeatures",value:function(t,e){for(var n=e,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o,s=t.renderer.getStyle(a);this._addSceneByFeature(t,a,s,!1)}this._mergeNode&&this._mergeNode.update(t.id)}},{key:"_addSceneByFeature",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=e.id,o=this._meshMapping[r],a=this._groups[t.id],s=null,u=null;if((0,h.isBlank)(r))return void console.warn("error feature's id");if((!o||!o[t.id])&&(s=this._getPgroupByLayer(t),a||(a=new M.Group,this._groups[t.id]=a,t.height&&a.position.setZ(t.height),s!==-1?this._groups[s].add(a):this._scene.add(a)),u=m.default.generator(this._sceneManager,t,e,n))){var l=u.children.concat(),c=this._mergeNode.merge(e,n,u,t.id,this._groups[t.id]||this._scene);0!==c&&i&&this._mergeNode.update(t.id),2!==c&&(a.add(u),o||(o={},o.size=0,this._meshMapping[r]=o),this._meshMapping[r][t.id]=u.id,o.size++),"Polygon"===n.type()&&n.clickable&&(2===c?(u instanceof M.Group&&0!==l.length&&l.forEach(function(t){u.add(t)}),this._sceneManager._octreeManager.add(u,t.id,r,{layerGroupId:t.parent.id,sceneGroupId:a.parent.id})):this._sceneManager._octreeManager.add(u,t.id,r))}}},{key:"_getPgroupByLayer",value:function(t){for(var e in this._groupLayers){var n=this._groupLayers[e];if(n.indexOf(t.id)!==-1)return e}return-1}},{key:"_updateSceneByFeature",value:function(t,e,n){var i=e.id;if(i){var r=this._groups[t.id],o=this._meshMapping[i];if(r&&o){var a=o[t.id],s=r.getObjectById(a),u=e.geometry;"Icon"===n.type()&&s.position.set(u.getCoordinates()[0],u.getCoordinates()[1],0)}}}},{key:"_removeSceneByFeature",value:function(t,e,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=e.id,o=this._groups[t.id],a=this._meshMapping[r],s=null;if(!(0,h.isBlank)(r)){if(o&&a){var u=a[t.id];s=o.getObjectById(u),s&&(o.remove(s),s.proxy&&delete s.proxy,s&&s.geometry&&s.geometry.dispose(),this._sceneManager.mapView.collisionSceneManager.remove(e),delete a[t.id],a.size--,0===a.size&&delete this._meshMapping[r])}this._sceneManager._octreeManager.removeByLayerAndFeature(t.id,r),this._mergeNode&&this._mergeNode.has(r,s)&&(this._mergeNode.remove(r,s),i&&this._mergeNode.update(t.id)),this._mergeManger&&this._mergeManger.remove(e,n)}}},{key:"_findMesh",value:function(t,e){var n=(0,h.isString)(t)?t:t.id,i=this._groups[n],r=void 0;if((0,h.isBlank)(e)||(0,h.isArray)(e))return i;if((0,h.isNumber)(e.id)){var o=this._meshMapping[e.id];if(o){var a=o[n];i&&a&&(r=i.getObjectById(a))}}return r}},{key:"_parseSceneChange",value:function(t,e,n){for(var i=void 0,r=arguments.length,o=Array(r>3?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];switch(t){case"scale":i=this._setMeshScale;break;case"quickPosition":i=this._quickSetMeshPosition;break;case"position":i=this._setMeshPosition;break;case"rotation":i=this._setMeshRotation;break;case"visible":i=this._setMeshVisible;break;case"color":i=this._setMeshColor;break;case"colorResetting":i=this._setMeshColor;break;case"highlight":i=this._hightlight;break;case"opacity":i=this._setOpacity;break;case"depthTest":i=this._setDepthTest;break;case"styleResetting":return this._resetStyle.apply(this,[e,n].concat(o)),this}if((0,h.isArray)(n))for(var s=n,u=Array.isArray(s),l=0,s=u?s:s[Symbol.iterator]();;){var c;if(u){if(l>=s.length)break;c=s[l++]}else{if(l=s.next(),l.done)break;c=l.value}var f=c;this._callMeshValue.apply(this,[t,e,f,i].concat(o))}else this._callMeshValue.apply(this,[t,e,n,i].concat(o));return this}},{key:"_callMeshValue",value:function(t,e,n,i){for(var r=this._findMesh(e,n),o=arguments.length,a=Array(o>4?o-4:0),s=4;s<o;s++)a[s-4]=arguments[s];"colorResetting"===t&&(a[0]=this._getColorByFeature(e,n)),r&&i.call.apply(i,[this,r].concat(a))}},{key:"_resetStyle",value:function(t,e,n){var i=this;if(t&&n)if((0,h.isEmpty)(e))t.visit(function(e){i._removeSceneByFeature(t,e,!1),i._addSceneByFeature(t,e,n)});else if(e.length)for(var r=e,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var u=s;this._removeSceneByFeature(t,u,!1),this._addSceneByFeature(t,u,n)}else this._removeSceneByFeature(t,e,!1),this._addSceneByFeature(t,e,n)}},{key:"_quickSetMeshPosition",value:function(t,e){var n=new M.Vector3(e[0],e[1],e[2]);return"MeshProxy"===t.type?t.proxyPosition.copy(n):t.position.copy(n),n}},{key:"_setMeshPosition",value:function(t,e){var n=this._sceneManager._octreeManager,i=!1;if(this._quickSetMeshPosition(t,e),t instanceof M.Group){var r=n.virtualGroups[n.groupMapping[t.id]];if(r){var o=e[0],a=e[1],s=e[2];i=!0,"MeshProxy"===r.type?r.proxyPosition.set(o,a,s):r.position.set(o,a,s),r.updateMatrixWorld()}}else n.has(t._layerId,t._sceneId)&&(i=!0);i&&n.rebuild()}},{key:"_setMeshScale",value:function(t,e){"MeshProxy"===t.type?t.proxyScale.set(e[0],e[1],e[2]):t.scale.set(e[0],e[1],e[2])}},{key:"_setMeshRotation",value:function(t,e){"MeshProxy"===t.type?t.proxyRotation.set(e[0],e[1],e[2]):t.rotation.set(e[0],e[1],e[2])}},{key:"_setMeshVisible",value:function(t,e){if(t.visible=e,t instanceof M.Group){var n=this._sceneManager._octreeManager,i=n.virtualGroups[n.groupMapping[t.id]];i&&(i.visible=e)}}},{key:"_getColorByFeature",value:function(t,e){if(!e)return null;var n=(0,h.isString)(t)?this._sceneManager.mapView.getLayer(t):t,i=n.renderer.getStyle(e);return i.color}},{key:"_setMeshColor",value:function(t,e,n){if(t instanceof M.Group)return this;var i=E.default.parseColor(e);return t.material.needsUpdate=!0,n?this._sceneAnimationManager.getAnimation("color").start(t,i,n.blink,n.duration,n.repeat):(this._sceneAnimationManager.getAnimation("color").stop(),t.material.color=(new M.Color).set(i)),this}},{key:"_hightlight",value:function(t,e){if(t instanceof M.Group)return this;var n=(0,h.isNumber)(e)?e:1.414,i=t.material.color,r=i.r*n>1?1:i.r*n,o=i.g*n>1?1:i.g*n,a=i.b*n>1?1:i.b*n,s=new M.Color(r,o,a);return t.material.color=s,t.material.needsUpdate=!0,this}},{key:"_setOpacity",value:function(t,e,n){var i=this;return t instanceof M.Group?(t.children.forEach(function(t){i._setOpacity(t,e,n)},this),this):(t&&t.material&&(0,h.isNumber)(e)&&e>=0&&e<=1&&(t.material.transparent=!0,t.destOpacity=e,n?this._sceneAnimationManager.getAnimation("opacity").start(t,e,n.blink,n.duration,n.repeat):(t.material.opacity=e,1===e&&(t.material.transparent=!1))),this)}},{key:"_setDepthTest",value:function(t,e){var n=this;return t instanceof M.Group?(t.children.forEach(function(t){n._setDepthTest(t,e)},this),this):(t&&t.material&&(0,h.isBoolean)(e)&&(t.material.depthTest=e),this)}},{key:"renderScene",get:function(){return this._scene}}]),e}(d.default);e.ThreeNode=L,e.ThreeNodeId=A},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(169),l=i(u),c=n(173),h=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._threeNode=new c.ThreeNode(c.ThreeNodeId),t}return a(e,t),s(e,[{key:"generator",value:function(t,e){return this._threeNode._sceneManager||(this._threeNode._sceneManager=e.sceneManager),this._threeNode}},{key:"find",value:function(t){return null}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(2),u=r(s),l=n(212),c=i(l),h=n(71),f=i(h),d=n(18),p=n(25),g=i(p),v=function(t,e){return e.priority-t.priority},m=function(){function t(){o(this,t),this._rbush=null,this._priorityQueue=null,this._features={},this._collsionFeatures={},this._collisionDetectionScenes={},this._visibleScenes={},this._animators={},this._animation=d.CAType.Default}return a(t,[{key:"add",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e instanceof u.Group&&!e.getAABB){for(var r=e.children,o=Array.isArray(r),a=0,r=o?r:r[Symbol.iterator]();;){var s;if(o){if(a>=r.length)break;s=r[a++]}else{if(a=r.next(),a.done)break;s=a.value}var l=s;this.add(t,l,n)}return i&&this.updateCollision(),this}var c=this._collisionDetectionScenes[t.id];return c||(c=[],this._collisionDetectionScenes[t.id]=c),this._features[t.id]=t,this._collsionFeatures[t.id]=t,c.push(e),i&&this.updateCollision(),this}},{key:"hide",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!t)return this;if(t.features){for(var n=t.features,i=Array.isArray(n),r=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(r>=n.length)break;o=n[r++]}else{if(r=n.next(),r.done)break;o=r.value}var a=o;this.hide(a,e)}return this}var s=this._collisionDetectionScenes[t.id];if(s)for(var u=s,l=Array.isArray(u),c=0,u=l?u:u[Symbol.iterator]();;){var h;if(l){if(c>=u.length)break;h=u[c++]}else{if(c=u.next(),c.done)break;h=c.value}var f=h;f&&(f.makeCollision(!0),e&&this.remove(t))}return this}},{key:"remove",value:function(t){return this.hasCollision(t)&&delete this._collisionDetectionScenes[t.id],this.hasVisible(t)&&delete this._visibleScenes[t.id],delete this._features[t.id],delete this._collsionFeatures[t.id],this}},{key:"setEnable",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.hasCollision(t)&&(e?this._collsionFeatures[t.id]=this._features[t.id]:delete this._collsionFeatures[t.id],n&&this.updateCollision()),this}},{key:"setFeatureLayerEnable",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(t instanceof g.default))throw new Error("setFeatureLayerEnable: Invalid featureLayer");return t.visit(function(t,i){i.collision&&e.setEnable(t,n)}),i&&this.updateCollision(),this}},{key:"hasCollision",value:function(t){return!!t&&t.id in this._collisionDetectionScenes}},{key:"hasVisible",value:function(t){return!!t&&t.id in this._visibleScenes}},{key:"isEnabled",value:function(t){return!!t&&t.id in this._collsionFeatures}},{key:"_AABB2RbushBox",value:function(t){if(!(t instanceof Array&&6===t.length))return console.warn("Invalid AABB"),null;var e={minX:t[0],minY:t[1],maxX:t[3],maxY:t[4]};return e}},{key:"animation",value:function(t){return this._animation=t,this}},{key:"updateCollision",value:function(){var t=this._activeCamera;if(t){var e=void 0,n=void 0;this._clearAnimation(),t.camera.updateMatrix(),t.camera.updateMatrixWorld(),this._visibleScenes={},this._rbush=(0,c.default)(),this._priorityQueue=new f.default(v);for(var i in this._collsionFeatures)this._priorityQueue.enq(this._collsionFeatures[i]);for(;this._priorityQueue.size();){var r=this._priorityQueue.deq();e=this._collisionDetectionScenes[r.id];for(var o=e,a=Array.isArray(o),s=0,o=a?o:o[Symbol.iterator]();;){var u;if(a){if(s>=o.length)break;u=o[s++]}else{if(s=o.next(),s.done)break;u=s.value}var l=u;if(n=this._AABB2RbushBox(l.getAABB(t))){var h=this._rbush.search(n),d=!1;h.length>0?d=!0:(this._visibleScenes[l._sceneId]=l,this._rbush.insert(n),d=!1);var p=this._animation.hasAnimation(l);if(p){var g=this._animation.makeCollision(l,d);this._postProcessAnimator(l,g)}else l.makeCollision(d,p)}}}this._animation.reset(this)}return this}},{key:"_postProcessAnimator",value:function(t,e){var n=this;e&&(this._animators[t.uuid]=e,e.on("complete",function(){delete n._animators[t.uuid]}).on("stop",function(){delete n._animators[t.uuid]}))}},{key:"_clearAnimation",value:function(){for(var t in this._animators){var e=this._animators[t];e.stop()}this._animators={}}},{key:"clear",value:function(){return this._rbush=null,this._priorityQueue=null,this._features={},this._collsionFeatures={},this._collisionDetectionScenes={},this._visibleScenes={},this._clearAnimation(),this}},{key:"activeCamera",get:function(){return this._activeCamera},set:function(t){this._activeCamera=t}}]),t}();e.default=m},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CAType=void 0;var i=n(18);e.CAType=i.CAType},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(5),o=i(r),a=n(74),s=(i(a),new o.default),u={compass:"compass"},l=function(){if(s.orientationControl){var t=s.orientationControl.getScreenAdjustedEuler(),e=t.alpha;e&&s.emit(u.compass,{type:u.compass,alpha:e})}},c=function(t,e){var n=s.listeners(e);switch(e){case u.compass:if(window.FULLTILT&&window.FULLTILT.getDeviceOrientation&&0===n.length){var i={type:"world"};window.FULLTILT.getDeviceOrientation(i).then(function(t){s.orientationControl=t,s.orientationControl.listen(l)})}break;default:throw new Error(e+" is a invalid value!")}s.on(e,t)},h=function(t,e){var n=s.listeners(e);switch(s.off(e,t),e){case u.compass:0===n.length&&window.FULLTILT&&window.FULLTILT.getDeviceOrientation&&s.orientationControl&&(s.orientationControl.stop(),delete s.orientationControl);break;default:throw new Error(e+" is a invalid value!")}};e.default={sensorType:u,registerListener:c,unregisterListener:h}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.SensorManager=void 0;var r=n(177),o=i(r);e.SensorManager=o.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,u)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(10),s=i(a),u={clickable:!0,scale:null,rotate:null,params:null,autoAttach:null,fileType:null,type:function(){return"Model"}};Object.defineProperty(r.prototype,"path",{get:function(){return this._path},set:function(t){var e=r.getFileType(t);e&&0!==e.length&&(this.fileType=e[0]),this._path=t}}),r.getFileType=function(t){return/[.]/.exec(t)?/[^.]+$/.exec(t):null},e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){o(this,new s.default,c)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(10),s=i(a),u=n(13),l=i(u),c={radius:1,widthSegments:8,heightSegments:6,type:function(){return"Sphere"}};Object.defineProperty(r.prototype,"color",{get:function(){return this._color},set:function(t){this._color=l.default.parseColor(t)}}),e.default=r},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Polygon=e.LineString=e.Light=e.JSONStyleGenerator=e.Icon=e.Annotation=e.Style=void 0;var r=n(10),o=i(r),a=n(62),s=i(a),u=n(63),l=i(u),c=n(64),h=i(c),f=n(65),d=i(f),p=n(66),g=i(p),v=n(67),m=i(v);e.Style=o.default,e.Annotation=s.default,e.Icon=l.default,e.JSONStyleGenerator=h.default,e.Light=d.default,e.LineString=g.default,e.Polygon=m.default},function(t,e,n){"use strict";function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){
function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(9),u=r(s),l=n(2),c=i(l),h=function(){function t(){o(this,t)}return a(t,null,[{key:"export",value:function(t,e,n){var i=[],r=t.getLayer(e.features[0].properties.planar_graph).getLayer("Area");return e.features.forEach(function(e){if(n){if(e.properties.category===n){var o=t.sceneManager.get(-1),a=o._findMesh(r,e);delete a.geometry.parameters,i.push({fId:e.id,gData:a.geometry.toJSON()})}}else{var s=t.sceneManager.get(-1),u=s._findMesh(r,e);delete u.geometry.parameters,i.push({fId:e.id,gData:u.geometry.toJSON()})}}),i}},{key:"load",value:function(t){var e={},n=new c.JSONLoader;return(0,u.default)(t,{}).then(function(t){var i=JSON.parse(t._bodyText);return i.forEach(function(t){e[t.fId]=n.parse(t.gData.data)}),e})}}]),t}();e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c={low:2,high:3},h=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._mapView=t,i.callType=c.high,i.callOne=!1,i.switchThreshold=n,i._switchType=i._switchType.bind(i),t&&(t.gestureManager.on("skewEnd",i._switchType),t.on("changePlanarGraph",i._switchType)),i}return a(e,t),s(e,[{key:"_switchType",value:function(){if(this._mapView.activeControl){var t=this._mapView.activeControl.getSkew();if(this.callType===c.high&&t<this.switchThreshold?(this.callType=c.low,this.callOne=!0):this.callType===c.low&&t>this.switchThreshold&&(this.callType=c.high,this.callOne=!0),this.callOne)switch(this.callOne=!1,this.callType){case c.low:this.emit("switch",{mode:c.low});break;case c.high:this.emit("switch",{mode:c.high})}}}},{key:"destroy",value:function(){this._mapView&&(this._mapView.gestureManager.off("skewEnd",this._switchType),this._mapView.off("changePlanarGraph",this._switchType))}},{key:"switchThreshold",get:function(){return this._switchThreshold},set:function(t){this._switchThreshold=t}}]),e}(l.default);e.default=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(5),l=i(u),c=(n(15),function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._gestures={},t._events={},t._platform=t.platform(),t}return a(e,t),s(e,[{key:"init",value:function(t){this._mapView=t}},{key:"addGesture",value:function(t){var e=t.type(),n=t.validPlatform();if(!this.hasGesture(t)&&n.indexOf(this._platform)>-1){this._gestures[e]=t;var i=t.providerEvent();i&&(this._events[e]=i),t.onAdd(this)}}},{key:"removeGesture",value:function(t){var e=t.type();if(this.hasGesture(t)){delete this._gestures[e];for(var n=this._events[e],i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}for(var s=a,u=this.listeners(s),l=u,c=Array.isArray(l),h=0,l=c?l:l[Symbol.iterator]();;){var f;if(c){if(h>=l.length)break;f=l[h++]}else{if(h=l.next(),h.done)break;f=h.value}var d=f;this.off(s,d)}}n&&delete this._events[e],t.onRemove(this)}}},{key:"hasGesture",value:function(t){return!!t&&t.type()in this._gestures}},{key:"destroy",value:function(){for(var t in this._gestures)this.removeGesture(this._gestures[t]);this._gesture=[],this._events=[]}},{key:"mapView",get:function(){return this._mapView}}]),e}(l.default));e.default=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},l=n(70),c=i(l),h=n(188),f=i(h),d=n(207),p=i(d),g=n(15),v=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"onAdd",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),this._eventManager=new p.default.Manager(t.mapView.targetDom),this._eventManager.add(new p.default.Tap({event:"doubletap",taps:2})),this._eventManager.add(new p.default.Tap({event:"singletap"})),this._eventManager.get("doubletap").recognizeWith("singletap"),this._eventManager.get("singletap").requireFailure("doubletap"),this._eventManager.on("singletap",function(e){var n=new f.default;n.cast(e),n.type="singleTap",t.emit("singleTap",n),t.emit("tap",n)}),this._eventManager.on("doubletap",function(e){var n=new f.default;n.cast(e),n.type="doubleTap",t.emit("doubleTap",n)}),this._eventManager.add(new p.default.Press({event:"press"})),this._eventManager.on("press",function(e){var n=new f.default;n.cast(e),n.type="longTap",t.emit("longTap",n)});var n=new f.default;this._eventManager.add(new p.default.Pan),this._eventManager.on("panstart panmove panend pinchin pinchout",function(e){switch(n.cast(e),e.type){case"panstart":n.type="moveStart",t.emit("moveStart",n);break;case"panend":n.type="moveEnd",t.emit("moveEnd",n);break;case"panmove":n.type="move",t.emit("move",n)}});var i=0,r=0,o=new f.default;this._eventManager.add(new p.default.Pan({event:"skew",pointers:2,direction:p.default.DIRECTION_ALL})),this._eventManager.on("skewstart skewup skewdown skewend",function(e){switch(o.cast(e),console.log("hammer:"+e.type),e.type){case"skewstart":o.type="skewStart",t.emit("skewStart",o);break;case"skewend":i=0,o.type="skewEnd",t.emit("skewEnd",o);break;case"skewup":o.type="skewUp",t.emit("skewUp",o);break;case"skewdown":o.type="skewDown",t.emit("skewDown",o)}}),this._eventManager.get("pan").recognizeWith(this._eventManager.get("skew")),this._eventManager.get("skew").requireFailure(this._eventManager.get("pan"));var a=new p.default.Pinch({threshold:0}),s=function(t,e){return Math.abs(e)>8&&Math.abs(e)<352||t.scale>1.15||t.scale<.85},l=new f.default,c=0,h=0;this._eventManager.add(a),this._eventManager.on("pinchstart pinchmove pinchend",function(e){switch(l.cast(e),console.log("hammer:"+e.type),e.type){case"pinchstart":c=e.rotation,h=0;break;case"pinchend":l.type="zoomEnd",t.emit("zoomEnd",l),l.type="rotateEnd",t.emit("rotateEnd",l),i=0,r=0;break;case"pinchmove":var n=Math.abs(e.rotation-c);r++<5?h+=n:6===r?(r++,l.type="zoomStart",t.emit("zoomStart",l),l.type="rotateStart",t.emit("rotateStart",l),h/=r,i=0===i&&s(e,h)?1:2):(l.type="zoom",t.emit("zoom",l),l.type="rotate",t.emit("rotate",l))}}),this._eventManager.get("pinch").recognizeWith(this._eventManager.get("skew"))}},{key:"onRemove",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),this._eventManager.destroy()}},{key:"providerEvent",value:function(){return["singleTap","doubleTap","longTap","moveStart","moveEnd","move","skewStart","skewEnd","skewUp","skewDown","zoomStart","zoomEnd","zoom","rotateStart","rotateEnd","rotate"]}},{key:"type",value:function(){return"hammer"}},{key:"validPlatform",value:function(){return[g.Platform.iOS,g.Platform.Android,g.Platform.BlackBerry,g.Platform.other,g.Platform.PC]}}],[{key:"getTouchEvent",value:function(t){var e=void 0;return 2===t.pointers.length&&(e=t.pointers),2===t.changedPointers.length&&(e=t.changedPointers),e}}]),e}(c.default);e.default=v},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},l=n(70),c=i(l),h=n(189),f=i(h),d=n(35),p=i(d),g=n(34),v=i(g),m=n(12),y=n(15),_=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"onAdd",value:function(t){var n=this;if(u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onAdd",this).call(this,t),!m.touchEmulator){var i=t.mapView.targetDom;this._contextMenu=function(t){t.preventDefault()},i.addEventListener("contextmenu",this._contextMenu,!1);var r=new f.default,o=void 0;this._mouseWheel=function(e){e.preventDefault(),e.stopPropagation(),r.cast(e),o||(r.scale=1,r.type="zoomStart",t.emit("zoomStart",r)),clearTimeout(o),o=setTimeout(function(){o=null,r.type="zoomEnd",t.emit("zoomEnd",r)},250),o&&(r.type="zoom",t.emit("zoom",r))},i.addEventListener("mousewheel",this._mouseWheel,!1),i.addEventListener("MozMousePixelScroll",this._mouseWheel,!1);var a=0,s=0,l=new p.default,c={clientX:0,clientY:0},h=function(t,e){var n=[],i=new v.default;i.clientX=e.clientX,i.clientY=e.clientY,i.pageX=e.pageX,i.pageY=e.pageY,i.screenX=e.screenX,i.screenY=e.screenY,i.detail=e.detail,n.push(i),t.touches=n,t.target=e.target;var r=e.clientX-c.clientX;r>0?(t.rotate-=r,t.scale=0):(t.rotate-=r,t.scale=0),c.clientX=e.clientX,c.clientY=e.clientY};this._mouseDown=function(e){2===e.button&&(e.preventDefault(),l.rotate=0,l.scale=1,c.clientX=e.clientX,c.clientY=e.clientY,h(l,e),i.addEventListener("mousemove",n._mouseMove,!1),i.addEventListener("mouseup",n._mouseUp,!1),l.type="rotateStart",t.emit("rotateStart",l),l.type="skewStart",t.emit("skewStart",l),a=e.clientX,s=e.clientY)},this._mouseMove=function(e){h(l,e),a=e.clientX-a,s=e.clientY-s,l.type="rotate",t.emit("rotate",l),s>0?(l.type="skewDown",t.emit("skewDown",l)):(l.type="skewUp",t.emit("skewUp",l)),a=e.clientX,s=e.clientY},this._mouseUp=function(e){h(l,e),i.removeEventListener("mousemove",n._mouseMove,!1),i.removeEventListener("mouseup",n._mouseUp,!1),l.type="rotateEnd",t.emit("rotateEnd",l),l.type="skewEnd",t.emit("skewEnd",l)},i.addEventListener("mousedown",this._mouseDown,!1)}}},{key:"onRemove",value:function(t){if(u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRemove",this).call(this,t),!m.touchEmulator){var n=t.mapView.targetDom;n.removeEventListener("contextmenu",this._contextMenu,!1),n.removeEventListener("mousewheel",this._mouseWheel,!1),n.removeEventListener("MozMousePixelScroll",this._mouseWheel,!1),n.removeEventListener("mousedown",this._mouseDown,!1)}}},{key:"providerEvent",value:function(){return["skewStart","skewEnd","skewUp","skewDown","zoomStart","zoomEnd","zoom","rotateStart","rotateEnd","rotate"]}},{key:"type",value:function(){return"mouse"}},{key:"validPlatform",value:function(){return[y.Platform.PC]}}]),e}(c.default);e.default=_},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.GeometryTransporter=e.SwitchDispatcher=e.CoordinateSystem=e.MapView=void 0;var r=n(19),o=i(r),a=n(68),s=i(a),u=n(183),l=i(u),c=n(182),h=i(c);e.MapView=o.default,e.CoordinateSystem=s.default,e.SwitchDispatcher=l.default,e.GeometryTransporter=h.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(34),s=i(a),u=function(){function t(){r(this,t)}return o(t,[{key:"cast",value:function(t){if(t){for(var e=[],n=t.pointers.length>0?t.pointers:t.changedPointers,i=n,r=Array.isArray(i),o=0,i=r?i:i[Symbol.iterator]();;){var a;if(r){if(o>=i.length)break;a=i[o++]}else{if(o=i.next(),o.done)break;a=o.value}var u=a,l=new s.default;l.clientX=u.clientX,l.clientY=u.clientY,l.pageX=u.pageX,l.pageY=u.pageY,l.screenX=u.screenX,l.screenY=u.screenY,l.detail=u.detail,e.push(l)}this.touches=e,this.target=t.target,this.rotate=t.rotation,this.scale=t.scale}}}]),t}();e.default=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=n(35),l=i(u),c=n(34),h=i(c),f=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.scale=1,t}return a(e,t),s(e,[{key:"cast",value:function(t){var e=[],n=new h.default;n.clientX=t.clientX,n.clientY=t.clientY,n.pageX=t.pageX,n.pageY=t.pageY,n.screenX=t.screenX,n.screenY=t.screenY,e.push(n),this.touches=e,this.rotate=0,this.target=t.target,"undefined"!=typeof t.wheelDelta?this.delta=t.wheelDelta:"undefined"!=typeof t.detail&&(this.delta=-t.detail),this.scale+=this.delta>0?.1:-.1}},{key:"delta",get:function(){return this._delta},set:function(t){this._delta=t}}]),e}(l.default);e.default=f},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function(){function t(){n(this,t),this._messageChannel=new MessageChannel}return i(t,[{key:"name",value:function(){return"null"}},{key:"params",value:function(){return null}},{key:"action",value:function(t,e,n,i){if(i){if("error"===i.type)return void this.error(t,n,i);this.success(t,e,i)}}},{key:"success",value:function(t,e,n){}},{key:"error",value:function(t,e,n){e(n.result.message)}},{key:"channel",get:function(){return this._messageChannel}}]),t}();e.default=r},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o="undefined"==typeof Promise?n(14).Promise:Promise,a=function(){function t(e){i(this,t),this._worker=e}return r(t,[{key:"exec",value:function(t){var e=new o(function(n,i){return t?void(t.channel.port1.onmessage=function(r){t.action(e,n,i,r.data)}):void i("protocal is null")});return t?(this._worker.postMessage({type:t.name(),params:t.params()},[t.channel.port2]),e):e}},{key:"destroy",value:function(){this._worker.terminate()}}]),t}();e.default=a},function(t,e){},192,192,192,192,192,192,192,192,192,function(t,e){function n(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}t.exports=n},function(t,e){function n(t,e){return t[0]*e[0]+t[1]*e[1]}t.exports=n},function(t,e){function n(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t}t.exports=n},function(t,e){function n(t,e,n){return t[0]=e,t[1]=n,t}t.exports=n},function(t,e){function n(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}t.exports=n},function(t,e,n){var i;/*! Hammer.JS - v2.0.7 - 2016-04-22
	 * http://hammerjs.github.io/
	 *
	 * Copyright (c) 2016 Jorik Tangelder;
	 * Licensed under the MIT license */
!function(r,o,a,s){"use strict";function u(t,e,n){return setTimeout(d(t,n),e)}function l(t,e,n){return!!Array.isArray(t)&&(c(t,n[e],n),!0)}function c(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==s)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function h(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=r.console&&(r.console.warn||r.console.log);return o&&o.call(r.console,i,n),t.apply(this,arguments)}}function f(t,e,n){var i,r=e.prototype;i=t.prototype=Object.create(r),i.constructor=t,i._super=r,n&&gt(i,n)}function d(t,e){return function(){return t.apply(e,arguments)}}function p(t,e){return typeof t==yt?t.apply(e?e[0]||s:s,e):t}function g(t,e){return t===s?e:t}function v(t,e,n){c(b(e),function(e){t.addEventListener(e,n,!1)})}function m(t,e,n){c(b(e),function(e){t.removeEventListener(e,n,!1)})}function y(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function _(t,e){return t.indexOf(e)>-1}function b(t){return t.trim().split(/\s+/g)}function x(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function w(t){return Array.prototype.slice.call(t,0)}function E(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];x(r,a)<0&&i.push(t[o]),r[o]=a,o++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function S(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),o=0;o<vt.length;){if(n=vt[o],i=n?n+r:e,i in t)return i;o++}return s}function M(){return St++}function C(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}function I(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){p(t.options.enable,[t])&&n.handler(e)},this.init()}function O(t){var e,n=t.options.inputClass;return new(e=n?n:It?G:Ot?H:Ct?Y:z)(t,T)}function T(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=e&kt&&i-r===0,a=e&(Dt|Ft)&&i-r===0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,P(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function P(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=N(e)),r>1&&!n.firstMultiple?n.firstMultiple=N(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=e.center=k(i);e.timeStamp=xt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=B(s,u),e.distance=F(s,u),A(n,e),e.offsetDirection=D(e.deltaX,e.deltaY);var l=R(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=bt(l.x)>bt(l.y)?l.x:l.y,e.scale=a?U(a.pointers,i):1,e.rotation=a?j(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,L(n,e);var c=t.element;y(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}function A(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};e.eventType!==kt&&o.eventType!==Dt||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}function L(t,e){var n,i,r,o,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(e.eventType!=Ft&&(u>Nt||a.velocity===s)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,h=R(u,l,c);i=h.x,r=h.y,n=bt(h.x)>bt(h.y)?h.x:h.y,o=D(l,c),t.lastInterval=e}else n=a.velocity,i=a.velocityX,r=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=o}function N(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:_t(t.pointers[n].clientX),clientY:_t(t.pointers[n].clientY)},n++;return{timeStamp:xt(),pointers:e,center:k(e),deltaX:t.deltaX,deltaY:t.deltaY}}function k(t){var e=t.length;if(1===e)return{x:_t(t[0].clientX),y:_t(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:_t(n/e),y:_t(i/e)}}function R(t,e,n){return{x:e/t||0,y:n/t||0}}function D(t,e){return t===e?Bt:bt(t)>=bt(e)?t<0?jt:Ut:e<0?zt:Gt}function F(t,e,n){n||(n=qt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function B(t,e,n){n||(n=qt);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function j(t,e){return B(e[1],e[0],Yt)+B(t[1],t[0],Yt)}function U(t,e){return F(e[0],e[1],Yt)/F(t[0],t[1],Yt)}function z(){this.evEl=Zt,this.evWin=Jt,this.pressed=!1,I.apply(this,arguments)}function G(){this.evEl=$t,this.evWin=te,I.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function V(){this.evTarget=ne,this.evWin=ie,this.started=!1,I.apply(this,arguments)}function X(t,e){var n=w(t.touches),i=w(t.changedTouches);return e&(Dt|Ft)&&(n=E(n.concat(i),"identifier",!0)),[n,i]}function H(){this.evTarget=oe,this.targetIds={},I.apply(this,arguments)}function q(t,e){var n=w(t.touches),i=this.targetIds;if(e&(kt|Rt)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,a=w(t.changedTouches),s=[],u=this.target;if(o=n.filter(function(t){return y(t.target,u)}),e===kt)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<a.length;)i[a[r].identifier]&&s.push(a[r]),e&(Dt|Ft)&&delete i[a[r].identifier],r++;return s.length?[E(o.concat(s),"identifier",!0),s]:void 0}function Y(){I.apply(this,arguments);var t=d(this.handler,this);this.touch=new H(this.manager,t),this.mouse=new z(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function W(t,e){t&kt?(this.primaryTouch=e.changedPointers[0].identifier,Z.call(this,e)):t&(Dt|Ft)&&Z.call(this,e)}function Z(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches,r=function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)};setTimeout(r,ae)}}function J(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),a=Math.abs(n-r.y);if(o<=se&&a<=se)return!0}return!1}function K(t,e){this.manager=t,this.set(e)}function Q(t){if(_(t,de))return de;var e=_(t,pe),n=_(t,ge);return e&&n?de:e||n?e?pe:ge:_(t,fe)?fe:he}function $(){if(!le)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!e||r.CSS.supports("touch-action",n)}),t}function tt(t){this.options=gt({},this.defaults,t||{}),this.id=M(),this.manager=null,this.options.enable=g(this.options.enable,!0),this.state=me,this.simultaneous={},this.requireFail=[]}function et(t){return t&we?"cancel":t&be?"end":t&_e?"move":t&ye?"start":""}function nt(t){return t==Gt?"down":t==zt?"up":t==jt?"left":t==Ut?"right":""}function it(t,e){var n=e.manager;return n?n.get(t):t}function rt(){tt.apply(this,arguments)}function ot(){rt.apply(this,arguments),this.pX=null,this.pY=null}function at(){rt.apply(this,arguments)}function st(){tt.apply(this,arguments),this._timer=null,this._input=null}function ut(){rt.apply(this,arguments)}function lt(){rt.apply(this,arguments)}function ct(){tt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ht(t,e){return e=e||{},e.recognizers=g(e.recognizers,ht.defaults.preset),new ft(t,e)}function ft(t,e){this.options=gt({},ht.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=O(this),this.touchAction=new K(this,this.options.touchAction),dt(this,!0),c(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function dt(t,e){var n=t.element;if(n.style){var i;c(t.options.cssProps,function(r,o){i=S(n.style,o),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={})}}function pt(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}var gt,vt=["","webkit","Moz","MS","ms","o"],mt=o.createElement("div"),yt="function",_t=Math.round,bt=Math.abs,xt=Date.now;gt="function"!=typeof Object.assign?function(t){if(t===s||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==s&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var wt=h(function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&t[i[r]]===s)&&(t[i[r]]=e[i[r]]),r++;return t},"extend","Use `assign`."),Et=h(function(t,e){return wt(t,e,!0)},"merge","Use `assign`."),St=1,Mt=/mobile|tablet|ip(ad|hone|od)|android/i,Ct="ontouchstart"in r,It=S(r,"PointerEvent")!==s,Ot=Ct&&Mt.test(navigator.userAgent),Tt="touch",Pt="pen",At="mouse",Lt="kinect",Nt=25,kt=1,Rt=2,Dt=4,Ft=8,Bt=1,jt=2,Ut=4,zt=8,Gt=16,Vt=jt|Ut,Xt=zt|Gt,Ht=Vt|Xt,qt=["x","y"],Yt=["clientX","clientY"];I.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(C(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(C(this.element),this.evWin,this.domHandler)}};var Wt={mousedown:kt,mousemove:Rt,mouseup:Dt},Zt="mousedown",Jt="mousemove mouseup";f(z,I,{handler:function(t){var e=Wt[t.type];e&kt&&0===t.button&&(this.pressed=!0),e&Rt&&1!==t.which&&(e=Dt),this.pressed&&(e&Dt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:At,srcEvent:t}))}});var Kt={pointerdown:kt,pointermove:Rt,pointerup:Dt,pointercancel:Ft,pointerout:Ft},Qt={2:Tt,3:Pt,4:At,5:Lt},$t="pointerdown",te="pointermove pointerup pointercancel";r.MSPointerEvent&&!r.PointerEvent&&($t="MSPointerDown",te="MSPointerMove MSPointerUp MSPointerCancel"),f(G,I,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=Kt[i],o=Qt[t.pointerType]||t.pointerType,a=o==Tt,s=x(e,t.pointerId,"pointerId");r&kt&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):r&(Dt|Ft)&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var ee={touchstart:kt,touchmove:Rt,touchend:Dt,touchcancel:Ft},ne="touchstart",ie="touchstart touchmove touchend touchcancel";f(V,I,{handler:function(t){var e=ee[t.type];if(e===kt&&(this.started=!0),this.started){var n=X.call(this,t,e);e&(Dt|Ft)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:Tt,srcEvent:t})}}});var re={touchstart:kt,touchmove:Rt,touchend:Dt,touchcancel:Ft},oe="touchstart touchmove touchend touchcancel";f(H,I,{handler:function(t){var e=re[t.type],n=q.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:Tt,srcEvent:t})}});var ae=2500,se=25;f(Y,I,{handler:function(t,e,n){var i=n.pointerType==Tt,r=n.pointerType==At;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)W.call(this,e,n);else if(r&&J.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ue=S(mt.style,"touchAction"),le=ue!==s,ce="compute",he="auto",fe="manipulation",de="none",pe="pan-x",ge="pan-y",ve=$();K.prototype={set:function(t){t==ce&&(t=this.compute()),le&&this.manager.element.style&&ve[t]&&(this.manager.element.style[ue]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return c(this.manager.recognizers,function(e){p(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Q(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var i=this.actions,r=_(i,de)&&!ve[de],o=_(i,ge)&&!ve[ge],a=_(i,pe)&&!ve[pe];if(r){var s=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(s&&u&&l)return}return a&&o?void 0:r||o&&n&Vt||a&&n&Xt?this.preventSrc(e):void 0},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var me=1,ye=2,_e=4,be=8,xe=be,we=16,Ee=32;tt.prototype={defaults:{},set:function(t){return gt(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(l(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=it(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return l(t,"dropRecognizeWith",this)?this:(t=it(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(l(t,"requireFailure",this))return this;var e=this.requireFail;return t=it(t,this),x(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(l(t,"dropRequireFailure",this))return this;t=it(t,this);var e=x(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){n.manager.emit(e,t)}var n=this,i=this.state;i<be&&e(n.options.event+et(i)),e(n.options.event),t.additionalEvent&&e(t.additionalEvent),i>=be&&e(n.options.event+et(i))},tryEmit:function(t){return this.canEmit()?this.emit(t):void(this.state=Ee)},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(Ee|me)))return!1;t++}return!0},recognize:function(t){var e=gt({},t);return p(this.options.enable,[this,e])?(this.state&(xe|we|Ee)&&(this.state=me),this.state=this.process(e),void(this.state&(ye|_e|be|we)&&this.tryEmit(e))):(this.reset(),void(this.state=Ee))},process:function(t){},getTouchAction:function(){},reset:function(){}},f(rt,tt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=e&(ye|_e),r=this.attrTest(t);return i&&(n&Ft||!r)?e|we:i||r?n&Dt?e|be:e&ye?e|_e:ye:Ee}}),f(ot,rt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ht},getTouchAction:function(){var t=this.options.direction,e=[];return t&Vt&&e.push(ge),t&Xt&&e.push(pe),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,a=t.deltaY;return r&e.direction||(e.direction&Vt?(r=0===o?Bt:o<0?jt:Ut,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===a?Bt:a<0?zt:Gt,n=a!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return rt.prototype.attrTest.call(this,t)&&(this.state&ye||!(this.state&ye)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=nt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),f(at,rt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&ye)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),f(st,tt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||t.eventType&(Dt|Ft)&&!r)this.reset();else if(t.eventType&kt)this.reset(),this._timer=u(function(){this.state=xe,this.tryEmit()},e.time,this);else if(t.eventType&Dt)return xe;return Ee},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===xe&&(t&&t.eventType&Dt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=xt(),this.manager.emit(this.options.event,this._input)))}}),f(ut,rt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[de]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&ye)}}),f(lt,rt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Vt|Xt,pointers:1},getTouchAction:function(){return ot.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(Vt|Xt)?e=t.overallVelocity:n&Vt?e=t.overallVelocityX:n&Xt&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&bt(e)>this.options.velocity&&t.eventType&Dt},emit:function(t){var e=nt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),f(ct,tt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fe]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&kt&&0===this.count)return this.failTimeout();if(i&&r&&n){if(t.eventType!=Dt)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||F(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t;var s=this.count%e.taps;if(0===s)return this.hasRequireFailures()?(this._timer=u(function(){this.state=xe,this.tryEmit()},e.interval,this),ye):xe}return Ee},failTimeout:function(){return this._timer=u(function(){this.state=Ee},this.options.interval,this),Ee},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==xe&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ht.VERSION="2.0.7",ht.defaults={domEvents:!1,touchAction:ce,enable:!0,inputTarget:null,inputClass:null,preset:[[ut,{enable:!1}],[at,{enable:!1},["rotate"]],[lt,{direction:Vt}],[ot,{direction:Vt},["swipe"]],[ct],[ct,{event:"doubletap",taps:2},["tap"]],[st]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Se=1,Me=2;ft.prototype={set:function(t){return gt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?Me:Se},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n,i=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&xe)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],e.stopped===Me||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&n.state&(ye|_e|be)&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof tt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(l(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(l(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=x(e,t);n!==-1&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==s&&e!==s){var n=this.handlers;return c(b(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==s){var n=this.handlers;return c(b(t),function(t){e?n[t]&&n[t].splice(x(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&pt(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&dt(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},gt(ht,{INPUT_START:kt,INPUT_MOVE:Rt,INPUT_END:Dt,INPUT_CANCEL:Ft,STATE_POSSIBLE:me,STATE_BEGAN:ye,STATE_CHANGED:_e,STATE_ENDED:be,STATE_RECOGNIZED:xe,STATE_CANCELLED:we,STATE_FAILED:Ee,DIRECTION_NONE:Bt,DIRECTION_LEFT:jt,DIRECTION_RIGHT:Ut,DIRECTION_UP:zt,DIRECTION_DOWN:Gt,DIRECTION_HORIZONTAL:Vt,DIRECTION_VERTICAL:Xt,DIRECTION_ALL:Ht,Manager:ft,Input:I,TouchAction:K,TouchInput:H,MouseInput:z,PointerEventInput:G,TouchMouseInput:Y,SingleTouchInput:V,Recognizer:tt,AttrRecognizer:rt,Tap:ct,Pan:ot,Swipe:lt,Pinch:at,Rotate:ut,Press:st,on:v,off:m,each:c,merge:Et,extend:wt,assign:gt,inherit:f,bindFn:d,prefixed:S});var Ce="undefined"!=typeof r?r:"undefined"!=typeof self?self:{};Ce.Hammer=ht,i=function(){return ht}.call(e,n,e,t),!(i!==s&&(t.exports=i))}(window,document,"Hammer")},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){var i=n(202),r=n(205),o=n(204),a=n(206),s=n(203),u=[0,0];t.exports.computeMiter=function(t,e,n,a,l){return i(t,n,a),o(t,t),r(e,-t[1],t[0]),r(u,-n[1],n[0]),l/s(e,u)},t.exports.normal=function(t,e){return r(t,-e[1],e[0]),t},t.exports.direction=function(t,e,n){return a(t,e,n),o(t,t),t}},function(t,e,n){function i(t,e,n){t.push([[e[0],e[1]],n])}var r=n(209),o=[0,0],a=[0,0],s=[0,0],u=[0,0];t.exports=function(t,e){var n=null,l=[];e&&(t=t.slice(),t.push(t[0]));for(var c=t.length,h=1;h<c;h++){var f=t[h-1],d=t[h],p=h<t.length-1?t[h+1]:null;if(r.direction(o,d,f),n||(n=[0,0],r.normal(n,o)),1===h&&i(l,n,1),p){r.direction(a,p,d);var g=r.computeMiter(s,u,o,a,1);i(l,u,g)}else r.normal(n,o),i(l,n,1)}if(t.length>2&&e){var v=t[c-2],m=t[0],y=t[1];r.direction(o,m,v),r.direction(a,y,m),r.normal(n,o);var _=r.computeMiter(s,u,o,a,1);l[0][0]=u.slice(),l[c-1][0]=u.slice(),l[0][1]=_,l[c-1][1]=_,l.pop()}return l}},function(t,e){"use strict";function n(t,e,o,a,s){for(o=o||0,a=a||t.length-1,s=s||r;a>o;){if(a-o>600){var u=a-o+1,l=e-o+1,c=Math.log(u),h=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*h*(u-h)/u)*(l-u/2<0?-1:1),d=Math.max(o,Math.floor(e-l*h/u+f)),p=Math.min(a,Math.floor(e+(u-l)*h/u+f));n(t,e,d,p,s)}var g=t[e],v=o,m=a;for(i(t,o,e),s(t[a],g)>0&&i(t,o,a);v<m;){for(i(t,v,m),v++,m--;s(t[v],g)<0;)v++;for(;s(t[m],g)>0;)m--}0===s(t[o],g)?i(t,o,m):(m++,i(t,m,a)),m<=e&&(o=m+1),e<=m&&(a=m-1)}}function i(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function r(t,e){return t<e?-1:t>e?1:0}t.exports=n},function(t,e,n){"use strict";function i(t,e){return this instanceof i?(this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),void this.clear()):new i(t,e)}function r(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,n,i,r){r||(r=v(null)),r.minX=1/0,r.minY=1/0,r.maxX=-(1/0),r.maxY=-(1/0);for(var o,a=e;a<n;a++)o=t.children[a],s(r,t.leaf?i(o):o);return r}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function f(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function d(t,e){var n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function p(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function g(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function v(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-(1/0),maxY:-(1/0)}}function m(t,e,n,i,r){for(var o,a=[e,n];a.length;)n=a.pop(),e=a.pop(),n-e<=i||(o=e+Math.ceil((n-e)/i/2)*i,y(t,o,e,n,r),a.push(e,o,o,n))}t.exports=i;var y=n(211);i.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!g(t,e))return n;for(var r,o,a,s,u=[];e;){for(r=0,o=e.children.length;r<o;r++)a=e.children[r],s=e.leaf?i(a):a,g(t,s)&&(e.leaf?n.push(a):p(t,s)?this._all(a,n):u.push(a));e=u.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!g(t,e))return!1;for(var i,r,o,a,s=[];e;){for(i=0,r=e.children.length;i<r;i++)if(o=e.children[i],a=e.leaf?n(o):o,g(t,a)){if(e.leaf||p(t,a))return!0;s.push(o)}e=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=v([]),this},remove:function(t,e){if(!t)return this;for(var n,i,o,a,s=this.data,u=this.toBBox(t),l=[],c=[];s||l.length;){if(s||(s=l.pop(),i=l[l.length-1],n=c.pop(),a=!0),s.leaf&&(o=r(t,s.children,e),o!==-1))return s.children.splice(o,1),l.push(s),this._condense(l),this;a||s.leaf||!p(s,u)?i?(n++,s=i.children[n],a=!1):s=null:(l.push(s),c.push(n),n=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:u,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var r,a=n-e+1,s=this._maxEntries;if(a<=s)return r=v(t.slice(e,n+1)),o(r,this.toBBox),r;i||(i=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,i-1))),r=v([]),r.leaf=!1,r.height=i;var u,l,c,h,f=Math.ceil(a/s),d=f*Math.ceil(Math.sqrt(s));for(m(t,e,n,d,this.compareMinX),u=e;u<=n;u+=d)for(c=Math.min(u+d-1,n),m(t,u,c,f,this.compareMinY),l=u;l<=c;l+=f)h=Math.min(l+f-1,c),r.children.push(this._build(t,l,h,i-1));return o(r,this.toBBox),r},_chooseSubtree:function(t,e,n,i){for(var r,o,a,s,u,l,h,d;;){if(i.push(e),e.leaf||i.length-1===n)break;for(h=d=1/0,r=0,o=e.children.length;r<o;r++)a=e.children[r],u=c(a),l=f(t,a)-u,l<d?(d=l,h=u<h?u:h,s=a):l===d&&u<h&&(h=u,s=a);e=s||e.children[0]}return e},_insert:function(t,e,n){var i=this.toBBox,r=n?t:i(t),o=[],a=this._chooseSubtree(r,this.data,e,o);for(a.children.push(t),s(a,r);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(r,o,e)},_split:function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var a=this._chooseSplitIndex(n,r,i),s=v(n.children.splice(a,n.children.length-a));s.height=n.height,s.leaf=n.leaf,o(n,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=v([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,r,o,s,u,l,h,f;for(l=h=1/0,i=e;i<=n-e;i++)r=a(t,0,i,this.toBBox),o=a(t,i,n,this.toBBox),s=d(r,o),u=c(r)+c(o),s<l?(l=s,f=i,h=u<h?u:h):s===l&&u<h&&(h=u,f=i);return f},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:u,r=t.leaf?this.compareMinY:l,o=this._allDistMargin(t,e,n,i),a=this._allDistMargin(t,e,n,r);o<a&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var r,o,u=this.toBBox,l=a(t,0,e,u),c=a(t,n-e,n,u),f=h(l)+h(c);for(r=e;r<n-e;r++)o=t.children[r],s(l,t.leaf?u(o):o),f+=h(l);for(r=n-e-1;r>=e;r--)o=t.children[r],s(c,t.leaf?u(o):o),f+=h(c);return f},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)s(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():o(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t,e){"use strict";function n(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return e>>>0}t.exports=n},function(t,e,n){var i=n(208),r=n(210),o=2;t.exports=function(t){function e(n,i){return this instanceof e?(t.BufferGeometry.call(this),Array.isArray(n)?i=i||{}:"object"==typeof n&&(i=n,n=[]),i=i||{},this.addAttribute("position",new t.BufferAttribute(void 0,3)),this.addAttribute("lineNormal",new t.BufferAttribute(void 0,2)),this.addAttribute("lineMiter",new t.BufferAttribute(void 0,1)),i.distances&&this.addAttribute("lineDistance",new t.BufferAttribute(void 0,1)),"function"==typeof this.setIndex?this.setIndex(new t.BufferAttribute(void 0,1)):this.addAttribute("index",new t.BufferAttribute(void 0,1)),void this.update(n,i.closed)):new e(n,i)}return i(e,t.BufferGeometry),e.prototype.update=function(t,e){t=t||[];var n=r(t,e);e&&(t=t.slice(),t.push(t[0]),n.push(n[0]));var i=this.getAttribute("position"),a=this.getAttribute("lineNormal"),s=this.getAttribute("lineMiter"),u=this.getAttribute("lineDistance"),l="function"==typeof this.getIndex?this.getIndex():this.getAttribute("index"),c=Math.max(0,6*(t.length-1));if(!i.array||t.length!==i.array.length/3/o){var h=t.length*o;i.array=new Float32Array(3*h),a.array=new Float32Array(2*h),s.array=new Float32Array(h),l.array=new Uint16Array(c),u&&(u.array=new Float32Array(h))}void 0!==i.count&&(i.count=h),i.needsUpdate=!0,void 0!==a.count&&(a.count=h),a.needsUpdate=!0,void 0!==s.count&&(s.count=h),s.needsUpdate=!0,void 0!==l.count&&(l.count=c),l.needsUpdate=!0,u&&(void 0!==u.count&&(u.count=h),u.needsUpdate=!0);var f=0,d=0,p=0,g=l.array;t.forEach(function(t,e,n){var r=f;if(g[d++]=r+0,g[d++]=r+1,g[d++]=r+2,g[d++]=r+2,g[d++]=r+1,g[d++]=r+3,i.setXYZ(f++,t[0],t[1],0),i.setXYZ(f++,t[0],t[1],0),u){var o=e/(n.length-1);u.setX(p++,o),u.setX(p++,o)}});var v=0,m=0;n.forEach(function(t){var e=t[0],n=t[1];a.setXY(v++,e[0],e[1]),a.setXY(v++,e[0],e[1]),s.setX(m++,-n),s.setX(m++,n)})},e}},function(t,e,n){t.exports=function(){return new Worker(n.p+"699f020579f0c3512a2d.worker.js")}},function(t,e){}]));
//# sourceMappingURL=ngr.min.js.map